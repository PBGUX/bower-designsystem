{"version":3,"sources":["../../../node_modules/tslib/tslib.es6.js","ng://pb-design-system/lib/dataviz/dataviz.service.ts","ng://pb-design-system/lib/dataviz/dataviz-pie.component.ts","ng://pb-design-system/lib/dataviz/dataviz-bar.component.ts","ng://pb-design-system/lib/dataviz/dataviz-line.component.ts","ng://pb-design-system/lib/dataviz/dataviz-gauge.component.ts","ng://pb-design-system/lib/dataviz/dataviz-sparkline.component.ts","ng://pb-design-system/lib/dataviz/dataviz-bar-stacked.component.ts","ng://pb-design-system/lib/dataviz/dataviz-metric-indicator.component.ts","ng://pb-design-system/lib/dataviz/dataviz-metric-block.component.ts","ng://pb-design-system/lib/dataviz/dataviz-bubble-map.component.ts","ng://pb-design-system/lib/dataviz/dataviz-heatmap.component.ts","ng://pb-design-system/lib/dataviz/dataviz-choropleth-map.component.ts","ng://pb-design-system/lib/dataviz/dataviz-bar-grouped.component.ts","ng://pb-design-system/lib/dataviz/dataviz-bar-single-horizontal.component.ts","ng://pb-design-system/lib/dataviz/dataviz.module.ts","ng://pb-design-system/lib/header-shadow/header-shadow.directive.ts","ng://pb-design-system/lib/header-shadow/header-shadow.module.ts","ng://pb-design-system/lib/daterange-popover/daterange-popover.service.ts","ng://pb-design-system/lib/daterange-popover/daterange-popover.component.ts","ng://pb-design-system/lib/daterange-popover/daterange-popover.module.ts","ng://pb-design-system/lib/progress-spinner/progress-spinner.component.ts","ng://pb-design-system/lib/progress-spinner/progress-spinner.module.ts"],"names":["extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__assign","assign","t","s","i","n","arguments","length","prototype","call","apply","this","__read","o","m","Symbol","iterator","r","e","ar","next","done","push","value","error","__spread","concat","PbdsDatavizService","_this","colors","classic","full","mono","twilight","ocean","sunset","getColors","theme","createGradientDefs","svg","vertical","color","gradient","append","attr","replace","createGlowFilter","glow","feOffsets","dy","slope","y","merge","x","d3Format","type","string","format","d3_format","d3_timeFormat","Injectable","args","providedIn","PbdsDatavizPieComponent","_dataviz","_element","chartClass","pieClass","width","monochrome","legendLabelFormatType","legendLabelFormatString","legendValueFormatString","tooltipLabelFormatType","tooltipLabelFormatString","tooltipValueFormatString","hovered","EventEmitter","clicked","currentData","updateChart","firstRun","selectAll","data","pie","join","enter","path","each","outerRadius","colorRange","label","nodes","splice","style","transition","duration","attrTween","arcEnterTween","update","tooltipHide","arcTween","exit","remove","on","index","pathMouseOver","d3_event","tooltipShow","chart","node","tooltipMove","pathMouseOut","pathClick","select","li","description","html","parsedTime","d3_isoParse","legendLabelFormat","legendValueFormat","legendMouseOverFocus","legendMouseOutBlur","emit","event","d3_interpolate","startAngle","endAngle","arc","arcExitTween","end","arcMouseOverTween","arcZoom","arcMouseOutTween","filter","classed","slices","slice","delay","tooltipSetPosition","percentage","Math","PI","tooltipLabelFormat","tooltip","tooltipValueFormat","coordinates","d3_mouse","ngOnInit","margin","top","right","bottom","left","height","innerRadius","min","anglePad","d3_scaleOrdinal","range","domain","map","c","d3_pie","padAngle","sort","d3_arc","padRadius","d3_select","nativeElement","ngOnChanges","changes","firstChange","ngOnDestroy","Component","selector","template","changeDetection","ChangeDetectionStrategy","OnPush","ElementRef","HostBinding","Input","Output","PbdsDatavizBarComponent","_scroll","_location","barClass","singleSeries","xAxisFormatType","xAxisFormatString","xAxisTitle","yAxisFormatType","yAxisFormatString","yAxisTicks","yAxisMinBuffer","yAxisMaxBuffer","hideLegend","legendWidth","legendPosition","tooltipValueFormatType","marginTop","marginRight","marginBottom","marginLeft","threshold","thresholdLabel","average","averageLabel","xAxisScale","yAxisScale","d3_min","d3_max","rangeRound","nice","xAxis","xAxisCall","yAxis","yAxisCall","hideXGrid","xGrid","xGridCall","hideYGrid","yGrid","yGridCall","hideGrayBars","substr","bandwidth","barMouseOver","barMouseOut","barMouseClick","insert","legendMouseOver","legendMouseOut","legendMouseClick","yThreshold","raise","yAverage","bar","barColor","dimensions","getBoundingClientRect","scroll","getScrollPosition","hideTooltipLabel","tooltipOffsetWidth","offsetWidth","tooltipOffsetHeight","offsetHeight","xAxisFormatter","item","xAxisFormat","parseDate","yAxisFormatter","yAxisFormat","hideXAxis","hideYAxis","hideXAxisZero","hideYAxisZero","hideXAxisDomain","hideYAxisDomain","hideTooltip","hideXAxisTicks","hideYAxisTicks","xAxisTickSize","xAxisTickSizeOuter","xAxisTitleMargin","yAxisTickSize","yAxisTickSizeOuter","d3_scaleBand","align","paddingInner","paddingOuter","d3_axisBottom","tickSize","tickSizeOuter","tickFormat","text","d3_scaleLinear","d3_axisLeft","ticks","ViewportScroller","Location","nextId","PbdsDatavizLineComponent","lineClass","area","xAxisTicks","tooltipHeadingFormatString","tooltipHovered","tooltipClicked","mouserect","d3_extent","dates","series","minVal","values","maxVal","clipPathId","lineWidth","array","fill","d3line","ease","d3_easeQuadInOut","d3area","linePoints","tooltipItem","mouserectMouseMove","mouseXDate","invert","leftIndex","d3_bisectLeft","d3_isoFormat","dateLower","Date","dateUpper","closestDate","closestIndex","indexOf","circles","tooltipLine","mousedata","date","mouserectMouseOut","mouserectMouseClick","position","mouserectDimensions","tooltipDimensions","dimensionCalculated","clientWidth","document","body","tooltipHeadingFormat","lineCurved","d3_line","curve","d3_curveCatmullRom","alpha","d3_area","y0","y1","d3_scaleTime","PbdsDatavizGaugeComponent","gaugeClass","hideLabel","labelFormatString","gaugeWidth","degreesToRadians","degree","calculateMinMax","minvalue","maxvalue","calculateCurve","start","drawChart","gauge","radius","labelTween","textTween","newAngle","interpolate","tween","oldValue","updatedNumber","labelFormat","max","rounded","cornerRadius","previousValue","PbdsDatavizSparklineComponent","sparklineClass","colorNegative","strokeWidth","line","barWidth_1","abs","PbdsDatavizBarStackedComponent","stackedBarClass","tooltipHeadingFormatType","tooltipHeadingValueFormatType","tooltipHeadingValueFormatString","dataKeys","keys","dataStack","d3_stack","order","d3_stackOrderNone","key","yAxisMax","grayBars","bars","mouseBars","yPosition","xPosition","total","tooltipHeadingValueFormat","PbdsDatavizMetricIndicatorComponent","class","indicator","inverse","defineProperty","PbdsDatavizMetricBlockComponent","heading","unit","centered","centeredText","infoMessage","hideValueMargin","isPercentUnit","isUnit","indicatorRef","ContentChild","static","DatavizBubbleMapComponent","bubbleMapClass","feature","scale","center","dot","textColor","textSizeRange","dotSize","bubbleSizeRange","bubbleLabelFormatType","bubbleLabelFormatString","hideTooltipValue","bubbleContainer","projection","longitude","latitude","sqrt","bubbleRadius","bubbleMouseOver","bubbleMouseOut","bubbleMouseClick","bubbleLabelFormat","round","fontRange","projectionType","d3_geoAlbers","d3_geoAlbersUsa","d3_geoMercator","topojsonFeature","topojson.feature","topojson","objects","fitSize","geoPath","d3_geoPath","features","datum","topojson.mesh","a","PbdsDatavizHeatmapComponent","heatmapClass","tooltipXLabelFormatType","tooltipXLabelFormatString","tooltipYLabelFormatType","tooltipYLabelFormatString","undefined","xLabel","yLabel","blockMouseOver","blockMouseOut","blockMouseClick","colorDomain","tooltipYLabelFormat","tooltipXLabelFormat","reverse","colorValues","d3_scaleThreshold","d3_scaleQuantile","quantiles","d3_scaleQuantize","thresholds","xAxisLabels","Set","yAxisLabels","tslib_1.__spread","PbdsDatavizChoroplethMapComponent","choroplethMapClass","dataField","mesh","colorScale","legendLabel","legendValueFormatType","legendLeft","legendTop","match","find","obj","some","featureMouseOver","featureMouseOut","featureMouseClick","mouse","mouseLeft","mouseTop","geometry","geometryLeft","geometryTop","scrollTop","legend","g","tickValues","d3_range","PbdsDatavizBarGroupedComponent","groupedBarClass","xAxisMaxBuffer","showGrid","clone","d3_values","barScale","updateChartVertical","xAxisMax","updateChartHorizontal","parentIndex","updateLegend","legendData","legendKeys","PbdsDatavizBarSingleHorizontalComponent","singleStackedBarClass","nullValueText","barMargin","xAxisTickLabelSuffix","hideLegendTooltip","tooltipDateFormatString","tooltipValueSuffix","tooltipPercentFormatString","compareChangeFormatString","isSingleData","isCompare","barPadding","d3_sum","comparePercentage","compareValue","tooltipLabel","tooltipCompareDaterangeMargin","tooltipCompareDaterange","tooltipCompareValue","tooltipDaterangeMargin","tooltipDaterange","tooltipValue","tooltipIndicator","compareStartDate","compareEndDate","tooltipDateFormat","tooltipPercentFormat","comparveValue","startDate","endDate","compareChangeDirection","compareChangeInverse","tooltipCompareChangeFormat","compareChangeValue","barHover","includes","ceil","sumValues","isLastBarZero","lastBarZeroCount","cloneData","isLast","forEach","Number","isInteger","reduce","acc","d3_easeLinear","sign","PbdsDatavizModule","NgModule","declarations","imports","CommonModule","NgbTooltipModule","exports","PbdsHeaderShadowDirective","onWindowScroll","offset","shadow","Directive","HostListener","PbdsHeaderShadowModule","PbdsDaterangeService","localeId","locale","toLowerCase","setLocale","language","country","registerLocaleData","getCurrentLocale","Inject","LOCALE_ID","CustomDatepickerI18n","_super","daterangeService","__","constructor","create","tslib_1.__extends","getWeekdayShortName","weekday","getLocaleDayNames","FormStyle","Standalone","TranslationWidth","Abbreviated","getMonthShortName","month","getLocaleMonthNames","Wide","getMonthFullName","getDayAriaLabel","day","year","NgbDatepickerI18n","PbdsDaterangePopoverComponent","calendar","presets","presetSelected","filterSelected","showCustomPreset","applyText","cancelText","customRangeText","minDate","getPrev","getToday","maxDate","fromDate","toDate","inputFormat","change","firstDayOfWeek","getLocaleFirstDayOfWeek","dateRange","isDatepickerVisible","presetSelect","$event","isHovered","hoveredDate","after","before","isInside","isRange","equals","showDatepicker","filters","selectedFilter","presetClick","setInputLabel","formattedDate","dateFormat","field","datepickerPopup","close","cancel","onDateSelection","preset","getFormattedDate","getLocaleDateFormat","FormatWidth","Short","formatDate","onFilterChange","setPreset","setFilter","setDateRange","NgbDate","findIndex","f","selected","providers","provide","useClass","NgbCalendar","ViewChild","PbdsDaterangePopoverModule","FormsModule","MatRadioModule","NgbDatepickerModule","NgbPopoverModule","NgbDropdownModule","PbdsProgressSpinnerComponent","PbdsProgressSpinnerModule"],"mappings":"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","sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","import { Injectable } from '@angular/core';\n\nimport { format as d3_format, timeFormat as d3_timeFormat } from 'd3';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class PbdsDatavizService {\n  private colors = {\n    classic: {\n      full: [\n        '#B70077',\n        '#0384D4',\n        '#EE6B0B',\n        '#A319B1',\n        '#11A611',\n        '#1BB9FF',\n        '#495A9C',\n        '#EDB700',\n        '#8B98C8',\n        '#E6C49C',\n        '#CCB8CE',\n        '#9B9B9B'\n      ],\n      mono: ['#001D56', '#003296', '#4B74C5', '#89A1D0', '#A3BCEE', '#C9D7F3'] // blue\n    },\n    twilight: {\n      full: [\n        '#A319B1',\n        '#11A611',\n        '#1BB9FF',\n        '#EE6B0B',\n        '#B70077',\n        '#0384D4',\n        '#495A9C',\n        '#EDB700',\n        '#8B98C8',\n        '#E6C49C',\n        '#CCB8CE',\n        '#9B9B9B'\n      ],\n      mono: ['#05395C', '#0A5B92', '#0072B8', '#5DA9DC', '#A5D4F3', '#D1EDFF'] // light blue\n    },\n    ocean: {\n      full: [\n        '#0384D4',\n        '#B70077',\n        '#1BB9FF',\n        '#495A9C',\n        '#EDB700',\n        '#A319B1',\n        '#EE6B0B',\n        '#11A611',\n        '#8B98C8',\n        '#E6C49C',\n        '#CCB8CE',\n        '#9B9B9B'\n      ],\n      mono: ['#394B4D', '#3A6B6E', '#14767D', '#99BFC2', '#C9E6E8', '#DEECED'] // blue-green\n    },\n    sunset: {\n      full: [\n        '#B70077',\n        '#EE6B0B',\n        '#1BB9FF',\n        '#EDB700',\n        '#11A611',\n        '#A319B1',\n        '#0384D4',\n        '#CCB8CE',\n        '#495A9C',\n        '#E6C49C',\n        '#8B98C8',\n        '#9B9B9B'\n      ],\n      mono: ['#31254A', '#50248F', '#7945C4', '#9A79E2', '#C4A8FF', '#D9C7FF'] // purple\n    }\n  };\n\n  constructor() {}\n\n  getColors = (mono = false, theme = 'classic') => {\n    return mono ? this.colors[theme].mono : this.colors[theme].full;\n  };\n\n  createGradientDefs = (svg, mono = false, theme = 'classic', vertical = true) => {\n    const colors = mono ? [this.colors[theme].mono[2]] : this.colors[theme].full;\n\n    for (let i = 0; i < colors.length; i++) {\n      const color = mono ? this.colors[theme].mono[2] : this.colors[theme].full[i];\n      let gradient;\n\n      if (vertical) {\n        gradient = svg\n          .append('defs')\n          .append('linearGradient')\n          .attr('id', `gradient-${color.replace('#', '')}`)\n          .attr('x1', '0')\n          .attr('y1', '0')\n          .attr('x2', '0')\n          .attr('y2', '1')\n          .attr('spreadMethod', 'pad');\n\n        gradient\n          .append('stop')\n          .attr('offset', '0%')\n          .attr('stop-color', color)\n          .attr('stop-opacity', '1'); // top of bar will be full opacity\n\n        gradient\n          .append('stop')\n          .attr('offset', '100%')\n          .attr('stop-color', color)\n          .attr('stop-opacity', '.3'); // bottom of bar will be .3 opacity\n      } else {\n        gradient = svg\n          .append('defs')\n          .append('linearGradient')\n          .attr('id', `gradient-horizontal-${color.replace('#', '')}`)\n          .attr('x1', '1')\n          .attr('y1', '0')\n          .attr('x2', '0')\n          .attr('y2', '0')\n          .attr('spreadMethod', 'pad');\n\n        gradient\n          .append('stop')\n          .attr('offset', '0%')\n          .attr('stop-color', color)\n          .attr('stop-opacity', '1'); // top of bar will be full opacity\n\n        gradient\n          .append('stop')\n          .attr('offset', '100%')\n          .attr('stop-color', color)\n          .attr('stop-opacity', '.3'); // bottom of bar will be .3 opacity\n      }\n    }\n\n    return colors;\n  };\n\n  createGlowFilter = svg => {\n    // add a new definition\n    const glow = svg\n      .append('defs')\n      .append('filter')\n      .attr('id', 'glow')\n      .attr('width', '200%')\n      .attr('height', '200%');\n\n    glow\n      .append('feGaussianBlur')\n      .attr('in', 'SourceGraphic')\n      .attr('stdDeviation', 4);\n\n    // build two dropshadows with different intensities\n    const feOffsets = [\n      {\n        dy: 2,\n        slope: 0.2\n      },\n      {\n        dy: 5,\n        slope: 0.05\n      }\n    ];\n\n    for (let i = 0; i < feOffsets.length; i++) {\n      glow\n        .append('feOffset')\n        .attr('result', 'offsetBlur' + i)\n        .attr('dx', 0)\n        .attr('dy', feOffsets[i].dy);\n    }\n\n    for (let y = 0; y < feOffsets.length; y++) {\n      glow\n        .append('feComponentTransfer')\n        .attr('result', 'coloredBlur' + y)\n        .attr('in', 'offsetBlur' + y)\n        .append('feFuncA')\n        .attr('type', 'linear')\n        .attr('slope', feOffsets[y].slope);\n    }\n\n    const merge = glow.append('feMerge');\n\n    merge.append('feMergeNode').attr('in', 'SourceGraphic');\n\n    for (let x = 0; x < feOffsets.length; x++) {\n      merge.append('feMergeNode').attr('in', 'coloredBlur' + x);\n    }\n  };\n\n  d3Format(type: string, string: string) {\n    let format;\n\n    switch (type) {\n      case 'number':\n        format = d3_format(string);\n        break;\n      case 'time':\n        format = d3_timeFormat(string);\n        break;\n      default:\n        format = null;\n        break;\n    }\n\n    return format;\n  }\n}\n","import {\n  Component,\n  OnInit,\n  Input,\n  ElementRef,\n  HostBinding,\n  OnChanges,\n  SimpleChanges,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  OnDestroy\n} from '@angular/core';\n\nimport { select as d3_select, mouse as d3_mouse, event as d3_event } from 'd3-selection';\nimport { scaleOrdinal as d3_scaleOrdinal } from 'd3-scale';\nimport { pie as d3_pie, arc as d3_arc } from 'd3-shape';\nimport { interpolate as d3_interpolate } from 'd3-interpolate';\nimport { format as d3_format } from 'd3-format';\nimport { isoParse as d3_isoParse } from 'd3-time-format';\n\nimport { PbdsDatavizService } from './dataviz.service';\nimport { PbdsDatavizPie } from './dataviz.interfaces';\n\n@Component({\n  selector: 'pbds-dataviz-pie',\n  template: ``,\n  styleUrls: [],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class PbdsDatavizPieComponent implements OnInit, OnChanges, OnDestroy {\n  @HostBinding('class.pbds-chart')\n  chartClass = true;\n\n  @HostBinding('class.pbds-chart-pie')\n  pieClass = true;\n\n  @Input()\n  data: Array<PbdsDatavizPie>;\n\n  @Input()\n  width = 300;\n\n  @Input()\n  type: 'pie' | 'donut' = 'pie';\n\n  @Input()\n  monochrome = false;\n\n  @Input()\n  legendLabelFormatType: 'time' = null;\n\n  @Input()\n  legendLabelFormatString = '';\n\n  @Input()\n  legendValueFormatString = '';\n\n  @Input()\n  tooltipLabelFormatType: 'time' = null;\n\n  @Input()\n  tooltipLabelFormatString = '';\n\n  @Input()\n  tooltipValueFormatString = '';\n\n  @Input()\n  theme;\n\n  @Output()\n  hovered: EventEmitter<object> = new EventEmitter<object>();\n\n  @Output()\n  clicked: EventEmitter<object> = new EventEmitter<object>();\n\n  private currentData = [];\n  private height;\n  private chart;\n  private margin;\n  private colors;\n  private colorRange;\n  private arc;\n  private arcZoom;\n  private svg;\n  private pie;\n  private legendLabelFormat;\n  private legendValueFormat;\n  private innerRadius;\n  private anglePad;\n  private outerRadius;\n  private tooltip;\n  private tooltipLabelFormat;\n  private tooltipValueFormat;\n\n  constructor(private _dataviz: PbdsDatavizService, private _element: ElementRef) {}\n\n  ngOnInit() {\n    this.margin = { top: 10, right: 10, bottom: 10, left: 10 };\n    this.width = this.width - this.margin.left - this.margin.right;\n    this.height = this.width - this.margin.top - this.margin.bottom;\n    this.colors = this._dataviz.getColors(this.monochrome, this.theme);\n    this.innerRadius = Math.min(this.width, this.height) / 2.5;\n    this.outerRadius = Math.min(this.width, this.height) / 2;\n    this.arcZoom = 10;\n    this.anglePad = 0.02;\n    this.legendValueFormat = d3_format(this.legendValueFormatString);\n    this.tooltipValueFormat = d3_format(this.tooltipValueFormatString);\n\n    // create formatters\n    this.legendLabelFormat = this._dataviz.d3Format(this.legendLabelFormatType, this.legendLabelFormatString);\n    this.tooltipLabelFormat = this._dataviz.d3Format(this.tooltipLabelFormatType, this.tooltipLabelFormatString);\n\n    this.colorRange = d3_scaleOrdinal()\n      .range(this.colors)\n      .domain(this.data.map(c => c.label));\n\n    if (this.type === 'pie') {\n      this.innerRadius = 0;\n      this.anglePad = 0;\n    }\n\n    this.pie = d3_pie()\n      .padAngle(this.anglePad)\n      .value((d: any) => d.value)\n      .sort(null);\n\n    this.arc = d3_arc()\n      .padRadius(this.outerRadius)\n      .innerRadius(this.innerRadius);\n\n    this.chart = d3_select(this._element.nativeElement).attr('aria-hidden', 'true');\n\n    this.svg = this.chart\n      .append('svg')\n      .attr('width', this.width)\n      .attr('height', this.height)\n      .attr('class', 'img-fluid')\n      .attr('preserveAspectRatio', 'xMinYMin meet')\n      .attr(\n        'viewBox',\n        `-${this.width / 2 + this.margin.left} -${this.height / 2 + this.margin.top} ${this.width +\n          this.margin.left +\n          this.margin.right} ${this.height + this.margin.top + this.margin.bottom}`\n      );\n\n    this.chart.append('ul').attr('class', 'legend legend-right');\n\n    this.tooltip = this.chart\n      .append('div')\n      .style('opacity', 0)\n      .attr('class', 'pbds-tooltip')\n      .attr('aria-hidden', 'true');\n\n    this.updateChart();\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    if (changes.data && !changes.data.firstChange) {\n      this.updateChart(false);\n    }\n  }\n\n  ngOnDestroy() {\n    if (this.tooltip) this.tooltip.remove();\n  }\n\n  updateChart = (firstRun = true) => {\n    // slices\n    this.svg\n      .selectAll('path')\n      .data(this.pie(this.data))\n      .join(\n        enter => {\n          const path = enter.append('path');\n\n          path\n            .each((d: any) => (d.outerRadius = this.outerRadius))\n            .attr('fill', (d: any) => this.colorRange(d.data.label))\n            .attr('class', 'slice')\n            .each((d, i, nodes) => {\n              this.currentData.splice(i, 1, d);\n            });\n\n          if (this.type === 'pie') {\n            path\n              .style('stroke', '#fff')\n              .style('stroke-width', 2)\n              .style('stroke-alignment', 'inner');\n          }\n\n          path.call(path =>\n            path\n              .transition()\n              .duration((d, i, n) => (firstRun ? 0 : 500))\n              .attrTween('d', this.arcEnterTween)\n          );\n\n          return path;\n        },\n        update => {\n          this.tooltipHide();\n\n          update\n            .each((d: any) => (d.outerRadius = this.outerRadius))\n            .call(update =>\n              update\n                .transition()\n                .duration(500)\n                .attrTween('d', this.arcTween)\n            );\n          return update;\n        },\n        exit => exit.remove()\n      )\n      .on('mouseover', (data, index, nodes) => {\n        this.pathMouseOver(d3_event, data, index, nodes);\n        // this.tooltipShow(this.chart.node(), data);\n      })\n      .on('mousemove', (data, index, nodes) => {\n        this.tooltipShow(this.chart.node(), data);\n        this.tooltipMove(this.chart.node());\n      })\n      .on('mouseout', (data, index, nodes) => {\n        this.pathMouseOut(data, index, nodes);\n        this.tooltipHide();\n      })\n      .on('click', (data, index, nodes) => {\n        this.pathClick(d3_event, data, index, nodes);\n      });\n\n    // legend\n    this.chart\n      .select('.legend')\n      .selectAll('.legend-item')\n      .data(this.data)\n      .join(\n        enter => {\n          const li = enter.append('li').attr('class', 'legend-item');\n\n          li.append('span')\n            .attr('class', 'legend-key')\n            .style('background-color', (d: any) => this.colorRange(d.label));\n\n          const description = li.append('span').attr('class', 'legend-description');\n\n          description\n            .append('span')\n            .attr('class', 'legend-label')\n            .html((d: any) => {\n              switch (this.legendLabelFormatType) {\n                case 'time':\n                  const parsedTime = d3_isoParse(d.label);\n                  return this.legendLabelFormat(parsedTime);\n\n                default:\n                  return d.label;\n              }\n            });\n\n          description\n            .append('span')\n            .attr('class', 'legend-value')\n            .html((d: any) => this.legendValueFormat(d.value));\n\n          return li;\n        },\n        update => {\n          update.selectAll('.legend-key').style('background-color', (d: any) => this.colorRange(d.label));\n\n          update.select('.legend-label').html((d: any) => {\n            switch (this.legendLabelFormatType) {\n              case 'time':\n                const parsedTime = d3_isoParse(d.label);\n                return this.legendLabelFormat(parsedTime);\n\n              default:\n                return d.label;\n            }\n          });\n\n          update.select('.legend-value').html((d: any) => this.legendValueFormat(d.value));\n\n          return update;\n        },\n        exit => exit.remove()\n      )\n\n      .on('mouseover focus', (data, index, nodes) => {\n        this.legendMouseOverFocus(data, index, nodes);\n        this.pathMouseOver(d3_event, data, index, nodes);\n      })\n      .on('mouseout blur', (data, index, nodes) => {\n        this.legendMouseOutBlur(data, index, nodes);\n        this.pathMouseOut(data, index, nodes);\n      })\n      .on('click', (data, index, nodes) => {\n        this.clicked.emit({ event: d3_event, data: data });\n      });\n  };\n\n  private arcEnterTween = (data, index, nodes) => {\n    const i = d3_interpolate(data.startAngle, data.endAngle);\n    return t => {\n      data.endAngle = i(t);\n      return this.arc(data);\n    };\n  };\n\n  private arcTween = (data, index, nodes) => {\n    // console.log('ARGS: ', data, index, nodes);\n    const i = d3_interpolate(this.currentData[index], data);\n\n    this.currentData[index] = i(1);\n    return t => this.arc(i(t));\n  };\n\n  private arcExitTween = (data, index, nodes) => {\n    const end = Object.assign({}, this.currentData[index], { startAngle: this.currentData[index].endAngle });\n    const i = d3_interpolate(data, end);\n\n    return t => {\n      return this.arc(i(t));\n    };\n  };\n\n  private arcMouseOverTween = (data, index, nodes) => {\n    const i = d3_interpolate(data.outerRadius, this.outerRadius + this.arcZoom);\n\n    return t => {\n      data.outerRadius = i(t);\n      return this.arc(data);\n    };\n  };\n\n  private arcMouseOutTween = (data, index, nodes) => {\n    const i = d3_interpolate(data.outerRadius, this.outerRadius);\n    return t => {\n      data.outerRadius = i(t);\n      return this.arc(data);\n    };\n  };\n\n  private legendMouseOverFocus = (data, index, nodes) => {\n    this.chart\n      .selectAll('.legend-item')\n      .filter((d, i) => i !== index)\n      .classed('inactive', true);\n  };\n\n  private legendMouseOutBlur = (data, index, nodes) => {\n    this.chart.selectAll('.legend-item').classed('inactive', false);\n  };\n\n  private pathMouseOver = (event, data, index, nodes) => {\n    const slices = this.chart.selectAll('.slice');\n    const slice = slices.filter((d, i) => i === index);\n\n    this.chart\n      .selectAll('.legend-item')\n      .filter((d, i) => i !== index)\n      .classed('inactive', true);\n\n    slices.filter((d, i) => i !== index).classed('inactive', true);\n\n    slice\n      .transition()\n      .duration(300)\n      .delay(0)\n      .attrTween('d', this.arcMouseOverTween);\n\n    this.hovered.emit({\n      event: event,\n      data: data.data ? data.data : data // legend hover data is different than slice hover data\n    });\n  };\n\n  private pathMouseOut = (data, index, value) => {\n    const slices = this.chart.selectAll('.slice');\n    const slice = slices.filter((d, i) => i === index);\n\n    this.chart\n      .selectAll('.legend-item')\n      .filter((d, i) => i !== index)\n      .classed('inactive', false);\n\n    slices.classed('inactive', false);\n\n    slice\n      .transition()\n      .duration(300)\n      .delay(0)\n      .attrTween('d', this.arcMouseOutTween);\n  };\n\n  private pathClick = (event, data, index, nodes) => {\n    this.clicked.emit({\n      event: event,\n      data: data.data\n    });\n  };\n\n  private tooltipShow = (node, data) => {\n    this.tooltipSetPosition(node);\n\n    const percentage = (data.endAngle - data.startAngle) / (2 * Math.PI);\n    let label;\n\n    switch (this.tooltipLabelFormatType) {\n      case 'time':\n        const parsedTime = d3_isoParse(data.data.label);\n        label = this.tooltipLabelFormat(parsedTime);\n        break;\n\n      default:\n        label = data.data.label;\n    }\n\n    this.tooltip.html(\n      `\n        <div class=\"tooltip-label\">${label}</div>\n        <div class=\"tooltip-value\">${this.tooltipValueFormat(percentage)}</div>\n      `\n    );\n\n    this.tooltip.style('opacity', 1);\n  };\n\n  private tooltipMove = node => {\n    this.tooltipSetPosition(node);\n  };\n\n  private tooltipHide = () => {\n    this.tooltip.style('opacity', 0);\n  };\n\n  private tooltipSetPosition = node => {\n    const coordinates = d3_mouse(node);\n\n    this.tooltip.style('left', `${coordinates[0] + 16}px`);\n    this.tooltip.style('top', `${coordinates[1] + 16}px`);\n  };\n}\n","import {\n  Component,\n  OnInit,\n  OnChanges,\n  Input,\n  Output,\n  EventEmitter,\n  ElementRef,\n  HostBinding,\n  OnDestroy,\n  SimpleChanges,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { ViewportScroller, Location } from '@angular/common';\n\nimport { select as d3_select, event as d3_event } from 'd3-selection';\nimport { scaleOrdinal as d3_scaleOrdinal, scaleLinear as d3_scaleLinear, scaleBand as d3_scaleBand } from 'd3-scale';\nimport { min as d3_min, max as d3_max } from 'd3-array';\nimport { axisBottom as d3_axisBottom, axisLeft as d3_axisLeft } from 'd3-axis';\nimport { isoParse as d3_isoParse } from 'd3-time-format';\n\nimport { PbdsDatavizService } from './dataviz.service';\nimport { PbdsDatavizBar } from './dataviz.interfaces';\n\n@Component({\n  selector: 'pbds-dataviz-bar',\n  template: ``,\n  styles: [],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class PbdsDatavizBarComponent implements OnInit, OnDestroy, OnChanges {\n  @HostBinding('class.pbds-chart')\n  chartClass = true;\n\n  @HostBinding('class.pbds-chart-bar')\n  barClass = true;\n\n  @Input()\n  data: PbdsDatavizBar[];\n\n  @Input()\n  width = 306;\n\n  @Input()\n  height = 400;\n\n  @Input()\n  type: 'low' | 'medium' | 'high' | 'debug' = 'medium'; // debug to show all chart options\n\n  @Input()\n  singleSeries = false;\n\n  @Input()\n  xAxisFormatType: 'number' | 'time' = null;\n\n  @Input()\n  xAxisFormatString = '';\n\n  @Input()\n  xAxisTitle: string | null = null;\n\n  @Input()\n  yAxisFormatType: 'number' | 'time' = null;\n\n  @Input()\n  yAxisFormatString = '';\n\n  @Input()\n  yAxisTicks = 5;\n\n  @Input()\n  yAxisMinBuffer = 0.01;\n\n  @Input()\n  yAxisMaxBuffer = 0.01;\n\n  @Input()\n  hideLegend = false;\n\n  @Input()\n  legendWidth = 105 + 28; // hardcoded legend width + left margin, do not document until feedback\n\n  @Input()\n  legendPosition: 'right' | 'bottom' = 'right';\n\n  @Input()\n  legendLabelFormatType: 'number' | 'time' = null;\n\n  @Input()\n  legendLabelFormatString = '';\n\n  @Input()\n  tooltipLabelFormatType: 'number' | 'time' = null;\n\n  @Input()\n  tooltipLabelFormatString = '';\n\n  @Input()\n  tooltipValueFormatType: 'number' | 'time' = null;\n\n  @Input()\n  tooltipValueFormatString = '';\n\n  @Input()\n  marginTop = 10; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  marginRight = 0; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  marginBottom = 30; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  marginLeft = 55; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  threshold = null;\n\n  @Input()\n  thresholdLabel = 'Threshold';\n\n  @Input()\n  average = null;\n\n  @Input()\n  averageLabel = 'Average';\n\n  @Input()\n  theme;\n\n  @Output()\n  hovered: EventEmitter<object> = new EventEmitter<object>();\n\n  @Output()\n  clicked: EventEmitter<object> = new EventEmitter<object>();\n\n  private chart;\n  private svg;\n  private margin;\n  private colorRange;\n  private hideGrayBars: boolean;\n  private yThreshold;\n  private yAverage;\n  private xAxisScale;\n  private xAxisCall;\n  private xAxis;\n  private xAxisFormat;\n  private xAxisTitleMargin: number;\n  private yAxisScale;\n  private yAxisCall;\n  private yAxis;\n  private yAxisFormat;\n  private xGrid;\n  private xGridCall;\n  private yGrid;\n  private yGridCall;\n  private xAxisTickSize: number;\n  private xAxisTickSizeOuter: number;\n  private yAxisTickSize: number;\n  private yAxisTickSizeOuter: number;\n  private hideXAxis: boolean;\n  private hideYAxis: boolean;\n  private hideXAxisDomain: boolean;\n  private hideYAxisDomain: boolean;\n  private hideXAxisZero: boolean;\n  private hideYAxisZero: boolean;\n  private hideXGrid: boolean;\n  private hideYGrid: boolean;\n  private hideXAxisTicks: boolean;\n  private hideYAxisTicks: boolean;\n  private legendLabelFormat;\n  private tooltip;\n  private hideTooltip: boolean;\n  private hideTooltipLabel: boolean;\n  private tooltipValueFormat;\n  private tooltipLabelFormat;\n\n  constructor(\n    private _dataviz: PbdsDatavizService,\n    private _element: ElementRef,\n    private _scroll: ViewportScroller,\n    private _location: Location\n  ) {}\n\n  ngOnInit() {\n    this.margin = {\n      top: +this.marginTop,\n      right: +this.marginRight,\n      bottom: +this.marginBottom,\n      left: +this.marginLeft\n    };\n\n    // create formatters\n    this.xAxisFormat = this._dataviz.d3Format(this.xAxisFormatType, this.xAxisFormatString);\n    this.yAxisFormat = this._dataviz.d3Format(this.yAxisFormatType, this.yAxisFormatString);\n    this.legendLabelFormat = this._dataviz.d3Format(this.legendLabelFormatType, this.legendLabelFormatString);\n    this.tooltipLabelFormat = this._dataviz.d3Format(this.tooltipLabelFormatType, this.tooltipLabelFormatString);\n    this.tooltipValueFormat = this._dataviz.d3Format(this.tooltipValueFormatType, this.tooltipValueFormatString);\n\n    // defaults for all chart types\n    this.hideGrayBars = false;\n    this.hideXAxis = false;\n    this.hideYAxis = false;\n    this.hideXAxisZero = false;\n    this.hideYAxisZero = false;\n    this.hideXGrid = false;\n    this.hideYGrid = false;\n    this.hideXAxisDomain = false;\n    this.hideYAxisDomain = false;\n    this.hideTooltip = false;\n    this.hideXAxisTicks = false;\n    this.hideYAxisTicks = false;\n    this.xAxisTickSize = 8;\n    this.xAxisTickSizeOuter = 0;\n    this.xAxisTitleMargin = this.xAxisTitle ? 20 : 0;\n    this.yAxisTickSize = 8;\n    this.yAxisTickSizeOuter = 0;\n    this.hideTooltipLabel = false;\n\n    if (this.type !== 'debug') {\n      // set type defaults\n      switch (this.type) {\n        case 'low':\n          this.hideGrayBars = true;\n          this.hideXAxis = !this.hideLegend;\n          this.hideXAxisTicks = true;\n          this.hideXGrid = true;\n          this.hideYAxisDomain = false;\n          this.hideYAxisTicks = true;\n          this.legendPosition = 'bottom';\n          this.hideTooltipLabel = true;\n          break;\n\n        case 'medium':\n          this.hideXAxisDomain = true;\n          this.hideXAxis = !this.hideLegend;\n          this.hideXGrid = true;\n          this.hideXAxisTicks = true;\n          this.hideYAxisDomain = true;\n          this.hideYAxisTicks = true;\n          this.hideYGrid = true;\n          this.hideTooltipLabel = true;\n          break;\n\n        case 'high':\n          this.hideXAxis = true;\n          this.hideXAxisDomain = true;\n          this.hideXGrid = true;\n          this.hideYAxisDomain = true;\n          this.hideYAxisTicks = true;\n          this.hideYGrid = true;\n          this.hideLegend = true;\n          this.hideTooltipLabel = false;\n          break;\n      }\n\n      // single series overrides\n      if (this.singleSeries) {\n        this.hideLegend = true;\n        this.hideXAxis = true;\n        this.hideXGrid = true;\n        this.hideTooltipLabel = false;\n      }\n    }\n\n    // adjust margin if xAxis hidden\n    if (this.hideXAxis) this.margin.bottom = 10; // need small margin for yAxis with 0 tick label\n\n    if (!this.hideLegend && this.legendPosition === 'right') {\n      this.width = +this.width - +this.legendWidth;\n    }\n\n    // create the chart\n    this.chart = d3_select(this._element.nativeElement).attr('aria-hidden', 'true');\n\n    // create chart svg\n    this.svg = this.chart\n      .append('svg')\n      .attr('width', +this.width)\n      .attr('height', +this.height + this.margin.top + this.margin.bottom + this.xAxisTitleMargin)\n      .attr('class', 'img-fluid')\n      .attr('preserveAspectRatio', 'xMinYMin meet')\n      .attr(\n        'viewBox',\n        `-${this.margin.left} -${this.margin.top} ${+this.width} ${+this.height +\n          this.margin.top +\n          this.margin.bottom +\n          this.xAxisTitleMargin}`\n      );\n\n    // build color ranges\n    this.colorRange = d3_scaleOrdinal().range(\n      this._dataviz.createGradientDefs(this.svg, this.singleSeries, this.theme)\n    );\n\n    // X AXIS\n    this.xAxisScale = d3_scaleBand()\n      .domain(this.data.map(d => d.label))\n      .rangeRound([0, this.width - this.margin.left])\n      .align(0);\n\n    // add padding to the scale for gray bars\n    !this.hideGrayBars\n      ? this.xAxisScale.paddingInner(0.1).paddingOuter(0)\n      : this.xAxisScale.paddingInner(0).paddingOuter(0);\n\n    this.xAxisCall = d3_axisBottom(this.xAxisScale)\n      .tickSize(this.xAxisTickSize)\n      .tickSizeOuter(this.xAxisTickSizeOuter)\n      .tickFormat(this.xAxisFormatter);\n\n    this.xAxis = this.svg\n      .append('g')\n      .attr('class', 'axis axis-x')\n      .attr('transform', `translate(0, ${this.height})`)\n      .classed('axis-hidden', this.hideXAxis)\n      .classed('axis-zero-hidden', this.hideXAxisZero)\n      .classed('axis-domain-hidden', this.hideXAxisDomain)\n      .classed('axis-ticks-hidden', this.hideXAxisTicks)\n      .call(this.xAxisCall);\n\n    // X GRIDLINES\n    if (!this.hideXGrid) {\n      this.xGridCall = d3_axisBottom(this.xAxisScale).tickSize(-this.height);\n\n      this.xGrid = this.svg\n        .append('g')\n        .attr('class', 'grid grid-x')\n        .classed('grid-zero-hidden', this.hideXAxisZero)\n        .attr('transform', `translate(0, ${this.height})`)\n        .call(this.xGridCall);\n    }\n\n    // X AXIS TITLE\n    if (this.xAxisTitle) {\n      this.svg\n        .append('text')\n        .attr('class', 'axis-title')\n        .attr('text-anchor', 'center')\n        .attr('x', this.width / 2 - this.margin.left)\n        .attr('y', this.height + this.margin.top + (this.hideXAxis ? 15 : 0))\n        .text(this.xAxisTitle);\n    }\n\n    // Y AXIS\n    this.yAxisScale = d3_scaleLinear()\n      .domain([\n        d3_min(this.data, d => d.value - d.value * +this.yAxisMinBuffer),\n        d3_max(this.data, d => d.value + d.value * +this.yAxisMaxBuffer)\n      ])\n      .nice()\n      .rangeRound([this.height, 0]);\n\n    this.yAxisCall = d3_axisLeft(this.yAxisScale)\n      .ticks(this.yAxisTicks)\n      .tickSize(this.yAxisTickSize)\n      .tickSizeOuter(this.yAxisTickSizeOuter)\n      .tickFormat(this.yAxisFormatter);\n\n    this.yAxis = this.svg\n      .append('g')\n      .attr('class', 'axis axis-y')\n      .classed('axis-hidden', this.hideYAxis)\n      .classed('axis-zero-hidden', this.hideYAxisZero)\n      .classed('axis-domain-hidden', this.hideYAxisDomain)\n      .classed('axis-ticks-hidden', this.hideYAxisTicks)\n      .call(this.yAxisCall);\n\n    // Y GRIDLINES\n    if (!this.hideYGrid) {\n      this.yGridCall = d3_axisLeft(this.yAxisScale)\n        .ticks(this.yAxisTicks)\n        .tickSize(-this.width + this.margin.left + this.margin.right);\n\n      this.yGrid = this.svg\n        .append('g')\n        .attr('class', 'grid grid-y')\n        .classed('grid-zero-hidden', this.hideYAxisZero)\n        .attr('transform', `translate(0, 0)`)\n        .call(this.yGridCall);\n    }\n\n    // Y THRESHOLD\n    if (this.threshold) {\n      this.yThreshold = this.svg\n        .append('line')\n        .attr('class', 'threshold')\n        .attr('x2', +this.width - this.margin.right - this.margin.left)\n        .attr('transform', `translate(0,  ${this.yAxisScale(+this.threshold)})`);\n    }\n\n    // Y AVERAGE\n    if (this.average) {\n      this.yAverage = this.svg\n        .append('line')\n        .attr('class', 'average')\n        .attr('x2', +this.width - this.margin.right - this.margin.left)\n        .attr('transform', `translate(0,  ${this.yAxisScale(+this.average)})`);\n    }\n\n    // TOOLTIP\n    if (!this.hideTooltip) {\n      this.tooltip = d3_select('body')\n        .append('div')\n        .attr('class', 'pbds-tooltip south')\n        .style('opacity', 0)\n        .attr('aria-hidden', 'true'); // hide tooltip for accessibility\n    }\n\n    // add legend classes\n    if (!this.hideLegend) {\n      this.chart.classed('pbds-chart-legend-bottom', this.legendPosition === 'bottom' ? true : false);\n      this.chart.append('ul').attr('class', `legend legend-${this.legendPosition}`);\n    }\n\n    // add average to legend\n    if (this.average && !this.hideLegend) {\n      this.chart\n        .select('.legend')\n        .append('li')\n        .attr('class', 'legend-static legend-average')\n        .html(() => {\n          return `\n          <span class=\"legend-key\"></span>\n          <span class=\"legend-label\">${this.averageLabel}</span>\n        `;\n        });\n    }\n\n    // add threshold to legend\n    if (this.threshold && !this.hideLegend) {\n      this.chart\n        .select('.legend')\n        .append('li')\n        .attr('class', 'legend-static legend-threshold')\n        .html(() => {\n          return `\n          <span class=\"legend-key\"></span>\n          <span class=\"legend-label\">${this.thresholdLabel}</span>\n        `;\n        });\n    }\n\n    this.updateChart();\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    if (changes.data && !changes.data.firstChange) {\n      this.updateChart();\n    }\n  }\n\n  ngOnDestroy() {\n    if (this.tooltip) this.tooltip.remove();\n  }\n\n  updateChart = () => {\n    // update the xScale\n    this.xAxisScale.domain(this.data.map(d => d.label));\n\n    // update the yScale\n    this.yAxisScale\n      .domain([\n        d3_min(this.data, d => d.value - d.value * +this.yAxisMinBuffer),\n        d3_max(this.data, d => d.value + d.value * +this.yAxisMaxBuffer)\n      ])\n      .rangeRound([this.height, 0])\n      .nice();\n\n    this.xAxis\n      .transition()\n      .duration(1000)\n      .call(this.xAxisCall);\n\n    this.yAxis\n      .transition()\n      .duration(1000)\n      .call(this.yAxisCall);\n\n    // update the grids\n    if (!this.hideXGrid) {\n      this.xGrid\n        .transition()\n        .duration(1000)\n        .call(this.xGridCall);\n    }\n\n    if (!this.hideYGrid) {\n      this.yGrid\n        .transition()\n        .duration(1000)\n        .call(this.yGridCall);\n    }\n\n    if (!this.hideGrayBars) {\n      // gray bars\n      this.svg\n        .selectAll('.gray-bar')\n        .data(this.data)\n        .join(\n          enter =>\n            enter\n              .append('rect')\n              .attr('class', 'gray-bar')\n              .attr('height', 0)\n              .attr('x', d => this.xAxisScale(d.label))\n              .attr('width', this.xAxisScale.bandwidth())\n              .call(enter =>\n                enter\n                  .transition()\n                  .duration(500)\n                  .attr('height', this.height)\n              ),\n          update =>\n            update\n              .transition()\n              .duration(1000)\n              .attr('x', d => this.xAxisScale(d.label))\n              .attr('width', this.xAxisScale.bandwidth()),\n          exit =>\n            exit\n              .transition()\n              .attr('pointer-events', 'none')\n              .remove()\n        );\n\n      // color bars\n      this.svg\n        .selectAll('.bar')\n        .data(this.data)\n        .join(\n          enter =>\n            enter\n              .append('rect')\n              .attr('class', 'bar')\n              .attr('fill', d => `url(${this._location.path()}#gradient-${this.colorRange(d.label).substr(1)})`) // removes hash to prevent safari bug;\n              .attr('x', d => this.xAxisScale(d.label) + this.xAxisScale.bandwidth() / 4)\n              .attr('width', this.xAxisScale.bandwidth() / 2)\n              .attr('y', this.height)\n              .attr('height', 0)\n              .attr('pointer-events', 'none')\n              .call(enter =>\n                enter\n                  .transition()\n                  .duration(1000)\n                  .attr('y', d => this.yAxisScale(d.value))\n                  .attr('height', d => this.height - this.yAxisScale(d.value))\n                  .attr('data-color', d => this.colorRange(d.label))\n                  .transition()\n                  .attr('pointer-events', 'auto')\n              ),\n          update =>\n            update\n              .attr('pointer-events', 'none')\n              .transition()\n              .duration(1000)\n              .attr('x', d => this.xAxisScale(d.label) + this.xAxisScale.bandwidth() / 4)\n              .attr('width', this.xAxisScale.bandwidth() / 2)\n              .attr('height', d => this.height - this.yAxisScale(d.value))\n              .attr('y', d => this.yAxisScale(d.value))\n              .transition()\n              .attr('pointer-events', 'auto'),\n          exit =>\n            exit\n              .transition()\n              .attr('pointer-events', 'none')\n              .remove()\n        )\n        .on('mouseover', (data, index, nodes) => this.barMouseOver(d3_event, data, index, nodes))\n        .on('mouseout', (data, index, nodes) => this.barMouseOut())\n        .on('click', (data, index, nodes) => this.barMouseClick(d3_event, data, index, nodes));\n    } else {\n      // color bars\n      this.svg\n        .selectAll('.bar')\n        .data(this.data)\n        .join(\n          enter =>\n            enter\n              .append('rect')\n              .attr('class', 'bar')\n              .attr('fill', d => `url(${this._location.path()}#gradient-${this.colorRange(d.label).substr(1)})`)\n              .attr('x', d => this.xAxisScale(d.label) + this.xAxisScale.bandwidth() / 5.5)\n              .attr('width', this.xAxisScale.bandwidth() / 1.5)\n              .attr('y', this.height)\n              .attr('height', 0)\n              .attr('pointer-events', 'none')\n              .call(enter =>\n                enter\n                  .transition()\n                  .duration(1000)\n                  .attr('y', d => this.yAxisScale(d.value))\n                  .attr('height', d => this.height - this.yAxisScale(d.value))\n                  .attr('data-color', d => this.colorRange(d.label))\n                  .transition()\n                  .attr('pointer-events', 'auto')\n              ),\n          update =>\n            update\n              .attr('pointer-events', 'none')\n              .transition()\n              .duration(1000)\n              .attr('x', d => this.xAxisScale(d.label) + this.xAxisScale.bandwidth() / 5.5)\n              .attr('width', this.xAxisScale.bandwidth() / 1.5)\n              .attr('height', d => this.height - this.yAxisScale(d.value))\n              .attr('y', d => this.yAxisScale(d.value))\n              .transition()\n              .attr('pointer-events', 'auto'),\n          exit =>\n            exit\n              .transition()\n              .attr('pointer-events', 'none')\n              .remove()\n        )\n        .on('mouseover', (data, index, nodes) => this.barMouseOver(d3_event, data, index, nodes))\n        .on('mouseout', (data, index, nodes) => this.barMouseOut())\n        .on('click', (data, index, nodes) => this.barMouseClick(d3_event, data, index, nodes));\n    }\n\n    if (!this.hideLegend) {\n      this.chart\n        .select('.legend')\n        .selectAll('.legend-item')\n        .data(this.data)\n        .join(\n          enter => {\n            const li = enter.insert('li', 'li.legend-static').attr('class', 'legend-item');\n\n            li.append('span')\n              .attr('class', 'legend-key')\n              .style('background-color', d => this.colorRange(d.label));\n\n            li.append('span')\n              .attr('class', 'legend-label')\n              .html(d => {\n                switch (this.legendLabelFormatType) {\n                  case 'number':\n                    return this.legendLabelFormat(d.label);\n\n                  case 'time':\n                    const parsedTime = d3_isoParse(d.label);\n                    return this.legendLabelFormat(parsedTime);\n\n                  default:\n                    return d.label;\n                }\n              });\n\n            return li;\n          },\n          update =>\n            update.select('.legend-label').html(d => {\n              switch (this.legendLabelFormatType) {\n                case 'number':\n                  return this.legendLabelFormat(d.label);\n\n                case 'time':\n                  const parsedTime = d3_isoParse(d.label);\n                  return this.legendLabelFormat(parsedTime);\n\n                default:\n                  return d.label;\n              }\n            }),\n          exit => exit.remove()\n        )\n        .on('mouseover', (data, index, nodes) => this.legendMouseOver(d3_event, data, index, nodes))\n        .on('mouseout', () => this.legendMouseOut())\n        .on('click', (data, index, nodes) => this.legendMouseClick(d3_event, data, index, nodes));\n    }\n\n    if (this.threshold) {\n      this.yThreshold\n        .raise()\n        .transition()\n        .duration(1000)\n        .attr('transform', `translate(0,  ${this.yAxisScale(+this.threshold)})`);\n    }\n\n    if (this.average) {\n      this.yAverage\n        .raise()\n        .transition()\n        .duration(1000)\n        .attr('transform', `translate(0,  ${this.yAxisScale(+this.average)})`);\n    }\n  };\n\n  barMouseOver = (event, data, index, nodes) => {\n    this.chart\n      .selectAll('.bar')\n      .filter((d, i) => i !== index)\n      .classed('inactive', true);\n\n    const bar = this.chart.selectAll('.bar').filter((d, i) => i === index);\n\n    const barColor = bar.attr('data-color');\n\n    bar.style('fill', barColor);\n\n    this.chart\n      .selectAll('.legend-item')\n      .filter((d, i) => i !== index)\n      .classed('inactive', true);\n\n    this.tooltipShow(data, nodes.filter((d, i) => i === index)[0]);\n\n    this.hovered.emit({ event, data });\n  };\n\n  barMouseOut = () => {\n    this.chart\n      .selectAll('.bar')\n      .classed('inactive', false)\n      .style('fill', null);\n\n    this.chart.selectAll('.legend-item').classed('inactive', false);\n\n    this.tooltipHide();\n  };\n\n  barMouseClick = (event, data, index, nodes) => {\n    this.clicked.emit({ event, data });\n  };\n\n  legendMouseOver = (event, data, index, nodes) => {\n    this.chart\n      .selectAll('.legend-item')\n      .filter((d, i) => i !== index)\n      .classed('inactive', true);\n\n    this.chart\n      .selectAll('.bar')\n      .filter((d, i) => i !== index)\n      .classed('inactive', true);\n\n    const bar = this.chart.selectAll('.bar').filter((d, i) => i === index);\n\n    const barColor = bar.attr('data-color');\n\n    bar.style('fill', barColor);\n\n    this.tooltipShow(\n      data,\n      this.chart\n        .selectAll('.bar')\n        .filter((d, i) => i === index)\n        .node()\n    );\n\n    this.hovered.emit({ event, data });\n  };\n\n  legendMouseOut = () => {\n    this.chart.selectAll('.legend-item').classed('inactive', false);\n\n    this.chart\n      .selectAll('.bar')\n      .classed('inactive', false)\n      .style('fill', null);\n\n    this.tooltipHide();\n  };\n\n  legendMouseClick = (event, data, index, nodes) => {\n    this.clicked.emit({ event, data });\n  };\n\n  private tooltipShow = (data, node) => {\n    const dimensions = node.getBoundingClientRect();\n    const scroll = this._scroll.getScrollPosition();\n    let label;\n\n    switch (this.tooltipLabelFormatType) {\n      case 'number':\n        label = this.tooltipLabelFormat(data.label);\n        break;\n\n      case 'time':\n        const parsedTime = d3_isoParse(data.label);\n        label = this.tooltipLabelFormat(parsedTime);\n        break;\n\n      default:\n        label = data.label;\n    }\n    const value =\n      this.tooltipValueFormat === null\n        ? `<div class=\"tooltip-value\">${data.value}</div>`\n        : `<div class=\"tooltip-value\">${this.tooltipValueFormat(data.value)}</div>`;\n\n    this.tooltip.html(\n      `\n        ${this.hideTooltipLabel ? '' : `${label}`}\n        ${value}\n      `\n    );\n\n    const tooltipOffsetWidth = +this.tooltip.node().offsetWidth / 2;\n    const tooltipOffsetHeight = +this.tooltip.node().offsetHeight + 8;\n\n    this.tooltip.style('top', `${+scroll[1] + +dimensions.top - tooltipOffsetHeight}px`); //\n    this.tooltip.style('left', `${+scroll[0] + +dimensions.left - tooltipOffsetWidth + +dimensions.width / 2}px`);\n    this.tooltip.style('opacity', 1);\n  };\n\n  private tooltipHide = () => {\n    this.tooltip.style('opacity', 0);\n  };\n\n  private xAxisFormatter = item => {\n    switch (this.xAxisFormatType) {\n      case 'number':\n        return this.xAxisFormat(item);\n\n      case 'time':\n        const parseDate = d3_isoParse(item);\n        return this.xAxisFormat(parseDate);\n\n      default:\n        return item;\n    }\n  };\n\n  private yAxisFormatter = item => {\n    switch (this.yAxisFormatType) {\n      case 'number':\n        return this.yAxisFormat(item);\n\n      case 'time':\n        const parseDate = d3_isoParse(item);\n        return this.yAxisFormat(parseDate);\n\n      default:\n        return item;\n    }\n  };\n}\n","import {\n  Component,\n  OnInit,\n  OnChanges,\n  Input,\n  Output,\n  EventEmitter,\n  ElementRef,\n  HostBinding,\n  OnDestroy,\n  SimpleChanges,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { ViewportScroller, Location } from '@angular/common';\n\nimport { select as d3_select, event as d3_event, mouse as d3_mouse } from 'd3-selection';\nimport { line as d3_line, area as d3_area, curveCatmullRom as d3_curveCatmullRom } from 'd3-shape';\nimport { scaleOrdinal as d3_scaleOrdinal, scaleLinear as d3_scaleLinear, scaleTime as d3_scaleTime } from 'd3-scale';\nimport { min as d3_min, max as d3_max, extent as d3_extent, bisectLeft as d3_bisectLeft } from 'd3-array';\nimport { axisBottom as d3_axisBottom, axisLeft as d3_axisLeft } from 'd3-axis';\nimport { format as d3_format } from 'd3-format';\nimport { isoParse as d3_isoParse, isoFormat as d3_isoFormat, timeFormat as d3_timeFormat } from 'd3-time-format';\nimport { easeQuadInOut as d3_easeQuadInOut } from 'd3-ease';\n\nimport { PbdsDatavizService } from './dataviz.service';\nimport { PbdsDatavizLine } from './dataviz.interfaces';\n\n// assign an ID for each component instance\nlet nextId = 0;\n\n@Component({\n  selector: 'pbds-dataviz-line',\n  template: ``,\n  styles: [],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class PbdsDatavizLineComponent implements OnInit, OnDestroy, OnChanges {\n  @HostBinding('class.pbds-chart')\n  chartClass = true;\n\n  @HostBinding('class.pbds-chart-line')\n  lineClass = true;\n\n  @Input()\n  data: PbdsDatavizLine;\n\n  @Input()\n  width = 306;\n\n  @Input()\n  height = 400;\n\n  @Input()\n  type: 'medium' | 'high' | 'debug' = 'medium'; // debug to show all chart options\n\n  @Input()\n  area = false;\n\n  @Input()\n  xAxisFormatString = '';\n\n  @Input()\n  xAxisTicks = 6;\n\n  @Input()\n  yAxisFormatString = '';\n\n  @Input()\n  yAxisTicks = 5;\n\n  @Input()\n  yAxisMinBuffer = 0.01;\n\n  @Input()\n  yAxisMaxBuffer = 0.01;\n\n  @Input()\n  hideXGrid = true;\n\n  @Input()\n  hideYGrid = true;\n\n  @Input()\n  hideLegend = false;\n\n  @Input()\n  legendWidth = 105 + 28; // hardcoded legend width + left margin, do not document until feedback\n\n  @Input()\n  legendPosition: 'right' | 'bottom' = 'right';\n\n  @Input()\n  legendLabelFormatType: 'number' | 'time' = null;\n\n  @Input()\n  legendLabelFormatString = '';\n\n  @Input()\n  tooltipHeadingFormatString = '';\n\n  @Input()\n  tooltipLabelFormatType: 'number' | 'time' = null;\n\n  @Input()\n  tooltipLabelFormatString = '';\n\n  @Input()\n  tooltipValueFormatType: 'number' | 'time' = null;\n\n  @Input()\n  tooltipValueFormatString = '';\n\n  @Input()\n  marginTop = 10; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  marginRight = 20; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  marginBottom = 30; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  marginLeft = 55; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  theme;\n\n  @Output()\n  hovered: EventEmitter<object> = new EventEmitter<object>();\n\n  @Output()\n  clicked: EventEmitter<object> = new EventEmitter<object>();\n\n  @Output()\n  tooltipHovered: EventEmitter<object> = new EventEmitter<object>();\n\n  @Output()\n  tooltipClicked: EventEmitter<object> = new EventEmitter<object>();\n\n  private chart;\n  private svg;\n  private mouserect;\n  private tooltipLine;\n  private margin;\n  private clipPathId;\n  private d3line;\n  private d3area;\n  private lineWidth;\n  private lineCurved;\n  private linePoints;\n  private colorRange;\n  private xAxisScale;\n  private xAxisCall;\n  private xAxis;\n  private xAxisFormat;\n  private yAxisScale;\n  private yAxisCall;\n  private yAxis;\n  private yAxisFormat;\n  private xGrid;\n  private xGridCall;\n  private yGrid;\n  private yGridCall;\n  private xAxisTickSize: number;\n  private xAxisTickSizeOuter: number;\n  private yAxisTickSize: number;\n  private yAxisTickSizeOuter: number;\n  private hideXAxis: boolean;\n  private hideYAxis: boolean;\n  private hideXAxisDomain: boolean;\n  private hideYAxisDomain: boolean;\n  private hideXAxisZero: boolean;\n  private hideYAxisZero: boolean;\n  private hideXAxisTicks: boolean;\n  private hideYAxisTicks: boolean;\n  private legendLabelFormat;\n  private tooltip;\n  private hideTooltip: boolean;\n  private tooltipHeadingFormat;\n  private tooltipValueFormat;\n  private tooltipLabelFormat;\n  private mousedata;\n\n  constructor(\n    private _dataviz: PbdsDatavizService,\n    private _element: ElementRef,\n    private _scroll: ViewportScroller,\n    private _location: Location\n  ) {}\n\n  ngOnInit() {\n    this.margin = {\n      top: +this.marginTop,\n      right: +this.marginRight,\n      bottom: +this.marginBottom,\n      left: +this.marginLeft\n    };\n\n    this.clipPathId = nextId;\n\n    // create formatters\n    this.xAxisFormat = d3_timeFormat(this.xAxisFormatString);\n    this.yAxisFormat = d3_format(this.yAxisFormatString);\n    this.legendLabelFormat = this._dataviz.d3Format(this.legendLabelFormatType, this.legendLabelFormatString);\n    this.tooltipHeadingFormat = d3_timeFormat(this.tooltipHeadingFormatString);\n    this.tooltipLabelFormat = this._dataviz.d3Format(this.tooltipLabelFormatType, this.tooltipLabelFormatString);\n    this.tooltipValueFormat = this._dataviz.d3Format(this.tooltipValueFormatType, this.tooltipValueFormatString);\n\n    // defaults for all chart types\n    this.lineWidth = 3;\n    this.lineCurved = true;\n    this.linePoints = true;\n    this.hideXAxis = false;\n    this.hideYAxis = false;\n    this.hideXAxisZero = false;\n    this.hideYAxisZero = false;\n    this.hideXAxisDomain = false;\n    this.hideYAxisDomain = false;\n    this.hideTooltip = false;\n    this.hideXAxisTicks = false;\n    this.hideYAxisTicks = false;\n    this.xAxisTickSize = 8;\n    this.xAxisTickSizeOuter = 0;\n    this.yAxisTickSize = 8;\n    this.yAxisTickSizeOuter = 0;\n\n    if (this.type !== 'debug') {\n      // set type defaults\n      switch (this.type) {\n        case 'medium':\n          this.hideXAxisTicks = true;\n          this.hideYAxisTicks = true;\n          break;\n\n        case 'high':\n          this.lineWidth = 2;\n          this.lineCurved = false;\n          this.linePoints = false;\n          this.hideXAxisTicks = true;\n          this.hideYAxisTicks = true;\n          this.hideXGrid = false;\n          this.hideYGrid = false;\n          break;\n      }\n    }\n\n    // adjust margin if xAxis hidden\n    if (this.hideXAxis) this.margin.bottom = 10; // need small margin for yAxis with 0 tick label\n\n    if (!this.hideLegend && this.legendPosition === 'right') {\n      this.width = +this.width - +this.legendWidth;\n    }\n\n    // define line\n    this.d3line = d3_line()\n      .x((d: any, i) => this.xAxisScale(d3_isoParse(this.data.dates[i])))\n      .y((d: any) => this.yAxisScale(d));\n\n    // define line curve\n    if (this.lineCurved) {\n      this.d3line.curve(d3_curveCatmullRom.alpha(0.5));\n    }\n\n    // define area\n    if (this.area) {\n      this.d3area = d3_area()\n        .x((d: any, i) => this.xAxisScale(d3_isoParse(this.data.dates[i])))\n        .y0(this.height)\n        .y1((d: any, i) => this.yAxisScale(d));\n\n      if (this.lineCurved) {\n        this.d3area.curve(d3_curveCatmullRom.alpha(0.5));\n      }\n    }\n\n    // create the chart\n    this.chart = d3_select(this._element.nativeElement).attr('aria-hidden', 'true');\n\n    // create chart svg\n    this.svg = this.chart\n      .append('svg')\n      .attr('width', +this.width + this.margin.right)\n      .attr('height', +this.height + this.margin.top + this.margin.bottom)\n      .attr('class', 'img-fluid')\n      .attr('preserveAspectRatio', 'xMinYMin meet')\n      .attr(\n        'viewBox',\n        `-${this.margin.left} -${this.margin.top} ${+this.width + this.margin.right} ${+this.height +\n          this.margin.top +\n          this.margin.bottom}`\n      );\n\n    // add rectangle to capture mouse\n    this.mouserect = this.svg\n      .append('rect')\n      .attr('width', this.width - this.margin.left - this.margin.right)\n      .attr('height', this.height)\n      .attr('class', 'mouserect')\n      .on('mousemove', (data, index, nodes) => this.mouserectMouseMove(d3_event, index, nodes))\n      .on('mouseout', (data, index, nodes) => this.mouserectMouseOut(d3_event, index, nodes))\n      .on('click', (data, index, nodes) => this.mouserectMouseClick());\n\n    this.tooltipLine = this.svg\n      .append('line')\n      .attr('y1', 0)\n      .attr('y2', this.height)\n      .attr('class', 'tooltip-line');\n\n    // define color range\n    this.colorRange = d3_scaleOrdinal().range(this._dataviz.getColors(false, this.theme));\n\n    // add glow def\n    this._dataviz.createGlowFilter(this.svg);\n\n    // X AXIS\n    this.xAxisScale = d3_scaleTime()\n      .domain(\n        d3_extent(this.data.dates, (d: any, i) => {\n          return d3_isoParse(d);\n        })\n      )\n      .range([0, this.width - this.margin.left - this.margin.right]);\n\n    this.xAxisCall = d3_axisBottom(this.xAxisScale)\n      .ticks(+this.xAxisTicks)\n      .tickSize(this.xAxisTickSize)\n      .tickSizeOuter(this.xAxisTickSizeOuter)\n      .tickFormat(this.xAxisFormatter);\n\n    this.xAxis = this.svg\n      .append('g')\n      .attr('class', 'axis axis-x')\n      .attr('transform', `translate(0, ${this.height})`) //${-this.margin.right / 2}\n      .classed('axis-hidden', this.hideXAxis)\n      .classed('axis-zero-hidden', this.hideXAxisZero)\n      .classed('axis-domain-hidden', this.hideXAxisDomain)\n      .classed('axis-ticks-hidden', this.hideXAxisTicks)\n      .call(this.xAxisCall);\n\n    // X GRIDLINES\n    if (!this.hideXGrid) {\n      this.xGridCall = d3_axisBottom(this.xAxisScale).tickSize(-this.height);\n\n      this.xGrid = this.svg\n        .append('g')\n        .attr('class', 'grid grid-x')\n        .classed('grid-zero-hidden', this.hideXAxisZero)\n        .attr('transform', `translate(0, ${this.height})`) //${-this.margin.right / 2}\n        .call(this.xGridCall);\n    }\n\n    // Y AXIS\n    this.yAxisScale = d3_scaleLinear()\n      .domain([\n        d3_min(this.data.series, (d: any, i) => {\n          const minVal = +d3_min(d.values);\n          return minVal - minVal * +this.yAxisMinBuffer;\n        }),\n        d3_max(this.data.series, (d: any, i) => {\n          const maxVal = +d3_max(d.values);\n          return maxVal + maxVal * this.yAxisMaxBuffer;\n        })\n      ])\n      .nice()\n      .range([this.height, 0]);\n\n    this.yAxisCall = d3_axisLeft(this.yAxisScale)\n      .ticks(this.yAxisTicks)\n      .tickSize(this.yAxisTickSize)\n      .tickSizeOuter(this.yAxisTickSizeOuter)\n      .tickFormat(this.yAxisFormatter);\n\n    this.yAxis = this.svg\n      .append('g')\n      .attr('class', 'axis axis-y')\n      .classed('axis-hidden', this.hideYAxis)\n      .classed('axis-zero-hidden', this.hideYAxisZero)\n      .classed('axis-domain-hidden', this.hideYAxisDomain)\n      .classed('axis-ticks-hidden', this.hideYAxisTicks)\n      .call(this.yAxisCall);\n\n    // Y GRIDLINES\n    if (!this.hideYGrid) {\n      this.yGridCall = d3_axisLeft(this.yAxisScale)\n        .ticks(this.yAxisTicks)\n        .tickSize(-this.width + this.margin.left + this.margin.right);\n\n      this.yGrid = this.svg\n        .append('g')\n        .attr('class', 'grid grid-y')\n        .classed('grid-zero-hidden', this.hideYAxisZero)\n        .attr('transform', `translate(0, 0)`)\n        .call(this.yGridCall);\n    }\n\n    // TOOLTIP\n    if (!this.hideTooltip) {\n      this.tooltip = d3_select('body')\n        .append('div')\n        .attr('class', 'pbds-tooltip west')\n        .style('opacity', 0)\n        .attr('aria-hidden', 'true'); // hide tooltip for accessibility\n\n      // tooltip header\n      this.tooltip.append('div').attr('class', 'tooltip-header');\n\n      // tooltip table\n      const tooltipTable = this.tooltip.append('table').attr('class', 'tooltip-table text-left w-100');\n\n      const tooltipTableTbody = tooltipTable.append('tbody');\n\n      tooltipTableTbody\n        .selectAll('tr')\n        .data(this.data)\n        .join(enter => enter.append('tr'));\n    }\n\n    // add legend classes\n    if (!this.hideLegend) {\n      this.chart.classed('pbds-chart-legend-bottom', this.legendPosition === 'bottom' ? true : false);\n      this.chart.append('ul').attr('class', `legend legend-${this.legendPosition}`);\n    }\n\n    // add clip path for line animation\n    this.svg\n      .append('clipPath')\n      .attr('id', `clip-path-${this.clipPathId}`)\n      .append('rect')\n      .attr('width', +this.width - +this.margin.left - +this.margin.right)\n      .attr('height', +this.height);\n\n    // add clip path for points animation\n    this.svg\n      .append('clipPath')\n      .attr('id', `clip-path-points-${this.clipPathId}`)\n      .append('rect')\n      .attr('width', +this.width + +this.margin.left - +this.margin.right)\n      .attr('height', +this.height)\n      .attr('transform', `translate(-${this.margin.left}, 0)`);\n\n    this.updateChart();\n\n    nextId++;\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    if (changes.data && !changes.data.firstChange) {\n      this.updateChart();\n    }\n  }\n\n  ngOnDestroy() {\n    if (this.tooltip) this.tooltip.remove();\n  }\n\n  updateChart = () => {\n    this.mouserect.data(this.data);\n\n    // update the xScale\n    this.xAxisScale.domain(\n      d3_extent(this.data.dates, (d: any, i) => {\n        return d3_isoParse(d);\n      })\n    );\n\n    // update the yScale\n    this.yAxisScale\n      .domain([\n        d3_min(this.data.series, (d: any, i) => {\n          const minVal = +d3_min(d.values);\n          return minVal - minVal * +this.yAxisMinBuffer;\n        }),\n        d3_max(this.data.series, (d: any, i) => {\n          const maxVal = +d3_max(d.values);\n          return maxVal + maxVal * this.yAxisMaxBuffer;\n        })\n      ])\n      .nice();\n\n    this.xAxis\n      .transition()\n      .duration(1000)\n      .call(this.xAxisCall);\n\n    this.yAxis\n      .transition()\n      .duration(1000)\n      .call(this.yAxisCall);\n\n    // update the grids\n    if (!this.hideXGrid) {\n      this.xGrid\n        .transition()\n        .duration(1000)\n        .call(this.xGridCall);\n    }\n\n    if (!this.hideYGrid) {\n      this.yGrid\n        .transition()\n        .duration(1000)\n        .call(this.yGridCall);\n    }\n\n    // lines\n    this.svg\n      .selectAll('path.line')\n      .attr('filter', () => (this.type !== 'high' ? `url(${this._location.path()}#glow)` : null))\n      .data(this.data.series)\n      .join(\n        enter => {\n          enter\n            .append('path')\n            .attr('clip-path', `url(${this._location.path()}#clip-path-${this.clipPathId})`)\n            .attr('class', 'line')\n            .style('stroke', d => this.colorRange(d.label))\n            .style('stroke-width', this.lineWidth)\n            .attr('d', data => {\n              const array = new Array(data.values.length).fill(0);\n              return this.d3line(array);\n            })\n            .call(enter =>\n              enter\n                .transition()\n                .duration(1000)\n                .ease(d3_easeQuadInOut)\n                .attr('d', data => this.d3line(data.values))\n            );\n        },\n        update =>\n          update.call(update =>\n            update\n              .transition()\n              .duration(1000)\n              .ease(d3_easeQuadInOut)\n              .attr('d', d => this.d3line(d.values))\n          ),\n        exit => exit.remove()\n      );\n\n    // area\n    if (this.area) {\n      this.svg\n        .selectAll('path.area')\n        .data(this.data.series)\n        .join(\n          enter =>\n            enter\n              .append('path')\n              .attr('clip-path', `url(${this._location.path()}#clip-path-${this.clipPathId})`)\n              .attr('class', 'area')\n              .attr('d', data => {\n                const array = new Array(data.values.length).fill(0);\n                return this.d3area(array);\n              })\n              .style('color', d => this.colorRange(d.label))\n              .call(enter =>\n                enter\n                  .transition()\n                  .duration(1000)\n                  .ease(d3_easeQuadInOut)\n                  .attr('d', data => this.d3area(data.values))\n              ),\n          update =>\n            update.call(update => {\n              return update\n                .transition()\n                .duration(1000)\n                .ease(d3_easeQuadInOut)\n                .attr('d', d => this.d3area(d.values));\n            }),\n          exit => exit.remove()\n        );\n    }\n\n    // circles\n    if (this.linePoints) {\n      // add points\n      this.svg\n        .selectAll('g.points')\n        .data(this.data.series)\n        .join(\n          enter =>\n            enter\n              .append('g')\n              .attr('class', 'points')\n              .attr('clip-path', `url(${this._location.path()}#clip-path-points-${this.clipPathId})`)\n              .style('color', (d, i) => this.colorRange(d.label))\n\n              .selectAll('circle')\n              .data(d => d.values)\n              .join(\n                enter =>\n                  enter\n                    .append('circle')\n                    .attr('cx', (d, i) => this.xAxisScale(d3_isoParse(this.data.dates[i])))\n                    .attr('cy', d => this.yAxisScale(0))\n                    .attr('r', this.lineWidth * 2)\n                    .style('stroke-width', this.lineWidth)\n                    .call(enter =>\n                      enter\n                        .transition()\n                        .duration(1000)\n                        .ease(d3_easeQuadInOut)\n                        .attr('cy', d => this.yAxisScale(d))\n                    ),\n                () => {},\n                exit => exit.remove()\n              ),\n          update =>\n            update\n              .selectAll('circle')\n              .data(d => d.values)\n              .join(\n                enter =>\n                  enter\n                    .append('circle')\n                    .attr('cx', (d, i) => this.xAxisScale(d3_isoParse(this.data.dates[i])))\n                    .attr('cy', d => this.yAxisScale(d))\n                    .attr('r', this.lineWidth * 2)\n                    .style('stroke-width', this.lineWidth),\n                update =>\n                  update.call(update =>\n                    update\n                      .transition()\n                      .duration(1000)\n                      .ease(d3_easeQuadInOut)\n                      .attr('cx', (d, i) => this.xAxisScale(d3_isoParse(this.data.dates[i])))\n                      .attr('cy', d => this.yAxisScale(d))\n                  ),\n                exit => exit.remove()\n              ),\n          exit => exit.remove()\n        );\n    }\n\n    if (!this.hideLegend) {\n      this.chart\n        .select('.legend')\n        .selectAll('.legend-item')\n        .data(this.data.series)\n        .join(\n          enter => {\n            const li = enter.append('li').attr('class', 'legend-item');\n\n            li.append('span')\n              .attr('class', 'legend-key')\n              .style('background-color', d => this.colorRange(d.label));\n\n            li.append('span')\n              .attr('class', 'legend-label')\n              .html(d => {\n                switch (this.legendLabelFormatType) {\n                  case 'number':\n                    return this.legendLabelFormat(d.label);\n\n                  case 'time':\n                    const parsedTime = d3_isoParse(d.label);\n                    return this.legendLabelFormat(parsedTime);\n\n                  default:\n                    return d.label;\n                }\n              });\n\n            return li;\n          },\n          update => {\n            update.select('.legend-label').html(d => {\n              switch (this.legendLabelFormatType) {\n                case 'number':\n                  return this.legendLabelFormat(d.label);\n\n                case 'time':\n                  const parsedTime = d3_isoParse(d.label);\n                  return this.legendLabelFormat(parsedTime);\n\n                default:\n                  return d.label;\n              }\n            });\n\n            return update;\n          },\n          exit => exit.remove()\n        )\n        .on('mouseover', (data, index, nodes) => this.legendMouseOver(d3_event, data, index, nodes))\n        .on('mouseout', () => this.legendMouseOut())\n        .on('click', (data, index, nodes) => this.legendMouseClick(d3_event, data, index, nodes));\n    }\n\n    if (!this.hideTooltip) {\n      this.tooltip\n        .select('.tooltip-table')\n        .selectAll('tr')\n        .data(this.data.series)\n        .join(\n          enter => {\n            const tooltipItem = enter.append('tr').attr('class', 'tooltip-item');\n\n            tooltipItem\n              .append('td')\n              .style('color', d => this.colorRange(d.label))\n              .append('span')\n              .attr('class', 'pbds-tooltip-key');\n\n            tooltipItem\n              .append('td')\n              .attr('class', 'tooltip-label pr-2 text-nowrap')\n              .html(d => {\n                return this.tooltipLabelFormatType ? this.tooltipLabelFormat(d.label) : d.label;\n              });\n\n            tooltipItem\n              .append('td')\n              .attr('class', 'tooltip-value text-right text-nowrap')\n              .html(d => '');\n\n            return tooltipItem;\n          },\n          () => {},\n          exit => exit.remove()\n        );\n    }\n\n    this.svg.selectAll('.points').raise();\n    this.mouserect.raise();\n  };\n\n  legendMouseOver = (event, data, index, nodes) => {\n    this.chart\n      .selectAll('.legend-item')\n      .filter((d, i) => i !== index)\n      .classed('inactive', true);\n\n    this.svg\n      .selectAll('.line')\n      .filter((d, i) => i !== index)\n      .classed('inactive', true);\n\n    this.svg\n      .selectAll('.line')\n      .filter((d, i) => i === index)\n      .classed('active', true);\n\n    if (this.area) {\n      this.svg\n        .selectAll('.area')\n        .filter((d, i) => i !== index)\n        .classed('inactive', true);\n    }\n\n    if (this.linePoints) {\n      this.svg\n        .selectAll('.points')\n        .filter((d, i) => i !== index)\n        .selectAll('circle')\n        .classed('inactive', true);\n    }\n\n    this.hovered.emit({ event, data });\n  };\n\n  legendMouseOut = () => {\n    this.chart.selectAll('.legend-item').classed('inactive', false);\n\n    this.chart\n      .selectAll('.line')\n      .classed('inactive', false)\n      .classed('active', false);\n\n    if (this.linePoints) {\n      this.svg\n        .selectAll('circle')\n        .classed('active', false)\n        .classed('inactive', false);\n    }\n\n    if (this.area) {\n      this.svg.selectAll('.area').classed('inactive', false);\n    }\n  };\n\n  legendMouseClick = (event, data, index, nodes) => {\n    this.clicked.emit({ event, data });\n  };\n\n  mouserectMouseMove = (event, index, nodes) => {\n    const mouseXDate = this.xAxisScale.invert(d3_mouse(nodes[0])[0]); // return date at mouse x position\n    const leftIndex = d3_bisectLeft(this.data.dates, d3_isoFormat(mouseXDate)); // index of left closest date\n\n    // prevent error for 0 index\n    if (leftIndex === 0) return false;\n\n    const dateLower = new Date(this.data.dates[leftIndex - 1]);\n    const dateUpper = new Date(this.data.dates[leftIndex]);\n    const closestDate = +mouseXDate - +dateLower > +dateUpper - mouseXDate ? dateUpper : dateLower; // date mouse is closest to\n    const closestIndex = this.data.dates.indexOf(d3_isoFormat(closestDate)); // which index the mouse is closest to\n    // console.log(+mouseXDate, leftIndex, +dateLower, +dateUpper, +closestDate, closestIndex);\n\n    const circles = this.svg.selectAll('.line-group').selectAll('circle');\n    circles.filter((d, i) => i === closestIndex).classed('active', true);\n    circles.filter((d, i) => i !== closestIndex).classed('active', false);\n\n    this.tooltipLine\n      .attr('x1', this.xAxisScale(closestDate))\n      .attr('x2', this.xAxisScale(closestDate))\n      .classed('active', true);\n\n    // console.log(this.tooltipLine.node().getBoundingClientRect(), this._scroll.getScrollPosition());\n    this.tooltipShow(this.tooltipLine.node(), closestIndex);\n\n    this.mousedata = {\n      date: closestDate,\n      series: this.data.series.map(d => {\n        return {\n          label: d.label,\n          value: d.values[closestIndex]\n        };\n      })\n    };\n\n    this.tooltipHovered.emit({ event, data: this.mousedata });\n  };\n\n  mouserectMouseOut = (event, index, nodes) => {\n    this.svg.selectAll('circle').classed('active', false);\n    this.tooltipLine.classed('active', false);\n    this.tooltipHide();\n  };\n\n  mouserectMouseClick = () => {\n    this.tooltipClicked.emit({ event, data: this.mousedata });\n  };\n\n  private tooltipShow = (node, closestIndex) => {\n    const scroll = this._scroll.getScrollPosition();\n    const mouserectDimensions = node.getBoundingClientRect();\n    const tooltipOffsetHeight = +this.tooltip.node().offsetHeight;\n    const tooltipDimensions = this.tooltip.node().getBoundingClientRect();\n    const dimensionCalculated = mouserectDimensions.left + tooltipDimensions.width + 8;\n    const clientWidth = document.body.clientWidth - 10;\n    let position;\n\n    // console.log(scroll, mouserectDimensions, tooltipOffsetHeight, tooltipDimensions, dimensionCalculated, clientWidth);\n\n    this.tooltip.select('.tooltip-header').html(d => {\n      const parsedTime = d3_isoParse(this.data.dates[closestIndex]);\n      return this.tooltipHeadingFormat(parsedTime);\n    });\n\n    this.tooltip.selectAll('.tooltip-value').html((d, i) => {\n      return this.tooltipValueFormatType\n        ? this.tooltipValueFormat(this.data.series[i].values[closestIndex])\n        : this.data.series[i].values[closestIndex];\n    });\n\n    // flip the tooltip positions if near the right edge of the screen\n    if (dimensionCalculated > clientWidth) {\n      this.tooltip.classed('east', true);\n      this.tooltip.classed('west', false);\n      position = `${mouserectDimensions.left - tooltipDimensions.width - 8}px`;\n    } else if (dimensionCalculated < clientWidth) {\n      this.tooltip.classed('east', false);\n      this.tooltip.classed('west', true);\n      position = `${mouserectDimensions.left + 8}px`;\n    }\n\n    // console.log('POSITION: ', position, mouserectDimensions);\n\n    // set the tooltip styles\n    this.tooltip.style(\n      'top',\n      `${mouserectDimensions.top + mouserectDimensions.height / 2 - tooltipOffsetHeight / 2 + scroll[1]}px`\n    );\n    this.tooltip.style('left', position);\n    this.tooltip.style('opacity', 1);\n  };\n\n  private tooltipHide = () => {\n    this.tooltip.style('opacity', 0);\n  };\n\n  private xAxisFormatter = item => {\n    const parseDate = d3_isoParse(item);\n    return this.xAxisFormat(parseDate);\n  };\n\n  private yAxisFormatter = item => {\n    return this.yAxisFormat(item);\n  };\n}\n","import { Component, OnInit, Input, ElementRef, HostBinding, OnChanges, SimpleChanges } from '@angular/core';\n\nimport { select as d3_select } from 'd3-selection';\nimport { interpolate as d3_interpolate } from 'd3-interpolate';\nimport { arc as d3_arc } from 'd3-shape';\nimport { format as d3_format } from 'd3-format';\n\nimport { PbdsDatavizService } from './dataviz.service';\nimport { PbdsDatavizGauge } from './dataviz.interfaces';\n\n@Component({\n  selector: 'pbds-dataviz-gauge',\n  template: `\n    <div\n      *ngIf=\"!hideLabel\"\n      class=\"gauge-details\"\n      [ngClass]=\"{ halfmoon: type === 'halfmoon', 'gauge-details-small': type === 'halfmoon' }\"\n      [ngStyle]=\"{ 'max-width.px': width - 3 * gaugeWidth }\"\n    >\n      <div class=\"gauge-number\">{{ label }}</div>\n      <div *ngIf=\"description\" class=\"gauge-description text-center\">{{ description }}</div>\n    </div>\n  `,\n  styles: []\n})\nexport class PbdsDatavizGaugeComponent implements OnInit, OnChanges {\n  @HostBinding('class.pbds-chart')\n  chartClass = true;\n\n  @HostBinding('class.pbds-chart-gauge')\n  gaugeClass = true;\n\n  @Input()\n  data: PbdsDatavizGauge;\n\n  @Input()\n  width = 300;\n\n  @Input()\n  type: 'halfmoon' | 'horseshoe' | 'circle' = 'halfmoon';\n\n  @Input()\n  color = '#E23DA8';\n\n  @Input()\n  hideLabel = false;\n\n  @Input()\n  labelFormatString = '';\n\n  @Input()\n  description;\n\n  @Input()\n  gaugeWidth = 20;\n\n  private chart;\n  private svg;\n  private gauge;\n  private labelTween;\n  public label;\n  private startAngle;\n  private endAngle;\n  private radius;\n  private arc;\n  private labelFormat;\n  private oldValue;\n  private height;\n  private rounded;\n\n  constructor(private _dataviz: PbdsDatavizService, private _element: ElementRef) {}\n\n  ngOnInit() {\n    this.height = this.width;\n    this.radius = Math.max(this.width, this.height) / 2;\n    this.labelFormat = d3_format(this.labelFormatString);\n    this.label = this.labelFormat(this.data.value);\n\n    switch (this.type) {\n      case 'halfmoon':\n        this.startAngle = -90;\n        this.endAngle = 90;\n        this.rounded = true;\n        break;\n\n      case 'horseshoe':\n        this.startAngle = -140;\n        this.endAngle = 140;\n        this.rounded = true;\n        break;\n\n      case 'circle':\n        this.startAngle = 0;\n        this.endAngle = 360;\n        this.rounded = false;\n        break;\n    }\n\n    this.arc = d3_arc().cornerRadius(this.rounded ? this.gaugeWidth : 0);\n\n    this.chart = d3_select(this._element.nativeElement).attr('aria-hidden', 'true');\n\n    this.svg = this.chart\n      .append('svg')\n      .attr('width', this.width)\n      .attr('height', this.height)\n      .attr('class', 'img-fluid')\n      .attr('preserveAspectRatio', 'xMinYMin meet')\n      .attr('viewBox', `-${this.width / 2} -${this.height / 2} ${this.width} ${this.height}`);\n\n    this.drawChart();\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    if (changes.data && !changes.data.firstChange) {\n      this.oldValue = changes.data.previousValue.value;\n      this.updateChart();\n    }\n  }\n\n  degreesToRadians = degree => {\n    return (degree * Math.PI) / 180;\n  };\n\n  calculateMinMax = () => {\n    const percentage = this.data.minvalue / (this.data.maxvalue - this.data.minvalue);\n\n    return percentage * (this.data.value - this.data.minvalue) + (this.data.value - this.data.minvalue);\n  };\n\n  calculateCurve = data => {\n    const start = this.degreesToRadians(this.startAngle);\n    const end = start + (data * (this.degreesToRadians(this.endAngle) - start)) / this.data.maxvalue;\n\n    return [\n      {\n        startAngle: start,\n        endAngle: end\n      }\n    ];\n  };\n\n  drawChart = () => {\n    this.gauge = this.svg.append('g').attr('class', 'gauge-group');\n\n    // background arc\n    this.gauge\n      .append('path')\n      .data(this.calculateCurve(this.data.maxvalue))\n      .attr('class', 'gauge-background')\n      .attr('d', d => {\n        return this.arc({\n          innerRadius: this.radius - this.gaugeWidth,\n          outerRadius: this.radius,\n          startAngle: d.startAngle,\n          endAngle: d.endAngle\n        });\n      });\n\n    // value arc\n    this.gauge\n      .append('path')\n      .data(this.calculateCurve(this.calculateMinMax()))\n      .attr('class', 'gauge-value')\n      .attr('fill', this.color)\n      .attr('d', d => {\n        return this.arc({\n          innerRadius: this.radius - this.gaugeWidth,\n          outerRadius: this.radius,\n          startAngle: d.startAngle,\n          endAngle: d.endAngle\n        });\n      });\n\n    switch (this.type) {\n      case 'horseshoe':\n        this.svg.attr('height', 230).attr('viewBox', `-${this.width / 2} -${this.height / 2} ${this.height} 230`);\n        break;\n      case 'halfmoon':\n        this.svg.attr('height', this.width / 2);\n        this.svg.attr('viewBox', `-${this.width / 2} -${this.width / 2} ${this.width} ${this.width / 2}`);\n        break;\n    }\n  };\n\n  updateChart = () => {\n    const group = this.svg.select('.gauge-group');\n\n    group\n      .select('.gauge-value')\n      .transition()\n      .duration(750)\n      .call(this.arcTween, this.calculateMinMax());\n\n    this.labelTween = this.chart.select('.gauge-number');\n\n    this.labelTween\n      .transition()\n      .duration(750)\n      .call(this.textTween, this.data.value);\n  };\n\n  arcTween = (transition, value) => {\n    const newAngle = this.calculateCurve(value);\n\n    transition.attrTween('d', d => {\n      const interpolate = d3_interpolate(d.endAngle, newAngle[0].endAngle);\n\n      return t => {\n        d.endAngle = interpolate(t);\n\n        return this.arc({\n          innerRadius: this.radius - this.gaugeWidth,\n          outerRadius: this.radius,\n          startAngle: d.startAngle,\n          endAngle: d.endAngle\n        });\n      };\n    });\n  };\n\n  textTween = (transition, value) => {\n    value = d3_format('.4f')(value);\n    value = value.replace(/,/g, '.');\n\n    transition.tween('text', () => {\n      const interpolate = d3_interpolate(d3_format('.4f')(+this.oldValue), value);\n\n      return t => {\n        this.labelTween.text(d => {\n          const updatedNumber = this.labelFormat(interpolate(t));\n          this.label = updatedNumber;\n          return updatedNumber;\n        });\n      };\n    });\n  };\n}\n","import {\n  Component,\n  OnInit,\n  Input,\n  ElementRef,\n  HostBinding,\n  ChangeDetectionStrategy,\n  OnChanges,\n  SimpleChanges\n} from '@angular/core';\n\nimport { select as d3_select } from 'd3-selection';\nimport { line as d3_line, area as d3_area } from 'd3-shape';\nimport { scaleLinear as d3_scaleLinear } from 'd3-scale';\nimport { min as d3_min, max as d3_max } from 'd3-array';\n\nimport { PbdsDatavizSparkline } from './dataviz.interfaces';\n\n@Component({\n  selector: 'pbds-dataviz-sparkline',\n  template: ``,\n  styles: [],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class PbdsDatavizSparklineComponent implements OnInit, OnChanges {\n  @HostBinding('class.pbds-chart')\n  chartClass = true;\n\n  @HostBinding('class.pbds-chart-sparkline')\n  sparklineClass = true;\n\n  @Input()\n  data: PbdsDatavizSparkline;\n\n  @Input()\n  width = 160;\n\n  @Input()\n  height = 40;\n\n  @Input()\n  type: 'line' | 'line-high' | 'area' | 'area-high' | 'bar' = 'line';\n\n  @Input()\n  color = '#E23DA8';\n\n  @Input()\n  colorNegative: string | null = null; // undocumented, may add if needed\n\n  @Input()\n  strokeWidth = 2; // undocumented, width is automatically set by the type\n\n  @Input()\n  yAxisMinBuffer = 0;\n\n  @Input()\n  yAxisMaxBuffer = 0;\n\n  private chart;\n  private svg;\n  private margin;\n\n  constructor(private _element: ElementRef) {}\n\n  ngOnInit() {\n    this.margin = { top: 1, right: 0, bottom: 1, left: 0 };\n\n    if (this.type === 'bar') {\n      this.margin = { top: 0, right: 0, bottom: 0, left: 0 };\n    }\n\n    if (this.type === 'line-high' || this.type === 'area-high') {\n      this.strokeWidth = 1;\n    }\n\n    if (this.colorNegative === null) {\n      this.colorNegative = this.color;\n    }\n\n    this.chart = d3_select(this._element.nativeElement).attr('aria-hidden', 'true');\n\n    this.svg = this.chart\n      .append('svg')\n      .attr('width', this.width)\n      .attr('height', this.height)\n      .attr('class', 'img-fluid')\n      .attr('preserveAspectRatio', 'xMinYMin meet')\n      .attr('viewBox', `-${this.margin.left} -${this.margin.top} ${this.width} ${this.height}`);\n\n    if (this.type === 'line' || this.type === 'line-high' || this.type === 'area' || this.type === 'area-high') {\n      this.svg\n        .append('path')\n        .attr('class', 'sparkline')\n        .attr('fill', 'none')\n        .attr('stroke-width', this.strokeWidth)\n        .attr('stroke', this.color);\n    }\n\n    if (this.type === 'area' || this.type === 'area-high') {\n      this.svg\n        .append('path')\n        .attr('class', 'sparkarea')\n        .attr('fill', this.color)\n        .attr('fill-opacity', 0.3);\n    }\n\n    this.updateChart();\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    if (changes.data && !changes.data.firstChange) {\n      this.updateChart();\n    }\n  }\n\n  updateChart() {\n    const data: any = this.data;\n\n    const x = d3_scaleLinear()\n      .domain([0, this.data.length])\n      .range([0, this.width - this.margin.left - this.margin.right]);\n\n    const y = d3_scaleLinear()\n      .domain([+d3_min(this.data) - this.yAxisMinBuffer, +d3_max(this.data) + this.yAxisMaxBuffer])\n      .range([this.height - this.margin.top - this.margin.bottom, 0]);\n\n    const line = d3_line()\n      .x((d, i) => x(i))\n      .y((d: any) => y(d));\n\n    const area = d3_area()\n      .x((d, i) => x(i))\n      .y0(this.height)\n      .y1((d: any) => y(d));\n\n    if (this.type === 'line' || this.type === 'line-high' || this.type === 'area' || this.type === 'area-high') {\n      this.svg\n        .selectAll('.sparkline')\n        .transition()\n        .duration(1000)\n        .attr('d', () => line(data));\n    }\n\n    if (this.type === 'area' || this.type === 'area-high') {\n      this.svg\n        .selectAll('.sparkarea')\n        .transition()\n        .duration(1000)\n        .attr('d', () => area(data));\n    }\n\n    if (this.type === 'bar') {\n      const barWidth = (this.width - this.data.length) / this.data.length;\n\n      // handles negative values, see example https://www.essycode.com/posts/create-sparkline-charts-d3/\n      this.svg\n        .selectAll('.sparkbar')\n        .data(this.data)\n        .join(\n          enter =>\n            enter\n              .append('rect')\n              .attr('class', 'sparkbar')\n              .attr('x', (d, i) => x(i))\n              .attr('y', this.height)\n              .attr('width', barWidth)\n              .attr('fill', d => (d > 0 ? this.color : this.colorNegative)) // still uses undocumented negative color values\n              .attr('height', 0)\n              .call(enter => {\n                enter\n                  .transition()\n                  .duration(1000)\n                  .attr('y', d => (d > 0 ? y(d) : y(0)))\n                  .attr('height', d => Math.abs(y(d) - y(0)));\n\n                return enter;\n              }),\n          update =>\n            update\n              .transition()\n              .duration(1000)\n              .attr('x', (d, i) => x(i))\n              .attr('y', d => (d > 0 ? y(d) : y(0)))\n              .attr('width', barWidth)\n              .attr('height', d => Math.abs(y(d) - y(0)))\n              .attr('fill', d => (d > 0 ? this.color : this.colorNegative)),\n          exit => exit.remove()\n        );\n    }\n  }\n}\n","import {\n  Component,\n  OnInit,\n  OnChanges,\n  Input,\n  Output,\n  EventEmitter,\n  ElementRef,\n  HostBinding,\n  OnDestroy,\n  SimpleChanges,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { ViewportScroller } from '@angular/common';\n\nimport { select as d3_select, event as d3_event } from 'd3-selection';\nimport { scaleOrdinal as d3_scaleOrdinal, scaleLinear as d3_scaleLinear, scaleBand as d3_scaleBand } from 'd3-scale';\nimport { max as d3_max } from 'd3-array';\nimport { axisBottom as d3_axisBottom, axisLeft as d3_axisLeft } from 'd3-axis';\nimport { isoParse as d3_isoParse } from 'd3-time-format';\nimport { stack as d3_stack, stackOrderNone as d3_stackOrderNone } from 'd3-shape';\n\nimport { PbdsDatavizService } from './dataviz.service';\nimport { PbdsDatavizBarStacked } from './dataviz.interfaces';\n\n@Component({\n  selector: 'pbds-dataviz-bar-stacked',\n  template: ``,\n  styles: [],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class PbdsDatavizBarStackedComponent implements OnInit, OnDestroy, OnChanges {\n  @HostBinding('class.pbds-chart')\n  chartClass = true;\n\n  @HostBinding('class.pbds-chart-stacked-bar')\n  stackedBarClass = true;\n\n  @Input()\n  data: Array<PbdsDatavizBarStacked>;\n\n  @Input()\n  width = 306;\n\n  @Input()\n  height = 400;\n\n  @Input()\n  type: 'low' | 'medium' | 'high' | 'debug' = 'medium'; // debug to show all chart options\n\n  @Input()\n  marginTop = 10; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  marginRight = 0; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  marginBottom = 30; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  marginLeft = 55; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  hideXAxis = false;\n\n  @Input()\n  xAxisFormatType: 'number' | 'time' = null;\n\n  @Input()\n  xAxisFormatString = '';\n\n  @Input()\n  yAxisFormatType: 'number' | 'time' = null;\n\n  @Input()\n  yAxisFormatString = '';\n\n  @Input()\n  yAxisTicks = 5;\n\n  @Input()\n  yAxisMaxBuffer = 0.01;\n\n  @Input()\n  hideLegend = false;\n\n  @Input()\n  legendWidth = 105 + 28; // hardcoded legend width + left margin, do not document until feedback\n\n  @Input()\n  legendPosition: 'right' | 'bottom' = 'right';\n\n  @Input()\n  legendLabelFormatType: 'number' | 'time' = null;\n\n  @Input()\n  legendLabelFormatString = '';\n\n  @Input()\n  tooltipHeadingFormatType: 'time' = null;\n\n  @Input()\n  tooltipHeadingFormatString = '';\n\n  @Input()\n  tooltipHeadingValueFormatType: 'number' = null;\n\n  @Input()\n  tooltipHeadingValueFormatString = '';\n\n  @Input()\n  tooltipLabelFormatType: 'time' = null;\n\n  @Input()\n  tooltipLabelFormatString = '';\n\n  @Input()\n  tooltipValueFormatType: 'number' = null;\n\n  @Input()\n  tooltipValueFormatString = '';\n\n  @Input()\n  theme;\n\n  @Output()\n  hovered: EventEmitter<object> = new EventEmitter<object>();\n\n  @Output()\n  clicked: EventEmitter<object> = new EventEmitter<object>();\n\n  private dataStack;\n  private dataKeys;\n  private chart;\n  private svg;\n  private grayBars;\n  private mouseBars;\n  private bars;\n  private margin;\n  private colorRange;\n  private hideGrayBars: boolean;\n  private xAxisScale;\n  private xAxisCall;\n  private xAxis;\n  private xAxisFormat;\n  private xAxisTickSize: number;\n  private xAxisTickSizeOuter: number;\n  private hideXAxisDomain: boolean;\n  private hideXAxisZero: boolean;\n  private hideXAxisTicks: boolean;\n  private hideXGrid: boolean;\n  private hideYGrid: boolean;\n  private yAxisMax;\n  private yAxisScale;\n  private yAxisCall;\n  private yAxis;\n  private yAxisFormat;\n  private yAxisTickSize: number;\n  private yAxisTickSizeOuter: number;\n  private xGrid;\n  private xGridCall;\n  private yGrid;\n  private yGridCall;\n  private hideYAxis: boolean;\n  private hideYAxisZero: boolean;\n  private hideYAxisDomain: boolean;\n  private hideYAxisTicks: boolean;\n  private legendLabelFormat;\n  private tooltip;\n  private hideTooltip: boolean;\n  private tooltipHeadingFormat;\n  private tooltipHeadingValueFormat;\n  private tooltipValueFormat;\n  private tooltipLabelFormat;\n\n  constructor(private _dataviz: PbdsDatavizService, private _element: ElementRef, private _scroll: ViewportScroller) {}\n\n  ngOnInit() {\n    // extract keys for stack data\n    this.dataKeys = Object.keys(this.data[0]).filter(item => item !== 'key');\n\n    // create the D3 stack data\n    this.dataStack = d3_stack()\n      .keys(this.dataKeys)\n      .order(d3_stackOrderNone)(this.data);\n\n    //////////////////////////////////////////\n\n    this.margin = {\n      top: +this.marginTop,\n      right: +this.marginRight,\n      bottom: +this.marginBottom,\n      left: +this.marginLeft\n    };\n\n    // create formatters\n    this.xAxisFormat = this._dataviz.d3Format(this.xAxisFormatType, this.xAxisFormatString);\n    this.yAxisFormat = this._dataviz.d3Format(this.yAxisFormatType, this.yAxisFormatString);\n    this.legendLabelFormat = this._dataviz.d3Format(this.legendLabelFormatType, this.legendLabelFormatString);\n    this.tooltipHeadingFormat = this._dataviz.d3Format(this.tooltipHeadingFormatType, this.tooltipHeadingFormatString);\n    this.tooltipHeadingValueFormat = this._dataviz.d3Format(\n      this.tooltipHeadingValueFormatType,\n      this.tooltipHeadingValueFormatString\n    );\n    this.tooltipLabelFormat = this._dataviz.d3Format(this.tooltipLabelFormatType, this.tooltipLabelFormatString);\n    this.tooltipValueFormat = this._dataviz.d3Format(this.tooltipValueFormatType, this.tooltipValueFormatString);\n\n    // defaults for all chart types\n    this.hideGrayBars = false;\n    this.hideYAxis = false;\n    this.hideXAxisZero = false;\n    this.hideYAxisZero = false;\n    this.hideXGrid = false;\n    this.hideYGrid = false;\n    this.hideXAxisDomain = false;\n    this.hideYAxisDomain = false;\n    this.hideTooltip = false;\n    this.hideXAxisTicks = false;\n    this.hideYAxisTicks = false;\n    this.xAxisTickSize = 8;\n    this.xAxisTickSizeOuter = 0;\n    this.yAxisTickSize = 8;\n    this.yAxisTickSizeOuter = 0;\n    // this.hideTooltipLabel = false;\n\n    if (this.type !== 'debug') {\n      // set type defaults\n      switch (this.type) {\n        case 'low':\n          this.hideGrayBars = true;\n          this.hideXAxisTicks = true;\n          this.hideXGrid = true;\n          this.hideYAxisDomain = false;\n          this.hideYAxisTicks = true;\n          this.legendPosition = 'bottom';\n          break;\n\n        case 'medium':\n          this.hideXAxisDomain = true;\n          this.hideXGrid = true;\n          this.hideXAxisTicks = true;\n          this.hideYAxisDomain = true;\n          this.hideYAxisTicks = true;\n          this.hideYGrid = true;\n          break;\n\n        case 'high':\n          this.hideXAxis = true;\n          this.hideXAxisTicks = true;\n          this.hideXAxisDomain = true;\n          this.hideXGrid = true;\n          this.hideYAxisDomain = true;\n          this.hideYAxisTicks = true;\n          this.hideYGrid = true;\n          this.hideLegend = false;\n          this.legendPosition = 'bottom';\n          break;\n      }\n    }\n\n    // adjust margin if xAxis hidden\n    if (this.hideXAxis) this.margin.bottom = 10; // need small margin for yAxis with 0 tick label\n\n    if (!this.hideLegend && this.legendPosition === 'right') {\n      this.width = +this.width - +this.legendWidth;\n    }\n\n    // create the chart\n    this.chart = d3_select(this._element.nativeElement).attr('aria-hidden', 'true');\n\n    // create chart svg\n    this.svg = this.chart\n      .append('svg')\n      .attr('width', +this.width)\n      .attr('height', +this.height + this.margin.top + this.margin.bottom)\n      .attr('class', 'img-fluid')\n      .attr('preserveAspectRatio', 'xMinYMin meet')\n      .attr(\n        'viewBox',\n        `-${this.margin.left} -${this.margin.top} ${+this.width} ${+this.height + this.margin.top + this.margin.bottom}`\n      );\n\n    this.grayBars = this.svg.append('g').attr('class', 'gray-bars');\n    this.mouseBars = this.svg.append('g').attr('class', 'mouseover-bars');\n    this.bars = this.svg.append('g').attr('class', 'bars');\n\n    // build color ranges\n    this.colorRange = d3_scaleOrdinal().range(this._dataviz.getColors(false, this.theme));\n\n    // X AXIS\n    this.xAxisScale = d3_scaleBand()\n      .domain(this.data.map(d => d.key))\n      .rangeRound([0, this.width - this.margin.left])\n      .align(0);\n\n    // add padding to the scale for gray bars\n    !this.hideGrayBars\n      ? this.xAxisScale.paddingInner(0.1).paddingOuter(0)\n      : this.xAxisScale.paddingInner(0).paddingOuter(0);\n\n    this.xAxisCall = d3_axisBottom(this.xAxisScale)\n      .tickSize(this.xAxisTickSize)\n      .tickSizeOuter(this.xAxisTickSizeOuter)\n      .tickFormat(this.xAxisFormatter);\n\n    this.xAxis = this.svg\n      .append('g')\n      .attr('class', 'axis axis-x')\n      .attr('transform', `translate(0, ${this.height})`)\n      .classed('axis-hidden', this.hideXAxis)\n      .classed('axis-zero-hidden', this.hideXAxisZero)\n      .classed('axis-domain-hidden', this.hideXAxisDomain)\n      .classed('axis-ticks-hidden', this.hideXAxisTicks)\n      .call(this.xAxisCall);\n\n    // X GRIDLINES\n    if (!this.hideXGrid) {\n      this.xGridCall = d3_axisBottom(this.xAxisScale).tickSize(-this.height);\n\n      this.xGrid = this.svg\n        .append('g')\n        .attr('class', 'grid grid-x')\n        .classed('grid-zero-hidden', this.hideXAxisZero)\n        .attr('transform', `translate(0, ${this.height})`)\n        .call(this.xGridCall);\n    }\n\n    // KEEP: use this block to debug yAxisMax\n    // console.log(\n    //   d3_max(this.dataStack, (data: any) => {\n    //     // console.log(data);\n\n    //     return d3_max(data, (d: any) => {\n    //       // console.log('D: ', d);\n    //       return d[1];\n    //     });\n    //   })\n    // );\n\n    // Y AXIS\n    this.yAxisMax = d3_max(this.dataStack, (data: any) => {\n      return d3_max(data, (d: any) => {\n        return d[1];\n      });\n    });\n\n    this.yAxisMax = this.yAxisMax + this.yAxisMax * this.yAxisMaxBuffer;\n\n    this.yAxisScale = d3_scaleLinear()\n      .domain([0, this.yAxisMax])\n      .nice()\n      .rangeRound([this.height, 0]);\n\n    this.yAxisCall = d3_axisLeft(this.yAxisScale)\n      .ticks(this.yAxisTicks)\n      .tickSize(this.yAxisTickSize)\n      .tickSizeOuter(this.yAxisTickSizeOuter)\n      .tickFormat(this.yAxisFormatter);\n\n    this.yAxis = this.svg\n      .append('g')\n      .attr('class', 'axis axis-y')\n      .classed('axis-hidden', this.hideYAxis)\n      .classed('axis-zero-hidden', this.hideYAxisZero)\n      .classed('axis-domain-hidden', this.hideYAxisDomain)\n      .classed('axis-ticks-hidden', this.hideYAxisTicks)\n      .call(this.yAxisCall);\n\n    // Y GRIDLINES\n    if (!this.hideYGrid) {\n      this.yGridCall = d3_axisLeft(this.yAxisScale)\n        .ticks(this.yAxisTicks)\n        .tickSize(-this.width + this.margin.left + this.margin.right);\n\n      this.yGrid = this.svg\n        .append('g')\n        .attr('class', 'grid grid-y')\n        .classed('grid-zero-hidden', this.hideYAxisZero)\n        .attr('transform', `translate(0, 0)`)\n        .call(this.yGridCall);\n    }\n\n    // TOOLTIP\n    if (!this.hideTooltip) {\n      this.tooltip = d3_select('body')\n        .append('div')\n        .attr('class', 'pbds-tooltip west')\n        .style('opacity', 0)\n        .attr('aria-hidden', 'true'); // hide tooltip for accessibility\n\n      // tooltip header\n      this.tooltip.append('div').attr('class', 'tooltip-header');\n      this.tooltip.append('div').attr('class', 'tooltip-header-value');\n\n      // tooltip table\n      this.tooltip\n        .append('table')\n        .attr('class', 'tooltip-table text-left w-100')\n        .append('tbody');\n    }\n\n    // add legend classes\n    if (!this.hideLegend) {\n      this.chart.classed('pbds-chart-legend-bottom', this.legendPosition === 'bottom' ? true : false);\n      this.chart.append('ul').attr('class', `legend legend-${this.legendPosition}`);\n    }\n\n    this.updateChart();\n  }\n\n  ngOnDestroy() {\n    if (this.tooltip) this.tooltip.remove();\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    if (changes.data && !changes.data.firstChange) {\n      this.updateChart(false);\n    }\n  }\n\n  updateChart = (firstRun = true) => {\n    this.dataKeys = Object.keys(this.data[0]).filter(item => item !== 'key');\n\n    // create the D3 stack data\n    this.dataStack = d3_stack()\n      .keys(this.dataKeys)\n      .order(d3_stackOrderNone)(this.data);\n\n    // update the xScale\n    this.xAxisScale.domain(this.data.map(d => d.key));\n\n    // update the yScale\n    this.yAxisMax = d3_max(this.dataStack, (data: any) => {\n      return d3_max(data, (d: any) => {\n        return d[1];\n      });\n    });\n\n    this.yAxisMax = this.yAxisMax + this.yAxisMax * this.yAxisMaxBuffer;\n\n    this.yAxisScale\n      .domain([0, this.yAxisMax])\n      .rangeRound([this.height, 0])\n      .nice();\n\n    this.xAxis\n      .transition()\n      .duration(0) // 1000\n      .call(this.xAxisCall);\n\n    this.yAxis\n      .transition()\n      .duration(0) // 1000\n      .call(this.yAxisCall);\n\n    // update the grids\n    if (!this.hideXGrid) {\n      this.xGrid\n        .transition()\n        .duration(0) // 1000\n        .call(this.xGridCall);\n    }\n\n    if (!this.hideYGrid) {\n      this.yGrid\n        .transition()\n        .duration(0) // 1000\n        .call(this.yGridCall);\n    }\n\n    // add gray bars\n    if (!this.hideGrayBars) {\n      this.grayBars\n        .selectAll('.gray-bar')\n        .data(this.data)\n        .join(\n          enter =>\n            enter\n              .append('rect')\n              .attr('class', 'gray-bar')\n              .attr('x', d => this.xAxisScale(d.key))\n              .attr('width', this.xAxisScale.bandwidth())\n              .attr('height', this.height),\n          update =>\n            update\n              .transition()\n              .duration((d, i, n) => (firstRun ? 0 : 1000))\n              .attr('x', d => this.xAxisScale(d.key))\n              .attr('width', this.xAxisScale.bandwidth())\n              .attr('height', this.height),\n          exit => exit.remove()\n        );\n    }\n\n    // add colored bars\n    const barGroups = this.bars\n      .selectAll('.bar-group')\n      .data(this.dataStack)\n      .join(\n        enter =>\n          enter\n            .append('g')\n            .attr('class', 'bar-group')\n            .attr('fill', d => this.colorRange(d.index)),\n        update => update.attr('fill', d => this.colorRange(d.index)),\n        exit => exit.remove()\n      );\n\n    barGroups\n      .selectAll('.bar')\n      .data(d => d)\n      .join(\n        enter =>\n          enter\n            .append('rect')\n            .attr('class', 'bar')\n            .classed('bar-divided', this.type !== 'high')\n            .classed('bar-divided-low', this.type === 'low')\n            .attr('x', (d, i) => {\n              let x;\n\n              if (this.type === 'medium') {\n                x = this.xAxisScale(d.data.key) + (this.xAxisScale.bandwidth() / 8) * 3;\n              } else {\n                x = this.xAxisScale(d.data.key) + (this.xAxisScale.bandwidth() / 4) * 1;\n              }\n\n              return x;\n            })\n            .attr('y', d => this.yAxisScale(d[0]))\n            .attr('width', d => {\n              let width;\n\n              if (this.type === 'medium') {\n                width = this.xAxisScale.bandwidth() / 4;\n              } else {\n                width = this.xAxisScale.bandwidth() / 2;\n              }\n\n              return width;\n            })\n            .attr('height', 0)\n            .call(enter => {\n              enter\n                .transition()\n                .duration((d, i, n) => (firstRun ? 0 : 500))\n                .delay((d, i, n) => (firstRun ? 0 : 750))\n                .attr('y', d => this.yAxisScale(d[1]))\n                .attr('height', d => {\n                  return this.yAxisScale(d[0]) - this.yAxisScale(d[1]);\n                });\n\n              return enter;\n            }),\n        update =>\n          update.call(update => {\n            // let width;\n\n            // if (this.type === 'medium') {\n            //   width = this.xAxisScale.bandwidth() / 4;\n            // } else {\n            //   width = this.xAxisScale.bandwidth() / 2;\n            // }\n\n            update\n              .transition()\n              .duration(1000)\n              .attr('width', this.xAxisScale.bandwidth() / 4)\n              .attr('x', (d, i) => this.xAxisScale(d.data.key) + (this.xAxisScale.bandwidth() / 8) * 3)\n              .attr('y', d => this.yAxisScale(d[1]))\n              .attr('height', d => this.yAxisScale(d[0]) - this.yAxisScale(d[1]));\n\n            return update;\n          }),\n\n        exit => exit.remove()\n      );\n\n    // mouseover bars\n    this.mouseBars\n      .selectAll('.mouseover-bar')\n      .data(this.data)\n      .join(\n        enter =>\n          enter\n            .append('rect')\n            .attr('class', 'mouseover-bar')\n            .style('opacity', 0)\n            .attr('x', d => this.xAxisScale(d.key))\n            .attr('width', this.xAxisScale.bandwidth())\n            .attr('height', this.height),\n        update =>\n          update\n            .attr('pointer-events', 'none')\n            .attr('x', d => this.xAxisScale(d.key))\n            .attr('width', this.xAxisScale.bandwidth())\n            .attr('height', this.height)\n            .transition()\n            .attr('pointer-events', 'auto'),\n        exit =>\n          exit\n            .transition()\n            .attr('pointer-events', 'none')\n            .remove()\n      )\n      .on('mouseover', (data, index, nodes) => this.barMouseOver(d3_event, data, index, nodes))\n      .on('mouseout', (data, index, nodes) => this.barMouseOut())\n      .on('click', (data, index, nodes) => this.barMouseClick(d3_event, data, index, nodes));\n\n    this.bars.raise();\n    this.xAxis.raise();\n    this.mouseBars.raise();\n\n    if (!this.hideLegend) {\n      this.chart\n        .select('.legend')\n        .selectAll('.legend-item')\n        .data(this.dataStack)\n        .join(\n          enter => {\n            const li = enter.append('li').attr('class', 'legend-item');\n\n            li.append('span')\n              .attr('class', 'legend-key')\n              .style('background-color', d => this.colorRange(d.index));\n\n            li.append('span')\n              .attr('class', 'legend-label')\n              .html(d => {\n                switch (this.legendLabelFormatType) {\n                  case 'number':\n                    return this.legendLabelFormat(d.key);\n\n                  case 'time':\n                    const parsedTime = d3_isoParse(d.key);\n                    return this.legendLabelFormat(parsedTime);\n\n                  default:\n                    return d.key;\n                }\n              });\n\n            return li;\n          },\n          update => {\n            update.select('.legend-label').html(d => {\n              switch (this.legendLabelFormatType) {\n                case 'number':\n                  return this.legendLabelFormat(d.key);\n\n                case 'time':\n                  const parsedTime = d3_isoParse(d.key);\n                  return this.legendLabelFormat(parsedTime);\n\n                default:\n                  return d.key;\n              }\n            });\n\n            return update;\n          },\n          exit => exit.remove()\n        )\n        .on('mouseover', (data, index, nodes) => this.legendMouseOver(d3_event, data, index, nodes))\n        .on('mouseout', () => this.legendMouseOut())\n        .on('click', (data, index, nodes) => this.legendMouseClick(d3_event, data, index, nodes));\n    }\n  };\n\n  barMouseOver = (event, data, index, nodes) => {\n    this.chart\n      .selectAll('.bar-group')\n      .selectAll('.bar')\n      .filter((d, i) => i !== index)\n      .classed('inactive', true);\n\n    this.tooltipShow(data, index, nodes[index]);\n\n    this.hovered.emit({ event, data });\n  };\n\n  barMouseOut = () => {\n    this.chart.selectAll('.bar').classed('inactive', false);\n\n    this.tooltipHide();\n  };\n\n  barMouseClick = (event, data, index, nodes) => {\n    this.clicked.emit({ event, data });\n  };\n\n  legendMouseOver = (event, data, index, nodes) => {\n    this.chart\n      .selectAll('.legend-item')\n      .filter((d, i) => i !== index)\n      .classed('inactive', true);\n\n    this.chart\n      .selectAll('.bar-group')\n      .filter((d, i) => i !== index)\n      .classed('inactive', true);\n\n    this.hovered.emit({ event, data });\n  };\n\n  legendMouseOut = () => {\n    this.chart.selectAll('.legend-item').classed('inactive', false);\n\n    this.chart.selectAll('.bar-group').classed('inactive', false);\n\n    this.tooltipHide();\n  };\n\n  legendMouseClick = (event, data, index, nodes) => {\n    this.clicked.emit({ event, data });\n  };\n\n  private xAxisFormatter = item => {\n    switch (this.xAxisFormatType) {\n      case 'number':\n        return this.xAxisFormat(item);\n\n      case 'time':\n        const parseDate = d3_isoParse(item);\n        return this.xAxisFormat(parseDate);\n\n      default:\n        return item;\n    }\n  };\n\n  private tooltipShow = (data, index, node) => {\n    // console.log('TOOLTIP: ', data, index, node);\n\n    const scroll = this._scroll.getScrollPosition();\n    const mouserectDimensions = node.getBoundingClientRect();\n    const clientWidth = document.body.clientWidth - 10;\n    let dimensionCalculated;\n    let tooltipDimensions;\n    let tooltipOffsetHeight;\n    let yPosition;\n    let xPosition;\n\n    // console.log(scroll, mouserectDimensions, tooltipOffsetHeight, tooltipDimensions, dimensionCalculated, clientWidth);\n\n    this.tooltip.select('.tooltip-header').html(d => {\n      switch (this.tooltipHeadingFormatType) {\n        case 'time':\n          const parseDate = d3_isoParse(data.key);\n          return this.tooltipHeadingFormat(parseDate);\n\n        default:\n          return data.key;\n      }\n    });\n\n    this.tooltip.select('.tooltip-header-value').html(d => {\n      let total = 0;\n\n      Object.keys(data).map(e => {\n        if (e !== 'key') {\n          total = total + data[e];\n        }\n      });\n\n      return this.tooltipHeadingValueFormat(total);\n    });\n\n    this.tooltip\n      .select('.tooltip-table')\n      .select('tbody')\n      .html(d => {\n        let html = ``;\n        let label;\n        let value;\n\n        Object.keys(data).map((key, index) => {\n          switch (this.tooltipLabelFormatType) {\n            case 'time':\n              const parseDate = d3_isoParse(key);\n              label = this.tooltipHeadingFormat(parseDate);\n              break;\n\n            default:\n              label = key;\n          }\n\n          switch (this.tooltipValueFormatType) {\n            case 'number':\n              value = this.tooltipValueFormat(data[key]);\n              break;\n\n            default:\n              value = data[key];\n          }\n\n          if (key !== 'key') {\n            html += `\n              <tr class='tooltip-item'>\n                <td style=\"color: ${this.colorRange(index - 1)}\">\n                  <span class=\"pbds-tooltip-key\"></span>\n                </td>\n                <td class=\"tooltip-label pr-2 text-nowrap\">${label}</td>\n                <td class=\"tooltip-value text-right text-nowrap\">${value}</td>\n              </tr>\n            `;\n          }\n        });\n\n        return html;\n      });\n\n    tooltipDimensions = this.tooltip.node().getBoundingClientRect();\n    dimensionCalculated = mouserectDimensions.left + mouserectDimensions.width + tooltipDimensions.width + 8;\n    tooltipOffsetHeight = +this.tooltip.node().offsetHeight;\n\n    // flip the tooltip positions if near the right edge of the screen\n    if (dimensionCalculated > clientWidth) {\n      this.tooltip.classed('east', true);\n      this.tooltip.classed('west', false);\n\n      if (this.type === 'medium') {\n        xPosition = `${mouserectDimensions.left + (mouserectDimensions.width / 8) * 3 - tooltipDimensions.width - 8}px`;\n      } else {\n        xPosition = `${mouserectDimensions.left + (mouserectDimensions.width / 4) * 1 - tooltipDimensions.width - 8}px`;\n      }\n    } else if (dimensionCalculated < clientWidth) {\n      this.tooltip.classed('east', false);\n      this.tooltip.classed('west', true);\n\n      if (this.type === 'medium') {\n        xPosition = `${mouserectDimensions.left + (mouserectDimensions.width / 8) * 5 + 8}px`;\n      } else {\n        xPosition = `${mouserectDimensions.left + (mouserectDimensions.width / 4) * 3 + 8}px`;\n      }\n    }\n\n    yPosition = this.svg\n      .selectAll('.bar-group')\n      .filter(':last-child')\n      .selectAll('.bar')\n      .filter((d, i) => i === index)\n      .node()\n      .getBoundingClientRect();\n\n    // set the tooltip styles\n    this.tooltip.style('top', `${yPosition.top - tooltipOffsetHeight / 2 + scroll[1]}px`);\n    this.tooltip.style('left', xPosition);\n    this.tooltip.style('opacity', 1);\n  };\n\n  private tooltipHide = () => {\n    this.tooltip.style('opacity', 0);\n  };\n\n  private yAxisFormatter = item => {\n    switch (this.yAxisFormatType) {\n      case 'number':\n        return this.yAxisFormat(item);\n\n      case 'time':\n        const parseDate = d3_isoParse(item);\n        return this.yAxisFormat(parseDate);\n\n      default:\n        return item;\n    }\n  };\n}\n","import { Component, Input, HostBinding } from '@angular/core';\n\n@Component({\n  selector: 'pbds-dataviz-metric-indicator',\n  template: `\n    <span>{{ value }}</span>\n  `,\n  styles: []\n})\nexport class PbdsDatavizMetricIndicatorComponent {\n  @Input()\n  value = 0;\n\n  @Input()\n  class = '';\n\n  @Input()\n  indicator: 'flat' | 'increase' | 'decrease' = 'flat';\n\n  @Input()\n  inverse = false;\n\n  @HostBinding('class')\n  get hostClasses() {\n    return ['metric-block-indicator', this.indicator, this.inverse ? 'inverse' : '', this.class].join(' ');\n  }\n}\n","import { Component, OnInit, Input, HostBinding, ElementRef, ContentChild } from '@angular/core';\n\nimport { PbdsDatavizMetricIndicatorComponent } from './dataviz-metric-indicator.component';\n\n@Component({\n  selector: 'pbds-dataviz-metric-block',\n  template: `\n    <div class=\"metric-block-inner\">\n      <div *ngIf=\"heading\" class=\"metric-block-heading\">\n        {{ heading }}\n        <i\n          *ngIf=\"infoMessage\"\n          class=\"pbi-icon-mini pbi-info-circle-open ml-1 align-middle\"\n          ngbTooltip=\"{{ infoMessage }}\"\n          container=\"body\"\n        ></i>\n      </div>\n      <div class=\"metric-block-data-block\">\n        <div class=\"metric-block-contents\">\n          <div class=\"metric-block-value\" [ngClass]=\"{ 'mr-0': hideValueMargin }\">\n            {{ value\n            }}<span [ngClass]=\"{ 'metric-block-unit': isUnit, 'metric-block-percentage': isPercentUnit }\">{{\n              unit\n            }}</span>\n          </div>\n\n          <div>\n            <ng-content select=\"pbds-dataviz-metric-indicator\"></ng-content>\n          </div>\n          <div *ngIf=\"description\" class=\"metric-block-description\">{{ description }}</div>\n        </div>\n        <ng-content select=\"pbds-dataviz-sparkline\"></ng-content>\n      </div>\n    </div>\n  `,\n  styles: []\n})\nexport class PbdsDatavizMetricBlockComponent implements OnInit {\n  @Input()\n  class = '';\n\n  @Input()\n  heading: string = null;\n\n  @Input()\n  value = 0;\n\n  @Input()\n  unit: string = null;\n\n  @Input()\n  description: string = null;\n\n  @Input()\n  centered = false;\n\n  @Input()\n  centeredText = false;\n\n  @Input()\n  vertical = false;\n\n  @Input()\n  infoMessage: string | null = null;\n\n  hideValueMargin = false;\n  isPercentUnit = false;\n  isUnit = false;\n\n  @HostBinding('class')\n  get hostClasses() {\n    return [\n      'metric-block',\n      this.centered ? 'metric-block-centered' : '',\n      this.centeredText ? 'metric-block-centered-text' : '',\n      this.vertical ? 'metric-block-vertical' : '',\n      this.class\n    ].join(' ');\n  }\n\n  @ContentChild(PbdsDatavizMetricIndicatorComponent, { static: true }) indicatorRef: ElementRef;\n\n  ngOnInit() {\n    if (!this.indicatorRef) {\n      this.hideValueMargin = true;\n    }\n\n    if (this.unit !== '%' && this.unit !== null) {\n      this.isUnit = true;\n    } else if (this.unit === '%') {\n      this.isPercentUnit = true;\n    }\n  }\n}\n","import {\n  Component,\n  OnInit,\n  OnChanges,\n  Input,\n  Output,\n  EventEmitter,\n  ElementRef,\n  HostBinding,\n  OnDestroy,\n  SimpleChanges,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { ViewportScroller } from '@angular/common';\n\nimport { select as d3_select, event as d3_event } from 'd3-selection';\nimport { scaleLinear as d3_scaleLinear } from 'd3-scale';\nimport { min as d3_min, max as d3_max } from 'd3-array';\nimport {\n  geoPath as d3_geoPath,\n  geoAlbers as d3_geoAlbers,\n  geoAlbersUsa as d3_geoAlbersUsa,\n  geoMercator as d3_geoMercator\n} from 'd3-geo';\n\nimport * as topojson from 'topojson';\n\nimport { PbdsDatavizService } from './dataviz.service';\nimport { PbdsDatavizMapData } from './dataviz.interfaces';\n\n@Component({\n  selector: 'pbds-dataviz-bubble-map',\n  template: ``,\n  styles: [],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class DatavizBubbleMapComponent implements OnInit, OnChanges, OnDestroy {\n  @HostBinding('class.pbds-chart')\n  chartClass = true;\n\n  @HostBinding('class.pbds-chart-bubble-map')\n  bubbleMapClass = true;\n\n  @Input()\n  data: Array<PbdsDatavizMapData>;\n\n  @Input()\n  topojson;\n\n  @Input()\n  feature = '';\n\n  @Input()\n  projectionType;\n\n  @Input()\n  scale = null;\n\n  @Input()\n  center = null;\n\n  @Input()\n  width = 306;\n\n  @Input()\n  height = 400;\n\n  @Input()\n  type: 'medium' | 'high' | 'debug' = 'medium'; // debug to show all chart options\n\n  @Input()\n  dot = false;\n\n  @Input()\n  marginTop = 0;\n\n  @Input()\n  marginRight = 0;\n\n  @Input()\n  marginBottom = 0;\n\n  @Input()\n  marginLeft = 0;\n\n  @Input()\n  color = '#ef8200';\n\n  @Input()\n  textColor = '#fff';\n\n  @Input()\n  textSizeRange = [14, 24];\n\n  @Input()\n  dotSize = 4;\n\n  @Input()\n  bubbleSizeRange = [500, 2000];\n\n  @Input()\n  bubbleLabelFormatType: 'number' = null;\n\n  @Input()\n  bubbleLabelFormatString = '';\n\n  @Input()\n  hideTooltip = false;\n\n  @Input()\n  hideTooltipValue = false;\n\n  @Input()\n  tooltipValueFormatType: 'number' = null;\n\n  @Input()\n  tooltipValueFormatString = '';\n\n  @Output()\n  hovered: EventEmitter<object> = new EventEmitter<object>();\n\n  @Output()\n  clicked: EventEmitter<object> = new EventEmitter<object>();\n\n  private projection;\n  private geoPath;\n  private topojsonFeature;\n  private chart;\n  private svg;\n  private margin;\n  private bubbleContainer;\n  private bubbleRadius;\n  private fontRange;\n  private bubbleLabelFormat;\n  private tooltip;\n  private tooltipValueFormat;\n\n  constructor(private _element: ElementRef, private _scroll: ViewportScroller, private _dataviz: PbdsDatavizService) {}\n\n  ngOnInit() {\n    this.margin = {\n      top: +this.marginTop,\n      right: +this.marginRight,\n      bottom: +this.marginBottom,\n      left: +this.marginLeft\n    };\n\n    if (this.type !== 'debug') {\n      // set type defaults\n      switch (this.type) {\n        case 'medium':\n          break;\n\n        case 'high':\n          break;\n      }\n    }\n\n    switch (this.projectionType) {\n      case 'geoAlbers':\n        this.projection = d3_geoAlbers();\n        break;\n\n      case 'geoAlbersUsa':\n        this.projection = d3_geoAlbersUsa();\n        break;\n\n      case 'geoMercator':\n        this.projection = d3_geoMercator();\n        break;\n\n      default:\n        break;\n    }\n\n    // dreate formatters\n    this.bubbleLabelFormat = this._dataviz.d3Format(this.bubbleLabelFormatType, this.bubbleLabelFormatString);\n    this.tooltipValueFormat = this._dataviz.d3Format(this.tooltipValueFormatType, this.tooltipValueFormatString);\n\n    // console.log('TOPOJSON: ', this.topojson);\n\n    this.topojsonFeature = topojson.feature(this.topojson, this.topojson.objects[this.feature]);\n    this.projection.fitSize([+this.width, +this.height], this.topojsonFeature);\n\n    // console.log('TOPOJSON FEATURE: ', this.topojsonFeature);\n    // console.log('MESH: ', topojson.mesh(this.topojson, this.topojson.objects[this.feature], (a, b) => a !== b));\n    // console.log('DATA: ', this.data);\n\n    if (this.scale) {\n      this.projection.scale(+this.scale);\n    }\n\n    if (this.center) {\n      this.projection.center(this.center);\n    }\n\n    this.geoPath = d3_geoPath().projection(this.projection);\n\n    // bubble radius range\n    if (this.data && !this.dot) {\n      this.bubbleRadius = d3_scaleLinear()\n        .range(this.bubbleSizeRange)\n        .domain([d3_min(this.data, (d: any) => +d.value), d3_max(this.data, (d: any) => +d.value)]);\n\n      // font range\n      this.fontRange = d3_scaleLinear()\n        .range(this.textSizeRange)\n        .domain([d3_min(this.data, (d: any) => +d.value), d3_max(this.data, (d: any) => +d.value)]);\n    }\n\n    // TOOLTIP\n    if (!this.hideTooltip) {\n      this.tooltip = d3_select('body')\n        .append('div')\n        .attr('class', 'pbds-tooltip south')\n        .style('opacity', 0)\n        .attr('aria-hidden', 'true'); // hide tooltip for accessibility\n\n      // tooltip header\n      this.tooltip.append('div').attr('class', 'tooltip-header');\n      if (!this.hideTooltipValue) this.tooltip.append('div').attr('class', 'tooltip-value');\n    }\n\n    // create the chart\n    this.chart = d3_select(this._element.nativeElement).attr('aria-hidden', 'true');\n\n    // create chart svg\n    this.svg = this.chart\n      .append('svg')\n      .attr('width', +this.width + this.margin.left + this.margin.right)\n      .attr('height', +this.height + this.margin.top + this.margin.bottom)\n      .attr('class', 'img-fluid')\n      .attr('preserveAspectRatio', 'xMinYMin meet')\n      .attr(\n        'viewBox',\n        `-${this.margin.left} -${this.margin.top} ${+this.width + this.margin.left + this.margin.right} ${+this.height +\n          this.margin.top +\n          this.margin.bottom}`\n      )\n      .append('g')\n      .attr('class', 'container');\n\n    // map\n    this.svg\n      .append('g')\n      .attr('class', 'map')\n      .selectAll('path')\n      .data(this.topojsonFeature.features)\n      .join(enter =>\n        enter\n          .append('path')\n          .attr('class', 'feature')\n          .attr('d', this.geoPath)\n      );\n\n    // borders\n    this.svg\n      .append('path')\n      .attr('class', 'mesh')\n      .datum(topojson.mesh(this.topojson, this.topojson.objects[this.feature], (a, b) => a !== b))\n      .attr('d', this.geoPath);\n\n    this.bubbleContainer = this.svg\n      .append('g')\n      .attr('class', 'dots')\n      .style('color', this.color);\n\n    this.updateChart();\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    if (changes.data && !changes.data.firstChange) {\n      this.updateChart();\n    }\n  }\n\n  ngOnDestroy() {\n    if (this.tooltip) this.tooltip.remove();\n  }\n\n  updateChart = () => {\n    // bubbles\n\n    this.bubbleContainer\n      .selectAll('circle')\n      .data(this.data)\n      .join(\n        enter =>\n          enter\n            .append('circle')\n            .attr('class', 'dot-circle')\n            .classed('solid', this.dot)\n            .attr('cx', d => this.projection([d.longitude, d.latitude])[0])\n            .attr('cy', d => this.projection([d.longitude, d.latitude])[1])\n            .attr('r', d => (!this.dot ? Math.sqrt(this.bubbleRadius(d.value)) : `${this.dotSize}px`)),\n        update =>\n          update\n            .transition()\n            .duration(1000)\n            .attr('cx', d => this.projection([d.longitude, d.latitude])[0])\n            .attr('cy', d => this.projection([d.longitude, d.latitude])[1])\n            .attr('r', d => (!this.dot ? Math.sqrt(this.bubbleRadius(d.value)) : `${this.dotSize}px`))\n            .transition()\n            .attr('pointer-events', 'auto'),\n        exit =>\n          exit\n            .transition()\n            .attr('pointer-events', 'none')\n            .remove()\n      );\n\n    if (!this.hideTooltip) {\n      this.bubbleContainer\n        .selectAll('circle')\n        .on('mouseover', (data, index, nodes) => this.bubbleMouseOver(d3_event, data, index, nodes))\n        .on('mouseout', (data, index, nodes) => this.bubbleMouseOut(d3_event, data, index, nodes))\n        .on('click', (data, index, nodes) => this.bubbleMouseClick(d3_event, data, index, nodes));\n\n      // bubble text\n      if (this.type !== 'high' && !this.dot) {\n        this.bubbleContainer\n          .selectAll('text')\n          .data(this.data)\n          .join(\n            enter =>\n              enter\n                .append('text')\n                .text(d => (this.bubbleLabelFormat ? this.bubbleLabelFormat(d.value) : d.value))\n                .attr('class', 'dot-text')\n                .style('fill', this.textColor)\n                .style('font-size', d => `${Math.round(this.fontRange(d.value))}px`)\n                .attr('x', d => this.projection([d.longitude, d.latitude])[0])\n                .attr('y', d => this.projection([d.longitude, d.latitude])[1])\n                .attr('dy', '.4em'),\n            update =>\n              update\n                .attr('pointer-events', 'none')\n                .transition()\n                .duration(1000)\n                .text(d => (this.bubbleLabelFormat ? this.bubbleLabelFormat(d.value) : d.value))\n                .style('font-size', d => `${Math.round(this.fontRange(d.value))}px`)\n                .attr('x', d => this.projection([d.longitude, d.latitude])[0])\n                .attr('y', d => this.projection([d.longitude, d.latitude])[1])\n                .attr('dy', '.4em')\n                .transition()\n                .attr('pointer-events', 'auto'),\n            exit =>\n              exit\n                .transition()\n                .attr('pointer-events', 'none')\n                .remove()\n          );\n      }\n    }\n  };\n\n  bubbleMouseOver = (event, data, index, nodes) => {\n    this.chart\n      .selectAll('.dot-circle')\n      .filter((d, i) => i !== index)\n      .classed('inactive', true);\n\n    this.chart\n      .selectAll('.dot-circle')\n      .filter((d, i) => i === index)\n      .classed('active', true);\n\n    this.tooltipShow(data, nodes[index]);\n\n    this.hovered.emit({ event, data });\n  };\n\n  bubbleMouseOut = (event, data, index, nodes) => {\n    this.chart\n      .selectAll('.dot-circle')\n      .classed('active', false)\n      .classed('inactive', false);\n\n    this.tooltipHide();\n  };\n\n  bubbleMouseClick = (event, data, index, nodes) => {\n    this.clicked.emit({ event, data });\n  };\n\n  private tooltipShow = (data, node) => {\n    const dimensions = node.getBoundingClientRect();\n    const scroll = this._scroll.getScrollPosition();\n\n    this.tooltip.select('.tooltip-header').html(d => `${data.label}`);\n\n    if (!this.hideTooltipValue) {\n      this.tooltip\n        .select('.tooltip-value')\n        .html(d => (this.tooltipValueFormat ? `${this.tooltipValueFormat(data.value)}` : `${data.value}`));\n    }\n\n    const tooltipOffsetWidth = +this.tooltip.node().offsetWidth / 2;\n    const tooltipOffsetHeight = +this.tooltip.node().offsetHeight + 8;\n\n    this.tooltip.style('top', `${+scroll[1] + +dimensions.top - tooltipOffsetHeight}px`); //\n    this.tooltip.style('left', `${+scroll[0] + +dimensions.left - tooltipOffsetWidth + +dimensions.width / 2}px`);\n    this.tooltip.style('opacity', 1);\n  };\n\n  private tooltipHide = () => {\n    this.tooltip.style('opacity', 0);\n  };\n}\n","import {\n  Component,\n  OnInit,\n  OnChanges,\n  OnDestroy,\n  HostBinding,\n  Input,\n  Output,\n  ElementRef,\n  SimpleChanges,\n  EventEmitter,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { ViewportScroller } from '@angular/common';\n\nimport { PbdsDatavizHeatmap } from './dataviz.interfaces';\nimport { PbdsDatavizService } from './dataviz.service';\n\nimport { select as d3_select, event as d3_event } from 'd3-selection';\nimport {\n  scaleThreshold as d3_scaleThreshold,\n  scaleQuantile as d3_scaleQuantile,\n  scaleQuantize as d3_scaleQuantize,\n  scaleBand as d3_scaleBand\n} from 'd3-scale';\nimport { min as d3_min, max as d3_max } from 'd3-array';\nimport { axisBottom as d3_axisBottom, axisLeft as d3_axisLeft } from 'd3-axis';\nimport { isoParse as d3_isoParse } from 'd3-time-format';\n\n@Component({\n  selector: 'pbds-dataviz-heatmap',\n  template: ``,\n  styles: [],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class PbdsDatavizHeatmapComponent implements OnInit, OnChanges, OnDestroy {\n  @HostBinding('class.pbds-chart')\n  chartClass = true;\n\n  @HostBinding('class.pbds-chart-heatmap')\n  heatmapClass = true;\n\n  @Input()\n  data: Array<PbdsDatavizHeatmap>;\n\n  @Input()\n  width = 306;\n\n  @Input()\n  height = 400;\n\n  @Input()\n  marginTop = 0; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  marginRight = 0; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  marginBottom = 30; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  marginLeft = 55;\n\n  @Input()\n  scale: 'threshold' | 'quantile' | 'quantize' = 'quantile';\n\n  @Input()\n  domain: Array<number>;\n\n  @Input()\n  xAxisFormatType: 'number' | 'time' = null;\n\n  @Input()\n  xAxisFormatString = '';\n\n  @Input()\n  yAxisFormatType: 'number' | 'time' = null;\n\n  @Input()\n  yAxisFormatString = '';\n\n  @Input()\n  hideLegend = false;\n\n  @Input()\n  legendWidth = 105 + 28; // hardcoded legend width + left margin, do not document until feedback\n\n  @Input()\n  legendPosition: 'right' | 'bottom' = 'right';\n\n  @Input()\n  legendLabelFormatType: 'number' = null;\n\n  @Input()\n  legendLabelFormatString = '';\n\n  @Input()\n  tooltipXLabelFormatType: 'number' | 'time' = null;\n\n  @Input()\n  tooltipXLabelFormatString = '';\n\n  @Input()\n  tooltipYLabelFormatType: 'number' | 'time' = null;\n\n  @Input()\n  tooltipYLabelFormatString = '';\n\n  @Input()\n  tooltipValueFormatType: 'number' = null;\n\n  @Input()\n  tooltipValueFormatString = '';\n\n  @Input()\n  theme: 'classic' | 'ocean' | 'sunset' | 'twilight' = 'classic';\n\n  @Output()\n  hovered: EventEmitter<object> = new EventEmitter<object>();\n\n  @Output()\n  clicked: EventEmitter<object> = new EventEmitter<object>();\n\n  private chart;\n  private svg;\n  private margin;\n  private colorRange;\n  private colorDomain;\n  private xAxisScale;\n  private xAxisCall;\n  private xAxis;\n  private xAxisFormat;\n  private xAxisTickSize: number;\n  private xAxisTickSizeOuter: number;\n  private hideXAxisDomain: boolean;\n  private hideXAxisZero: boolean;\n  private hideXAxisTicks: boolean;\n  private hideXAxis: boolean;\n  private yAxis;\n  private yAxisFormat;\n  private yAxisTickSize;\n  private yAxisTickSizeOuter;\n  private yAxisScale;\n  private yAxisCall;\n  private hideYAxis: boolean;\n  private hideYAxisDomain: boolean;\n  private hideYAxisZero: boolean;\n  private hideYAxisTicks: boolean;\n  private legendLabelFormat;\n  private tooltip;\n  private tooltipYLabelFormat;\n  private tooltipXLabelFormat;\n  private hideTooltip;\n  private tooltipValueFormat;\n\n  constructor(private _dataviz: PbdsDatavizService, private _element: ElementRef, private _scroll: ViewportScroller) {}\n\n  ngOnInit() {\n    this.margin = {\n      top: +this.marginTop,\n      right: +this.marginRight,\n      bottom: +this.marginBottom,\n      left: +this.marginLeft\n    };\n\n    // create formatters\n    this.yAxisFormat = this._dataviz.d3Format(this.yAxisFormatType, this.yAxisFormatString);\n    this.xAxisFormat = this._dataviz.d3Format(this.xAxisFormatType, this.xAxisFormatString);\n    this.legendLabelFormat = this._dataviz.d3Format(this.legendLabelFormatType, this.legendLabelFormatString);\n    this.tooltipYLabelFormat = this._dataviz.d3Format(this.tooltipYLabelFormatType, this.tooltipYLabelFormatString);\n    this.tooltipXLabelFormat = this._dataviz.d3Format(this.tooltipXLabelFormatType, this.tooltipXLabelFormatString);\n    this.tooltipValueFormat = this._dataviz.d3Format(this.tooltipValueFormatType, this.tooltipValueFormatString);\n\n    // defaults for all chart types\n    this.hideXAxis = false;\n    this.hideXAxisZero = false;\n    this.hideXAxisDomain = true;\n    this.hideYAxisDomain = true;\n    this.hideTooltip = false;\n    this.hideXAxisTicks = true;\n    this.hideYAxisTicks = true;\n    this.xAxisTickSize = 8;\n    this.xAxisTickSizeOuter = 0;\n    this.yAxisTickSize = 8;\n    this.yAxisTickSizeOuter = 0;\n\n    // create the chart\n    this.chart = d3_select(this._element.nativeElement).attr('aria-hidden', 'true');\n\n    // create chart svg\n    this.svg = this.chart\n      .append('svg')\n      .attr('width', +this.width)\n      .attr('height', +this.height + this.margin.top + this.margin.bottom)\n      .attr('class', 'img-fluid')\n      .attr('preserveAspectRatio', 'xMinYMin meet')\n      .attr(\n        'viewBox',\n        `-${this.margin.left} -${this.margin.top} ${+this.width} ${+this.height + this.margin.top + this.margin.bottom}`\n      );\n\n    // color range\n    const colors = this._dataviz\n      .getColors(true, this.theme)\n      .slice()\n      .reverse();\n\n    const colorDomain: any = [\n      +d3_min(this.data, (d: PbdsDatavizHeatmap) => d.value),\n      +d3_max(this.data, (d: PbdsDatavizHeatmap) => d.value)\n    ];\n    const colorValues = this.data.map(d => d.value);\n\n    switch (this.scale) {\n      case 'threshold':\n        this.colorRange = d3_scaleThreshold()\n          .domain(this.domain)\n          .range(colors);\n\n        this.colorDomain = this.colorRange.domain();\n        break;\n\n      case 'quantile':\n        this.colorRange = d3_scaleQuantile()\n          .domain(colorValues)\n          .range(colors);\n\n        this.colorDomain = this.colorRange.quantiles();\n        break;\n\n      case 'quantize':\n        this.colorRange = d3_scaleQuantize()\n          .domain(colorDomain)\n          .range(colors);\n\n        this.colorDomain = this.colorRange.thresholds();\n        break;\n    }\n\n    // console.log(colors, colorDomain, colorValues, this.scale, this.colorRange, this.colorDomain);\n\n    // define axis labels\n    const xAxisLabels: any = [...new Set(this.data.map(d => d.xLabel))];\n    const yAxisLabels: any = [...new Set(this.data.map(d => d.yLabel))].reverse();\n\n    // X axis\n    this.xAxisScale = d3_scaleBand()\n      .domain(xAxisLabels)\n      .rangeRound([0, this.width - this.margin.left])\n      .paddingInner(0.1);\n\n    this.xAxisCall = d3_axisBottom(this.xAxisScale)\n      .tickSize(this.xAxisTickSize)\n      .tickSizeOuter(this.xAxisTickSizeOuter)\n      .tickFormat(this.xAxisFormatter);\n\n    this.xAxis = this.svg\n      .append('g')\n      .attr('class', 'axis axis-x')\n      .attr('transform', `translate(0, ${this.height})`)\n      .classed('axis-hidden', this.hideXAxis)\n      .classed('axis-zero-hidden', this.hideXAxisZero)\n      .classed('axis-domain-hidden', this.hideXAxisDomain)\n      .classed('axis-ticks-hidden', this.hideXAxisTicks)\n      .call(this.xAxisCall);\n\n    // Y axis\n    this.yAxisScale = d3_scaleBand()\n      .domain(yAxisLabels)\n      .rangeRound([this.height, 0])\n      .paddingInner(0.1);\n\n    this.yAxisCall = d3_axisLeft(this.yAxisScale)\n      .tickSize(this.yAxisTickSize)\n      .tickSizeOuter(this.yAxisTickSizeOuter)\n      .tickFormat(this.yAxisFormatter);\n\n    this.yAxis = this.svg\n      .append('g')\n      .attr('class', 'axis axis-y')\n      .classed('axis-hidden', this.hideYAxis)\n      .classed('axis-zero-hidden', this.hideYAxisZero)\n      .classed('axis-domain-hidden', this.hideYAxisDomain)\n      .classed('axis-ticks-hidden', this.hideYAxisTicks)\n      .call(this.yAxisCall);\n\n    // TOOLTIP\n    if (!this.hideTooltip) {\n      this.tooltip = d3_select('body')\n        .append('div')\n        .attr('class', 'pbds-tooltip south')\n        .style('opacity', 0)\n        .attr('aria-hidden', 'true'); // hide tooltip for accessibility\n    }\n\n    // add legend classes\n    if (!this.hideLegend) {\n      this.chart.classed('pbds-chart-legend-bottom', this.legendPosition === 'bottom' ? true : false);\n      this.chart.append('ul').attr('class', `legend legend-${this.legendPosition}`);\n    }\n\n    this.updateChart();\n  }\n\n  ngOnDestroy() {\n    if (this.tooltip) this.tooltip.remove();\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    if (changes.data && !changes.data.firstChange) {\n      this.updateChart();\n    }\n  }\n\n  updateChart = () => {\n    this.svg\n      .selectAll('rect')\n      .data(this.data)\n      .join(\n        enter =>\n          enter\n            .append('rect')\n            .attr('class', 'block')\n            .classed('empty', d => d.value === undefined || d.value === null)\n            .attr('x', d => this.xAxisScale(d.xLabel))\n            .attr('y', d => this.yAxisScale(d.yLabel))\n            .attr('width', this.xAxisScale.bandwidth())\n            .attr('height', this.yAxisScale.bandwidth())\n            .style('fill', d => this.colorRange(d.value)),\n        update =>\n          update.call(update => {\n            update\n              .classed('empty', d => d.value === undefined || d.value === null)\n              .attr('pointer-events', 'none')\n              .transition()\n              .duration(1000)\n              .attr('x', d => this.xAxisScale(d.xLabel))\n              .attr('y', d => this.yAxisScale(d.yLabel))\n              .attr('width', this.xAxisScale.bandwidth())\n              .attr('height', this.yAxisScale.bandwidth())\n              .style('fill', d => this.colorRange(d.value))\n              .transition()\n              .attr('pointer-events', 'auto');\n\n            return update;\n          }),\n        exit =>\n          exit\n            .transition()\n            .attr('pointer-events', 'none')\n            .remove()\n      )\n      .on('mouseover', (data, index, nodes) => this.blockMouseOver(d3_event, data, index, nodes))\n      .on('mouseout', (data, index, nodes) => this.blockMouseOut())\n      .on('click', (data, index, nodes) => this.blockMouseClick(d3_event, data, index, nodes));\n\n    if (!this.hideLegend) {\n      this.chart\n        .select('.legend')\n        .selectAll('.legend-item')\n        .data(this.colorDomain)\n        .join(\n          enter => {\n            const li = enter.append('li').attr('class', 'legend-item');\n\n            li.append('span')\n              .attr('class', 'legend-key')\n              .style('background-color', d => this.colorRange(d));\n\n            li.append('span')\n              .attr('class', 'legend-label')\n              .html(d => {\n                let label: string = d;\n\n                switch (this.legendLabelFormatType) {\n                  case 'number':\n                    label = this.legendLabelFormat(d);\n                    break;\n                }\n\n                return `&ge; ${label}`;\n              });\n\n            return li;\n          },\n          update =>\n            update.select('.legend-label').html(d => {\n              let label: string = d;\n\n              switch (this.legendLabelFormatType) {\n                case 'number':\n                  label = this.legendLabelFormat(d);\n                  break;\n              }\n\n              return `&ge; ${label}`;\n            }),\n          exit => exit.remove()\n        )\n        .on('mouseover', (data, index, nodes) => this.legendMouseOver(d3_event, data, index, nodes))\n        .on('mouseout', () => this.legendMouseOut())\n        .on('click', (data, index, nodes) => this.legendMouseClick(d3_event, data, index, nodes));\n    }\n  };\n\n  blockMouseOver = (event, data, index, nodes) => {\n    // console.log(data.value, event, data, index, nodes);\n\n    if (data.value !== null) {\n      this.tooltipShow(data, index, nodes[index]);\n    }\n\n    this.hovered.emit({ event, data });\n  };\n\n  blockMouseOut = () => {\n    this.tooltipHide();\n  };\n\n  blockMouseClick = (event, data, index, nodes) => {\n    this.clicked.emit({ event, data });\n  };\n\n  legendMouseOver = (event, data, index, nodes) => {\n    this.chart\n      .selectAll('.legend-item')\n      .filter((d, i) => i !== index)\n      .classed('inactive', true);\n\n    this.chart\n      .selectAll('.block')\n      .filter((d, i) => {\n        if (index + 1 === nodes.length) {\n          return d.value < data;\n        } else {\n          return d.value < data || d.value >= +d3_select(nodes[index + 1]).data()[0];\n        }\n      })\n      .classed('inactive', true);\n\n    this.hovered.emit({ event, data });\n  };\n\n  legendMouseOut = () => {\n    this.chart.selectAll('.legend-item').classed('inactive', false);\n\n    this.chart.selectAll('.block').classed('inactive', false);\n  };\n\n  legendMouseClick = (event, data, index, nodes) => {\n    this.clicked.emit({ event, data });\n  };\n\n  private tooltipShow = (data, index, node) => {\n    // console.log('TOOLTIP: ', data, index, node);\n\n    const dimensions = node.getBoundingClientRect();\n    const scroll = this._scroll.getScrollPosition();\n    let yLabel;\n    let xLabel;\n\n    switch (this.tooltipYLabelFormatType) {\n      case 'number':\n        yLabel = this.tooltipYLabelFormat(data.yLabel);\n        break;\n\n      case 'time':\n        const parsedTime = d3_isoParse(data.yLabel);\n        yLabel = this.tooltipYLabelFormat(parsedTime);\n        break;\n\n      default:\n        yLabel = `${data.yLabel}${this.tooltipYLabelFormatString}`;\n    }\n\n    switch (this.tooltipXLabelFormatType) {\n      case 'number':\n        xLabel = this.tooltipXLabelFormat(data.xLabel);\n        break;\n\n      case 'time':\n        const parsedTime = d3_isoParse(data.xLabel);\n        xLabel = this.tooltipXLabelFormat(parsedTime);\n        break;\n\n      default:\n        xLabel = `${data.xLabel}${this.tooltipXLabelFormatString}`;\n    }\n\n    const value =\n      this.tooltipValueFormat === null\n        ? `<div class=\"tooltip-value\">${data.value}</div>`\n        : `<div class=\"tooltip-value\">${this.tooltipValueFormat(data.value)}</div>`;\n\n    this.tooltip.html(\n      `\n        ${yLabel} : ${xLabel}<br>\n        ${value}\n      `\n    );\n\n    const tooltipOffsetWidth = +this.tooltip.node().offsetWidth / 2;\n    const tooltipOffsetHeight = +this.tooltip.node().offsetHeight + 8;\n\n    this.tooltip.style('top', `${+scroll[1] + +dimensions.top - tooltipOffsetHeight}px`); //\n    this.tooltip.style('left', `${+scroll[0] + +dimensions.left - tooltipOffsetWidth + +dimensions.width / 2}px`);\n    this.tooltip.style('opacity', 1);\n\n    this.tooltip.style('opacity', 1);\n  };\n\n  private tooltipHide = () => {\n    this.tooltip.style('opacity', 0);\n  };\n\n  private xAxisFormatter = item => {\n    switch (this.xAxisFormatType) {\n      case 'number':\n        return this.xAxisFormat(item);\n\n      case 'time':\n        const parseDate = d3_isoParse(item);\n        return this.xAxisFormat(parseDate);\n\n      default:\n        return item;\n    }\n  };\n\n  private yAxisFormatter = item => {\n    switch (this.yAxisFormatType) {\n      case 'number':\n        return this.yAxisFormat(item);\n\n      case 'time':\n        const parseDate = d3_isoParse(item);\n        return this.yAxisFormat(parseDate);\n\n      default:\n        return item;\n    }\n  };\n}\n","import {\n  Component,\n  OnInit,\n  OnChanges,\n  Input,\n  Output,\n  EventEmitter,\n  ElementRef,\n  HostBinding,\n  OnDestroy,\n  SimpleChanges,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { ViewportScroller } from '@angular/common';\n\nimport { select as d3_select, event as d3_event, mouse as d3_mouse } from 'd3-selection';\nimport {\n  scaleLinear as d3_scaleLinear,\n  scaleThreshold as d3_scaleThreshold,\n  scaleQuantile as d3_scaleQuantile,\n  scaleQuantize as d3_scaleQuantize\n} from 'd3-scale';\nimport { min as d3_min, max as d3_max, range as d3_range } from 'd3-array';\nimport {\n  geoPath as d3_geoPath,\n  geoAlbers as d3_geoAlbers,\n  geoAlbersUsa as d3_geoAlbersUsa,\n  geoMercator as d3_geoMercator\n} from 'd3-geo';\nimport { axisBottom as d3_axisBottom } from 'd3-axis';\n\nimport * as topojson from 'topojson';\nimport { PbdsDatavizService } from './dataviz.service';\n\nimport { PbdsDatavizChoroplethMapData } from './dataviz.interfaces';\n\n@Component({\n  selector: 'pbds-dataviz-choropleth-map',\n  template: ``,\n  styles: [],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class PbdsDatavizChoroplethMapComponent implements OnInit, OnDestroy, OnChanges {\n  @HostBinding('class.pbds-chart')\n  chartClass = true;\n\n  @HostBinding('class.pbds-chart-choropleth-map')\n  choroplethMapClass = true;\n\n  @Input()\n  data: Array<PbdsDatavizChoroplethMapData>;\n\n  @Input()\n  topojson;\n\n  @Input()\n  feature = '';\n\n  @Input()\n  projectionType;\n\n  @Input()\n  dataField = 'id';\n\n  @Input()\n  mesh: string | null = null;\n\n  @Input()\n  scale = null;\n\n  @Input()\n  center = null;\n\n  @Input()\n  width = 960;\n\n  @Input()\n  height = 500;\n\n  @Input()\n  marginTop = 0;\n\n  @Input()\n  marginRight = 0;\n\n  @Input()\n  marginBottom = 0;\n\n  @Input()\n  marginLeft = 0;\n\n  @Input()\n  theme: 'classic' | 'ocean' | 'sunset' | 'twilight' = 'classic';\n\n  @Input()\n  colorScale: 'threshold' | 'quantile' | 'quantize' = 'quantile';\n\n  @Input()\n  domain: Array<number>;\n\n  @Input()\n  hideTooltip = false;\n\n  @Input()\n  tooltipValueFormatType: 'number' = null;\n\n  @Input()\n  tooltipValueFormatString = '';\n\n  @Input()\n  hideLegend = false;\n\n  @Input()\n  legendWidth = 260;\n\n  @Input()\n  legendLabel: string | null = null;\n\n  @Input()\n  legendValueFormatType: 'number' = null;\n\n  @Input()\n  legendValueFormatString = '';\n\n  @Input()\n  legendLeft = 20;\n\n  @Input()\n  legendTop = 20;\n\n  @Output()\n  hovered: EventEmitter<object> = new EventEmitter<object>();\n\n  @Output()\n  clicked: EventEmitter<object> = new EventEmitter<object>();\n\n  private projection;\n  private geoPath;\n  private topojsonFeature;\n  private chart;\n  private svg;\n  private margin;\n  private colorRange;\n  private colorDomain;\n  private tooltip;\n  private tooltipValueFormat;\n  private legendValueFormat;\n\n  constructor(private _dataviz: PbdsDatavizService, private _element: ElementRef, private _scroll: ViewportScroller) {}\n\n  ngOnInit() {\n    this.margin = {\n      top: +this.marginTop,\n      right: +this.marginRight,\n      bottom: +this.marginBottom,\n      left: +this.marginLeft\n    };\n\n    // color range\n    const colors = this._dataviz\n      .getColors(true, this.theme)\n      .slice()\n      .reverse();\n\n    const colorDomain: any = [+d3_min(this.data, d => d.value), +d3_max(this.data, d => d.value)];\n    const colorValues = this.data.map(d => d.value);\n\n    switch (this.colorScale) {\n      case 'threshold':\n        this.colorRange = d3_scaleThreshold()\n          .domain(this.domain)\n          .range(colors);\n\n        this.colorDomain = this.colorRange.domain();\n        break;\n\n      case 'quantile':\n        this.colorRange = d3_scaleQuantile()\n          .domain(colorValues)\n          .range(colors);\n\n        this.colorDomain = this.colorRange.quantiles();\n        break;\n\n      case 'quantize':\n        this.colorRange = d3_scaleQuantize()\n          .domain(colorDomain)\n          .range(colors);\n\n        this.colorDomain = this.colorRange.thresholds();\n        break;\n    }\n\n    // create formatters\n    this.tooltipValueFormat = this._dataviz.d3Format(this.tooltipValueFormatType, this.tooltipValueFormatString);\n    this.legendValueFormat = this._dataviz.d3Format(this.legendValueFormatType, this.legendValueFormatString);\n\n    switch (this.projectionType) {\n      case 'geoAlbers':\n        this.projection = d3_geoAlbers();\n        break;\n\n      case 'geoAlbersUsa':\n        this.projection = d3_geoAlbersUsa();\n        break;\n\n      case 'geoMercator':\n        this.projection = d3_geoMercator();\n        break;\n    }\n\n    this.topojsonFeature = topojson.feature(this.topojson, this.topojson.objects[this.feature]);\n    this.projection.fitSize([+this.width, +this.height], this.topojsonFeature);\n\n    if (this.scale) {\n      this.projection.scale(+this.scale);\n    }\n\n    if (this.center) {\n      this.projection.center(this.center);\n    }\n\n    this.geoPath = d3_geoPath().projection(this.projection);\n\n    // console.log('TOPOJSON: ', this.topojson);\n    // console.log('TOPOJSON FEATURE: ', this.topojsonFeature);\n    // console.log('MESH: ', topojson.mesh(this.topojson, this.topojson.objects[this.feature], (a, b) => a !== b));\n    // console.log('DATA: ', this.data);\n\n    // create the chart\n    this.chart = d3_select(this._element.nativeElement).attr('aria-hidden', 'true');\n\n    // TOOLTIP\n    if (!this.hideTooltip) {\n      this.tooltip = d3_select('body')\n        .append('div')\n        .attr('class', 'pbds-tooltip south')\n        .style('opacity', 0)\n        .attr('aria-hidden', 'true'); // hide tooltip for accessibility\n\n      // tooltip header\n      this.tooltip.append('div').attr('class', 'tooltip-header');\n      this.tooltip.append('div').attr('class', 'tooltip-value');\n    }\n\n    // create chart svg\n    this.svg = this.chart\n      .append('svg')\n      .attr('width', +this.width)\n      .attr('height', +this.height + this.margin.top + this.margin.bottom)\n      .attr('class', 'img-fluid')\n      .attr('preserveAspectRatio', 'xMinYMin meet')\n      .attr(\n        'viewBox',\n        `-${this.margin.left} -${this.margin.top} ${+this.width} ${+this.height + this.margin.top + this.margin.bottom}`\n      );\n\n    // map\n    this.svg\n      .append('g')\n      .attr('class', 'map')\n      .selectAll('path')\n      .data(this.topojsonFeature.features)\n      .join(enter =>\n        enter\n          .append('path')\n          .attr('class', 'feature')\n          .attr('d', this.geoPath)\n      );\n\n    // borders\n    this.svg\n      .append('path')\n      .attr('class', 'mesh')\n      .datum(topojson.mesh(this.topojson, this.topojson.objects[this.mesh || this.feature], (a, b) => a !== b))\n      .attr('d', this.geoPath);\n\n    // legend\n    if (!this.hideLegend) {\n      this.svg\n        .append('g')\n        .attr('transform', `translate(${+this.legendLeft}, ${+this.legendTop})`)\n        .call(this.legend);\n    }\n\n    this.updateChart();\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    if (changes.data && !changes.data.firstChange) {\n      this.updateChart();\n    }\n  }\n\n  ngOnDestroy() {\n    if (this.tooltip) this.tooltip.remove();\n  }\n\n  updateChart = () => {\n    this.svg\n      .select('.map')\n      .selectAll('path')\n      .style('fill', (d, i) => {\n        const match = this.data.find(obj => obj[this.dataField] === d[this.dataField]);\n        if (match) {\n          return this.colorRange(match.value);\n        }\n      })\n      .classed('hasData', (d, i) => {\n        return this.data.some(obj => obj[this.dataField] === d[this.dataField]);\n      });\n\n    if (!this.hideTooltip) {\n      this.svg\n        .select('.map')\n        .selectAll('path')\n        .on('mouseover', (data, index, nodes) =>\n          this.featureMouseOver(\n            d3_event,\n            this.data.find(obj => obj[this.dataField] === data[this.dataField]),\n            index,\n            nodes\n          )\n        )\n        .on('mouseout', (data, index, nodes) => this.featureMouseOut(d3_event, this.data, index, nodes))\n        .on('mousemove', (data, index, nodes) => this.tooltipMove(this.chart.node()))\n        .on('click', (data, index, nodes) =>\n          this.featureMouseClick(\n            d3_event,\n            this.data.find(obj => obj[this.dataField] === data[this.dataField]),\n            index,\n            nodes\n          )\n        );\n    }\n  };\n\n  featureMouseOver = (event, data, index, nodes) => {\n    if (data) {\n      this.tooltipShow(data, nodes[index]);\n      this.hovered.emit({ event, data });\n    }\n  };\n\n  featureMouseOut = (event, data, index, nodes) => {\n    this.tooltipHide();\n  };\n\n  featureMouseClick = (event, data, index, nodes) => {\n    if (data) {\n      this.clicked.emit({ event, data });\n    }\n  };\n\n  private tooltipShow = (data, node) => {\n    // console.log('TOOLTIP: ', data, node);\n\n    this.tooltipSetPosition(node);\n\n    if (data.label) {\n      this.tooltip.select('.tooltip-header').html(d => `${data.label}`);\n    }\n\n    this.tooltip\n      .select('.tooltip-value')\n      .html(d => (this.tooltipValueFormat ? `${this.tooltipValueFormat(data.value)}` : `${data.value}`));\n\n    this.tooltip.style('opacity', 1);\n  };\n\n  private tooltipHide = () => {\n    this.tooltip.style('opacity', 0);\n  };\n\n  private tooltipMove = node => {\n    this.tooltipSetPosition(node);\n  };\n\n  private tooltipSetPosition = node => {\n    const mouse = d3_mouse(node);\n    const mouseLeft = +mouse[0];\n    const mouseTop = +mouse[1];\n\n    const geometry = node.getBoundingClientRect();\n    const geometryLeft = +geometry.left;\n    const geometryTop = +geometry.top;\n\n    const scroll = this._scroll.getScrollPosition();\n    // const scrollLeft = +scroll[0];\n    const scrollTop = +scroll[1];\n\n    const tooltipOffsetWidth = +this.tooltip.node().offsetWidth / 2;\n    const tooltipOffsetHeight = +this.tooltip.node().offsetHeight;\n\n    this.tooltip.style('top', `${scrollTop + mouseTop + geometryTop - tooltipOffsetHeight - 14}px`);\n    this.tooltip.style('left', `${mouseLeft + geometryLeft - tooltipOffsetWidth}px`);\n  };\n\n  legend = g => {\n    const length = this.colorRange.range().length;\n\n    // console.log(this.colorRange.range().length, this.colorDomain);\n\n    const x = d3_scaleLinear()\n      .domain([1, length - 1])\n      .rangeRound([+this.legendWidth / length, (this.legendWidth * (length - 1)) / length]);\n\n    g.attr('class', 'legend')\n      .selectAll('rect')\n      .data(this.colorRange.range())\n      .join('rect')\n      .attr('height', 8)\n      .attr('x', (d, i) => x(i))\n      .attr('width', (d, i) => x(i + 1) - x(i))\n      .attr('fill', d => d);\n\n    if (this.legendLabel) {\n      g.append('text')\n        .attr('y', -6)\n        .attr('text-anchor', 'start')\n        .attr('class', 'legend-label')\n        .text(this.legendLabel);\n    }\n\n    g.call(\n      d3_axisBottom(x)\n        .tickSize(13)\n        .tickValues(d3_range(1, length))\n        .tickFormat((i: number) =>\n          this.legendValueFormat ? `${this.legendValueFormat(this.colorDomain[i - 1])}` : `${this.colorDomain[i - 1]}`\n        )\n    )\n      .select('.domain')\n      .remove();\n  };\n}\n","import {\n  Component,\n  OnInit,\n  OnChanges,\n  Input,\n  Output,\n  EventEmitter,\n  ElementRef,\n  HostBinding,\n  OnDestroy,\n  SimpleChanges,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { ViewportScroller, Location } from '@angular/common';\n\nimport { select as d3_select, event as d3_event } from 'd3-selection';\nimport { scaleOrdinal as d3_scaleOrdinal, scaleBand as d3_scaleBand, scaleLinear as d3_scaleLinear } from 'd3-scale';\nimport { max as d3_max } from 'd3-array';\nimport { axisBottom as d3_axisBottom, axisLeft as d3_axisLeft } from 'd3-axis';\nimport { values as d3_values } from 'd3-collection';\nimport { isoParse as d3_isoParse } from 'd3-time-format';\n\nimport { PbdsDatavizService } from './dataviz.service';\nimport { PbdsDatavizBarGrouped } from './dataviz.interfaces';\n\n@Component({\n  selector: 'pbds-dataviz-bar-grouped',\n  template: ``,\n  styles: [],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class PbdsDatavizBarGroupedComponent implements OnInit, OnDestroy, OnChanges {\n  @HostBinding('class.pbds-chart')\n  chartClass = true;\n\n  @HostBinding('class.pbds-chart-bar-grouped')\n  groupedBarClass = true;\n\n  @Input()\n  data: Array<PbdsDatavizBarGrouped>;\n\n  @Input()\n  width = 306;\n\n  @Input()\n  height = 400;\n\n  @Input()\n  vertical = true;\n\n  @Input()\n  hideXAxis = false;\n\n  @Input()\n  xAxisMaxBuffer = 0.01;\n\n  @Input()\n  xAxisFormatType: 'number' | 'time' = null;\n\n  @Input()\n  xAxisFormatString = '';\n\n  @Input()\n  xAxisTicks = 5;\n\n  @Input()\n  hideYAxis = false;\n\n  @Input()\n  yAxisMaxBuffer = 0.01;\n\n  @Input()\n  yAxisFormatType: 'number' | 'time' = null;\n\n  @Input()\n  yAxisFormatString = '';\n\n  @Input()\n  yAxisTicks = 5;\n\n  @Input()\n  marginTop = 10;\n\n  @Input()\n  marginRight = this.vertical ? 0 : 55;\n\n  @Input()\n  marginBottom = 30;\n\n  @Input()\n  marginLeft = 55;\n\n  @Input()\n  hideLegend = false;\n\n  @Input()\n  legendWidth = 105 + 28; // hardcoded legend width + left margin, do not document until feedback\n\n  @Input()\n  legendPosition: 'right' | 'bottom' = 'right';\n\n  @Input()\n  legendLabelFormatType: 'number' | 'time' = null;\n\n  @Input()\n  legendLabelFormatString = '';\n\n  @Input()\n  hideTooltip = false;\n\n  @Input()\n  tooltipLabelFormatType: 'number' | 'time' = null;\n\n  @Input()\n  tooltipLabelFormatString = '';\n\n  @Input()\n  tooltipValueFormatType: 'number' = null;\n\n  @Input()\n  tooltipValueFormatString = '';\n\n  @Input()\n  showGrid = false;\n\n  @Input()\n  theme: 'classic' | 'sunset' | 'ocean' | 'twilight' = 'classic';\n\n  @Output()\n  hovered: EventEmitter<object> = new EventEmitter<object>();\n\n  @Output()\n  clicked: EventEmitter<object> = new EventEmitter<object>();\n\n  private barScale;\n  private chart;\n  private svg;\n  private margin;\n  private colorRange;\n  private xAxisMax;\n  private xAxisScale;\n  private xAxisCall;\n  private xAxis;\n  private xAxisTickSize: number;\n  private xAxisTickSizeOuter: number;\n  private xAxisFormat;\n  private hideXAxisDomain: boolean;\n  private hideXAxisZero: boolean;\n  private hideXAxisTicks: boolean;\n  private xGrid;\n  private xGridCall;\n  private yAxisMax;\n  private yAxisScale;\n  private yAxisCall;\n  private yAxis;\n  private yAxisFormat;\n  private yAxisTickSize: number;\n  private yAxisTickSizeOuter: number;\n  private hideYAxisZero: boolean;\n  private hideYAxisDomain: boolean;\n  private hideYAxisTicks: boolean;\n  private yGrid;\n  private yGridCall;\n  private legendLabelFormat;\n  private hideGrayBars: boolean;\n  private tooltip;\n  private tooltipValueFormat;\n  private tooltipLabelFormat;\n\n  constructor(\n    private _dataviz: PbdsDatavizService,\n    private _element: ElementRef,\n    private _scroll: ViewportScroller,\n    private _location: Location\n  ) {}\n\n  ngOnInit() {\n    this.margin = {\n      top: +this.marginTop,\n      right: +this.marginRight,\n      bottom: +this.marginBottom,\n      left: +this.marginLeft\n    };\n\n    // create formatters\n    this.xAxisFormat = this._dataviz.d3Format(this.xAxisFormatType, this.xAxisFormatString);\n    this.yAxisFormat = this._dataviz.d3Format(this.yAxisFormatType, this.yAxisFormatString);\n    this.legendLabelFormat = this._dataviz.d3Format(this.legendLabelFormatType, this.legendLabelFormatString);\n    this.tooltipLabelFormat = this._dataviz.d3Format(this.tooltipLabelFormatType, this.tooltipLabelFormatString);\n    this.tooltipValueFormat = this._dataviz.d3Format(this.tooltipValueFormatType, this.tooltipValueFormatString);\n\n    // defaults for all chart types\n    this.hideGrayBars = false;\n    this.hideXAxisZero = false;\n    this.hideXAxisDomain = false;\n    this.hideXAxisTicks = true;\n    this.xAxisTickSize = 8;\n    this.xAxisTickSizeOuter = 0;\n    this.hideYAxisZero = false;\n    this.hideYAxisDomain = false;\n    this.hideYAxisTicks = true;\n    this.yAxisTickSize = 8;\n    this.yAxisTickSizeOuter = 0;\n\n    if (!this.hideLegend && this.legendPosition === 'right') {\n      this.width = +this.width - +this.legendWidth;\n    }\n\n    // create the chart\n    this.chart = d3_select(this._element.nativeElement).attr('aria-hidden', 'true');\n\n    // create chart svg\n    this.svg = this.chart\n      .append('svg')\n      .attr('width', () => {\n        if (this.vertical) {\n          return +this.width;\n        } else {\n          return +this.width + this.margin.left + this.margin.right;\n        }\n      })\n      .attr('height', +this.height + this.margin.top + this.margin.bottom)\n      .attr('class', 'img-fluid')\n      .attr('preserveAspectRatio', 'xMinYMin meet')\n      .attr('viewBox', () => {\n        if (this.vertical) {\n          return `-${this.margin.left} -${this.margin.top} ${+this.width} ${+this.height +\n            this.margin.top +\n            this.margin.bottom}`;\n        } else {\n          return `-${this.margin.left} -${this.margin.top} ${+this.width + this.margin.left + this.margin.right} ${+this\n            .height +\n            this.margin.top +\n            this.margin.bottom}`;\n        }\n      });\n\n    // TOOLTIP\n    if (!this.hideTooltip) {\n      this.tooltip = d3_select('body')\n        .append('div')\n        .attr('class', () => {\n          return this.vertical ? 'pbds-tooltip south' : 'pbds-tooltip west';\n        })\n        .style('opacity', 0)\n        .attr('aria-hidden', 'true'); // hide tooltip for accessibility\n    }\n\n    // add legend classes\n    if (!this.hideLegend) {\n      this.chart.classed('pbds-chart-legend-bottom', this.legendPosition === 'bottom' ? true : false);\n      this.chart.append('ul').attr('class', `legend legend-${this.legendPosition}`);\n    }\n\n    // build color ranges\n    this.colorRange = d3_scaleOrdinal().range(\n      this._dataviz.createGradientDefs(this.svg, false, this.theme, this.vertical)\n    );\n\n    if (this.vertical) {\n      // X AXIS\n      this.xAxisScale = d3_scaleBand()\n        .domain(this.data.map(d => d.key))\n        .rangeRound([0, this.width - this.margin.left])\n        .align(0);\n\n      // add padding to the scale for gray bars\n      !this.hideGrayBars\n        ? this.xAxisScale.paddingInner(0.1).paddingOuter(0)\n        : this.xAxisScale.paddingInner(0).paddingOuter(0);\n\n      this.xAxisCall = d3_axisBottom(this.xAxisScale)\n        .tickSize(this.xAxisTickSize)\n        .tickSizeOuter(this.xAxisTickSizeOuter)\n        .tickFormat(this.xAxisFormatter);\n\n      this.xAxis = this.svg\n        .append('g')\n        .attr('class', 'axis axis-x')\n        .attr('transform', `translate(0, ${this.height})`)\n        .classed('axis-hidden', this.hideXAxis)\n        .classed('axis-zero-hidden', this.hideXAxisZero)\n        .classed('axis-domain-hidden', this.hideXAxisDomain)\n        .classed('axis-ticks-hidden', this.hideXAxisTicks)\n        .call(this.xAxisCall);\n\n      // X GRIDLINES\n      // if (!this.hideXGrid) {\n      //   this.xGridCall = d3_axisBottom(this.xAxisScale).tickSize(-this.height);\n\n      //   this.xGrid = this.svg\n      //     .append('g')\n      //     .attr('class', 'grid grid-x')\n      //     .classed('grid-zero-hidden', this.hideXAxisZero)\n      //     .attr('transform', `translate(0, ${this.height})`)\n      //     .call(this.xGridCall);\n      // }\n\n      // Y AXIS\n      this.yAxisMax = d3_max(this.data, (data: any) => {\n        const clone = { ...data };\n        delete clone.key;\n\n        return d3_max(d3_values(clone));\n      });\n\n      this.yAxisMax = this.yAxisMax + this.yAxisMax * this.yAxisMaxBuffer;\n\n      this.yAxisScale = d3_scaleLinear()\n        .domain([0, this.yAxisMax])\n        .nice()\n        .rangeRound([this.height, 0]);\n\n      this.yAxisCall = d3_axisLeft(this.yAxisScale)\n        .ticks(this.yAxisTicks)\n        .tickSize(this.yAxisTickSize)\n        .tickSizeOuter(this.yAxisTickSizeOuter)\n        .tickFormat(this.yAxisFormatter);\n\n      this.yAxis = this.svg\n        .append('g')\n        .attr('class', 'axis axis-y')\n        .classed('axis-hidden', this.hideYAxis)\n        .classed('axis-zero-hidden', this.hideYAxisZero)\n        .classed('axis-domain-hidden', this.hideYAxisDomain)\n        .classed('axis-ticks-hidden', this.hideYAxisTicks)\n        .call(this.yAxisCall);\n\n      // Y GRIDLINES\n      if (this.showGrid) {\n        this.yGridCall = d3_axisLeft(this.yAxisScale)\n          .ticks(this.yAxisTicks)\n          .tickSize(-this.width + this.margin.left + this.margin.right);\n\n        this.yGrid = this.svg\n          .append('g')\n          .attr('class', 'grid grid-y')\n          .classed('grid-zero-hidden', this.hideYAxisZero)\n          .attr('transform', `translate(0, 0)`)\n          .call(this.yGridCall);\n      }\n\n      // color bar scale\n      this.barScale = d3_scaleBand()\n        .domain(Object.keys(this.data[0]).slice(1))\n        .rangeRound([0, this.xAxisScale.bandwidth()])\n        .paddingInner(0.2)\n        .paddingOuter(0.5);\n\n      this.updateChartVertical();\n    } else {\n      // X AXIS\n      this.xAxisMax = d3_max(this.data, (data: any) => {\n        const clone = { ...data };\n        delete clone.key;\n        return d3_max(d3_values(clone));\n      });\n\n      this.xAxisMax = this.xAxisMax + this.xAxisMax * this.xAxisMaxBuffer;\n\n      this.xAxisScale = d3_scaleLinear()\n        .domain([0, this.xAxisMax])\n        .rangeRound([0, this.width])\n        .nice();\n\n      this.xAxisCall = d3_axisBottom(this.xAxisScale)\n        .ticks(this.xAxisTicks)\n        .tickSize(this.xAxisTickSize)\n        .tickSizeOuter(this.xAxisTickSizeOuter)\n        .tickFormat(this.xAxisFormatter);\n\n      this.xAxis = this.svg\n        .append('g')\n        .attr('class', 'axis axis-x')\n        .attr('transform', `translate(0, ${this.height})`)\n        .classed('axis-hidden', this.hideXAxis)\n        .classed('axis-zero-hidden', this.hideXAxisZero)\n        .classed('axis-domain-hidden', this.hideXAxisDomain)\n        .classed('axis-ticks-hidden', this.hideXAxisTicks)\n        .call(this.xAxisCall);\n\n      // Y AXIS\n      this.yAxisScale = d3_scaleBand()\n        .domain(this.data.map(d => d.key))\n        .rangeRound([0, this.height])\n        .align(1);\n\n      // add padding to the scale for gray bars\n      !this.hideGrayBars\n        ? this.yAxisScale.paddingInner(0.1).paddingOuter(0)\n        : this.yAxisScale.paddingInner(0).paddingOuter(0);\n\n      this.yAxisCall = d3_axisLeft(this.yAxisScale)\n        .tickSize(this.yAxisTickSize)\n        .tickSizeOuter(this.yAxisTickSizeOuter)\n        .tickFormat(this.yAxisFormatter);\n\n      this.yAxis = this.svg\n        .append('g')\n        .attr('class', 'axis axis-y')\n        .classed('axis-hidden', this.hideYAxis)\n        .classed('axis-zero-hidden', this.hideYAxisZero)\n        .classed('axis-domain-hidden', this.hideYAxisDomain)\n        .classed('axis-ticks-hidden', this.hideYAxisTicks)\n        .call(this.yAxisCall);\n\n      // X GRIDLINES\n      if (this.showGrid) {\n        this.xGridCall = d3_axisBottom(this.xAxisScale).tickSize(-this.height);\n        this.xGrid = this.svg\n          .append('g')\n          .attr('class', 'grid grid-x')\n          .classed('grid-zero-hidden', this.hideXAxisZero)\n          .attr('transform', `translate(0, ${this.height})`)\n          .call(this.xGridCall);\n      }\n\n      // Y GRIDLINES\n      // if (!this.hideYGrid) {\n      //   this.yGridCall = d3_axisLeft(this.yAxisScale)\n      //     .ticks(this.yAxisTicks)\n      //     .tickSize(-this.width);\n\n      //   this.yGrid = this.svg\n      //     .append('g')\n      //     .attr('class', 'grid grid-y')\n      //     .classed('grid-zero-hidden', this.hideYAxisZero)\n      //     .attr('transform', `translate(0, 0)`)\n      //     .call(this.yGridCall);\n      // }\n\n      // color bar scale\n      this.barScale = d3_scaleBand()\n        .domain(Object.keys(this.data[0]).slice(1))\n        .rangeRound([this.yAxisScale.bandwidth(), 0])\n        .paddingInner(0.2)\n        .paddingOuter(0.5);\n\n      this.updateChartHorizontal();\n    }\n  }\n\n  ngOnDestroy() {\n    if (this.tooltip) this.tooltip.remove();\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    if (changes.data && !changes.data.firstChange) {\n      if (this.vertical) {\n        this.updateChartVertical();\n      } else {\n        this.updateChartHorizontal();\n      }\n    }\n  }\n\n  updateChartVertical() {\n    // update the xScale\n    this.xAxisScale.domain(this.data.map(d => d.key));\n\n    // update the yScale\n    this.yAxisMax = d3_max(this.data, (data: any) => {\n      const clone = { ...data };\n      delete clone.key;\n\n      return d3_max(d3_values(clone));\n    });\n\n    this.yAxisMax = this.yAxisMax + this.yAxisMax * this.yAxisMaxBuffer;\n\n    this.yAxisScale\n      .domain([0, this.yAxisMax])\n      .rangeRound([this.height, 0])\n      .nice();\n\n    this.xAxis\n      .transition()\n      .duration(1000)\n      .call(this.xAxisCall);\n\n    this.yAxis\n      .transition()\n      .duration(1000)\n      .call(this.yAxisCall);\n\n    // update the grids\n    // if (!this.hideXGrid) {\n    //   this.xGrid\n    //     .transition()\n    //     .duration(1000)\n    //     .call(this.xGridCall);\n    // }\n\n    if (this.showGrid) {\n      this.yGrid\n        .transition()\n        .duration(1000)\n        .call(this.yGridCall);\n    }\n\n    // update the color bar scale\n    this.barScale.domain(Object.keys(this.data[0]).slice(1)).rangeRound([0, this.xAxisScale.bandwidth()]);\n\n    this.svg\n      .selectAll('.gray-bar')\n      .data(this.data)\n      .join(\n        enter =>\n          enter\n            .append('rect')\n            .attr('class', 'gray-bar')\n            .attr('x', d => this.xAxisScale(d.key))\n            .attr('y', d => this.yAxisScale(d.value))\n            .attr('width', this.xAxisScale.bandwidth())\n            .attr('height', this.height),\n        update =>\n          update\n            .transition()\n            .duration(1000)\n            .attr('x', d => this.xAxisScale(d.key))\n            .attr('y', d => this.yAxisScale(d.value))\n            .attr('width', this.xAxisScale.bandwidth())\n            .attr('height', this.height)\n      );\n\n    this.svg\n      .selectAll('.bar-group')\n      .data(this.data)\n      .join(\n        enter =>\n          enter\n            .append('g')\n            .attr('class', 'bar-group')\n            .attr('transform', (d, i) => {\n              return `translate(${this.xAxisScale(d.key)}, 0)`;\n            }),\n        update =>\n          update\n            .transition()\n            .duration(1000)\n            .attr('transform', (d, i) => {\n              return `translate(${this.xAxisScale(d.key)}, 0)`;\n            })\n      );\n\n    this.svg\n      .selectAll('.bar-group')\n      .selectAll('.bar')\n      .data((d, i) => {\n        const clone = { ...d };\n        delete clone.key;\n\n        const keys = Object.keys(clone);\n\n        const keyData = keys.map(function(key) {\n          return { label: key, value: d[key], parentIndex: i };\n        });\n\n        return keyData;\n      })\n      .join(\n        enter =>\n          enter\n            .append('rect')\n            .attr('class', 'bar')\n            .attr('fill', d => `url(${this._location.path()}#gradient-${this.colorRange(d.label).substr(1)})`)\n            .attr('data-color', d => this.colorRange(d.label))\n            .attr('data-parent-index', d => d.parentIndex)\n            .attr('x', d => this.barScale(d.label))\n            .attr('width', this.barScale.bandwidth())\n            .attr('y', this.height)\n            .attr('height', 0)\n            .call(enter => {\n              return enter\n                .attr('pointer-events', 'none')\n                .transition()\n                .duration(0) // 500\n                .attr('height', d => this.height - this.yAxisScale(d.value))\n                .attr('y', d => this.yAxisScale(d.value))\n                .transition()\n                .attr('pointer-events', 'auto');\n            }),\n        update =>\n          update\n            .attr('pointer-events', 'none')\n            .transition()\n            .duration(1000)\n            .attr('x', d => this.barScale(d.label))\n            .attr('width', this.barScale.bandwidth())\n            .attr('height', d => this.height - this.yAxisScale(d.value))\n            .attr('y', d => this.yAxisScale(d.value))\n            .transition()\n            .attr('pointer-events', 'auto'),\n        exit =>\n          exit\n            .transition()\n            .duration(0) // 100\n            .attr('pointer-events', 'none')\n            .attr('height', 0)\n            .attr('y', this.height)\n      )\n      .on('mouseover', (data, index, nodes) => this.barMouseOver(d3_event, data, index, nodes))\n      .on('mouseout', (data, index, nodes) => this.barMouseOut())\n      .on('click', (data, index, nodes) => this.barMouseClick(d3_event, data, index, nodes));\n\n    this.updateLegend();\n\n    this.svg.selectAll('.axis').raise();\n  }\n\n  updateChartHorizontal() {\n    // update the xScale\n    this.xAxisMax = d3_max(this.data, (data: any) => {\n      const clone = { ...data };\n      delete clone.key;\n      return d3_max(d3_values(clone));\n    });\n\n    this.xAxisMax = this.xAxisMax + this.xAxisMax * this.xAxisMaxBuffer;\n\n    this.xAxisScale\n      .domain([0, this.xAxisMax])\n      .rangeRound([0, this.width])\n      .nice();\n\n    // update the yScale\n    this.yAxisScale.domain(this.data.map(d => d.key));\n\n    this.xAxis\n      .transition()\n      .duration(1000)\n      .call(this.xAxisCall);\n\n    this.yAxis\n      .transition()\n      .duration(1000)\n      .call(this.yAxisCall);\n\n    // update the grids\n    if (this.showGrid) {\n      this.xGrid\n        .transition()\n        .duration(1000)\n        .call(this.xGridCall);\n    }\n\n    // if (!this.hideYGrid) {\n    //   this.yGrid\n    //     .transition()\n    //     .duration(1000)\n    //     .call(this.yGridCall);\n    // }\n\n    // update the color bar scale\n    this.barScale.domain(Object.keys(this.data[0]).slice(1)).rangeRound([0, this.yAxisScale.bandwidth()]);\n\n    this.svg\n      .selectAll('.gray-bar')\n      .data(this.data)\n      .join(\n        enter =>\n          enter\n            .append('rect')\n            .attr('class', 'gray-bar')\n            .attr('y', d => this.yAxisScale(d.key))\n            .attr('width', this.width)\n            .attr('height', this.yAxisScale.bandwidth()),\n        update =>\n          update\n            .transition()\n            .duration(1000)\n            .attr('y', d => this.yAxisScale(d.key))\n            .attr('width', this.width)\n            .attr('height', this.yAxisScale.bandwidth())\n      );\n\n    this.svg\n      .selectAll('.bar-group')\n      .data(this.data)\n      .join(\n        enter =>\n          enter\n            .append('g')\n            .attr('class', 'bar-group')\n            .attr('transform', (d, i) => {\n              return `translate(0, ${this.yAxisScale(d.key)})`;\n            }),\n        update =>\n          update\n            .transition()\n            .duration(1000)\n            .attr('transform', (d, i) => {\n              return `translate(0, ${this.yAxisScale(d.key)})`;\n            })\n      );\n\n    this.svg\n      .selectAll('.bar-group')\n      .selectAll('.bar')\n      .data((d, i) => {\n        const clone = { ...d };\n        delete clone.key;\n\n        const keys = Object.keys(clone);\n\n        const keyData = keys.map(function(key) {\n          return { label: key, value: d[key], parentIndex: i };\n        });\n\n        return keyData;\n      })\n      .join(\n        enter =>\n          enter\n            .append('rect')\n            .attr('class', 'bar')\n            .attr(\n              'fill',\n              d => `url(${this._location.path()}#gradient-horizontal-${this.colorRange(d.label).substr(1)})`\n            )\n            .attr('data-color', d => this.colorRange(d.label))\n            .attr('data-parent-index', d => d.parentIndex)\n            .attr('x', 0)\n            .attr('width', 0)\n            .attr('y', d => this.barScale(d.label))\n            .attr('height', this.barScale.bandwidth())\n            .call(enter => {\n              return enter\n                .attr('pointer-events', 'none')\n                .transition()\n                .duration(0) // 500\n                .attr('width', d => this.xAxisScale(d.value))\n                .transition()\n                .attr('pointer-events', 'auto');\n            }),\n        update =>\n          update\n            .attr('pointer-events', 'none')\n            .transition()\n            .duration(1000)\n            .attr('width', d => this.xAxisScale(d.value))\n            .attr('height', this.barScale.bandwidth())\n            .attr('y', d => this.barScale(d.label))\n            .transition()\n            .attr('pointer-events', 'auto'),\n        exit =>\n          exit\n            .transition()\n            .duration(0) // 100\n            .attr('pointer-events', 'none')\n            .attr('width', 0)\n      )\n      .on('mouseover', (data, index, nodes) => this.barMouseOver(d3_event, data, index, nodes))\n      .on('mouseout', (data, index, nodes) => this.barMouseOut())\n      .on('click', (data, index, nodes) => this.barMouseClick(d3_event, data, index, nodes));\n\n    this.updateLegend();\n\n    this.svg.selectAll('.axis').raise();\n  }\n\n  updateLegend() {\n    // legend\n    if (!this.hideLegend) {\n      const legendData = { ...this.data[0] };\n      delete legendData.key;\n      const legendKeys = Object.keys(legendData).map(function(key) {\n        return { label: key };\n      });\n\n      this.chart\n        .select('.legend')\n        .selectAll('.legend-item')\n        .data(legendKeys)\n        .join(\n          enter => {\n            const li = enter.append('li').attr('class', 'legend-item');\n\n            li.insert('span')\n              .attr('class', 'legend-key')\n              .style('background-color', d => this.colorRange(d.label));\n\n            li.insert('span', '.legend-item')\n              .attr('class', 'legend-label')\n              .html(d => {\n                switch (this.legendLabelFormatType) {\n                  case 'number':\n                    return this.legendLabelFormat(d.label);\n\n                  case 'time':\n                    const parsedTime = d3_isoParse(d.label);\n                    return this.legendLabelFormat(parsedTime);\n\n                  default:\n                    return d.label;\n                }\n              });\n\n            return li;\n          },\n          update => {\n            update.select('.legend-label').html(d => {\n              switch (this.legendLabelFormatType) {\n                case 'number':\n                  return this.legendLabelFormat(d.label);\n\n                case 'time':\n                  const parsedTime = d3_isoParse(d.label);\n                  return this.legendLabelFormat(parsedTime);\n\n                default:\n                  return d.label;\n              }\n            });\n\n            return update;\n          },\n          exit => exit.remove()\n        )\n        .on('mouseover', (data, index, nodes) => this.legendMouseOver(d3_event, data, index, nodes))\n        .on('mouseout', () => this.legendMouseOut())\n        .on('click', (data, index, nodes) => this.legendMouseClick(d3_event, data, index, nodes));\n    }\n  }\n\n  barMouseOver = (event, data, index, nodes) => {\n    const node = d3_select(nodes[index]);\n\n    this.chart\n      .selectAll('.bar-group')\n      .selectAll('.bar')\n      .classed('inactive', true);\n\n    node.classed('inactive', false).style('fill', node.attr('data-color'));\n\n    this.tooltipShow(data, nodes[index]);\n\n    this.hovered.emit({ event, data });\n  };\n\n  barMouseOut = () => {\n    this.chart\n      .selectAll('.bar')\n      .classed('inactive', false)\n      .style('fill', null);\n\n    this.tooltipHide();\n  };\n\n  barMouseClick = (event, data, index, nodes) => {\n    this.clicked.emit({ event, data });\n  };\n\n  legendMouseOver = (event, data, index, nodes) => {\n    this.chart\n      .selectAll('.legend-item')\n      .filter((d, i) => i !== index)\n      .classed('inactive', true);\n\n    this.chart\n      .selectAll('.bar-group')\n      .selectAll('.bar')\n      .filter((d, i) => i !== index)\n      .classed('inactive', true);\n\n    const bar = this.chart\n      .selectAll('.bar-group')\n      .selectAll('.bar')\n      .filter((d, i) => i === index)\n      .classed('inactive', null);\n\n    const barColor = bar.attr('data-color');\n\n    bar.style('fill', () => barColor);\n\n    this.hovered.emit({ event, data });\n  };\n\n  legendMouseOut = () => {\n    this.chart.selectAll('.legend-item').classed('inactive', false);\n\n    this.chart\n      .selectAll('.bar-group')\n      .selectAll('.bar')\n      .classed('inactive', false)\n      .style('fill', null);\n  };\n\n  legendMouseClick = (event, data, index, nodes) => {\n    this.clicked.emit({ event, data });\n  };\n\n  private tooltipShow = (data, node) => {\n    const dimensions = node.getBoundingClientRect();\n    const scroll = this._scroll.getScrollPosition();\n    let label;\n\n    switch (this.tooltipLabelFormatType) {\n      case 'number':\n        label = this.tooltipLabelFormat(data.label);\n        break;\n\n      case 'time':\n        const parsedTime = d3_isoParse(data.label);\n        label = this.tooltipLabelFormat(parsedTime);\n        break;\n\n      default:\n        label = data.label;\n    }\n\n    const value =\n      this.tooltipValueFormat === null\n        ? `<div class=\"tooltip-value\">${data.value}</div>`\n        : `<div class=\"tooltip-value\">${this.tooltipValueFormat(data.value)}</div>`;\n\n    this.tooltip.html(\n      `\n        ${label}\n        ${value}\n      `\n    );\n\n    const tooltipOffsetWidth = +this.tooltip.node().offsetWidth / 2;\n    const tooltipOffsetHeight = +this.tooltip.node().offsetHeight;\n    const tooltipTipSize = 8;\n\n    if (this.vertical) {\n      this.tooltip.style('top', `${+scroll[1] + +dimensions.top - tooltipOffsetHeight - tooltipTipSize}px`);\n      this.tooltip.style('left', `${+scroll[0] + +dimensions.left - tooltipOffsetWidth + +dimensions.width / 2}px`);\n    } else {\n      this.tooltip.style('top', `${+scroll[1] + +dimensions.top + +dimensions.height / 2 - tooltipOffsetHeight / 2}px`);\n      this.tooltip.style('left', `${+scroll[0] + +dimensions.right + tooltipTipSize}px`);\n    }\n\n    this.tooltip.style('opacity', 1);\n  };\n\n  private tooltipHide = () => {\n    this.tooltip.style('opacity', 0);\n  };\n\n  private xAxisFormatter = item => {\n    switch (this.xAxisFormatType) {\n      case 'number':\n        return this.xAxisFormat(item);\n\n      case 'time':\n        const parseDate = d3_isoParse(item);\n        return this.xAxisFormat(parseDate);\n\n      default:\n        return item;\n    }\n  };\n\n  private yAxisFormatter = item => {\n    switch (this.yAxisFormatType) {\n      case 'number':\n        return this.yAxisFormat(item);\n\n      case 'time':\n        const parseDate = d3_isoParse(item);\n        return this.yAxisFormat(parseDate);\n\n      default:\n        return item;\n    }\n  };\n}\n","import {\n  Component,\n  OnInit,\n  Input,\n  ElementRef,\n  HostBinding,\n  OnChanges,\n  SimpleChanges,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  OnDestroy\n} from '@angular/core';\n\nimport { ViewportScroller, Location } from '@angular/common';\n\nimport { select as d3_select, event as d3_event } from 'd3-selection';\nimport { scaleOrdinal as d3_scaleOrdinal, scaleLinear as d3_scaleLinear } from 'd3-scale';\nimport { sum as d3_sum } from 'd3-array';\nimport { axisBottom as d3_axisBottom } from 'd3-axis';\nimport { format as d3_format } from 'd3-format';\nimport { timeFormat as d3_timeFormat, isoParse as d3_isoParse } from 'd3-time-format';\nimport { easeLinear as d3_easeLinear } from 'd3-ease';\n\nimport { PbdsDatavizService } from './dataviz.service';\nimport { PbdsDatavizBarSingleHorizontal, PbdsDatavizBarSingleHorizontalCompare } from './dataviz.interfaces';\n\n@Component({\n  selector: 'pbds-dataviz-bar-single-horizontal',\n  template: ``,\n  styles: [],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class PbdsDatavizBarSingleHorizontalComponent implements OnInit, OnDestroy, OnChanges {\n  @HostBinding('class.pbds-chart')\n  chartClass = true;\n\n  @HostBinding('class.pbds-chart-bar-single-horizontal')\n  singleStackedBarClass = true;\n\n  @Input()\n  data: Array<PbdsDatavizBarSingleHorizontal | PbdsDatavizBarSingleHorizontalCompare>;\n\n  @Input()\n  width = 300;\n\n  @Input()\n  height = 40;\n\n  @Input()\n  nullValueText = 'No data available';\n\n  @Input()\n  percentage = false;\n\n  @Input()\n  marginTop = 10;\n\n  @Input()\n  marginRight = 20;\n\n  @Input()\n  marginBottom = 35;\n\n  @Input()\n  marginLeft = 15;\n\n  @Input()\n  barMargin = 2;\n\n  @Input()\n  hideXAxis = false;\n\n  @Input()\n  xAxisTicks = 6;\n\n  @Input()\n  xAxisTitle: string | null = null;\n\n  @Input()\n  xAxisFormatType: 'number' = null;\n\n  @Input()\n  xAxisFormatString = '';\n\n  @Input()\n  xAxisTickLabelSuffix = '';\n\n  @Input()\n  hideXGrid = false;\n\n  @Input()\n  hideLegend = false;\n\n  @Input()\n  hideLegendTooltip = true;\n\n  @Input()\n  legendWidth = 105 + 28; // hardcoded legend width + left margin, do not document until feedback\n\n  @Input()\n  legendPosition: 'right' | 'bottom' = 'bottom';\n\n  @Input()\n  legendLabelFormatType: 'number' | 'time' = null;\n\n  @Input()\n  legendLabelFormatString = '';\n\n  @Input()\n  hideTooltip = false;\n\n  @Input()\n  tooltipLabelFormatType: 'number' | 'time' = null;\n\n  @Input()\n  tooltipLabelFormatString = '';\n\n  @Input()\n  tooltipDateFormatString = '%b %e, %Y';\n\n  @Input()\n  tooltipValueFormatType: 'number' = null;\n\n  @Input()\n  tooltipValueFormatString = '';\n\n  @Input()\n  tooltipValueSuffix = '';\n\n  @Input()\n  tooltipPercentFormatString = '.2%';\n\n  @Input()\n  compareChangeFormatString = '.2%';\n\n  @Input()\n  monochrome = false;\n\n  @Input()\n  theme: 'classic' | 'ocean' | 'sunset' | 'twilight';\n\n  @Output()\n  hovered: EventEmitter<object> = new EventEmitter<object>();\n\n  @Output()\n  clicked: EventEmitter<object> = new EventEmitter<object>();\n\n  private isSingleData = false;\n  private isCompare = false;\n  private chart;\n  private svg;\n  private margin;\n  private colorRange;\n  private barPadding = 40;\n  private xAxisCall;\n  private xAxis;\n  private xAxisScale;\n  private xAxisTickSize: number;\n  private xAxisTickSizeOuter: number;\n  private xAxisFormat;\n  private xAxisTitleMargin: number;\n  private hideXAxisDomain: boolean;\n  private hideXAxisZero: boolean;\n  private hideXAxisTicks: boolean;\n  private xGrid;\n  private xGridCall;\n  private legendLabelFormat;\n  private tooltip;\n  private tooltipLabelFormat;\n  private tooltipValueFormat;\n  private tooltipDateFormat;\n  private tooltipPercentFormat;\n  private tooltipCompareChangeFormat;\n\n  constructor(\n    private _dataviz: PbdsDatavizService,\n    private _element: ElementRef,\n    private _scroll: ViewportScroller,\n    private _location: Location\n  ) {}\n\n  ngOnInit() {\n    this.height = +this.height + this.barPadding;\n\n    this.margin = {\n      top: +this.marginTop,\n      right: +this.marginRight,\n      bottom: +this.marginBottom,\n      left: +this.marginLeft\n    };\n\n    this.isSingleData = this.data.length === 1 ? true : false;\n    this.isCompare = Object.keys(this.data[0]).includes('compareValue');\n\n    // create formatters\n    this.xAxisFormat = this._dataviz.d3Format(this.xAxisFormatType, this.xAxisFormatString);\n    this.legendLabelFormat = this._dataviz.d3Format(this.legendLabelFormatType, this.legendLabelFormatString);\n    this.tooltipValueFormat = this._dataviz.d3Format(this.tooltipValueFormatType, this.tooltipValueFormatString);\n    this.tooltipDateFormat = d3_timeFormat(this.tooltipDateFormatString);\n    this.tooltipPercentFormat = d3_format(this.tooltipPercentFormatString);\n    this.tooltipCompareChangeFormat = d3_format(this.compareChangeFormatString);\n\n    // defaults for all chart types\n    this.hideXAxisZero = false;\n    this.hideXAxisDomain = true;\n    this.hideXAxisTicks = true;\n    this.xAxisTickSize = 8;\n    this.xAxisTickSizeOuter = 0;\n    this.xAxisTitleMargin = this.xAxisTitle ? 20 : 0;\n\n    if (!this.hideLegend && this.legendPosition === 'right') {\n      this.width = +this.width - +this.legendWidth;\n    }\n\n    // create the chart\n    this.chart = d3_select(this._element.nativeElement).attr('aria-hidden', 'true');\n\n    // create chart svg\n    this.svg = this.chart\n      .append('svg')\n      .attr('width', () => {\n        return +this.width + this.margin.left + this.margin.right;\n      })\n      .attr('height', +this.height + this.margin.top + this.margin.bottom + this.xAxisTitleMargin)\n      .attr('class', 'img-fluid')\n      .attr('preserveAspectRatio', 'xMinYMin meet')\n      .attr('viewBox', () => {\n        return `-${this.margin.left} -${this.margin.top} ${+this.width + this.margin.left + this.margin.right} ${+this\n          .height +\n          this.margin.top +\n          this.margin.bottom +\n          this.xAxisTitleMargin}`;\n      });\n\n    // TOOLTIP\n    if (!this.hideTooltip) {\n      this.tooltip = d3_select('body')\n        .append('div')\n        .attr('class', 'pbds-tooltip south')\n        .classed('pbds-tooltip-compare', this.isCompare)\n        .style('opacity', 0)\n        .attr('aria-hidden', 'true'); // hide tooltip for accessibility\n    }\n\n    // add legend classes\n    if (!this.hideLegend && this.data.length > 1) {\n      this.chart.classed('pbds-chart-legend-bottom', this.legendPosition === 'bottom' ? true : false);\n      this.chart.append('ul').attr('class', `legend legend-${this.legendPosition}`);\n    }\n\n    // X AXIS\n    this.xAxisScale = d3_scaleLinear()\n      .domain([0, Math.ceil(d3_sum(this.data, (d: any) => d.value))])\n      .range([0, +this.width]);\n\n    this.xAxisCall = d3_axisBottom(this.xAxisScale)\n      // .tickValues([0, d3_sum(this.data, (d: any) => d.value)])\n      .ticks(this.xAxisTicks)\n      .tickSize(this.xAxisTickSize)\n      .tickSizeOuter(this.xAxisTickSizeOuter)\n      .tickFormat(this.xAxisFormatter);\n\n    this.xAxis = this.svg\n      .append('g')\n      .attr('class', 'axis axis-x')\n      .attr('transform', `translate(0, ${this.height})`)\n      .classed('axis-hidden', this.hideXAxis)\n      .classed('axis-zero-hidden', this.hideXAxisZero)\n      .classed('axis-domain-hidden', this.hideXAxisDomain)\n      .classed('axis-ticks-hidden', this.hideXAxisTicks);\n    // .call(this.xAxisCall);\n\n    // X GRIDLINES\n    if (!this.hideXGrid) {\n      this.xGridCall = d3_axisBottom(this.xAxisScale).tickSize(-this.height);\n\n      this.xGrid = this.svg\n        .append('g')\n        .attr('class', 'grid grid-x')\n        .classed('grid-zero-hidden', this.hideXAxisZero)\n        .attr('transform', `translate(0, ${this.height})`)\n        .call(this.xGridCall);\n    }\n\n    if (this.xAxisTitle) {\n      this.svg\n        .append('text')\n        .attr('class', 'axis-title')\n        .attr('text-anchor', 'center')\n        .attr('x', this.width / 2 - this.margin.left)\n        .attr('y', this.height + this.margin.top + (!this.hideXAxis ? 40 : 0))\n        .text(this.xAxisTitle);\n    }\n\n    // build color ranges\n    let colors;\n\n    if (this.isSingleData) {\n      colors = this._dataviz.createGradientDefs(this.svg, this.monochrome, this.theme, false);\n    } else if (this.monochrome) {\n      colors = this._dataviz.getColors(this.monochrome, this.theme).reverse();\n    } else {\n      colors = this._dataviz.getColors(this.monochrome, this.theme);\n    }\n\n    this.colorRange = d3_scaleOrdinal().range(colors);\n\n    this.updateChart();\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    if (changes.data && !changes.data.firstChange) {\n      this.updateChart();\n    }\n  }\n\n  ngOnDestroy() {\n    if (this.tooltip) this.tooltip.remove();\n  }\n\n  updateChart() {\n    this.isSingleData = this.data.length === 1 ? true : false;\n    this.isCompare = Object.keys(this.data[0]).includes('compareValue');\n\n    const sumValues = d3_sum(this.data, (d: any) => d.value);\n    const isLastBarZero =\n      this.data[this.data.length - 1].value === 0 || this.data[this.data.length - 1].value === null ? true : false;\n\n    let lastBarZeroCount = 0;\n    const cloneData = [...this.data];\n    let isLast = false;\n\n    cloneData.reverse().forEach((value, index, array) => {\n      if ((value.value === 0 || value.value === null) && !isLast) {\n        lastBarZeroCount++;\n      } else {\n        isLast = true;\n      }\n    });\n\n    if (this.percentage && !this.isSingleData) {\n      this.xAxisScale.domain([0, sumValues]).range([0, +this.width]);\n      this.xAxisCall.tickValues([0, sumValues * 0.25, sumValues * 0.5, sumValues * 0.75, sumValues]);\n      this.xAxis.call(this.xAxisCall);\n\n      this.xGridCall.tickValues([0, sumValues * 0.25, sumValues * 0.5, sumValues * 0.75, sumValues]);\n      this.xGrid.call(this.xGridCall);\n\n      this.svg\n        .select('.axis-x')\n        .selectAll('text')\n        .html((d, i) => {\n          const format = d3_format('.0%');\n          return format(i * 0.25);\n        });\n    } else if (this.percentage && this.isSingleData) {\n      this.xAxisScale.domain([0, 1.0]).range([0, +this.width]);\n      this.xAxisCall.tickValues([0, 0.25, 0.5, 0.75, 1.0]);\n      this.xAxis.call(this.xAxisCall);\n\n      this.xGridCall.tickValues([0, 0.25, 0.5, 0.75, 1.0]);\n      this.xGrid.call(this.xGridCall);\n\n      this.svg\n        .select('.axis-x')\n        .selectAll('text')\n        .html((d, i) => {\n          const format = d3_format('.0%');\n          return format(i * 0.25);\n        });\n    } else {\n      this.xAxisScale.domain([0, Math.ceil(sumValues)]).range([0, +this.width]);\n      this.xGridCall.tickValues(this.xAxisScale.ticks().filter(n => Number.isInteger(n))); // remove decimal grid values\n\n      this.xAxis\n        .transition()\n        .duration(1000)\n        .call(this.xAxisCall);\n\n      // update the grids\n      if (!this.hideXGrid) {\n        this.xGrid\n          .transition()\n          .duration(1000)\n          .call(this.xGridCall);\n      }\n    }\n\n    this.svg\n      .selectAll('.bar')\n      .data(this.data)\n      .join(\n        enter =>\n          enter\n            .append('rect')\n            .attr('class', 'bar')\n            .attr('width', 0)\n            .attr('height', () => {\n              return this.height - this.barPadding;\n            })\n            .attr('fill', d => {\n              if (this.isSingleData) {\n                return `url(${this._location.path()}#gradient-horizontal-${this.colorRange(d.label).substr(1)})`;\n              } else {\n                return this.colorRange(d.label);\n              }\n            })\n            .attr('y', () => {\n              return this.barPadding / 2;\n            })\n            .attr('x', (d, i) => {\n              return this.data.slice(0, i).reduce((acc, item) => {\n                // console.log(acc, item, acc + this.xAxisScale(item.value) + this.barMargin);\n                return +acc + +this.xAxisScale(item.value);\n              }, 1);\n            })\n            .attr('pointer-events', 'none')\n            .call(enter => {\n              return (\n                enter\n                  .transition()\n                  // .duration(0)\n                  .delay((d, i) => i * 250)\n                  .ease(d3_easeLinear)\n                  .attr('width', (d, i) => {\n                    // debugger;\n                    if (i === this.data.length - lastBarZeroCount - 1 && isLastBarZero) {\n                      return this.xAxisScale(d.value);\n                    } else if (i !== this.data.length - 1) {\n                      let width = this.xAxisScale(d.value) - +this.barMargin;\n                      width = Math.sign(width) === -1 ? 0 : width; // handle negative values\n                      return width;\n                    } else {\n                      return this.xAxisScale(d.value);\n                    }\n                  })\n                  .transition()\n                  .attr('pointer-events', 'auto')\n              );\n            }),\n        update =>\n          update\n            .attr('pointer-events', 'none')\n            .transition()\n            .duration(1000)\n            .attr('width', (d, i) => {\n              // debugger;\n              if (d.value === null || d.value === 0) {\n                return this.xAxisScale(0);\n              } else if (i === this.data.length - 1) {\n                return this.xAxisScale(d.value);\n              } else {\n                return this.xAxisScale(d.value) - this.barMargin;\n              }\n            })\n            .attr('x', (d, i) => {\n              return this.data.slice(0, i).reduce((acc, item) => {\n                return acc + +this.xAxisScale(item.value);\n              }, 0);\n            })\n            .transition()\n            .attr('pointer-events', 'auto'),\n        exit =>\n          exit\n            .transition()\n            .attr('pointer-events', 'none')\n            .remove()\n      )\n      .on('mouseover', (data, index, nodes) => this.barMouseOver(d3_event, data, index, nodes))\n      .on('mouseout', (data, index, nodes) => this.barMouseOut())\n      .on('click', (data, index, nodes) => this.barMouseClick(d3_event, data, index, nodes));\n\n    if (!this.hideLegend) {\n      this.chart\n        .select('.legend')\n        .selectAll('.legend-item')\n        .data(this.data)\n        .join(\n          enter => {\n            const li = enter\n              .append('li')\n              .attr('class', 'legend-item')\n              .classed('align-items-start', this.isCompare);\n\n            li.insert('span')\n              .attr('class', 'legend-key')\n              .style('background-color', d => this.colorRange(d.label))\n              .classed('mt-1', this.isCompare);\n\n            li.insert('span')\n              .attr('class', 'legend-description')\n              .classed('d-flex', this.isCompare)\n              .classed('flex-column', this.isCompare);\n\n            li.select('.legend-description')\n              .insert('span')\n              .attr('class', 'legend-label')\n              .html(d => {\n                switch (this.legendLabelFormatType) {\n                  case 'number':\n                    return this.legendLabelFormat(d.label);\n\n                  case 'time':\n                    const parsedTime = d3_isoParse(d.label);\n                    return this.legendLabelFormat(parsedTime);\n\n                  default:\n                    return d.label;\n                }\n              });\n\n            li.select('.legend-description')\n              .insert('div')\n              .attr('class', 'legend-change')\n              .classed('d-none', !this.isCompare);\n\n            li.select('.legend-change').html(d => {\n              return `<div class=\"metric-block-indicator ${d.compareChangeDirection} ${\n                d.compareChangeInverse ? 'inverse' : ''\n              } mt-1\"><span>${this.tooltipCompareChangeFormat(d.compareChangeValue)}</span></div>`;\n            });\n\n            return li;\n          },\n          update => {\n            update.classed('align-items-start', this.isCompare);\n            update.select('.legend-key').classed('mt-1', this.isCompare);\n            update.select('.legend-change').classed('d-none', !this.isCompare);\n\n            if (this.isCompare) {\n              update.select('.legend-change').html(d => {\n                return `<div class=\"metric-block-indicator ${d.compareChangeDirection} ${\n                  d.compareChangeInverse ? 'inverse' : ''\n                } mt-1\"><span>${this.tooltipCompareChangeFormat(d.compareChangeValue)}</span></div>`;\n              });\n            }\n\n            update.select('.legend-label').html(d => {\n              switch (this.legendLabelFormatType) {\n                case 'number':\n                  return this.legendLabelFormat(d.label);\n\n                case 'time':\n                  const parsedTime = d3_isoParse(d.label);\n                  return this.legendLabelFormat(parsedTime);\n\n                default:\n                  return d.label;\n              }\n            });\n\n            return update;\n          },\n          exit => exit.remove()\n        )\n        .on('mouseover', (data, index, nodes) => this.legendMouseOver(d3_event, data, index, nodes))\n        .on('mouseout', () => this.legendMouseOut())\n        .on('click', (data, index, nodes) => this.legendMouseClick(d3_event, data, index, nodes));\n    }\n  }\n\n  barMouseOver = (event, data, index, nodes) => {\n    const node = d3_select(nodes[index]);\n\n    this.chart.selectAll('.bar').classed('inactive', true);\n\n    node.classed('inactive', false);\n\n    this.chart\n      .selectAll('.legend-item')\n      .filter((d, i) => {\n        // debugger;\n        return i !== index;\n      })\n      .classed('inactive', true);\n\n    this.tooltipShow(data, nodes[index]);\n\n    this.hovered.emit({ event, data });\n  };\n\n  barMouseOut = () => {\n    this.chart\n      .selectAll('.bar')\n      .classed('inactive', false)\n      .style('fill', null);\n\n    this.chart.selectAll('.legend-item').classed('inactive', false);\n\n    this.tooltipHide();\n  };\n\n  barMouseClick = (event, data, index, nodes) => {\n    this.clicked.emit({ event, data });\n  };\n\n  private tooltipShow = (data, node) => {\n    const dimensions = node.getBoundingClientRect();\n    const scroll = this._scroll.getScrollPosition();\n\n    const percentage = data.value / d3_sum(this.data, (d: any) => d.value);\n    const comparePercentage = data.compareValue / d3_sum(this.data, (d: any) => d.compareValue);\n\n    let tooltipLabel = ``;\n    let tooltipCompareDaterangeMargin = ``;\n    let tooltipCompareDaterange = ``;\n    let tooltipCompareValue = ``;\n    let tooltipDaterangeMargin = ``;\n    let tooltipDaterange = ``;\n    let tooltipValue = `${this.nullValueText}`;\n    let tooltipIndicator = '';\n\n    // tooltip label\n    if (!this.isSingleData) {\n      this.tooltip.classed('pbds-tooltip-compare', null);\n\n      switch (this.tooltipLabelFormatType) {\n        case 'number':\n          tooltipLabel = this.tooltipLabelFormat(data.label);\n          break;\n\n        case 'time':\n          const parsedTime = d3_isoParse(data.label);\n          tooltipLabel = this.tooltipLabelFormat(parsedTime);\n          break;\n\n        default:\n          tooltipLabel = data.label;\n      }\n    }\n\n    // tooltip compare daterange\n    if (this.isCompare && data.compareStartDate && data.compareEndDate) {\n      this.tooltip.classed('pbds-tooltip-compare', this.isCompare);\n      tooltipCompareDaterangeMargin = `mt-2`;\n\n      tooltipCompareDaterange = `${this.tooltipDateFormat(\n        d3_isoParse(data.compareStartDate)\n      )} - ${this.tooltipDateFormat(d3_isoParse(data.compareEndDate))}`;\n    }\n\n    // tooltip compare value\n    if (this.percentage && this.isCompare && data.compareValue) {\n      tooltipCompareValue =\n        this.tooltipValueFormat === null\n          ? `${this.tooltipPercentFormat(comparePercentage)} (${data.comparveValue}${this.tooltipValueSuffix})`\n          : `${this.tooltipPercentFormat(comparePercentage)} (${this.tooltipValueFormat(data.compareValue)}${\n              this.tooltipValueSuffix\n            })`;\n    } else if (this.isCompare && data.compareValue !== null) {\n      tooltipCompareValue =\n        this.tooltipValueFormat === null\n          ? `${data.compareValue}${this.tooltipValueSuffix} (${this.tooltipPercentFormat(comparePercentage)})`\n          : `${this.tooltipValueFormat(data.compareValue)}${this.tooltipValueSuffix} (${this.tooltipPercentFormat(\n              comparePercentage\n            )})`;\n    } else if (this.isCompare && data.compareValue === null) {\n      tooltipCompareValue = `${this.nullValueText}`;\n    }\n\n    // tooltip daterange\n    if (data.startDate && data.endDate) {\n      tooltipDaterange = `${this.tooltipDateFormat(d3_isoParse(data.startDate))} - ${this.tooltipDateFormat(\n        d3_isoParse(data.endDate)\n      )}`;\n    }\n\n    //tooltip daterange margin\n    if (tooltipLabel !== '') {\n      tooltipDaterangeMargin = `mt-2`;\n    }\n\n    // tooltip value\n    if (this.isSingleData && this.percentage && data.value) {\n      tooltipValue = this.tooltipValueFormat === null ? `${data.value}` : `${this.tooltipValueFormat(data.value)}`;\n    } else if (this.isSingleData && data.value !== null) {\n      tooltipValue =\n        this.tooltipValueFormat === null\n          ? `${data.value}${this.tooltipValueSuffix}`\n          : `${this.tooltipValueFormat(data.value)}${this.tooltipValueSuffix}`;\n    } else if (!this.isSingleData && this.percentage && data.value !== null) {\n      tooltipValue =\n        this.tooltipValueFormat === null\n          ? `${this.tooltipPercentFormat(percentage)} (${data.value}${this.tooltipValueSuffix})`\n          : `${this.tooltipPercentFormat(percentage)} (${this.tooltipValueFormat(data.value)}${\n              this.tooltipValueSuffix\n            })`;\n    } else if (!this.isSingleData && data.value !== null) {\n      tooltipValue =\n        this.tooltipValueFormat === null\n          ? `${data.value}${this.tooltipValueSuffix} (${this.tooltipPercentFormat(percentage)})`\n          : `${this.tooltipValueFormat(data.value)}${this.tooltipValueSuffix} (${this.tooltipPercentFormat(\n              percentage\n            )})`;\n    }\n\n    // tooltip metric indicator\n    if (!this.isSingleData && this.isCompare && data.value !== null && data.compareValue !== null) {\n      tooltipIndicator = `<div class=\"metric-block-indicator ${data.compareChangeDirection} ${\n        data.compareChangeInverse ? 'inverse' : ''\n      } ml-2\"><span>${this.tooltipCompareChangeFormat(data.compareChangeValue)}</span></div>`;\n    }\n\n    this.tooltip.html(() => {\n      return `\n        <div class=\"tooltip-label font-weight-bold\">${tooltipLabel}</div>\n        <div class=\"${tooltipCompareDaterangeMargin}\">${tooltipCompareDaterange}</div>\n        <div class=\"tooltip-value font-weight-bold\">${tooltipCompareValue}</div>\n        <div class=\"${tooltipDaterangeMargin}\">${tooltipDaterange}</div>\n        <div class=\"tooltip-value\"><span class=\"font-weight-bold\">${tooltipValue}</span> <span>${tooltipIndicator}</span></div>\n      `;\n    });\n\n    const tooltipOffsetWidth = +this.tooltip.node().offsetWidth / 2;\n    const tooltipOffsetHeight = +this.tooltip.node().offsetHeight;\n    const tooltipTipSize = 8;\n\n    this.tooltip.style('top', `${+scroll[1] + +dimensions.top - tooltipOffsetHeight - tooltipTipSize}px`);\n\n    if (this.data.length > 1) {\n      this.tooltip.style('left', `${+scroll[0] + +dimensions.left - tooltipOffsetWidth + +dimensions.width / 2}px`);\n    } else {\n      this.tooltip.style('left', `${+scroll[0] - tooltipOffsetWidth + +dimensions.right}px`);\n    }\n\n    this.tooltip.style('opacity', 1);\n  };\n\n  private tooltipHide = () => {\n    this.tooltip.style('opacity', 0);\n  };\n\n  legendMouseOver = (event, data, index, nodes) => {\n    if (!this.hideLegendTooltip) {\n      const barHover = this.svg\n        .selectAll('.bar')\n        .filter((d, i) => i === index)\n        .node();\n\n      this.tooltipShow(data, barHover);\n    }\n\n    this.chart\n      .selectAll('.legend-item')\n      .filter((d, i) => i !== index)\n      .classed('inactive', true);\n\n    this.chart\n      .selectAll('.bar')\n      .filter((d, i) => i !== index)\n      .classed('inactive', true);\n\n    this.chart\n      .selectAll('.bar')\n      .filter((d, i) => i === index)\n      .classed('inactive', null);\n\n    this.hovered.emit({ event, data });\n  };\n\n  legendMouseOut = () => {\n    this.chart.selectAll('.legend-item').classed('inactive', false);\n\n    this.chart\n      .selectAll('.bar')\n      .classed('inactive', false)\n      .style('fill', null);\n\n    // hide tooltip for zero/null values\n    this.tooltipHide();\n  };\n\n  legendMouseClick = (event, data, index, nodes) => {\n    this.clicked.emit({ event, data });\n  };\n\n  private xAxisFormatter = item => {\n    switch (this.xAxisFormatType) {\n      case 'number':\n        return `${this.xAxisFormat(item)}${this.xAxisTickLabelSuffix}`;\n\n      default:\n        return `${item}${this.xAxisTickLabelSuffix}`;\n    }\n  };\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { NgbTooltipModule } from '@ng-bootstrap/ng-bootstrap';\n\nimport { PbdsDatavizPieComponent } from './dataviz-pie.component';\nimport { PbdsDatavizBarComponent } from './dataviz-bar.component';\nimport { PbdsDatavizLineComponent } from './dataviz-line.component';\nimport { PbdsDatavizGaugeComponent } from './dataviz-gauge.component';\nimport { PbdsDatavizSparklineComponent } from './dataviz-sparkline.component';\nimport { PbdsDatavizBarStackedComponent } from './dataviz-bar-stacked.component';\nimport { PbdsDatavizMetricBlockComponent } from './dataviz-metric-block.component';\nimport { PbdsDatavizMetricIndicatorComponent } from './dataviz-metric-indicator.component';\nimport { DatavizBubbleMapComponent } from './dataviz-bubble-map.component';\nimport { PbdsDatavizHeatmapComponent } from './dataviz-heatmap.component';\nimport { PbdsDatavizChoroplethMapComponent } from './dataviz-choropleth-map.component';\nimport { PbdsDatavizBarGroupedComponent } from './dataviz-bar-grouped.component';\nimport { PbdsDatavizBarSingleHorizontalComponent } from './dataviz-bar-single-horizontal.component';\n\n@NgModule({\n  declarations: [\n    PbdsDatavizPieComponent,\n    PbdsDatavizBarComponent,\n    PbdsDatavizLineComponent,\n    PbdsDatavizGaugeComponent,\n    PbdsDatavizSparklineComponent,\n    PbdsDatavizBarStackedComponent,\n    PbdsDatavizMetricBlockComponent,\n    DatavizBubbleMapComponent,\n    PbdsDatavizMetricIndicatorComponent,\n    PbdsDatavizHeatmapComponent,\n    PbdsDatavizChoroplethMapComponent,\n    PbdsDatavizBarGroupedComponent,\n    PbdsDatavizBarSingleHorizontalComponent\n  ],\n  imports: [CommonModule, NgbTooltipModule],\n  exports: [\n    PbdsDatavizPieComponent,\n    PbdsDatavizBarComponent,\n    PbdsDatavizLineComponent,\n    PbdsDatavizGaugeComponent,\n    PbdsDatavizSparklineComponent,\n    PbdsDatavizBarStackedComponent,\n    PbdsDatavizMetricBlockComponent,\n    DatavizBubbleMapComponent,\n    PbdsDatavizMetricIndicatorComponent,\n    PbdsDatavizHeatmapComponent,\n    PbdsDatavizChoroplethMapComponent,\n    PbdsDatavizBarGroupedComponent,\n    PbdsDatavizBarSingleHorizontalComponent\n  ]\n})\nexport class PbdsDatavizModule {}\n","import { Directive, HostListener, HostBinding } from '@angular/core';\nimport { ViewportScroller } from '@angular/common';\n\n@Directive({\n  selector: 'header.bg-brand-header'\n})\nexport class PbdsHeaderShadowDirective {\n  @HostBinding('class.pbds-header-shadow')\n  shadow: boolean;\n\n  @HostListener('window:scroll', []) onWindowScroll() {\n    const offset = this._scroll.getScrollPosition();\n    this.shadow = offset[1] > 20;\n  }\n\n  constructor(private _scroll: ViewportScroller) {}\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { PbdsHeaderShadowDirective } from './header-shadow.directive';\n\n@NgModule({\n  declarations: [PbdsHeaderShadowDirective],\n  imports: [CommonModule],\n  exports: [PbdsHeaderShadowDirective]\n})\nexport class PbdsHeaderShadowModule {}\n","import { Injectable, Inject, LOCALE_ID } from '@angular/core';\nimport { registerLocaleData } from '@angular/common';\n\nimport { PbdsDaterangeLocale } from './daterange-popover.interfaces';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class PbdsDaterangeService {\n  private locale = this.localeId.toLowerCase();\n\n  constructor(@Inject(LOCALE_ID) private localeId: string) {}\n\n  setLocale(locale: PbdsDaterangeLocale) {\n    this.locale = `${locale.language}-${locale.country}`.toLowerCase();\n\n    // set the angular LOCALE_ID dynamically for ng-bootstrap datepicker\n    registerLocaleData(locale.locale, this.locale);\n  }\n\n  getCurrentLocale() {\n    return this.locale;\n  }\n}\n","import {\n  Component,\n  Injectable,\n  OnInit,\n  ViewChild,\n  Input,\n  Output,\n  EventEmitter,\n  OnChanges,\n  SimpleChanges\n} from '@angular/core';\n\nimport {\n  getLocaleDayNames,\n  getLocaleMonthNames,\n  getLocaleFirstDayOfWeek,\n  FormStyle,\n  TranslationWidth,\n  getLocaleDateFormat,\n  FormatWidth,\n  formatDate\n} from '@angular/common';\n\nimport { NgbPopover, NgbDate, NgbCalendar, NgbDatepickerI18n, NgbDateStruct } from '@ng-bootstrap/ng-bootstrap';\n\nimport { PbdsDaterangePreset, PbdsDaterangeFilter, PbdsDaterangeChange } from './daterange-popover.interfaces';\nimport { PbdsDaterangeService } from './daterange-popover.service';\n\n// Define custom service providing the months and weekdays translations\n@Injectable()\nexport class CustomDatepickerI18n extends NgbDatepickerI18n {\n  constructor(public daterangeService: PbdsDaterangeService) {\n    super();\n  }\n\n  getWeekdayShortName(weekday: number): string {\n    // for ng-bootstrap, sunday number of 7 converted to 0\n    weekday = weekday === 7 ? 0 : weekday;\n\n    // console.log(\n    //   'weekday: ',\n    //   this.daterangeService.getCurrentLocale(),\n    //   weekday,\n    //   getLocaleDayNames(this.daterangeService.getCurrentLocale(), FormStyle.Standalone, TranslationWidth.Abbreviated)[weekday]\n    // );\n\n    return getLocaleDayNames(\n      this.daterangeService.getCurrentLocale(),\n      FormStyle.Standalone,\n      TranslationWidth.Abbreviated\n    )[weekday];\n  }\n\n  getMonthShortName(month: number): string {\n    return getLocaleMonthNames(this.daterangeService.getCurrentLocale(), FormStyle.Standalone, TranslationWidth.Wide)[\n      month - 1\n    ];\n  }\n\n  getMonthFullName(month: number): string {\n    return getLocaleMonthNames(this.daterangeService.getCurrentLocale(), FormStyle.Standalone, TranslationWidth.Wide)[\n      month - 1\n    ];\n  }\n\n  getDayAriaLabel(date: NgbDateStruct): string {\n    return `${date.day}-${date.month}-${date.year}`;\n  }\n}\n\n@Component({\n  selector: 'pbds-daterange-popover',\n  templateUrl: './daterange-popover.component.html',\n  providers: [{ provide: NgbDatepickerI18n, useClass: CustomDatepickerI18n }],\n  styles: []\n})\nexport class PbdsDaterangePopoverComponent implements OnInit, OnChanges {\n  @ViewChild('datepickerPopup', { static: true }) private datepickerPopup: NgbPopover;\n\n  @Input()\n  presets: Array<PbdsDaterangePreset> = [\n    {\n      label: 'All Dates',\n      value: null\n    },\n    {\n      label: 'Last 7 Days',\n      value: 7\n    },\n    {\n      label: 'Last 30 Days',\n      value: 30\n    },\n    {\n      label: 'Year to Date',\n      value: 365\n    }\n  ];\n\n  @Input()\n  presetSelected: number | null | 'custom' = null;\n\n  @Input()\n  filters: Array<PbdsDaterangeFilter>;\n\n  @Input()\n  filterSelected = 0;\n\n  @Input()\n  showCustomPreset = true;\n\n  @Input()\n  applyText = 'Apply';\n\n  @Input()\n  cancelText = 'Cancel';\n\n  @Input()\n  customRangeText = 'Custom Range';\n\n  @Input()\n  minDate: NgbDate = this.calendar.getPrev(this.calendar.getToday(), 'y');\n\n  @Input()\n  maxDate: NgbDate = this.calendar.getToday();\n\n  @Input()\n  fromDate: NgbDate | null = null;\n\n  @Input()\n  toDate: NgbDate | null = null;\n\n  @Input()\n  inputFormat = '{fromDate} to {toDate}';\n\n  @Output()\n  private change: EventEmitter<PbdsDaterangeChange> = new EventEmitter<PbdsDaterangeChange>();\n\n  firstDayOfWeek = getLocaleFirstDayOfWeek(this.daterangeService.getCurrentLocale());\n\n  hoveredDate: NgbDate;\n\n  dateRange = '';\n  isDatepickerVisible = false;\n  selectedFilter;\n\n  constructor(private calendar: NgbCalendar, private daterangeService: PbdsDaterangeService) {}\n\n  ngOnInit() {\n    // china should start on a Monday, Angular locale returns incorrect 0\n    this.firstDayOfWeek =\n      this.daterangeService.getCurrentLocale() === 'zh-cn' ? this.firstDayOfWeek + 1 : this.firstDayOfWeek;\n\n    if (this.presetSelected === 'custom') {\n      this.showDatepicker();\n    }\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    if (changes.filters && this.filters) {\n      this.selectedFilter = this.filters[this.filterSelected];\n    }\n\n    if (changes.presets) {\n      if (!this.filters && this.presetSelected) {\n        this.presetClick(this.presets.find(p => p.value === this.presetSelected));\n      } else if (this.presetSelected) {\n        this.presetSelect({ value: this.presetSelected });\n        this.apply();\n      }\n    }\n\n    // if (changes.toText && changes.toText.firstChange === false) {\n    //   this.setInputLabel();\n    // }\n\n    this.setInputLabel();\n  }\n\n  apply() {\n    this.setInputLabel();\n    this.change.emit({\n      fromDate: this.fromDate,\n      toDate: this.toDate,\n      formattedDate: this.isDatepickerVisible ? this.dateFormat() : this.dateRange,\n      filter: this.filters ? this.selectedFilter.field : null,\n      value: this.presetSelected\n    });\n\n    this.datepickerPopup.close();\n  }\n\n  cancel() {\n    this.datepickerPopup.close();\n  }\n\n  onDateSelection(date: NgbDate) {\n    if (!this.fromDate && !this.toDate) {\n      this.fromDate = date;\n    } else if (this.fromDate && !this.toDate && date.after(this.fromDate)) {\n      this.toDate = date;\n    } else {\n      this.toDate = null;\n      this.fromDate = date;\n    }\n\n    // this.presetSelected = null;\n  }\n\n  presetSelect = $event => {\n    if ($event.value === 'custom') {\n      this.presetSelected = 'custom';\n      return false;\n    }\n\n    if ($event.value) {\n      this.toDate = this.calendar.getToday();\n      this.fromDate = this.calendar.getPrev(this.toDate, 'd', $event.value);\n      this.presetSelected = $event.value;\n    } else {\n      this.fromDate = null;\n      this.toDate = null;\n      this.presetSelected = null;\n    }\n\n    this.isDatepickerVisible = false;\n  };\n\n  presetClick(preset) {\n    // console.log('PRESET CLICK: ', preset);\n    if (preset) {\n      if (preset.value === 'custom') {\n        return false;\n      }\n\n      if (preset.value) {\n        this.toDate = this.calendar.getToday();\n        this.fromDate = this.calendar.getPrev(this.toDate, 'd', preset.value);\n        this.presetSelected = preset.value;\n      } else {\n        this.fromDate = null;\n        this.toDate = null;\n        this.presetSelected = null;\n      }\n\n      this.isDatepickerVisible = false;\n      this.apply();\n    }\n  }\n\n  private getFormattedDate(date: NgbDate) {\n    if (date) {\n      const locale = this.daterangeService.getCurrentLocale();\n      const dateFormat = getLocaleDateFormat(locale, FormatWidth.Short);\n      const formattedDate = formatDate(`${date.month}/${date.day}/${date.year}`, dateFormat, locale);\n\n      return formattedDate;\n    }\n  }\n\n  isHovered = (date: NgbDate) =>\n    this.fromDate && !this.toDate && this.hoveredDate && date.after(this.fromDate) && date.before(this.hoveredDate);\n\n  isInside = (date: NgbDate) => date.after(this.fromDate) && date.before(this.toDate);\n\n  isRange = (date: NgbDate) =>\n    date.equals(this.fromDate) || date.equals(this.toDate) || this.isInside(date) || this.isHovered(date);\n\n  showDatepicker() {\n    this.isDatepickerVisible = true;\n    this.presetSelect({ value: 'custom' });\n  }\n\n  onFilterChange(filter, index) {\n    this.selectedFilter = this.filters[index];\n  }\n\n  setPreset(value: number | null) {\n    this.presetSelected = value;\n    this.presetSelect({ value: this.presetSelected });\n    this.apply();\n  }\n\n  setFilter(index: number) {\n    if (this.filters !== undefined) {\n      this.selectedFilter = this.filters[index];\n    }\n  }\n\n  setDateRange(value) {\n    this.fromDate = new NgbDate(value.fromDate.year, value.fromDate.month, value.fromDate.day);\n    this.toDate = new NgbDate(value.toDate.year, value.toDate.month, value.toDate.day);\n    this.isDatepickerVisible = value.value === 'custom';\n    this.presetSelected = value.value;\n\n    if (this.filters) {\n      this.filterSelected = this.filters.findIndex(f => f.field === value.filter);\n      this.selectedFilter = this.filters[this.filterSelected];\n    }\n\n    this.apply();\n  }\n\n  private setInputLabel() {\n    if (this.presets) {\n      const selected = this.presets.find(p => p.value === this.presetSelected);\n\n      if (selected) {\n        if (this.fromDate === null || this.toDate === null) {\n          this.dateRange = selected.label;\n        } else if (this.presetSelected === null || (this.presetSelected !== null && this.presetSelected !== 'custom')) {\n          this.dateRange = selected.label;\n        } else {\n          this.dateRange = this.dateFormat();\n        }\n      } else if (this.presetSelected === 'custom' && this.fromDate && this.toDate) {\n        this.dateRange = this.dateFormat();\n      }\n    }\n  }\n\n  private dateFormat() {\n    return this.inputFormat\n      .replace('{fromDate}', this.getFormattedDate(this.fromDate))\n      .replace('{toDate}', this.getFormattedDate(this.toDate));\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { NgbDatepickerModule, NgbPopoverModule, NgbDropdownModule } from '@ng-bootstrap/ng-bootstrap';\n\nimport { MatRadioModule } from '@angular/material/radio';\n\nimport { PbdsDaterangePopoverComponent } from './daterange-popover.component';\n\n@NgModule({\n  declarations: [PbdsDaterangePopoverComponent],\n  imports: [CommonModule, FormsModule, MatRadioModule, NgbDatepickerModule, NgbPopoverModule, NgbDropdownModule],\n  exports: [PbdsDaterangePopoverComponent]\n})\nexport class PbdsDaterangePopoverModule {}\n","import { Component, Input } from '@angular/core';\n\n@Component({\n  selector: 'pbds-progress-spinner',\n  template: `\n    <span role=\"alert\" aria-live=\"assertive\">\n      <span\n        class=\"sbl-circ\"\n        [style.width.px]=\"size\"\n        [style.height.px]=\"size\"\n        [style.border-width.px]=\"size / 8\"\n        aria-hidden=\"true\"\n      ></span>\n      <span class=\"sr-only\">Loading</span>\n    </span>\n  `,\n  styleUrls: ['./progress-spinner.component.scss']\n})\nexport class PbdsProgressSpinnerComponent {\n  @Input()\n  size: number;\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { PbdsProgressSpinnerComponent } from './progress-spinner.component';\n\n@NgModule({\n  declarations: [PbdsProgressSpinnerComponent],\n  imports: [CommonModule],\n  exports: [PbdsProgressSpinnerComponent]\n})\nexport class PbdsProgressSpinnerModule {}\n"]}