{"version":3,"sources":["../../../node_modules/tslib/tslib.es6.js","ng://pb-design-system/lib/dataviz/dataviz.service.ts","ng://pb-design-system/lib/dataviz/dataviz-pie.component.ts","ng://pb-design-system/lib/dataviz/dataviz-bar.component.ts","ng://pb-design-system/lib/dataviz/dataviz-line.component.ts","ng://pb-design-system/lib/dataviz/dataviz-gauge.component.ts","ng://pb-design-system/lib/dataviz/dataviz-sparkline.component.ts","ng://pb-design-system/lib/dataviz/dataviz-stacked-bar.component.ts","ng://pb-design-system/lib/dataviz/dataviz-metric-indicator.component.ts","ng://pb-design-system/lib/dataviz/dataviz-metric-block.component.ts","ng://pb-design-system/lib/dataviz/dataviz-bubble-map.component.ts","ng://pb-design-system/lib/dataviz/dataviz-heatmap.component.ts","ng://pb-design-system/lib/dataviz/dataviz.module.ts","ng://pb-design-system/lib/header-shadow/header-shadow.directive.ts","ng://pb-design-system/lib/header-shadow/header-shadow.module.ts"],"names":["__read","o","n","m","Symbol","iterator","r","e","i","call","ar","next","done","push","value","error","__spread","arguments","length","concat","PbdsDatavizService","_this","this","colors","classic","full","mono","twilight","ocean","sunset","getColors","theme","createGradientDefs","svg","color","gradient","append","attr","replace","createGlowFilter","glow","feOffsets","dy","slope","y","merge","x","Injectable","args","providedIn","PbdsDatavizPieComponent","_dataviz","_element","chartClass","pieClass","width","type","monochrome","legendLabelFormatType","legendLabelFormatString","legendValueFormatString","tooltipLabelFormatType","tooltipLabelFormatString","tooltipValueFormatString","hovered","EventEmitter","clicked","currentData","updateChart","paths","selectAll","data","pie","exit","remove","each","d","outerRadius","transition","duration","attrTween","arcTween","enterPaths","enter","arc","colorRange","label","nodes","splice","style","legendItem","chart","select","html","parsedTime","d3_isoParse","legendLabelFormat","legendValueFormat","enterLegendItem","legendDescription","on","index","legendMouseOverFocus","pathMouseOver","d3_event","legendMouseOutBlur","pathMouseOut","emit","tooltipShow","node","tooltipMove","tooltipHide","pathClick","d3_interpolate","t","filter","classed","event","slices","slice","delay","arcZoom","tooltipSetPosition","percentage","endAngle","startAngle","Math","PI","tooltipLabelFormat","tooltip","tooltipValueFormat","coordinates","d3_mouse","prototype","ngOnInit","margin","top","right","bottom","left","height","innerRadius","min","anglePad","d3_format","d3_timeFormat","d3_scaleOrdinal","range","domain","map","c","d3_pie","padAngle","sort","d3_arc","padRadius","d3_select","nativeElement","legend","ngOnChanges","changes","firstChange","ngOnDestroy","Component","selector","template","changeDetection","ChangeDetectionStrategy","OnPush","ElementRef","HostBinding","Input","Output","PbdsDatavizBarComponent","_scroll","_location","barClass","singleSeries","xAxisFormatType","xAxisFormatString","yAxisFormatType","yAxisFormatString","yAxisTicks","yAxisMinBuffer","yAxisMaxBuffer","hideLegend","legendWidth","legendPosition","tooltipValueFormatType","marginTop","marginRight","marginBottom","marginLeft","threshold","average","group","groupEnter","xAxisScale","yAxisScale","d3_min","d3_max","rangeRound","nice","xAxis","xAxisCall","yAxis","yAxisCall","hideXGrid","xGrid","xGridCall","hideYGrid","yGrid","yGridCall","hideGrayBars","bandwidth","path","substr","barMouseOver","barMouseOut","barMouseClick","legendMouseOver","legendMouseOut","legendMouseClick","yThreshold","raise","yAverage","bar","barColor","_groups","dimensions","getBoundingClientRect","scroll","getScrollPosition","hideTooltipLabel","tooltipOffsetWidth","offsetWidth","tooltipOffsetHeight","offsetHeight","xAxisFormatter","item","xAxisFormat","parseDate","yAxisFormatter","yAxisFormat","hideXAxis","hideYAxis","hideXAxisZero","hideYAxisZero","hideXAxisDomain","hideYAxisDomain","hideTooltip","hideXAxisTicks","hideYAxisTicks","xAxisTickSize","xAxisTickSizeOuter","yAxisTickSize","yAxisTickSizeOuter","d3_scaleBand","align","paddingInner","paddingOuter","d3_axisBottom","tickSize","tickSizeOuter","tickFormat","d3_scaleLinear","d3_axisLeft","ticks","ViewportScroller","Location","PbdsDatavizLineComponent","lineClass","area","xAxisTicks","tooltipHeadingFormatString","tooltipHovered","tooltipClicked","mouserect","d3_extent","dates","series","minVal","values","maxVal","d3line","d3area","line","lineWidth","linePoints","tooltipItem","tooltipHeadingFormat","entertooltipItem","mouserectMouseMove","mouseXDate","invert","leftIndex","d3_bisectLeft","d3_isoFormat","dateLower","Date","dateUpper","closestDate","closestIndex","indexOf","circles","tooltipLine","mousedata","date","mouserectMouseOut","mouserectMouseClick","position","mouserectDimensions","tooltipDimensions","dimensionCalculated","clientWidth","document","body","lineCurved","d3_line","curve","d3_curveCatmullRom","alpha","d3_area","y0","y1","d3_scaleTime","PbdsDatavizGaugeComponent","gaugeClass","hideLabel","labelFormatString","gaugeWidth","degreesToRadians","degree","calculateMinMax","minvalue","maxvalue","calculateCurve","start","drawChart","gauge","backgroundColor","radius","labelTween","textTween","newAngle","interpolate","tween","oldValue","text","updatedNumber","labelFormat","max","rounded","cornerRadius","previousValue","PbdsDatavizSparklineComponent","sparklineClass","colorNegative","strokeWidth","datum","barWidth","abs","PbdsDatavizStackedBarComponent","stackedBarClass","tooltipHeadingFormatType","tooltipHeadingValueFormatType","tooltipHeadingValueFormatString","dataKeys","Object","keys","dataStack","d3_stack","order","d3_stackOrderNone","key","yAxisMax","grayBars","join","update","bars","mouseBars","yPosition","xPosition","total","tooltipHeadingValueFormat","PbdsDatavizMetricIndicatorComponent","class","indicator","inverse","defineProperty","PbdsDatavizMetricBlockComponent","heading","unit","description","centered","hideValueMargin","isPercentUnit","isUnit","indicatorRef","ContentChild","static","DatavizBubbleMapComponent","bubbleMapClass","feature","scale","center","dot","textColor","textSizeRange","dotSize","bubbleSizeRange","bubbleLabelFormatType","bubbleLabelFormatString","hideTooltipValue","bubbleContainer","projection","longitude","latitude","sqrt","bubbleRadius","bubbleMouseOver","bubbleMouseOut","bubbleMouseClick","bubbleLabelFormat","round","fontRange","projectionType","d3_geoAlbers","d3_geoAlbersUsa","d3_geoMercator","topojsonFeature","topojson.feature","topojson","objects","fitSize","geoPath","d3_geoPath","features","topojson.mesh","a","b","PbdsDatavizHeatmapComponent","heatmapClass","tooltipXLabelFormatType","tooltipXLabelFormatString","tooltipYLabelFormatType","tooltipYLabelFormatString","undefined","xLabel","yLabel","blockMouseOver","blockMouseOut","blockMouseClick","colorDomain","li","tooltipYLabelFormat","tooltipXLabelFormat","reverse","colorValues","d3_scaleThreshold","d3_scaleQuantile","quantiles","d3_scaleQuantize","thresholds","xAxisLabels","Set","yAxisLabels","tslib_1.__spread","PbdsDatavizModule","NgModule","declarations","imports","CommonModule","exports","PbdsHeaderShadowDirective","onWindowScroll","offset","shadow","Directive","HostListener","PbdsHeaderShadowModule"],"mappings":"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","sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","import { Injectable } from '@angular/core';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class PbdsDatavizService {\n  private colors = {\n    classic: {\n      full: [\n        '#E23DA8',\n        '#314183',\n        '#1BB9FF',\n        '#FF8B00',\n        '#0384D4',\n        '#00B140',\n        '#A319B1',\n        '#FFC500',\n        '#8B98C8',\n        '#CCB8CE',\n        '#E6C49C',\n        '#9B9B9B'\n      ],\n      // mono: ['#060810', '#253262', '#3E53A4', '#7887BF', '#B2BADB', '#D8DDED'] // for heatmap testing\n      mono: ['#253162', '#314183', '#3e53a4', '#8b98c8', '#d8dded', '#eceef6'] // blue\n    },\n    twilight: {\n      full: [\n        '#E23DA8',\n        '#314183',\n        '#1BB9FF',\n        '#FF8B00',\n        '#0384D4',\n        '#00B140',\n        '#A319B1',\n        '#FFC500',\n        '#8B98C8',\n        '#CCB8CE',\n        '#E6C49C',\n        '#9B9B9B'\n      ],\n      mono: ['#60255d', '#80327c', '#a03f9b', '#c68cc3', '#ecd9eb', '#f5ecf5'] // purple\n    },\n    ocean: {\n      full: [\n        '#0384D4',\n        '#00B140',\n        '#314183',\n        '#1BB9FF',\n        '#E23DA8',\n        '#FFC500',\n        '#A319B1',\n        '#FF8B00',\n        '#8B98C8',\n        '#E6C49C',\n        '#CCB8CE',\n        '#9B9B9B'\n      ],\n      mono: ['#00436e', '#005a93', '#0072b8', '#66aad4', '#cce3f1', '#e5f1f8'] // medium blue\n    },\n    sunset: {\n      full: [\n        '#FF8B00',\n        '#A319B1',\n        '#1BB9FF',\n        '#E23DA8',\n        '#FFC500',\n        '#314183',\n        '#00B140',\n        '#0384D4',\n        '#CCB8CE',\n        '#E6C49C',\n        '#8B98C8',\n        '#9B9B9B'\n      ],\n      // mono: ['#fff2e3', '#fee3cb', '#f6a76b', '#ee6b0b', '#be5408', '#8e3f06'] // orange\n      mono: ['#8e3f06', '#be5408', '#ee6b0b', '#f6a76b', '#fee3cb', '#fff2e3'] // orange\n    }\n  };\n\n  // mono: ['#253162', '#314183', '#3e53a4', '#8b98c8', '#d8dded', '#eceef6'] // blue\n  // mono: ['#00436e', '#005a93', '#0072b8', '#66aad4', '#cce3f1', '#e5f1f8'] // medium blue\n\n  constructor() {}\n\n  getColors = (mono = false, theme = 'classic') => {\n    return mono ? this.colors[theme].mono : this.colors[theme].full;\n  };\n\n  createGradientDefs = (svg, mono = false, theme = 'classic') => {\n    const colors = mono ? [this.colors[theme].mono[2]] : this.colors[theme].full;\n\n    for (let i = 0; i < colors.length; i++) {\n      const color = mono ? this.colors[theme].mono[2] : this.colors[theme].full[i];\n\n      const gradient = svg\n        .append('defs')\n        .append('linearGradient')\n        .attr('id', `gradient-${color.replace('#', '')}`)\n        .attr('x1', '0')\n        .attr('y1', '0')\n        .attr('x2', '0')\n        .attr('y2', '1')\n        .attr('spreadMethod', 'pad');\n\n      gradient\n        .append('stop')\n        .attr('offset', '0%')\n        .attr('stop-color', color)\n        .attr('stop-opacity', '1'); // top of bar will be full opacity\n\n      gradient\n        .append('stop')\n        .attr('offset', '100%')\n        .attr('stop-color', color)\n        .attr('stop-opacity', '.3'); // bottom of bar will be .3 opacity\n    }\n\n    return colors;\n  };\n\n  createGlowFilter = svg => {\n    // add a new definition\n    const glow = svg\n      .append('defs')\n      .append('filter')\n      .attr('id', 'glow')\n      .attr('width', '200%')\n      .attr('height', '200%');\n\n    glow\n      .append('feGaussianBlur')\n      .attr('in', 'SourceGraphic')\n      .attr('stdDeviation', 4);\n\n    // build two dropshadows with different intensities\n    const feOffsets = [\n      {\n        dy: 2,\n        slope: 0.2\n      },\n      {\n        dy: 5,\n        slope: 0.05\n      }\n    ];\n\n    for (let i = 0; i < feOffsets.length; i++) {\n      glow\n        .append('feOffset')\n        .attr('result', 'offsetBlur' + i)\n        .attr('dx', 0)\n        .attr('dy', feOffsets[i].dy);\n    }\n\n    for (let y = 0; y < feOffsets.length; y++) {\n      glow\n        .append('feComponentTransfer')\n        .attr('result', 'coloredBlur' + y)\n        .attr('in', 'offsetBlur' + y)\n        .append('feFuncA')\n        .attr('type', 'linear')\n        .attr('slope', feOffsets[y].slope);\n    }\n\n    let merge = glow.append('feMerge');\n\n    merge.append('feMergeNode').attr('in', 'SourceGraphic');\n\n    for (let x = 0; x < feOffsets.length; x++) {\n      merge.append('feMergeNode').attr('in', 'coloredBlur' + x);\n    }\n  };\n}\n","import {\n  Component,\n  OnInit,\n  Input,\n  ElementRef,\n  HostBinding,\n  OnChanges,\n  SimpleChanges,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  OnDestroy\n} from '@angular/core';\n\nimport {\n  select as d3_select,\n  scaleOrdinal as d3_scaleOrdinal,\n  pie as d3_pie,\n  arc as d3_arc,\n  interpolate as d3_interpolate,\n  mouse as d3_mouse,\n  format as d3_format,\n  event as d3_event,\n  timeFormat as d3_timeFormat,\n  isoParse as d3_isoParse\n} from 'd3';\n\nimport { PbdsDatavizService } from './dataviz.service';\nimport { PbdsDatavizPie } from './dataviz.interfaces';\n\n@Component({\n  selector: 'pbds-dataviz-pie',\n  template: ``,\n  styleUrls: [],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class PbdsDatavizPieComponent implements OnInit, OnChanges, OnDestroy {\n  @HostBinding('class.pbds-chart')\n  chartClass = true;\n\n  @HostBinding('class.pbds-chart-pie')\n  pieClass = true;\n\n  @Input()\n  data: Array<PbdsDatavizPie>;\n\n  @Input()\n  width = 300;\n\n  @Input()\n  type: 'pie' | 'donut' = 'pie';\n\n  @Input()\n  monochrome = false;\n\n  @Input()\n  legendLabelFormatType: 'time' = null;\n\n  @Input()\n  legendLabelFormatString = '';\n\n  @Input()\n  legendValueFormatString = '';\n\n  @Input()\n  tooltipLabelFormatType: 'time' = null;\n\n  @Input()\n  tooltipLabelFormatString = '';\n\n  @Input()\n  tooltipValueFormatString = '';\n\n  @Input()\n  theme;\n\n  @Output()\n  hovered: EventEmitter<object> = new EventEmitter<object>();\n\n  @Output()\n  clicked: EventEmitter<object> = new EventEmitter<object>();\n\n  private currentData = [];\n  private height;\n  private chart;\n  private margin;\n  private colors;\n  private colorRange;\n  private arc;\n  private arcZoom;\n  private svg;\n  private pie;\n  private legend;\n  private legendLabelFormat;\n  private legendValueFormat;\n  private innerRadius;\n  private anglePad;\n  private outerRadius;\n  private tooltip;\n  private tooltipLabelFormat;\n  private tooltipValueFormat;\n\n  constructor(private _dataviz: PbdsDatavizService, private _element: ElementRef) {}\n\n  ngOnInit() {\n    this.margin = { top: 10, right: 10, bottom: 10, left: 10 };\n    this.width = this.width - this.margin.left - this.margin.right;\n    this.height = this.width - this.margin.top - this.margin.bottom;\n    this.colors = this._dataviz.getColors(this.monochrome, this.theme);\n    this.innerRadius = Math.min(this.width, this.height) / 2.5;\n    this.outerRadius = Math.min(this.width, this.height) / 2;\n    this.arcZoom = 10;\n    this.anglePad = 0.02;\n    this.legendValueFormat = d3_format(this.legendValueFormatString);\n    this.tooltipValueFormat = d3_format(this.tooltipValueFormatString);\n\n    switch (this.legendLabelFormatType) {\n      case 'time':\n        this.legendLabelFormat = d3_timeFormat(this.legendLabelFormatString);\n        break;\n      default:\n        this.legendLabelFormat = null;\n        break;\n    }\n\n    switch (this.tooltipLabelFormatType) {\n      case 'time':\n        this.tooltipLabelFormat = d3_timeFormat(this.tooltipLabelFormatString);\n        break;\n      default:\n        this.tooltipLabelFormat = null;\n        break;\n    }\n\n    this.colorRange = d3_scaleOrdinal()\n      .range(this.colors)\n      .domain(this.data.map(c => c.label));\n\n    if (this.type === 'pie') {\n      this.innerRadius = 0;\n      this.anglePad = 0;\n    }\n\n    this.pie = d3_pie()\n      .padAngle(this.anglePad)\n      .value((d: any) => d.value)\n      .sort(null);\n\n    this.arc = d3_arc()\n      .padRadius(this.outerRadius)\n      .innerRadius(this.innerRadius);\n\n    this.chart = d3_select(this._element.nativeElement).attr('aria-hidden', 'true');\n\n    this.svg = this.chart\n      .append('svg')\n      .attr('width', this.width)\n      .attr('height', this.height)\n      .attr('class', 'img-fluid')\n      .attr('preserveAspectRatio', 'xMinYMin meet')\n      .attr(\n        'viewBox',\n        `-${this.width / 2 + this.margin.left} -${this.height / 2 + this.margin.top} ${this.width +\n          this.margin.left +\n          this.margin.right} ${this.height + this.margin.top + this.margin.bottom}`\n      );\n\n    this.legend = this.chart.append('ul').attr('class', 'legend legend-right');\n\n    this.tooltip = this.chart\n      .append('div')\n      .style('opacity', 0)\n      .attr('class', 'pbds-tooltip')\n      .attr('aria-hidden', 'true');\n\n    this.updateChart();\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    if (changes.data && !changes.data.firstChange) {\n      this.updateChart();\n    }\n  }\n\n  ngOnDestroy() {\n    if (this.tooltip) this.tooltip.remove();\n  }\n\n  updateChart = () => {\n    let paths = this.svg.selectAll('path').data(this.pie(this.data));\n\n    paths.exit().remove();\n\n    //update existing items\n    paths\n      .each((d: any) => (d.outerRadius = this.outerRadius))\n      .transition()\n      .duration(500)\n      .attrTween('d', this.arcTween);\n\n    // paths on enter\n    let enterPaths = paths\n      .enter()\n      .append('path')\n      .each((d: any) => (d.outerRadius = this.outerRadius))\n      .attr('d', this.arc)\n      .attr('fill', (d: any) => this.colorRange(d.data.label))\n      .attr('class', 'slice')\n      .each((d, i, nodes) => {\n        this.currentData.splice(i, 1, d);\n      });\n\n    if (this.type === 'pie') {\n      enterPaths\n        .style('stroke', '#fff')\n        .style('stroke-width', 2)\n        .style('stroke-alignment', 'inner');\n    }\n\n    let legendItem = this.chart\n      .select('.legend')\n      .selectAll('.legend-item')\n      .data(this.data);\n\n    legendItem.exit().remove();\n\n    // update existing items\n    legendItem.select('.legend-label').html((d: any) => {\n      switch (this.legendLabelFormatType) {\n        case 'time':\n          const parsedTime = d3_isoParse(d.label);\n          return this.legendLabelFormat(parsedTime);\n\n        default:\n          return d.label;\n      }\n    });\n\n    legendItem.select('.legend-value').html((d: any) => this.legendValueFormat(d.value));\n\n    // legend items on enter\n    let enterLegendItem = legendItem\n      .enter()\n      .append('li')\n      // .attr('tabindex', 0)\n      .attr('class', 'legend-item');\n\n    enterLegendItem\n      .append('span')\n      .attr('class', 'legend-key')\n      .style('background-color', (d: any) => this.colorRange(d.label));\n\n    const legendDescription = enterLegendItem.append('span').attr('class', 'legend-description');\n\n    legendDescription\n      .append('span')\n      .attr('class', 'legend-label')\n      .html((d: any) => {\n        switch (this.legendLabelFormatType) {\n          case 'time':\n            const parsedTime = d3_isoParse(d.label);\n            return this.legendLabelFormat(parsedTime);\n\n          default:\n            return d.label;\n        }\n      });\n\n    legendDescription\n      .append('span')\n      .attr('class', 'legend-value')\n      .html((d: any) => this.legendValueFormat(d.value));\n\n    enterLegendItem\n      .on('mouseover focus', (data, index, nodes) => {\n        this.legendMouseOverFocus(data, index, nodes);\n        this.pathMouseOver(d3_event, data, index, nodes);\n      })\n      .on('mouseout blur', (data, index, nodes) => {\n        this.legendMouseOutBlur(data, index, nodes);\n        this.pathMouseOut(data, index, nodes);\n      })\n      .on('click', (data, index, nodes) => {\n        this.clicked.emit(data);\n      });\n\n    enterPaths\n      .on('mouseover', (data, index, nodes) => {\n        this.pathMouseOver(d3_event, data, index, nodes);\n        this.tooltipShow(this.chart.node(), data);\n      })\n      .on('mousemove', (data, index, nodes) => {\n        this.tooltipMove(this.chart.node());\n      })\n      .on('mouseout', (data, index, nodes) => {\n        this.pathMouseOut(data, index, nodes);\n        this.tooltipHide();\n      })\n      .on('click', (data, index, nodes) => {\n        this.pathClick(d3_event, data, index, nodes);\n      });\n  };\n\n  private arcTween = (data, index, nodes) => {\n    // console.log('ARGS: ', data, index, nodes);\n    const i = d3_interpolate(this.currentData[index], data);\n\n    this.currentData[index] = i(1);\n    return t => this.arc(i(t));\n  };\n\n  private legendMouseOverFocus = (data, index, nodes) => {\n    this.chart\n      .selectAll('.legend-item')\n      .filter((d, i) => i !== index)\n      .classed('inactive', true);\n  };\n\n  private legendMouseOutBlur = (data, index, nodes) => {\n    this.chart.selectAll('.legend-item').classed('inactive', false);\n  };\n\n  private pathMouseOver = (event, data, index, nodes) => {\n    let slices = this.chart.selectAll('.slice');\n    let slice = slices.filter((d, i) => i === index);\n\n    this.chart\n      .selectAll('.legend-item')\n      .filter((d, i) => i !== index)\n      .classed('inactive', true);\n\n    slices.filter((d, i) => i !== index).classed('inactive', true);\n\n    slice\n      .transition()\n      .duration(300)\n      .delay(0)\n      .attrTween('d', (d: any) => {\n        let i = d3_interpolate(d.outerRadius, this.outerRadius + this.arcZoom);\n        return t => {\n          d.outerRadius = i(t);\n          return this.arc(d);\n        };\n      });\n\n    this.hovered.emit({\n      event: event,\n      data: data.data ? data.data : data // legend hover data is different than slice hover data\n    });\n  };\n\n  private pathMouseOut = (data, index, value) => {\n    let slices = this.chart.selectAll('.slice');\n    let slice = slices.filter((d, i) => i === index);\n\n    this.chart\n      .selectAll('.legend-item')\n      .filter((d, i) => i !== index)\n      .classed('inactive', false);\n\n    slices.classed('inactive', false);\n\n    slice\n      .transition()\n      .duration(300)\n      .delay(0)\n      .attrTween('d', (d: any) => {\n        let i = d3_interpolate(d.outerRadius, this.outerRadius);\n        return t => {\n          d.outerRadius = i(t);\n          return this.arc(d);\n        };\n      });\n  };\n\n  private pathClick = (event, data, index, nodes) => {\n    this.clicked.emit({\n      event: event,\n      data: data.data\n    });\n  };\n\n  private tooltipShow = (node, data) => {\n    this.tooltipSetPosition(node);\n\n    let percentage = (data.endAngle - data.startAngle) / (2 * Math.PI);\n    let label;\n\n    switch (this.tooltipLabelFormatType) {\n      case 'time':\n        const parsedTime = d3_isoParse(data.data.label);\n        label = this.tooltipLabelFormat(parsedTime);\n        break;\n\n      default:\n        label = data.data.label;\n    }\n\n    this.tooltip.html(\n      `\n        <div class=\"tooltip-label\">${label}</div>\n        <div class=\"tooltip-value\">${this.tooltipValueFormat(percentage)}</div>\n      `\n    );\n\n    this.tooltip.style('opacity', 1);\n  };\n\n  private tooltipMove = node => {\n    this.tooltipSetPosition(node);\n  };\n\n  private tooltipHide = () => {\n    this.tooltip.style('opacity', 0);\n  };\n\n  private tooltipSetPosition = node => {\n    let coordinates = d3_mouse(node);\n\n    this.tooltip.style('left', `${coordinates[0] + 16}px`);\n    this.tooltip.style('top', `${coordinates[1] + 16}px`);\n  };\n}\n","import {\n  Component,\n  OnInit,\n  OnChanges,\n  Input,\n  Output,\n  EventEmitter,\n  ElementRef,\n  HostBinding,\n  OnDestroy,\n  SimpleChanges,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { ViewportScroller, Location } from '@angular/common';\n\nimport {\n  select as d3_select,\n  isoParse as d3_isoParse,\n  timeFormat as d3_timeFormat,\n  format as d3_format,\n  scaleOrdinal as d3_scaleOrdinal,\n  scaleBand as d3_scaleBand,\n  scaleLinear as d3_scaleLinear,\n  min as d3_min,\n  max as d3_max,\n  axisBottom as d3_axisBottom,\n  axisLeft as d3_axisLeft,\n  event as d3_event\n} from 'd3';\n\nimport { PbdsDatavizService } from './dataviz.service';\nimport { PbdsDatavizBar } from './dataviz.interfaces';\n\n@Component({\n  selector: 'pbds-dataviz-bar',\n  template: ``,\n  styles: [],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class PbdsDatavizBarComponent implements OnInit, OnDestroy, OnChanges {\n  @HostBinding('class.pbds-chart')\n  chartClass = true;\n\n  @HostBinding('class.pbds-chart-bar')\n  barClass = true;\n\n  @Input()\n  data: PbdsDatavizBar[];\n\n  @Input()\n  width = 306;\n\n  @Input()\n  height = 400;\n\n  @Input()\n  type: 'low' | 'medium' | 'high' | 'debug' = 'medium'; // debug to show all chart options\n\n  @Input()\n  singleSeries = false;\n\n  @Input()\n  xAxisFormatType: 'number' | 'time' = null;\n\n  @Input()\n  xAxisFormatString = '';\n\n  @Input()\n  yAxisFormatType: 'number' | 'time' = null;\n\n  @Input()\n  yAxisFormatString = '';\n\n  @Input()\n  yAxisTicks = 5;\n\n  @Input()\n  yAxisMinBuffer = 0.01;\n\n  @Input()\n  yAxisMaxBuffer = 0.01;\n\n  @Input()\n  hideLegend = false;\n\n  @Input()\n  legendWidth = 105 + 28; // hardcoded legend width + left margin, do not document until feedback\n\n  @Input()\n  legendPosition: 'right' | 'bottom' = 'right';\n\n  @Input()\n  legendLabelFormatType: 'number' | 'time' = null;\n\n  @Input()\n  legendLabelFormatString = '';\n\n  @Input()\n  tooltipLabelFormatType: 'number' | 'time' = null;\n\n  @Input()\n  tooltipLabelFormatString = '';\n\n  @Input()\n  tooltipValueFormatType: 'number' | 'time' = null;\n\n  @Input()\n  tooltipValueFormatString = '';\n\n  @Input()\n  marginTop = 10; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  marginRight = 0; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  marginBottom = 30; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  marginLeft = 55; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  threshold = null;\n\n  @Input()\n  average = null;\n\n  @Input()\n  theme;\n\n  @Output()\n  hovered: EventEmitter<object> = new EventEmitter<object>();\n\n  @Output()\n  clicked: EventEmitter<object> = new EventEmitter<object>();\n\n  private chart;\n  private svg;\n  private margin;\n  private colorRange;\n  private hideGrayBars: boolean;\n  private yThreshold;\n  private yAverage;\n  private xAxisScale;\n  private xAxisCall;\n  private xAxis;\n  private xAxisFormat;\n  private yAxisScale;\n  private yAxisCall;\n  private yAxis;\n  private yAxisFormat;\n  private xGrid;\n  private xGridCall;\n  private yGrid;\n  private yGridCall;\n  private xAxisTickSize: number;\n  private xAxisTickSizeOuter: number;\n  private yAxisTickSize: number;\n  private yAxisTickSizeOuter: number;\n  private hideXAxis: boolean;\n  private hideYAxis: boolean;\n  private hideXAxisDomain: boolean;\n  private hideYAxisDomain: boolean;\n  private hideXAxisZero: boolean;\n  private hideYAxisZero: boolean;\n  private hideXGrid: boolean;\n  private hideYGrid: boolean;\n  private hideXAxisTicks: boolean;\n  private hideYAxisTicks: boolean;\n  private legendLabelFormat;\n  private tooltip;\n  private hideTooltip: boolean;\n  private hideTooltipLabel: boolean;\n  private tooltipValueFormat;\n  private tooltipLabelFormat;\n\n  constructor(\n    private _dataviz: PbdsDatavizService,\n    private _element: ElementRef,\n    private _scroll: ViewportScroller,\n    private _location: Location\n  ) {}\n\n  ngOnInit() {\n    this.margin = {\n      top: +this.marginTop,\n      right: +this.marginRight,\n      bottom: +this.marginBottom,\n      left: +this.marginLeft\n    };\n\n    switch (this.xAxisFormatType) {\n      case 'number':\n        this.xAxisFormat = d3_format(this.xAxisFormatString);\n        break;\n      case 'time':\n        this.xAxisFormat = d3_timeFormat(this.xAxisFormatString);\n        break;\n    }\n\n    switch (this.yAxisFormatType) {\n      case 'number':\n        this.yAxisFormat = d3_format(this.yAxisFormatString);\n        break;\n      case 'time':\n        this.yAxisFormat = d3_timeFormat(this.yAxisFormatString);\n        break;\n    }\n\n    switch (this.legendLabelFormatType) {\n      case 'number':\n        this.legendLabelFormat = d3_format(this.legendLabelFormatString);\n        break;\n      case 'time':\n        this.legendLabelFormat = d3_timeFormat(this.legendLabelFormatString);\n        break;\n      default:\n        this.legendLabelFormat = null;\n        break;\n    }\n\n    switch (this.tooltipLabelFormatType) {\n      case 'number':\n        this.tooltipLabelFormat = d3_format(this.tooltipLabelFormatString);\n        break;\n      case 'time':\n        this.tooltipLabelFormat = d3_timeFormat(this.tooltipLabelFormatString);\n        break;\n      default:\n        this.tooltipLabelFormat = null;\n        break;\n    }\n\n    switch (this.tooltipValueFormatType) {\n      case 'number':\n        this.tooltipValueFormat = d3_format(this.tooltipValueFormatString);\n        break;\n      case 'time':\n        this.tooltipValueFormat = d3_timeFormat(this.tooltipValueFormatString);\n        break;\n      default:\n        this.tooltipValueFormat = null;\n    }\n\n    // defaults for all chart types\n    this.hideGrayBars = false;\n    this.hideXAxis = false;\n    this.hideYAxis = false;\n    this.hideXAxisZero = false;\n    this.hideYAxisZero = false;\n    this.hideXGrid = false;\n    this.hideYGrid = false;\n    this.hideXAxisDomain = false;\n    this.hideYAxisDomain = false;\n    this.hideTooltip = false;\n    this.hideXAxisTicks = false;\n    this.hideYAxisTicks = false;\n    this.xAxisTickSize = 8;\n    this.xAxisTickSizeOuter = 0;\n    this.yAxisTickSize = 8;\n    this.yAxisTickSizeOuter = 0;\n    this.hideTooltipLabel = false;\n\n    if (this.type !== 'debug') {\n      // set type defaults\n      switch (this.type) {\n        case 'low':\n          this.hideGrayBars = true;\n          this.hideXAxis = !this.hideLegend;\n          this.hideXAxisTicks = true;\n          this.hideXGrid = true;\n          this.hideYAxisDomain = false;\n          this.hideYAxisTicks = true;\n          this.legendPosition = 'bottom';\n          this.hideTooltipLabel = true;\n          break;\n\n        case 'medium':\n          this.hideXAxisDomain = true;\n          this.hideXAxis = !this.hideLegend;\n          this.hideXGrid = true;\n          this.hideXAxisTicks = true;\n          this.hideYAxisDomain = true;\n          this.hideYAxisTicks = true;\n          this.hideYGrid = true;\n          this.hideTooltipLabel = true;\n          break;\n\n        case 'high':\n          this.hideXAxis = true;\n          this.hideXAxisDomain = true;\n          this.hideXGrid = true;\n          this.hideYAxisDomain = true;\n          this.hideYAxisTicks = true;\n          this.hideYGrid = true;\n          this.hideLegend = true;\n          this.hideTooltipLabel = false;\n          break;\n      }\n\n      // single series overrides\n      if (this.singleSeries) {\n        this.hideLegend = true;\n        this.hideXAxis = true;\n        this.hideXGrid = true;\n        this.hideTooltipLabel = false;\n      }\n    }\n\n    // adjust margin if xAxis hidden\n    if (this.hideXAxis) this.margin.bottom = 10; // need small margin for yAxis with 0 tick label\n\n    if (!this.hideLegend && this.legendPosition === 'right') {\n      this.width = +this.width - +this.legendWidth;\n    }\n\n    // create the chart\n    this.chart = d3_select(this._element.nativeElement).attr('aria-hidden', 'true');\n\n    // create chart svg\n    this.svg = this.chart\n      .append('svg')\n      .attr('width', +this.width)\n      .attr('height', +this.height + this.margin.top + this.margin.bottom)\n      .attr('class', 'img-fluid')\n      .attr('preserveAspectRatio', 'xMinYMin meet')\n      .attr(\n        'viewBox',\n        `-${this.margin.left} -${this.margin.top} ${+this.width} ${+this.height + this.margin.top + this.margin.bottom}`\n      );\n\n    // build color ranges\n    this.colorRange = d3_scaleOrdinal().range(\n      this._dataviz.createGradientDefs(this.svg, this.singleSeries, this.theme)\n    );\n\n    // X AXIS\n    this.xAxisScale = d3_scaleBand()\n      .domain(this.data.map(d => d.label))\n      .rangeRound([0, this.width - this.margin.left])\n      .align(0);\n\n    // add padding to the scale for gray bars\n    !this.hideGrayBars\n      ? this.xAxisScale.paddingInner(0.1).paddingOuter(0)\n      : this.xAxisScale.paddingInner(0).paddingOuter(0);\n\n    this.xAxisCall = d3_axisBottom(this.xAxisScale)\n      .tickSize(this.xAxisTickSize)\n      .tickSizeOuter(this.xAxisTickSizeOuter)\n      .tickFormat(this.xAxisFormatter);\n\n    this.xAxis = this.svg\n      .append('g')\n      .attr('class', 'axis axis-x')\n      .attr('transform', `translate(0, ${this.height})`)\n      .classed('axis-hidden', this.hideXAxis)\n      .classed('axis-zero-hidden', this.hideXAxisZero)\n      .classed('axis-domain-hidden', this.hideXAxisDomain)\n      .classed('axis-ticks-hidden', this.hideXAxisTicks)\n      .call(this.xAxisCall);\n\n    // X GRIDLINES\n    if (!this.hideXGrid) {\n      this.xGridCall = d3_axisBottom(this.xAxisScale).tickSize(-this.height);\n\n      this.xGrid = this.svg\n        .append('g')\n        .attr('class', 'grid grid-x')\n        .classed('grid-zero-hidden', this.hideXAxisZero)\n        .attr('transform', `translate(0, ${this.height})`)\n        .call(this.xGridCall);\n    }\n\n    // Y AXIS\n    this.yAxisScale = d3_scaleLinear()\n      .domain([\n        d3_min(this.data, d => d.value - d.value * +this.yAxisMinBuffer),\n        d3_max(this.data, d => d.value + d.value * +this.yAxisMaxBuffer)\n      ])\n      .nice()\n      .rangeRound([this.height, 0]);\n\n    this.yAxisCall = d3_axisLeft(this.yAxisScale)\n      .ticks(this.yAxisTicks)\n      .tickSize(this.yAxisTickSize)\n      .tickSizeOuter(this.yAxisTickSizeOuter)\n      .tickFormat(this.yAxisFormatter);\n\n    this.yAxis = this.svg\n      .append('g')\n      .attr('class', 'axis axis-y')\n      .classed('axis-hidden', this.hideYAxis)\n      .classed('axis-zero-hidden', this.hideYAxisZero)\n      .classed('axis-domain-hidden', this.hideYAxisDomain)\n      .classed('axis-ticks-hidden', this.hideYAxisTicks)\n      .call(this.yAxisCall);\n\n    // Y GRIDLINES\n    if (!this.hideYGrid) {\n      this.yGridCall = d3_axisLeft(this.yAxisScale)\n        .ticks(this.yAxisTicks)\n        .tickSize(-this.width + this.margin.left + this.margin.right);\n\n      this.yGrid = this.svg\n        .append('g')\n        .attr('class', 'grid grid-y')\n        .classed('grid-zero-hidden', this.hideYAxisZero)\n        .attr('transform', `translate(0, 0)`)\n        .call(this.yGridCall);\n    }\n\n    // Y THRESHOLD\n    if (this.threshold) {\n      this.yThreshold = this.svg\n        .append('line')\n        .attr('class', 'threshold')\n        .attr('x2', +this.width)\n        .attr('transform', `translate(0,  ${this.yAxisScale(+this.threshold)})`);\n    }\n\n    // Y AVERAGE\n    if (this.average) {\n      this.yAverage = this.svg\n        .append('line')\n        .attr('class', 'average')\n        .attr('x2', +this.width)\n        .attr('transform', `translate(0,  ${this.yAxisScale(+this.average)})`);\n    }\n\n    // TOOLTIP\n    if (!this.hideTooltip) {\n      this.tooltip = d3_select('body')\n        .append('div')\n        .attr('class', 'pbds-tooltip south')\n        .style('opacity', 0)\n        .attr('aria-hidden', 'true'); // hide tooltip for accessibility\n    }\n\n    // add legend classes\n    if (!this.hideLegend) {\n      this.chart.classed('pbds-chart-legend-bottom', this.legendPosition === 'bottom' ? true : false);\n      this.chart.append('ul').attr('class', `legend legend-${this.legendPosition}`);\n    }\n\n    this.updateChart();\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    if (changes.data && !changes.data.firstChange) {\n      this.updateChart();\n    }\n  }\n\n  ngOnDestroy() {\n    if (this.tooltip) this.tooltip.remove();\n  }\n\n  updateChart = () => {\n    // update the xScale\n    this.xAxisScale.domain(this.data.map(d => d.label));\n\n    // update the yScale\n    this.yAxisScale\n      .domain([\n        d3_min(this.data, d => d.value - d.value * +this.yAxisMinBuffer),\n        d3_max(this.data, d => d.value + d.value * +this.yAxisMaxBuffer)\n      ])\n      .rangeRound([this.height, 0])\n      .nice();\n\n    this.xAxis\n      .transition()\n      .duration(1000)\n      .call(this.xAxisCall);\n\n    this.yAxis\n      .transition()\n      .duration(1000)\n      .call(this.yAxisCall);\n\n    // update the grids\n    if (!this.hideXGrid) {\n      this.xGrid\n        .transition()\n        .duration(1000)\n        .call(this.xGridCall);\n    }\n\n    if (!this.hideYGrid) {\n      this.yGrid\n        .transition()\n        .duration(1000)\n        .call(this.yGridCall);\n    }\n\n    if (!this.hideGrayBars) {\n      // rebind data to groups\n      let group = this.svg.selectAll('.bar-group').data(this.data);\n\n      // remove bars\n      group.exit().remove();\n\n      // update gray bars\n      group\n        .select('.gray-bar')\n        .transition()\n        .duration(1000)\n        .attr('x', d => this.xAxisScale(d.label))\n        .attr('width', this.xAxisScale.bandwidth());\n\n      // update the existing bars\n      group\n        .select('.bar')\n        .transition()\n        .duration(1000)\n        .attr('x', d => this.xAxisScale(d.label) + this.xAxisScale.bandwidth() / 4)\n        .attr('width', this.xAxisScale.bandwidth() / 2)\n        .attr('height', d => this.height - this.yAxisScale(d.value))\n        .attr('y', d => this.yAxisScale(d.value));\n\n      // add group on enter\n      const groupEnter = group\n        .enter()\n        .append('g')\n        .attr('class', 'bar-group');\n\n      // add gray bars on enter\n      groupEnter\n        .append('rect')\n        .attr('class', 'gray-bar')\n        .attr('rx', 0)\n        .attr('height', 0)\n        .attr('x', d => this.xAxisScale(d.label))\n        .attr('width', this.xAxisScale.bandwidth())\n        .transition()\n        // .delay(1000)\n        .attr('height', this.height)\n        .attr('width', this.xAxisScale.bandwidth());\n\n      // add bars on enter\n      groupEnter\n        .append('rect')\n        .attr('class', 'bar')\n        .attr('rx', 2)\n        .attr('fill', d => `url(${this._location.path()}#gradient-${this.colorRange(d.label).substr(1)})`) // removes hash to prevent safari bug;\n        .attr('x', d => this.xAxisScale(d.label) + this.xAxisScale.bandwidth() / 4)\n        .attr('width', this.xAxisScale.bandwidth() / 2)\n        .attr('y', this.height)\n        .attr('height', 0)\n        .transition()\n        .duration(1000)\n        // .delay(1000)\n        .attr('y', d => this.yAxisScale(d.value))\n        .attr('height', d => this.height - this.yAxisScale(d.value))\n        .attr('data-color', d => this.colorRange(d.label));\n\n      groupEnter\n        .select('.bar')\n        .on('mouseover', (data, index, nodes) => this.barMouseOver(d3_event, data, index, nodes))\n        .on('mouseout', (data, index, nodes) => this.barMouseOut())\n        .on('click', (data, index, nodes) => this.barMouseClick(d3_event, data, index, nodes));\n    } else {\n      // rebind data to groups\n      let group = this.svg.selectAll('.bar-group').data(this.data);\n\n      // remove bars\n      group.exit().remove();\n\n      // update the existing bars\n      group\n        .select('.bar')\n        .attr('x', d => this.xAxisScale(d.label) + this.xAxisScale.bandwidth() / 5.5)\n        .attr('width', this.xAxisScale.bandwidth() / 1.5)\n        .transition()\n        .duration(1000)\n        .attr('y', d => this.yAxisScale(d.value))\n        .attr('height', d => this.height - this.yAxisScale(d.value));\n\n      // add group on enter\n      const groupEnter = group\n        .enter()\n        .append('g')\n        .attr('class', 'bar-group');\n\n      // add bars on enter\n      groupEnter\n        .append('rect')\n        .attr('class', 'bar')\n        .attr('rx', 2)\n        .attr('fill', d => `url(${this._location.path()}#gradient-${this.colorRange(d.label).substr(1)})`) // removes hash to prevent safari bug;\n        .attr('x', d => this.xAxisScale(d.label) + this.xAxisScale.bandwidth() / 5.5)\n        .attr('width', this.xAxisScale.bandwidth() / 1.5)\n        .attr('y', this.height)\n        .attr('height', 0)\n        .transition()\n        .duration(1000)\n        .attr('y', d => this.yAxisScale(d.value))\n        .attr('height', d => this.height - this.yAxisScale(d.value))\n        .attr('data-color', d => this.colorRange(d.label));\n\n      groupEnter\n        .select('.bar')\n        .on('mouseover', (data, index, nodes) => this.barMouseOver(d3_event, data, index, nodes))\n        .on('mouseout', () => this.barMouseOut())\n        .on('click', (data, index, nodes) => this.barMouseClick(d3_event, data, index, nodes));\n    }\n\n    if (!this.hideLegend) {\n      let legendItem = this.chart\n        .select('.legend')\n        .selectAll('.legend-item')\n        .data(this.data);\n\n      legendItem.exit().remove();\n\n      // update existing items\n      legendItem.select('.legend-label').html(d => {\n        // return this.legendLabelFormat === null ? d.label : this.legendLabelFormat(d.label);\n        switch (this.legendLabelFormatType) {\n          case 'number':\n            return this.legendLabelFormat(d.label);\n\n          case 'time':\n            const parsedTime = d3_isoParse(d.label);\n            return this.legendLabelFormat(parsedTime);\n\n          default:\n            return d.label;\n        }\n      });\n\n      // legend items on enter\n      let enterLegendItem = legendItem\n        .enter()\n        .append('li')\n        .attr('class', 'legend-item');\n\n      enterLegendItem\n        .append('span')\n        .attr('class', 'legend-key')\n        .style('background-color', d => this.colorRange(d.label));\n\n      enterLegendItem\n        .append('span')\n        .attr('class', 'legend-label')\n        .html(d => {\n          // return this.legendLabelFormat === null ? d.label : this.legendLabelFormat(d.label);\n          switch (this.legendLabelFormatType) {\n            case 'number':\n              return this.legendLabelFormat(d.label);\n\n            case 'time':\n              const parsedTime = d3_isoParse(d.label);\n              return this.legendLabelFormat(parsedTime);\n\n            default:\n              return d.label;\n          }\n        });\n\n      enterLegendItem\n        .on('mouseover', (data, index, nodes) => this.legendMouseOver(d3_event, data, index, nodes))\n        .on('mouseout', () => this.legendMouseOut())\n        .on('click', (data, index, nodes) => this.legendMouseClick(d3_event, data, index, nodes));\n    }\n\n    if (this.threshold) {\n      this.yThreshold\n        .raise()\n        .transition()\n        .duration(1000)\n        .attr('transform', `translate(0,  ${this.yAxisScale(+this.threshold)})`);\n    }\n\n    if (this.average) {\n      this.yAverage\n        .raise()\n        .transition()\n        .duration(1000)\n        .attr('transform', `translate(0,  ${this.yAxisScale(+this.average)})`);\n    }\n  };\n\n  barMouseOver = (event, data, index, nodes) => {\n    this.chart\n      .selectAll('.bar-group')\n      .filter((d, i) => i !== index)\n      .classed('inactive', true);\n\n    const bar = this.chart\n      .selectAll('.bar-group')\n      .filter((d, i) => i === index)\n      .select('.bar');\n\n    const barColor = bar.attr('data-color');\n\n    bar.style('fill', () => barColor);\n\n    this.chart\n      .selectAll('.legend-item')\n      .filter((d, i) => i !== index)\n      .classed('inactive', true);\n\n    this.tooltipShow(data, nodes.filter((d, i) => i === index));\n\n    this.hovered.emit({ event, data });\n  };\n\n  barMouseOut = () => {\n    this.chart\n      .selectAll('.bar-group')\n      .classed('inactive', false)\n      .select('.bar')\n      .style('fill', null);\n\n    this.chart.selectAll('.legend-item').classed('inactive', false);\n\n    this.tooltipHide();\n  };\n\n  barMouseClick = (event, data, index, nodes) => {\n    this.clicked.emit({ event, data });\n  };\n\n  legendMouseOver = (event, data, index, nodes) => {\n    this.chart\n      .selectAll('.legend-item')\n      .filter((d, i) => i !== index)\n      .classed('inactive', true);\n\n    this.chart\n      .selectAll('.bar-group')\n      .filter((d, i) => i !== index)\n      .classed('inactive', true);\n\n    const bar = this.chart\n      .selectAll('.bar-group')\n      .filter((d, i) => i === index)\n      .select('.bar');\n\n    const barColor = bar.attr('data-color');\n\n    bar.style('fill', () => barColor);\n\n    this.tooltipShow(data, this.chart.selectAll('.bar').filter((d, i) => i === index)._groups[0]); // TODO: find better way than using _groups\n\n    this.hovered.emit({ event, data });\n  };\n\n  legendMouseOut = () => {\n    this.chart.selectAll('.legend-item').classed('inactive', false);\n\n    this.chart\n      .selectAll('.bar-group')\n      .classed('inactive', false)\n      .select('.bar')\n      .style('fill', null);\n\n    this.tooltipHide();\n  };\n\n  legendMouseClick = (event, data, index, nodes) => {\n    this.clicked.emit({ event, data });\n  };\n\n  private tooltipShow = (data, node) => {\n    let dimensions = node[0].getBoundingClientRect();\n    let scroll = this._scroll.getScrollPosition();\n    let label;\n\n    switch (this.tooltipLabelFormatType) {\n      case 'number':\n        label = this.tooltipLabelFormat(data.label);\n        break;\n\n      case 'time':\n        const parsedTime = d3_isoParse(data.label);\n        label = this.tooltipLabelFormat(parsedTime);\n        break;\n\n      default:\n        label = data.label;\n    }\n    let value =\n      this.tooltipValueFormat === null\n        ? `<div class=\"tooltip-value\">${data.value}</div>`\n        : `<div class=\"tooltip-value\">${this.tooltipValueFormat(data.value)}</div>`;\n\n    this.tooltip.html(\n      `\n        ${this.hideTooltipLabel ? '' : `${label}`}\n        ${value}\n      `\n    );\n\n    let tooltipOffsetWidth = +this.tooltip.node().offsetWidth / 2;\n    let tooltipOffsetHeight = +this.tooltip.node().offsetHeight + 8;\n\n    this.tooltip.style('top', `${+scroll[1] + +dimensions.top - tooltipOffsetHeight}px`); //\n    this.tooltip.style('left', `${+scroll[0] + +dimensions.left - tooltipOffsetWidth + +dimensions.width / 2}px`);\n    this.tooltip.style('opacity', 1);\n  };\n\n  private tooltipHide = () => {\n    this.tooltip.style('opacity', 0);\n  };\n\n  private xAxisFormatter = item => {\n    switch (this.xAxisFormatType) {\n      case 'number':\n        return this.xAxisFormat(item);\n\n      case 'time':\n        const parseDate = d3_isoParse(item);\n        return this.xAxisFormat(parseDate);\n\n      default:\n        return item;\n    }\n  };\n\n  private yAxisFormatter = item => {\n    switch (this.yAxisFormatType) {\n      case 'number':\n        return this.yAxisFormat(item);\n\n      case 'time':\n        const parseDate = d3_isoParse(item);\n        return this.yAxisFormat(parseDate);\n\n      default:\n        return item;\n    }\n  };\n}\n","import {\n  Component,\n  OnInit,\n  OnChanges,\n  Input,\n  Output,\n  EventEmitter,\n  ElementRef,\n  HostBinding,\n  OnDestroy,\n  SimpleChanges,\n  ChangeDetectionStrategy,\n  Inject\n} from '@angular/core';\n\nimport { ViewportScroller, Location } from '@angular/common';\n\nimport {\n  select as d3_select,\n  isoParse as d3_isoParse,\n  isoFormat as d3_isoFormat,\n  timeFormat as d3_timeFormat,\n  format as d3_format,\n  scaleOrdinal as d3_scaleOrdinal,\n  scaleTime as d3_scaleTime,\n  line as d3_line,\n  scaleLinear as d3_scaleLinear,\n  extent as d3_extent,\n  min as d3_min,\n  max as d3_max,\n  axisBottom as d3_axisBottom,\n  axisLeft as d3_axisLeft,\n  event as d3_event,\n  curveCatmullRom as d3_curveCatmullRom,\n  mouse as d3_mouse,\n  bisectLeft as d3_bisectLeft,\n  area as d3_area\n} from 'd3';\n\nimport { PbdsDatavizService } from './dataviz.service';\nimport { PbdsDatavizLine } from './dataviz.interfaces';\n\n@Component({\n  selector: 'pbds-dataviz-line',\n  template: ``,\n  styles: [],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class PbdsDatavizLineComponent implements OnInit, OnDestroy, OnChanges {\n  @HostBinding('class.pbds-chart')\n  chartClass = true;\n\n  @HostBinding('class.pbds-chart-line')\n  lineClass = true;\n\n  @Input()\n  data: PbdsDatavizLine;\n\n  @Input()\n  width = 306;\n\n  @Input()\n  height = 400;\n\n  @Input()\n  type: 'medium' | 'high' | 'debug' = 'medium'; // debug to show all chart options\n\n  @Input()\n  area = false;\n\n  @Input()\n  xAxisFormatString = '';\n\n  @Input()\n  xAxisTicks = 6;\n\n  @Input()\n  yAxisFormatString = '';\n\n  @Input()\n  yAxisTicks = 5;\n\n  @Input()\n  yAxisMinBuffer = 0.01;\n\n  @Input()\n  yAxisMaxBuffer = 0.01;\n\n  @Input()\n  hideLegend = false;\n\n  @Input()\n  legendWidth = 105 + 28; // hardcoded legend width + left margin, do not document until feedback\n\n  @Input()\n  legendPosition: 'right' | 'bottom' = 'right';\n\n  @Input()\n  legendLabelFormatType: 'number' | 'time' = null;\n\n  @Input()\n  legendLabelFormatString = '';\n\n  @Input()\n  tooltipHeadingFormatString = '';\n\n  @Input()\n  tooltipLabelFormatType: 'number' | 'time' = null;\n\n  @Input()\n  tooltipLabelFormatString = '';\n\n  @Input()\n  tooltipValueFormatType: 'number' | 'time' = null;\n\n  @Input()\n  tooltipValueFormatString = '';\n\n  @Input()\n  marginTop = 10; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  marginRight = 20; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  marginBottom = 30; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  marginLeft = 55; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  theme;\n\n  @Output()\n  hovered: EventEmitter<object> = new EventEmitter<object>();\n\n  @Output()\n  clicked: EventEmitter<object> = new EventEmitter<object>();\n\n  @Output()\n  tooltipHovered: EventEmitter<object> = new EventEmitter<object>();\n\n  @Output()\n  tooltipClicked: EventEmitter<object> = new EventEmitter<object>();\n\n  private chart;\n  private svg;\n  private mouserect;\n  private tooltipLine;\n  private margin;\n  private d3line;\n  private d3area;\n  private lineWidth;\n  private lineCurved;\n  private linePoints;\n  private colorRange;\n  private xAxisScale;\n  private xAxisCall;\n  private xAxis;\n  private xAxisFormat;\n  private yAxisScale;\n  private yAxisCall;\n  private yAxis;\n  private yAxisFormat;\n  private xGrid;\n  private xGridCall;\n  private yGrid;\n  private yGridCall;\n  private xAxisTickSize: number;\n  private xAxisTickSizeOuter: number;\n  private yAxisTickSize: number;\n  private yAxisTickSizeOuter: number;\n  private hideXAxis: boolean;\n  private hideYAxis: boolean;\n  private hideXAxisDomain: boolean;\n  private hideYAxisDomain: boolean;\n  private hideXAxisZero: boolean;\n  private hideYAxisZero: boolean;\n  private hideXGrid: boolean;\n  private hideYGrid: boolean;\n  private hideXAxisTicks: boolean;\n  private hideYAxisTicks: boolean;\n  private legendLabelFormat;\n  private tooltip;\n  private hideTooltip: boolean;\n  private tooltipHeadingFormat;\n  private tooltipValueFormat;\n  private tooltipLabelFormat;\n  private mousedata;\n\n  constructor(\n    private _dataviz: PbdsDatavizService,\n    private _element: ElementRef,\n    private _scroll: ViewportScroller,\n    private _location: Location\n  ) {}\n\n  ngOnInit() {\n    this.margin = {\n      top: +this.marginTop,\n      right: +this.marginRight,\n      bottom: +this.marginBottom,\n      left: +this.marginLeft\n    };\n\n    this.xAxisFormat = d3_timeFormat(this.xAxisFormatString);\n\n    this.yAxisFormat = d3_format(this.yAxisFormatString);\n\n    switch (this.legendLabelFormatType) {\n      case 'number':\n        this.legendLabelFormat = d3_format(this.legendLabelFormatString);\n        break;\n      case 'time':\n        this.legendLabelFormat = d3_timeFormat(this.legendLabelFormatString);\n        break;\n      default:\n        this.legendLabelFormat = null;\n        break;\n    }\n\n    this.tooltipHeadingFormat = d3_timeFormat(this.tooltipHeadingFormatString);\n\n    switch (this.tooltipLabelFormatType) {\n      case 'number':\n        this.tooltipLabelFormat = d3_format(this.tooltipLabelFormatString);\n        break;\n      case 'time':\n        this.tooltipLabelFormat = d3_timeFormat(this.tooltipLabelFormatString);\n        break;\n      default:\n        this.tooltipLabelFormat = null;\n        break;\n    }\n\n    switch (this.tooltipValueFormatType) {\n      case 'number':\n        this.tooltipValueFormat = d3_format(this.tooltipValueFormatString);\n        break;\n      case 'time':\n        this.tooltipValueFormat = d3_timeFormat(this.tooltipValueFormatString);\n        break;\n      default:\n        this.tooltipValueFormat = null;\n    }\n\n    // defaults for all chart types\n    this.lineWidth = 3;\n    this.lineCurved = true;\n    this.linePoints = true;\n    this.hideXAxis = false;\n    this.hideYAxis = false;\n    this.hideXAxisZero = false;\n    this.hideYAxisZero = false;\n    this.hideXGrid = false;\n    this.hideYGrid = false;\n    this.hideXAxisDomain = false;\n    this.hideYAxisDomain = false;\n    this.hideTooltip = false;\n    this.hideXAxisTicks = false;\n    this.hideYAxisTicks = false;\n    this.xAxisTickSize = 8;\n    this.xAxisTickSizeOuter = 0;\n    this.yAxisTickSize = 8;\n    this.yAxisTickSizeOuter = 0;\n\n    if (this.type !== 'debug') {\n      // set type defaults\n      switch (this.type) {\n        case 'medium':\n          this.hideXGrid = true;\n          this.hideXAxisTicks = true;\n          this.hideYAxisTicks = true;\n          this.hideYGrid = true;\n          break;\n\n        case 'high':\n          this.lineWidth = 2;\n          this.lineCurved = false;\n          this.linePoints = false;\n          this.hideXAxisTicks = true;\n          this.hideYAxisTicks = true;\n          break;\n      }\n    }\n\n    // adjust margin if xAxis hidden\n    if (this.hideXAxis) this.margin.bottom = 10; // need small margin for yAxis with 0 tick label\n\n    if (!this.hideLegend && this.legendPosition === 'right') {\n      this.width = +this.width - +this.legendWidth;\n    }\n\n    // define line\n    this.d3line = d3_line()\n      .x((d: any, i) => this.xAxisScale(d3_isoParse(this.data.dates[i])))\n      .y((d: any) => this.yAxisScale(d));\n\n    // define line curve\n    if (this.lineCurved) {\n      this.d3line.curve(d3_curveCatmullRom.alpha(0.5));\n    }\n\n    // define area\n    if (this.area) {\n      this.d3area = d3_area()\n        .x((d: any, i) => this.xAxisScale(d3_isoParse(this.data.dates[i])))\n        .y0(this.height)\n        .y1((d: any, i) => this.yAxisScale(d));\n\n      if (this.lineCurved) {\n        this.d3area.curve(d3_curveCatmullRom.alpha(0.5));\n      }\n    }\n\n    // create the chart\n    this.chart = d3_select(this._element.nativeElement).attr('aria-hidden', 'true');\n\n    // create chart svg\n    this.svg = this.chart\n      .append('svg')\n      .attr('width', +this.width + this.margin.right)\n      .attr('height', +this.height + this.margin.top + this.margin.bottom)\n      .attr('class', 'img-fluid')\n      .attr('preserveAspectRatio', 'xMinYMin meet')\n      .attr(\n        'viewBox',\n        `-${this.margin.left} -${this.margin.top} ${+this.width + this.margin.right} ${+this.height +\n          this.margin.top +\n          this.margin.bottom}`\n      );\n\n    // add rectangle to capture mouse\n    this.mouserect = this.svg\n      .append('rect')\n      .attr('width', this.width - this.margin.left - this.margin.right)\n      .attr('height', this.height)\n      .attr('class', 'mouserect')\n      .on('mousemove', (data, index, nodes) => this.mouserectMouseMove(d3_event, index, nodes))\n      .on('mouseout', (data, index, nodes) => this.mouserectMouseOut(d3_event, index, nodes))\n      .on('click', (data, index, nodes) => this.mouserectMouseClick());\n\n    this.tooltipLine = this.svg\n      .append('line')\n      .attr('y1', 0)\n      .attr('y2', this.height)\n      .attr('class', 'tooltip-line');\n\n    // define color range\n    this.colorRange = d3_scaleOrdinal().range(this._dataviz.getColors(false, this.theme));\n\n    // add glow def\n    this._dataviz.createGlowFilter(this.svg);\n\n    // X AXIS\n    this.xAxisScale = d3_scaleTime()\n      .domain(\n        d3_extent(this.data.dates, (d: any, i) => {\n          return d3_isoParse(d);\n        })\n      )\n      .range([0, this.width - this.margin.left - this.margin.right]);\n\n    this.xAxisCall = d3_axisBottom(this.xAxisScale)\n      .ticks(+this.xAxisTicks)\n      .tickSize(this.xAxisTickSize)\n      .tickSizeOuter(this.xAxisTickSizeOuter)\n      .tickFormat(this.xAxisFormatter);\n\n    this.xAxis = this.svg\n      .append('g')\n      .attr('class', 'axis axis-x')\n      .attr('transform', `translate(0, ${this.height})`) //${-this.margin.right / 2}\n      .classed('axis-hidden', this.hideXAxis)\n      .classed('axis-zero-hidden', this.hideXAxisZero)\n      .classed('axis-domain-hidden', this.hideXAxisDomain)\n      .classed('axis-ticks-hidden', this.hideXAxisTicks)\n      .call(this.xAxisCall);\n\n    // X GRIDLINES\n    if (!this.hideXGrid) {\n      this.xGridCall = d3_axisBottom(this.xAxisScale).tickSize(-this.height);\n\n      this.xGrid = this.svg\n        .append('g')\n        .attr('class', 'grid grid-x')\n        .classed('grid-zero-hidden', this.hideXAxisZero)\n        .attr('transform', `translate(0, ${this.height})`) //${-this.margin.right / 2}\n        .call(this.xGridCall);\n    }\n\n    // Y AXIS\n    this.yAxisScale = d3_scaleLinear()\n      .domain([\n        d3_min(this.data.series, (d: any, i) => {\n          const minVal = +d3_min(d.values);\n          return minVal - minVal * +this.yAxisMinBuffer;\n        }),\n        d3_max(this.data.series, (d: any, i) => {\n          const maxVal = +d3_max(d.values);\n          return maxVal + maxVal * this.yAxisMaxBuffer;\n        })\n      ])\n      .nice()\n      .range([this.height, 0]);\n\n    this.yAxisCall = d3_axisLeft(this.yAxisScale)\n      .ticks(this.yAxisTicks)\n      .tickSize(this.yAxisTickSize)\n      .tickSizeOuter(this.yAxisTickSizeOuter)\n      .tickFormat(this.yAxisFormatter);\n\n    this.yAxis = this.svg\n      .append('g')\n      .attr('class', 'axis axis-y')\n      .classed('axis-hidden', this.hideYAxis)\n      .classed('axis-zero-hidden', this.hideYAxisZero)\n      .classed('axis-domain-hidden', this.hideYAxisDomain)\n      .classed('axis-ticks-hidden', this.hideYAxisTicks)\n      .call(this.yAxisCall);\n\n    // Y GRIDLINES\n    if (!this.hideYGrid) {\n      this.yGridCall = d3_axisLeft(this.yAxisScale)\n        .ticks(this.yAxisTicks)\n        .tickSize(-this.width + this.margin.left + this.margin.right);\n\n      this.yGrid = this.svg\n        .append('g')\n        .attr('class', 'grid grid-y')\n        .classed('grid-zero-hidden', this.hideYAxisZero)\n        .attr('transform', `translate(0, 0)`)\n        .call(this.yGridCall);\n    }\n\n    // TOOLTIP\n    if (!this.hideTooltip) {\n      this.tooltip = d3_select('body')\n        .append('div')\n        .attr('class', 'pbds-tooltip west')\n        .style('opacity', 0)\n        .attr('aria-hidden', 'true'); // hide tooltip for accessibility\n\n      // tooltip header\n      this.tooltip.append('div').attr('class', 'tooltip-header');\n\n      // tooltip table\n      const tooltipTable = this.tooltip.append('table').attr('class', 'tooltip-table text-left w-100');\n\n      const tooltipTableTbody = tooltipTable.append('tbody');\n\n      tooltipTableTbody\n        .selectAll('tr')\n        .data(this.data)\n        .enter()\n        .append('tr');\n    }\n\n    // add legend classes\n    if (!this.hideLegend) {\n      this.chart.classed('pbds-chart-legend-bottom', this.legendPosition === 'bottom' ? true : false);\n      this.chart.append('ul').attr('class', `legend legend-${this.legendPosition}`);\n    }\n\n    this.updateChart();\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    if (changes.data && !changes.data.firstChange) {\n      this.updateChart();\n    }\n  }\n\n  ngOnDestroy() {\n    if (this.tooltip) this.tooltip.remove();\n  }\n\n  updateChart = () => {\n    this.mouserect.data(this.data);\n\n    // update the xScale\n    this.xAxisScale.domain(\n      d3_extent(this.data.dates, (d: any, i) => {\n        return d3_isoParse(d);\n      })\n    );\n\n    // update the yScale\n    this.yAxisScale\n      .domain([\n        d3_min(this.data.series, (d: any, i) => {\n          const minVal = +d3_min(d.values);\n          return minVal - minVal * +this.yAxisMinBuffer;\n        }),\n        d3_max(this.data.series, (d: any, i) => {\n          const maxVal = +d3_max(d.values);\n          return maxVal + maxVal * this.yAxisMaxBuffer;\n        })\n      ])\n      .nice();\n\n    this.xAxis\n      .transition()\n      .duration(1000)\n      .call(this.xAxisCall);\n\n    this.yAxis\n      .transition()\n      .duration(1000)\n      .call(this.yAxisCall);\n\n    // update the grids\n    if (!this.hideXGrid) {\n      this.xGrid\n        .transition()\n        .duration(1000)\n        .call(this.xGridCall);\n    }\n\n    if (!this.hideYGrid) {\n      this.yGrid\n        .transition()\n        .duration(1000)\n        .call(this.yGridCall);\n    }\n\n    let group = this.svg.selectAll('.line-group').data(this.data.series);\n\n    // remove lines\n    group.exit().remove();\n\n    // update existing\n    group\n      .select('path.line')\n      .transition()\n      .duration(1000)\n      .attr('d', d => this.d3line(d.values));\n\n    if (this.area) {\n      group\n        .select('path.area')\n        .transition()\n        .duration(1000)\n        .attr('d', d => this.d3area(d.values));\n    }\n\n    group\n      .selectAll('circle')\n      .data(d => d.values)\n      .transition()\n      .duration(1000)\n      .attr('cx', (d, i) => this.xAxisScale(d3_isoParse(this.data.dates[i])))\n      .attr('cy', d => this.yAxisScale(d));\n\n    // add group on enter\n    const groupEnter = group\n      .enter()\n      .append('g')\n      .attr('class', 'line-group');\n\n    // add line on enter\n    const line = groupEnter\n      .append('path')\n      .attr('class', 'line')\n      .style('color', d => this.colorRange(d.label))\n      .style('stroke-width', this.lineWidth)\n      .transition()\n      .duration(1000)\n      .attr('d', data => this.d3line(data.values));\n\n    if (this.area) {\n      groupEnter\n        .append('path')\n        .attr('class', 'area')\n        .attr('d', data => this.d3area(data.values))\n        .style('color', d => this.colorRange(d.label));\n    }\n\n    // add points\n    if (this.linePoints) {\n      const points = groupEnter\n        .append('g')\n        .attr('class', 'points')\n        .style('color', d => this.colorRange(d.label));\n\n      const circles = points.selectAll('circle').data(d => d.values);\n\n      circles\n        .enter()\n        .append('circle')\n        .attr('cx', (d, i) => this.xAxisScale(d3_isoParse(this.data.dates[i])))\n        .attr('cy', d => this.yAxisScale(d))\n        .attr('r', this.lineWidth * 2)\n        .style('stroke-width', this.lineWidth);\n    }\n\n    if (this.type !== 'high') {\n      line.attr('filter', `url(${this._location.path()}#glow)`);\n    }\n\n    if (!this.hideLegend) {\n      let legendItem = this.chart\n        .select('.legend')\n        .selectAll('.legend-item')\n        .data(this.data.series);\n\n      legendItem.exit().remove();\n\n      // update existing items\n      legendItem.select('.legend-label').html(d => {\n        switch (this.legendLabelFormatType) {\n          case 'number':\n            return this.legendLabelFormat(d.label);\n\n          case 'time':\n            const parsedTime = d3_isoParse(d.label);\n            return this.legendLabelFormat(parsedTime);\n\n          default:\n            return d.label;\n        }\n      });\n\n      // legend items on enter\n      let enterLegendItem = legendItem\n        .enter()\n        .append('li')\n        .attr('class', 'legend-item');\n\n      enterLegendItem\n        .append('span')\n        .attr('class', 'legend-key')\n        .style('background-color', d => this.colorRange(d.label));\n\n      enterLegendItem\n        .append('span')\n        .attr('class', 'legend-label')\n        .html(d => {\n          switch (this.legendLabelFormatType) {\n            case 'number':\n              return this.legendLabelFormat(d.label);\n\n            case 'time':\n              const parsedTime = d3_isoParse(d.label);\n              return this.legendLabelFormat(parsedTime);\n\n            default:\n              return d.label;\n          }\n        });\n\n      enterLegendItem\n        .on('mouseover', (data, index, nodes) => this.legendMouseOver(d3_event, data, index, nodes))\n        .on('mouseout', () => this.legendMouseOut())\n        .on('click', (data, index, nodes) => this.legendMouseClick(d3_event, data, index, nodes));\n    }\n\n    if (!this.hideTooltip) {\n      let tooltipItem = this.tooltip\n        .select('.tooltip-table')\n        .selectAll('tr')\n        .data(this.data.series);\n\n      tooltipItem.exit().remove();\n\n      // update existing items\n      tooltipItem.select('.tooltip-label pr-2').html(d => {\n        return this.tooltipHeadingFormat(d.label);\n      });\n\n      // items on enter\n      let entertooltipItem = tooltipItem\n        .enter()\n        .append('tr')\n        .attr('class', 'tooltip-item');\n\n      entertooltipItem\n        .append('td')\n        .style('color', d => this.colorRange(d.label))\n        .append('span')\n        .attr('class', 'pbds-tooltip-key');\n\n      entertooltipItem\n        .append('td')\n        .attr('class', 'tooltip-label pr-2 text-nowrap')\n        .html(d => {\n          return this.tooltipLabelFormatType ? this.tooltipLabelFormat(d.label) : d.label;\n        });\n\n      entertooltipItem\n        .append('td')\n        .attr('class', 'tooltip-value text-right text-nowrap')\n        .html(d => '');\n    }\n\n    this.mouserect.raise();\n  };\n\n  legendMouseOver = (event, data, index, nodes) => {\n    this.chart\n      .selectAll('.legend-item')\n      .filter((d, i) => i !== index)\n      .classed('inactive', true);\n\n    this.chart\n      .selectAll('.line-group')\n      .filter((d, i) => i !== index)\n      .classed('inactive', true);\n\n    const line = this.chart.selectAll('.line-group').filter((d, i) => i === index);\n    line.classed('active', true);\n\n    if (this.linePoints) {\n      const circles = line.selectAll('circle');\n      circles.classed('active', true);\n    }\n\n    this.hovered.emit({ event, data });\n  };\n\n  legendMouseOut = () => {\n    this.chart.selectAll('.legend-item').classed('inactive', false);\n\n    this.chart\n      .selectAll('.line-group')\n      .classed('inactive', false)\n      .classed('active', false);\n\n    if (this.linePoints) {\n      const circles = this.chart.selectAll('circle');\n      circles.classed('active', false);\n    }\n  };\n\n  legendMouseClick = (event, data, index, nodes) => {\n    this.clicked.emit({ event, data });\n  };\n\n  mouserectMouseMove = (event, index, nodes) => {\n    const mouseXDate = this.xAxisScale.invert(d3_mouse(nodes[0])[0]); // return date at mouse x position\n    const leftIndex = d3_bisectLeft(this.data.dates, d3_isoFormat(mouseXDate)); // index of left closest date\n\n    // prevent error for 0 index\n    if (leftIndex === 0) return false;\n\n    const dateLower = new Date(this.data.dates[leftIndex - 1]);\n    const dateUpper = new Date(this.data.dates[leftIndex]);\n    const closestDate = +mouseXDate - +dateLower > +dateUpper - mouseXDate ? dateUpper : dateLower; // date mouse is closest to\n    const closestIndex = this.data.dates.indexOf(d3_isoFormat(closestDate)); // which index the mouse is closest to\n    // console.log(+mouseXDate, leftIndex, +dateLower, +dateUpper, +closestDate, closestIndex);\n\n    const circles = this.svg.selectAll('.line-group').selectAll('circle');\n    circles.filter((d, i) => i === closestIndex).classed('active', true);\n    circles.filter((d, i) => i !== closestIndex).classed('active', false);\n\n    this.tooltipLine\n      .attr('x1', this.xAxisScale(closestDate))\n      .attr('x2', this.xAxisScale(closestDate))\n      .classed('active', true);\n\n    // console.log(this.tooltipLine.node().getBoundingClientRect(), this._scroll.getScrollPosition());\n    this.tooltipShow(this.tooltipLine.node(), closestIndex);\n\n    this.mousedata = {\n      date: closestDate,\n      series: this.data.series.map(d => {\n        return {\n          label: d.label,\n          value: d.values[closestIndex]\n        };\n      })\n    };\n\n    this.tooltipHovered.emit({ event, data: this.mousedata });\n  };\n\n  mouserectMouseOut = (event, index, nodes) => {\n    this.svg.selectAll('circle').classed('active', false);\n    this.tooltipLine.classed('active', false);\n    this.tooltipHide();\n  };\n\n  mouserectMouseClick = () => {\n    this.tooltipClicked.emit({ event, data: this.mousedata });\n  };\n\n  private tooltipShow = (node, closestIndex) => {\n    const scroll = this._scroll.getScrollPosition();\n    const mouserectDimensions = node.getBoundingClientRect();\n    const tooltipOffsetHeight = +this.tooltip.node().offsetHeight;\n    const tooltipDimensions = this.tooltip.node().getBoundingClientRect();\n    const dimensionCalculated = mouserectDimensions.left + tooltipDimensions.width + 8;\n    const clientWidth = document.body.clientWidth - 10;\n    let position;\n\n    // console.log(scroll, mouserectDimensions, tooltipOffsetHeight, tooltipDimensions, dimensionCalculated, clientWidth);\n\n    this.tooltip.select('.tooltip-header').html(d => {\n      const parsedTime = d3_isoParse(this.data.dates[closestIndex]);\n      return this.tooltipHeadingFormat(parsedTime);\n    });\n\n    this.tooltip.selectAll('.tooltip-value').html((d, i) => {\n      return this.tooltipValueFormatType\n        ? this.tooltipValueFormat(this.data.series[i].values[closestIndex])\n        : this.data.series[i].values[closestIndex];\n    });\n\n    // flip the tooltip positions if near the right edge of the screen\n    if (dimensionCalculated > clientWidth) {\n      this.tooltip.classed('east', true);\n      this.tooltip.classed('west', false);\n      position = `${mouserectDimensions.left - tooltipDimensions.width - 8}px`;\n    } else if (dimensionCalculated < clientWidth) {\n      this.tooltip.classed('east', false);\n      this.tooltip.classed('west', true);\n      position = `${mouserectDimensions.left + 8}px`;\n    }\n\n    // console.log('POSITION: ', position, mouserectDimensions);\n\n    // set the tooltip styles\n    this.tooltip.style(\n      'top',\n      `${mouserectDimensions.top + mouserectDimensions.height / 2 - tooltipOffsetHeight / 2 + scroll[1]}px`\n    );\n    this.tooltip.style('left', position);\n    this.tooltip.style('opacity', 1);\n  };\n\n  private tooltipHide = () => {\n    this.tooltip.style('opacity', 0);\n  };\n\n  private xAxisFormatter = item => {\n    const parseDate = d3_isoParse(item);\n    return this.xAxisFormat(parseDate);\n  };\n\n  private yAxisFormatter = item => {\n    return this.yAxisFormat(item);\n  };\n}\n","import { Component, OnInit, Input, ElementRef, HostBinding, OnChanges, SimpleChanges } from '@angular/core';\n\nimport { select as d3_select, arc as d3_arc, interpolate as d3_interpolate, format as d3_format } from 'd3';\n\nimport { PbdsDatavizService } from './dataviz.service';\nimport { PbdsDatavizGauge } from './dataviz.interfaces';\n\n@Component({\n  selector: 'pbds-dataviz-gauge',\n  template: `\n    <div\n      *ngIf=\"!hideLabel\"\n      class=\"gauge-details\"\n      [ngClass]=\"{ halfmoon: type === 'halfmoon', 'gauge-details-small': type === 'halfmoon' }\"\n      [ngStyle]=\"{ 'max-width.px': width - 3 * gaugeWidth }\"\n    >\n      <div class=\"gauge-number\">{{ label }}</div>\n      <div *ngIf=\"description\" class=\"gauge-description text-center\">{{ description }}</div>\n    </div>\n  `,\n  styles: []\n})\nexport class PbdsDatavizGaugeComponent implements OnInit, OnChanges {\n  @HostBinding('class.pbds-chart')\n  chartClass = true;\n\n  @HostBinding('class.pbds-chart-gauge')\n  gaugeClass = true;\n\n  @Input()\n  data: PbdsDatavizGauge;\n\n  @Input()\n  width = 300;\n\n  @Input()\n  type: 'halfmoon' | 'horseshoe' | 'circle' = 'halfmoon';\n\n  @Input()\n  color = '#E23DA8';\n\n  @Input()\n  hideLabel = false;\n\n  @Input()\n  labelFormatString = '';\n\n  @Input()\n  description;\n\n  @Input()\n  gaugeWidth = 20;\n\n  private chart;\n  private svg;\n  private gauge;\n  private labelTween; // TODO: rename this\n  public label;\n  private startAngle;\n  private endAngle;\n  private radius;\n  private backgroundColor; // TODO: should this be an input?\n  private arc;\n  private labelFormat;\n  private oldValue;\n  private height;\n  private rounded;\n\n  constructor(private _dataviz: PbdsDatavizService, private _element: ElementRef) {}\n\n  ngOnInit() {\n    this.height = this.width;\n    this.radius = Math.max(this.width, this.height) / 2;\n    this.labelFormat = d3_format(this.labelFormatString);\n    this.backgroundColor = '#F0F0F0';\n    this.label = this.labelFormat(this.data.value);\n\n    switch (this.type) {\n      case 'halfmoon':\n        this.startAngle = -90;\n        this.endAngle = 90;\n        this.rounded = true;\n        break;\n\n      case 'horseshoe':\n        this.startAngle = -140;\n        this.endAngle = 140;\n        this.rounded = true;\n        break;\n\n      case 'circle':\n        this.startAngle = 0;\n        this.endAngle = 360;\n        this.rounded = false;\n        break;\n    }\n\n    this.arc = d3_arc().cornerRadius(this.rounded ? this.gaugeWidth : 0);\n\n    this.chart = d3_select(this._element.nativeElement).attr('aria-hidden', 'true');\n\n    this.svg = this.chart\n      .append('svg')\n      .attr('width', this.width)\n      .attr('height', this.height)\n      .attr('class', 'img-fluid') // to resize chart\n      .attr('preserveAspectRatio', 'xMinYMin meet')\n      .attr('viewBox', `-${this.width / 2} -${this.height / 2} ${this.width} ${this.height}`);\n\n    this.drawChart();\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    if (changes.data && !changes.data.firstChange) {\n      // console.log(changes.data.previousValue.value, changes.data.currentValue.value);\n\n      this.oldValue = changes.data.previousValue.value;\n      this.updateChart();\n    }\n  }\n\n  degreesToRadians = degree => {\n    return (degree * Math.PI) / 180;\n  };\n\n  calculateMinMax = () => {\n    const percentage = this.data.minvalue / (this.data.maxvalue - this.data.minvalue);\n\n    return percentage * (this.data.value - this.data.minvalue) + (this.data.value - this.data.minvalue);\n  };\n\n  calculateCurve = data => {\n    const start = this.degreesToRadians(this.startAngle);\n    const end = start + (data * (this.degreesToRadians(this.endAngle) - start)) / this.data.maxvalue;\n\n    return [\n      {\n        startAngle: start,\n        endAngle: end\n      }\n    ];\n  };\n\n  drawChart = () => {\n    this.gauge = this.svg.append('g').attr('class', 'gauge-group');\n\n    // background arc\n    const background = this.gauge\n      .append('path')\n      .data(this.calculateCurve(this.data.maxvalue))\n      .attr('class', 'gauge-background')\n      .attr('fill', this.backgroundColor)\n      .attr('d', d => {\n        return this.arc({\n          innerRadius: this.radius - this.gaugeWidth,\n          outerRadius: this.radius,\n          startAngle: d.startAngle,\n          endAngle: d.endAngle\n        });\n      });\n\n    // value arc\n    this.gauge\n      .append('path')\n      .data(this.calculateCurve(this.calculateMinMax()))\n      .attr('class', 'gauge-value')\n      .attr('fill', this.color)\n      .attr('d', d => {\n        return this.arc({\n          innerRadius: this.radius - this.gaugeWidth,\n          outerRadius: this.radius,\n          startAngle: d.startAngle,\n          endAngle: d.endAngle\n        });\n      });\n\n    switch (this.type) {\n      case 'horseshoe':\n        this.svg.attr('height', 230).attr('viewBox', `-${this.width / 2} -${this.height / 2} ${this.height} 230`);\n        break;\n      case 'halfmoon':\n        this.svg.attr('height', this.width / 2);\n        this.svg.attr('viewBox', `-${this.width / 2} -${this.width / 2} ${this.width} ${this.width / 2}`);\n        break;\n    }\n  };\n\n  updateChart = () => {\n    let group = this.svg.select('.gauge-group');\n\n    group\n      .select('.gauge-value')\n      .transition()\n      .duration(750)\n      .call(this.arcTween, this.calculateMinMax());\n\n    this.labelTween = this.chart.select('.gauge-number');\n\n    this.labelTween\n      .transition()\n      .duration(750)\n      .call(this.textTween, this.data.value);\n  };\n\n  arcTween = (transition, value) => {\n    let newAngle = this.calculateCurve(value);\n\n    transition.attrTween('d', d => {\n      let interpolate = d3_interpolate(d.endAngle, newAngle[0].endAngle);\n\n      return t => {\n        d.endAngle = interpolate(t);\n\n        return this.arc({\n          innerRadius: this.radius - this.gaugeWidth,\n          outerRadius: this.radius,\n          startAngle: d.startAngle,\n          endAngle: d.endAngle\n        });\n      };\n    });\n  };\n\n  textTween = (transition, value) => {\n    value = d3_format('.2f')(value); // TODO: check these .1f formats here, should they be inputs?\n    value = value.replace(/,/g, '.');\n\n    transition.tween('text', () => {\n      let interpolate = d3_interpolate(d3_format('.2f')(+this.oldValue), value);\n\n      return t => {\n        this.labelTween.text(d => {\n          let updatedNumber = this.labelFormat(interpolate(t));\n          this.label = updatedNumber;\n          return updatedNumber;\n        });\n      };\n    });\n  };\n}\n","import { Component, OnInit, Input, ElementRef, HostBinding, ChangeDetectionStrategy } from '@angular/core';\n\nimport {\n  select as d3_select,\n  line as d3_line,\n  scaleLinear as d3_scaleLinear,\n  min as d3_min,\n  max as d3_max,\n  area as d3_area\n} from 'd3';\n\nimport { PbdsDatavizSparkline } from './dataviz.interfaces';\n\n@Component({\n  selector: 'pbds-dataviz-sparkline',\n  template: ``,\n  styles: [],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class PbdsDatavizSparklineComponent implements OnInit {\n  @HostBinding('class.pbds-chart')\n  chartClass = true;\n\n  @HostBinding('class.pbds-chart-sparkline')\n  sparklineClass = true;\n\n  @Input()\n  data: PbdsDatavizSparkline;\n\n  @Input()\n  width = 160;\n\n  @Input()\n  height = 40;\n\n  @Input()\n  type: 'line' | 'line-high' | 'area' | 'area-high' | 'bar' = 'line';\n\n  @Input()\n  color = '#E23DA8';\n\n  @Input()\n  colorNegative: string | null = null; // undocumented, may add if needed\n\n  @Input()\n  strokeWidth = 2; // undocumented, width is automatically set by the type\n\n  @Input()\n  yAxisMinBuffer = 0;\n\n  @Input()\n  yAxisMaxBuffer = 0;\n\n  private chart;\n  private svg;\n  private margin;\n\n  constructor(private _element: ElementRef) {}\n\n  ngOnInit() {\n    this.margin = { top: 1, right: 0, bottom: 1, left: 0 };\n\n    if (this.type === 'bar') {\n      this.margin = { top: 0, right: 0, bottom: 0, left: 0 };\n    }\n\n    if (this.type === 'line-high' || this.type === 'area-high') {\n      this.strokeWidth = 1;\n    }\n\n    if (this.colorNegative === null) {\n      this.colorNegative = this.color;\n    }\n\n    let x = d3_scaleLinear().range([0, this.width - this.margin.left - this.margin.right]);\n    let y = d3_scaleLinear().range([this.height - this.margin.top - this.margin.bottom, 0]);\n\n    y.domain([+d3_min(this.data) - this.yAxisMinBuffer, +d3_max(this.data) + this.yAxisMaxBuffer]);\n    x.domain([0, this.data.length]);\n\n    let line = d3_line()\n      .x((d, i) => x(i))\n      .y((d: any) => y(d));\n\n    let area = d3_area()\n      .x((d, i) => x(i))\n      .y0(this.height)\n      .y1((d: any) => y(d));\n\n    this.chart = d3_select(this._element.nativeElement).attr('aria-hidden', 'true');\n\n    this.svg = this.chart\n      .append('svg')\n      .attr('width', this.width)\n      .attr('height', this.height)\n      .attr('class', 'img-fluid')\n      .attr('preserveAspectRatio', 'xMinYMin meet')\n      .attr('viewBox', `-${this.margin.left} -${this.margin.top} ${this.width} ${this.height}`);\n\n    if (this.type === 'line' || this.type === 'line-high' || this.type === 'area' || this.type === 'area-high') {\n      this.svg\n        .append('path')\n        .datum(this.data)\n        .attr('class', 'sparkline')\n        .attr('fill', 'none')\n        .attr('stroke-width', this.strokeWidth)\n        .attr('stroke', this.color)\n        .attr('d', line);\n    }\n\n    if (this.type === 'area' || this.type === 'area-high') {\n      this.svg\n        .append('path')\n        .datum(this.data)\n        .attr('class', 'sparkarea')\n        .attr('fill', this.color)\n        .attr('fill-opacity', 0.3)\n        .attr('d', area);\n    }\n\n    if (this.type === 'bar') {\n      const barWidth = (this.width - this.data.length) / this.data.length;\n\n      // handles negative values, see example https://www.essycode.com/posts/create-sparkline-charts-d3/\n      this.svg\n        .selectAll('.bar')\n        .data(this.data)\n        .enter()\n        .append('rect')\n        .attr('class', 'sparkbar')\n        .attr('x', (d, i) => x(i))\n        .attr('y', d => (d > 0 ? y(d) : y(0)))\n        .attr('width', barWidth)\n        .attr('height', d => Math.abs(y(d) - y(0)))\n        .attr('fill', d => (d > 0 ? this.color : this.colorNegative)); // still uses undocumented negative color values\n    }\n  }\n}\n","import {\n  Component,\n  OnInit,\n  OnChanges,\n  Input,\n  Output,\n  EventEmitter,\n  ElementRef,\n  HostBinding,\n  OnDestroy,\n  SimpleChanges,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { ViewportScroller } from '@angular/common';\n\nimport {\n  select as d3_select,\n  isoParse as d3_isoParse,\n  timeFormat as d3_timeFormat,\n  format as d3_format,\n  scaleOrdinal as d3_scaleOrdinal,\n  scaleBand as d3_scaleBand,\n  scaleLinear as d3_scaleLinear,\n  max as d3_max,\n  axisBottom as d3_axisBottom,\n  axisLeft as d3_axisLeft,\n  event as d3_event,\n  stack as d3_stack,\n  stackOrderNone as d3_stackOrderNone\n} from 'd3';\n\nimport { PbdsDatavizService } from './dataviz.service';\nimport { PbdsDatavizStackedBar } from './dataviz.interfaces';\n\n@Component({\n  selector: 'pbds-dataviz-stacked-bar',\n  template: ``,\n  styles: [],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class PbdsDatavizStackedBarComponent implements OnInit, OnDestroy, OnChanges {\n  @HostBinding('class.pbds-chart')\n  chartClass = true;\n\n  @HostBinding('class.pbds-chart-stacked-bar')\n  stackedBarClass = true;\n\n  @Input()\n  data: Array<PbdsDatavizStackedBar>;\n\n  @Input()\n  width = 306;\n\n  @Input()\n  height = 400;\n\n  @Input()\n  type: 'low' | 'medium' | 'high' | 'debug' = 'medium'; // debug to show all chart options\n\n  @Input()\n  marginTop = 10; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  marginRight = 0; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  marginBottom = 30; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  marginLeft = 55; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  hideXAxis = false;\n\n  @Input()\n  xAxisFormatType: 'number' | 'time' = null;\n\n  @Input()\n  xAxisFormatString = '';\n\n  @Input()\n  yAxisFormatType: 'number' | 'time' = null;\n\n  @Input()\n  yAxisFormatString = '';\n\n  @Input()\n  yAxisTicks = 5;\n\n  @Input()\n  yAxisMaxBuffer = 0.01;\n\n  @Input()\n  hideLegend = false;\n\n  @Input()\n  legendWidth = 105 + 28; // hardcoded legend width + left margin, do not document until feedback\n\n  @Input()\n  legendPosition: 'right' | 'bottom' = 'right';\n\n  @Input()\n  legendLabelFormatType: 'number' | 'time' = null;\n\n  @Input()\n  legendLabelFormatString = '';\n\n  @Input()\n  tooltipHeadingFormatType: 'time' = null;\n\n  @Input()\n  tooltipHeadingFormatString = '';\n\n  @Input()\n  tooltipHeadingValueFormatType: 'number' = null;\n\n  @Input()\n  tooltipHeadingValueFormatString = '';\n\n  @Input()\n  tooltipLabelFormatType: 'time' = null;\n\n  @Input()\n  tooltipLabelFormatString = '';\n\n  @Input()\n  tooltipValueFormatType: 'number' = null;\n\n  @Input()\n  tooltipValueFormatString = '';\n\n  @Input()\n  theme;\n\n  @Output()\n  hovered: EventEmitter<object> = new EventEmitter<object>();\n\n  @Output()\n  clicked: EventEmitter<object> = new EventEmitter<object>();\n\n  private dataStack;\n  private dataKeys;\n  private chart;\n  private svg;\n  private grayBars;\n  private mouseBars;\n  private bars;\n  private margin;\n  private colorRange;\n  private hideGrayBars: boolean;\n  private xAxisScale;\n  private xAxisCall;\n  private xAxis;\n  private xAxisFormat;\n  private xAxisTickSize: number;\n  private xAxisTickSizeOuter: number;\n  private hideXAxisDomain: boolean;\n  private hideXAxisZero: boolean;\n  private hideXAxisTicks: boolean;\n  private hideXGrid: boolean;\n  private hideYGrid: boolean;\n  private yAxisMax;\n  private yAxisScale;\n  private yAxisCall;\n  private yAxis;\n  private yAxisFormat;\n  private yAxisTickSize: number;\n  private yAxisTickSizeOuter: number;\n  private xGrid;\n  private xGridCall;\n  private yGrid;\n  private yGridCall;\n  private hideYAxis: boolean;\n  private hideYAxisZero: boolean;\n  private hideYAxisDomain: boolean;\n  private hideYAxisTicks: boolean;\n  private legendLabelFormat;\n  private tooltip;\n  private hideTooltip: boolean;\n  private tooltipHeadingFormat;\n  private tooltipHeadingValueFormat;\n  private tooltipValueFormat;\n  private tooltipLabelFormat;\n\n  constructor(private _dataviz: PbdsDatavizService, private _element: ElementRef, private _scroll: ViewportScroller) {}\n\n  ngOnInit() {\n    // extract keys for stack data\n    this.dataKeys = Object.keys(this.data[0]).filter(item => item !== 'key');\n\n    // create the D3 stack data\n    this.dataStack = d3_stack()\n      .keys(this.dataKeys)\n      .order(d3_stackOrderNone)(this.data);\n\n    //////////////////////////////////////////\n\n    this.margin = {\n      top: +this.marginTop,\n      right: +this.marginRight,\n      bottom: +this.marginBottom,\n      left: +this.marginLeft\n    };\n\n    switch (this.xAxisFormatType) {\n      case 'number':\n        this.xAxisFormat = d3_format(this.xAxisFormatString);\n        break;\n      case 'time':\n        this.xAxisFormat = d3_timeFormat(this.xAxisFormatString);\n        break;\n    }\n\n    switch (this.yAxisFormatType) {\n      case 'number':\n        this.yAxisFormat = d3_format(this.yAxisFormatString);\n        break;\n      case 'time':\n        this.yAxisFormat = d3_timeFormat(this.yAxisFormatString);\n        break;\n    }\n\n    switch (this.legendLabelFormatType) {\n      case 'number':\n        this.legendLabelFormat = d3_format(this.legendLabelFormatString);\n        break;\n      case 'time':\n        this.legendLabelFormat = d3_timeFormat(this.legendLabelFormatString);\n        break;\n      default:\n        this.legendLabelFormat = null;\n        break;\n    }\n\n    switch (this.tooltipHeadingFormatType) {\n      case 'time':\n        this.tooltipHeadingFormat = d3_timeFormat(this.tooltipHeadingFormatString);\n        break;\n      default:\n        this.tooltipHeadingFormat = null;\n        break;\n    }\n\n    switch (this.tooltipHeadingValueFormatType) {\n      case 'number':\n        this.tooltipHeadingValueFormat = d3_format(this.tooltipHeadingValueFormatString);\n        break;\n      default:\n        this.tooltipHeadingValueFormat = null;\n        break;\n    }\n\n    switch (this.tooltipLabelFormatType) {\n      case 'time':\n        this.tooltipLabelFormat = d3_timeFormat(this.tooltipLabelFormatString);\n        break;\n      default:\n        this.tooltipLabelFormat = null;\n        break;\n    }\n\n    switch (this.tooltipValueFormatType) {\n      case 'number':\n        this.tooltipValueFormat = d3_format(this.tooltipValueFormatString);\n        break;\n      default:\n        this.tooltipValueFormat = null;\n    }\n\n    // defaults for all chart types\n    this.hideGrayBars = false;\n    this.hideYAxis = false;\n    this.hideXAxisZero = false;\n    this.hideYAxisZero = false;\n    this.hideXGrid = false;\n    this.hideYGrid = false;\n    this.hideXAxisDomain = false;\n    this.hideYAxisDomain = false;\n    this.hideTooltip = false;\n    this.hideXAxisTicks = false;\n    this.hideYAxisTicks = false;\n    this.xAxisTickSize = 8;\n    this.xAxisTickSizeOuter = 0;\n    this.yAxisTickSize = 8;\n    this.yAxisTickSizeOuter = 0;\n    // this.hideTooltipLabel = false;\n\n    if (this.type !== 'debug') {\n      // set type defaults\n      switch (this.type) {\n        case 'low':\n          this.hideGrayBars = true;\n          this.hideXAxisTicks = true;\n          this.hideXGrid = true;\n          this.hideYAxisDomain = false;\n          this.hideYAxisTicks = true;\n          this.legendPosition = 'bottom';\n          break;\n\n        case 'medium':\n          this.hideXAxisDomain = true;\n          this.hideXGrid = true;\n          this.hideXAxisTicks = true;\n          this.hideYAxisDomain = true;\n          this.hideYAxisTicks = true;\n          this.hideYGrid = true;\n          break;\n\n        case 'high':\n          this.hideXAxis = true;\n          this.hideXAxisTicks = true;\n          this.hideXAxisDomain = true;\n          this.hideXGrid = true;\n          this.hideYAxisDomain = true;\n          this.hideYAxisTicks = true;\n          this.hideYGrid = true;\n          this.hideLegend = false;\n          this.legendPosition = 'bottom';\n          break;\n      }\n    }\n\n    // adjust margin if xAxis hidden\n    if (this.hideXAxis) this.margin.bottom = 10; // need small margin for yAxis with 0 tick label\n\n    if (!this.hideLegend && this.legendPosition === 'right') {\n      this.width = +this.width - +this.legendWidth;\n    }\n\n    // create the chart\n    this.chart = d3_select(this._element.nativeElement).attr('aria-hidden', 'true');\n\n    // create chart svg\n    this.svg = this.chart\n      .append('svg')\n      .attr('width', +this.width)\n      .attr('height', +this.height + this.margin.top + this.margin.bottom)\n      .attr('class', 'img-fluid')\n      .attr('preserveAspectRatio', 'xMinYMin meet')\n      .attr(\n        'viewBox',\n        `-${this.margin.left} -${this.margin.top} ${+this.width} ${+this.height + this.margin.top + this.margin.bottom}`\n      );\n\n    this.grayBars = this.svg.append('g').attr('class', 'gray-bars');\n    this.mouseBars = this.svg.append('g').attr('class', 'mouseover-bars');\n    this.bars = this.svg.append('g').attr('class', 'bars');\n\n    // build color ranges\n    this.colorRange = d3_scaleOrdinal().range(this._dataviz.getColors(false, this.theme));\n\n    // X AXIS\n    this.xAxisScale = d3_scaleBand()\n      .domain(this.data.map(d => d.key))\n      .rangeRound([0, this.width - this.margin.left])\n      .align(0);\n\n    // add padding to the scale for gray bars\n    !this.hideGrayBars\n      ? this.xAxisScale.paddingInner(0.1).paddingOuter(0)\n      : this.xAxisScale.paddingInner(0).paddingOuter(0);\n\n    this.xAxisCall = d3_axisBottom(this.xAxisScale)\n      .tickSize(this.xAxisTickSize)\n      .tickSizeOuter(this.xAxisTickSizeOuter)\n      .tickFormat(this.xAxisFormatter);\n\n    this.xAxis = this.svg\n      .append('g')\n      .attr('class', 'axis axis-x')\n      .attr('transform', `translate(0, ${this.height})`)\n      .classed('axis-hidden', this.hideXAxis)\n      .classed('axis-zero-hidden', this.hideXAxisZero)\n      .classed('axis-domain-hidden', this.hideXAxisDomain)\n      .classed('axis-ticks-hidden', this.hideXAxisTicks)\n      .call(this.xAxisCall);\n\n    // X GRIDLINES\n    if (!this.hideXGrid) {\n      this.xGridCall = d3_axisBottom(this.xAxisScale).tickSize(-this.height);\n\n      this.xGrid = this.svg\n        .append('g')\n        .attr('class', 'grid grid-x')\n        .classed('grid-zero-hidden', this.hideXAxisZero)\n        .attr('transform', `translate(0, ${this.height})`)\n        .call(this.xGridCall);\n    }\n\n    // KEEP: use this block to debug yAxisMax\n    // console.log(\n    //   d3_max(this.dataStack, (data: any) => {\n    //     // console.log(data);\n\n    //     return d3_max(data, (d: any) => {\n    //       // console.log('D: ', d);\n    //       return d[1];\n    //     });\n    //   })\n    // );\n\n    // Y AXIS\n    this.yAxisMax = d3_max(this.dataStack, (data: any) => {\n      return d3_max(data, (d: any) => {\n        return d[1];\n      });\n    });\n\n    this.yAxisMax = this.yAxisMax + this.yAxisMax * this.yAxisMaxBuffer;\n\n    this.yAxisScale = d3_scaleLinear()\n      .domain([0, this.yAxisMax])\n      .nice()\n      .rangeRound([this.height, 0]);\n\n    this.yAxisCall = d3_axisLeft(this.yAxisScale)\n      .ticks(this.yAxisTicks)\n      .tickSize(this.yAxisTickSize)\n      .tickSizeOuter(this.yAxisTickSizeOuter)\n      .tickFormat(this.yAxisFormatter);\n\n    this.yAxis = this.svg\n      .append('g')\n      .attr('class', 'axis axis-y')\n      .classed('axis-hidden', this.hideYAxis)\n      .classed('axis-zero-hidden', this.hideYAxisZero)\n      .classed('axis-domain-hidden', this.hideYAxisDomain)\n      .classed('axis-ticks-hidden', this.hideYAxisTicks)\n      .call(this.yAxisCall);\n\n    // Y GRIDLINES\n    if (!this.hideYGrid) {\n      this.yGridCall = d3_axisLeft(this.yAxisScale)\n        .ticks(this.yAxisTicks)\n        .tickSize(-this.width + this.margin.left + this.margin.right);\n\n      this.yGrid = this.svg\n        .append('g')\n        .attr('class', 'grid grid-y')\n        .classed('grid-zero-hidden', this.hideYAxisZero)\n        .attr('transform', `translate(0, 0)`)\n        .call(this.yGridCall);\n    }\n\n    // TOOLTIP\n    if (!this.hideTooltip) {\n      this.tooltip = d3_select('body')\n        .append('div')\n        .attr('class', 'pbds-tooltip west')\n        .style('opacity', 0)\n        .attr('aria-hidden', 'true'); // hide tooltip for accessibility\n\n      // tooltip header\n      this.tooltip.append('div').attr('class', 'tooltip-header');\n      this.tooltip.append('div').attr('class', 'tooltip-header-value');\n\n      // tooltip table\n      const tooltipTable = this.tooltip\n        .append('table')\n        .attr('class', 'tooltip-table text-left w-100')\n        .append('tbody');\n    }\n\n    // add legend classes\n    if (!this.hideLegend) {\n      this.chart.classed('pbds-chart-legend-bottom', this.legendPosition === 'bottom' ? true : false);\n      this.chart.append('ul').attr('class', `legend legend-${this.legendPosition}`);\n    }\n\n    this.updateChart();\n  }\n\n  ngOnDestroy() {\n    if (this.tooltip) this.tooltip.remove();\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    if (changes.data && !changes.data.firstChange) {\n      this.updateChart();\n    }\n  }\n\n  updateChart = () => {\n    this.dataKeys = Object.keys(this.data[0]).filter(item => item !== 'key');\n\n    // create the D3 stack data\n    this.dataStack = d3_stack()\n      .keys(this.dataKeys)\n      .order(d3_stackOrderNone)(this.data);\n\n    // update the xScale\n    this.xAxisScale.domain(this.data.map(d => d.key));\n\n    // update the yScale\n    this.yAxisMax = d3_max(this.dataStack, (data: any) => {\n      return d3_max(data, (d: any) => {\n        return d[1];\n      });\n    });\n\n    this.yAxisMax = this.yAxisMax + this.yAxisMax * this.yAxisMaxBuffer;\n\n    this.yAxisScale\n      .domain([0, this.yAxisMax])\n      .rangeRound([this.height, 0])\n      .nice();\n\n    this.xAxis\n      .transition()\n      .duration(1000)\n      .call(this.xAxisCall);\n\n    this.yAxis\n      .transition()\n      .duration(1000)\n      .call(this.yAxisCall);\n\n    // update the grids\n    if (!this.hideXGrid) {\n      this.xGrid\n        .transition()\n        .duration(1000)\n        .call(this.xGridCall);\n    }\n\n    if (!this.hideYGrid) {\n      this.yGrid\n        .transition()\n        .duration(1000)\n        .call(this.yGridCall);\n    }\n\n    // add gray bars\n    if (!this.hideGrayBars) {\n      this.grayBars\n        .selectAll('.gray-bar')\n        .data(this.data)\n        .join(\n          enter =>\n            enter\n              .append('rect')\n              .attr('class', 'gray-bar')\n              .attr('x', d => this.xAxisScale(d.key))\n              .attr('width', this.xAxisScale.bandwidth())\n              .attr('height', this.height),\n          update =>\n            update\n              .transition()\n              .duration(1000)\n              .attr('x', d => this.xAxisScale(d.key))\n              .attr('width', this.xAxisScale.bandwidth())\n              .attr('height', this.height),\n          exit => exit.remove()\n        );\n    }\n\n    // add colored bars\n    const barGroups = this.bars\n      .selectAll('.bar-group')\n      .data(this.dataStack)\n      .join(\n        enter =>\n          enter\n            .append('g')\n            .attr('class', 'bar-group')\n            .attr('fill', d => this.colorRange(d.index)),\n        update => update.attr('fill', d => this.colorRange(d.index)),\n        exit => exit.remove()\n      );\n\n    barGroups\n      .selectAll('.bar')\n      .data(d => d)\n      .join(\n        enter =>\n          enter\n            .append('rect')\n            .attr('class', 'bar')\n            .classed('bar-divided', this.type !== 'high')\n            .classed('bar-divided-low', this.type === 'low')\n            .attr('x', (d, i) => {\n              let x;\n\n              if (this.type === 'medium') {\n                x = this.xAxisScale(d.data.key) + (this.xAxisScale.bandwidth() / 8) * 3;\n              } else {\n                x = this.xAxisScale(d.data.key) + (this.xAxisScale.bandwidth() / 4) * 1;\n              }\n\n              return x;\n            })\n            .attr('y', d => this.yAxisScale(d[1]))\n            .attr('width', 0)\n            .attr('height', 0)\n            .call(enter => {\n              let width;\n\n              if (this.type === 'medium') {\n                width = this.xAxisScale.bandwidth() / 4;\n              } else {\n                width = this.xAxisScale.bandwidth() / 2;\n              }\n\n              enter\n                .transition()\n                .duration(1000)\n                .attr('width', width)\n                .attr('height', d => this.yAxisScale(d[0]) - this.yAxisScale(d[1]));\n\n              return enter;\n            }),\n        update =>\n          update.call(update => {\n            let width;\n\n            if (this.type === 'medium') {\n              width = this.xAxisScale.bandwidth() / 4;\n            } else {\n              width = this.xAxisScale.bandwidth() / 2;\n            }\n\n            update\n              .transition()\n              .duration(1000)\n              .attr('width', this.xAxisScale.bandwidth() / 4)\n              .attr('x', (d, i) => this.xAxisScale(d.data.key) + (this.xAxisScale.bandwidth() / 8) * 3)\n              .attr('y', d => this.yAxisScale(d[1]))\n              .attr('height', d => this.yAxisScale(d[0]) - this.yAxisScale(d[1]));\n\n            return update;\n          }),\n\n        exit => exit.remove()\n      );\n\n    // mouseover bars\n    this.mouseBars\n      .selectAll('.mouseover-bar')\n      .data(this.data)\n      .join(\n        enter =>\n          enter\n            .append('rect')\n            .attr('class', 'mouseover-bar')\n            .style('opacity', 0)\n            .attr('x', d => this.xAxisScale(d.key))\n            .attr('width', this.xAxisScale.bandwidth())\n            .attr('height', this.height),\n        update =>\n          update\n            .attr('x', d => this.xAxisScale(d.key))\n            .attr('width', this.xAxisScale.bandwidth())\n            .attr('height', this.height),\n        exit => exit.remove()\n      )\n      .on('mouseover', (data, index, nodes) => this.barMouseOver(d3_event, data, index, nodes))\n      .on('mouseout', (data, index, nodes) => this.barMouseOut())\n      .on('click', (data, index, nodes) => this.barMouseClick(d3_event, data, index, nodes));\n\n    this.bars.raise();\n    this.mouseBars.raise();\n\n    if (!this.hideLegend) {\n      // TODO: refactor to use .join() with enter, update, exit\n      let legendItem = this.chart\n        .select('.legend')\n        .selectAll('.legend-item')\n        .data(this.dataStack);\n\n      legendItem.exit().remove();\n\n      // update existing items\n      legendItem.select('.legend-label').html(d => {\n        // return this.legendLabelFormat === null ? d.label : this.legendLabelFormat(d.label);\n        switch (this.legendLabelFormatType) {\n          case 'number':\n            return this.legendLabelFormat(d.key);\n\n          case 'time':\n            const parsedTime = d3_isoParse(d.key);\n            return this.legendLabelFormat(parsedTime);\n\n          default:\n            return d.key;\n        }\n      });\n\n      // legend items on enter\n      let enterLegendItem = legendItem\n        .enter()\n        .append('li')\n        .attr('class', 'legend-item');\n\n      enterLegendItem\n        .append('span')\n        .attr('class', 'legend-key')\n        .style('background-color', d => this.colorRange(d.index));\n\n      enterLegendItem\n        .append('span')\n        .attr('class', 'legend-label')\n        .html(d => {\n          // return this.legendLabelFormat === null ? d.label : this.legendLabelFormat(d.label);\n          switch (this.legendLabelFormatType) {\n            case 'number':\n              return this.legendLabelFormat(d.key);\n\n            case 'time':\n              const parsedTime = d3_isoParse(d.key);\n              return this.legendLabelFormat(parsedTime);\n\n            default:\n              return d.key;\n          }\n        });\n\n      enterLegendItem\n        .on('mouseover', (data, index, nodes) => this.legendMouseOver(d3_event, data, index, nodes))\n        .on('mouseout', () => this.legendMouseOut())\n        .on('click', (data, index, nodes) => this.legendMouseClick(d3_event, data, index, nodes));\n    }\n  };\n\n  barMouseOver = (event, data, index, nodes) => {\n    this.chart\n      .selectAll('.bar-group')\n      .selectAll('.bar')\n      .filter((d, i) => i !== index)\n      .classed('inactive', true);\n\n    this.tooltipShow(data, index, nodes[index]);\n\n    this.hovered.emit({ event, data });\n  };\n\n  barMouseOut = () => {\n    this.chart.selectAll('.bar').classed('inactive', false);\n\n    this.tooltipHide();\n  };\n\n  barMouseClick = (event, data, index, nodes) => {\n    this.clicked.emit({ event, data });\n  };\n\n  legendMouseOver = (event, data, index, nodes) => {\n    this.chart\n      .selectAll('.legend-item')\n      .filter((d, i) => i !== index)\n      .classed('inactive', true);\n\n    this.chart\n      .selectAll('.bar-group')\n      .filter((d, i) => i !== index)\n      .classed('inactive', true);\n\n    this.hovered.emit({ event, data });\n  };\n\n  legendMouseOut = () => {\n    this.chart.selectAll('.legend-item').classed('inactive', false);\n\n    this.chart.selectAll('.bar-group').classed('inactive', false);\n\n    this.tooltipHide();\n  };\n\n  legendMouseClick = (event, data, index, nodes) => {\n    this.clicked.emit({ event, data });\n  };\n\n  private xAxisFormatter = item => {\n    switch (this.xAxisFormatType) {\n      case 'number':\n        return this.xAxisFormat(item);\n\n      case 'time':\n        const parseDate = d3_isoParse(item);\n        return this.xAxisFormat(parseDate);\n\n      default:\n        return item;\n    }\n  };\n\n  private tooltipShow = (data, index, node) => {\n    // console.log('TOOLTIP: ', data, index, node);\n\n    const scroll = this._scroll.getScrollPosition();\n    const mouserectDimensions = node.getBoundingClientRect();\n    const clientWidth = document.body.clientWidth - 10;\n    let dimensionCalculated;\n    let tooltipDimensions;\n    let tooltipOffsetHeight;\n    let yPosition;\n    let xPosition;\n\n    // console.log(scroll, mouserectDimensions, tooltipOffsetHeight, tooltipDimensions, dimensionCalculated, clientWidth);\n\n    this.tooltip.select('.tooltip-header').html(d => {\n      switch (this.tooltipHeadingFormatType) {\n        case 'time':\n          const parseDate = d3_isoParse(data.key);\n          return this.tooltipHeadingFormat(parseDate);\n\n        default:\n          return data.key;\n      }\n    });\n\n    this.tooltip.select('.tooltip-header-value').html(d => {\n      let total = 0;\n\n      Object.keys(data).map(e => {\n        if (e !== 'key') {\n          total = total + data[e];\n        }\n      });\n\n      return this.tooltipHeadingValueFormat(total);\n    });\n\n    this.tooltip\n      .select('.tooltip-table')\n      .select('tbody')\n      .html(d => {\n        let html = ``;\n        let label;\n        let value;\n\n        Object.keys(data).map((key, index) => {\n          switch (this.tooltipLabelFormatType) {\n            case 'time':\n              const parseDate = d3_isoParse(key);\n              label = this.tooltipHeadingFormat(parseDate);\n              break;\n\n            default:\n              label = key;\n          }\n\n          switch (this.tooltipValueFormatType) {\n            case 'number':\n              value = this.tooltipValueFormat(data[key]);\n              break;\n\n            default:\n              value = data[key];\n          }\n\n          if (key !== 'key') {\n            html += `\n              <tr class='tooltip-item'>\n                <td style=\"color: ${this.colorRange(index - 1)}\">\n                  <span class=\"pbds-tooltip-key\"></span>\n                </td>\n                <td class=\"tooltip-label pr-2 text-nowrap\">${label}</td>\n                <td class=\"tooltip-value text-right text-nowrap\">${value}</td>\n              </tr>\n            `;\n          }\n        });\n\n        return html;\n      });\n\n    tooltipDimensions = this.tooltip.node().getBoundingClientRect();\n    dimensionCalculated = mouserectDimensions.left + mouserectDimensions.width + tooltipDimensions.width + 8;\n    tooltipOffsetHeight = +this.tooltip.node().offsetHeight;\n\n    // flip the tooltip positions if near the right edge of the screen\n    if (dimensionCalculated > clientWidth) {\n      this.tooltip.classed('east', true);\n      this.tooltip.classed('west', false);\n\n      if (this.type === 'medium') {\n        xPosition = `${mouserectDimensions.left + (mouserectDimensions.width / 8) * 3 - tooltipDimensions.width - 8}px`;\n      } else {\n        xPosition = `${mouserectDimensions.left + (mouserectDimensions.width / 4) * 1 - tooltipDimensions.width - 8}px`;\n      }\n    } else if (dimensionCalculated < clientWidth) {\n      this.tooltip.classed('east', false);\n      this.tooltip.classed('west', true);\n\n      if (this.type === 'medium') {\n        xPosition = `${mouserectDimensions.left + (mouserectDimensions.width / 8) * 5 + 8}px`;\n      } else {\n        xPosition = `${mouserectDimensions.left + (mouserectDimensions.width / 4) * 3 + 8}px`;\n      }\n    }\n\n    yPosition = this.svg\n      .selectAll('.bar-group')\n      .filter(':last-child')\n      .selectAll('.bar')\n      .filter((d, i) => i === index)\n      .node()\n      .getBoundingClientRect();\n\n    // set the tooltip styles\n    this.tooltip.style('top', `${yPosition.top - tooltipOffsetHeight / 2 + scroll[1]}px`);\n    this.tooltip.style('left', xPosition);\n    this.tooltip.style('opacity', 1);\n  };\n\n  private tooltipHide = () => {\n    this.tooltip.style('opacity', 0);\n  };\n\n  private yAxisFormatter = item => {\n    switch (this.yAxisFormatType) {\n      case 'number':\n        return this.yAxisFormat(item);\n\n      case 'time':\n        const parseDate = d3_isoParse(item);\n        return this.yAxisFormat(parseDate);\n\n      default:\n        return item;\n    }\n  };\n}\n","import { Component, OnInit, Input, HostBinding } from '@angular/core';\n\n@Component({\n  selector: 'pbds-dataviz-metric-indicator',\n  template: `\n    <span>{{ value }}</span>\n  `,\n  styles: []\n})\nexport class PbdsDatavizMetricIndicatorComponent implements OnInit {\n  @Input()\n  value = 0;\n\n  @Input()\n  class = '';\n\n  @Input()\n  indicator: 'flat' | 'increase' | 'decrease' = 'flat';\n\n  @Input()\n  inverse = false;\n\n  @HostBinding('class')\n  get hostClasses() {\n    return ['metric-block-indicator', this.indicator, this.inverse ? 'inverse' : '', this.class].join(' ');\n  }\n\n  constructor() {}\n\n  ngOnInit() {}\n}\n","import { Component, OnInit, Input, HostBinding, ElementRef, ContentChild } from '@angular/core';\n\nimport { PbdsDatavizMetricIndicatorComponent } from './dataviz-metric-indicator.component';\n\n@Component({\n  selector: 'pbds-dataviz-metric-block',\n  template: `\n    <ng-content select=\"pbds-dataviz-sparkline\"></ng-content>\n\n    <div class=\"metric-block-data\">\n      <div *ngIf=\"heading\" class=\"metric-block-heading\">{{ heading }}</div>\n\n      <div class=\"metric-block-value\" [ngClass]=\"{ 'mr-0': hideValueMargin }\">\n        {{ value\n        }}<span [ngClass]=\"{ 'metric-block-unit': isUnit, 'metric-block-percentage': isPercentUnit }\">{{ unit }}</span>\n      </div>\n\n      <ng-content select=\"pbds-dataviz-metric-indicator\"></ng-content>\n\n      <div *ngIf=\"description\" class=\"metric-block-description\">{{ description }}</div>\n    </div>\n  `,\n  styles: []\n})\nexport class PbdsDatavizMetricBlockComponent implements OnInit {\n  @Input()\n  class = '';\n\n  @Input()\n  heading: string = null;\n\n  @Input()\n  value = 0;\n\n  @Input()\n  unit: string = null;\n\n  @Input()\n  description: string = null;\n\n  @Input()\n  centered = false;\n\n  hideValueMargin = false;\n  isPercentUnit = false;\n  isUnit = false;\n\n  @HostBinding('class')\n  get hostClasses() {\n    return ['metric-block', this.centered ? 'metric-block-centered' : '', this.class].join(' ');\n  }\n\n  @ContentChild(PbdsDatavizMetricIndicatorComponent, { static: true }) indicatorRef: ElementRef;\n\n  constructor() {}\n\n  ngOnInit() {\n    if (!this.indicatorRef) {\n      this.hideValueMargin = true;\n    }\n\n    if (this.unit !== '%' && this.unit !== null) {\n      this.isUnit = true;\n    } else if (this.unit === '%') {\n      this.isPercentUnit = true;\n    }\n  }\n}\n","import {\n  Component,\n  OnInit,\n  OnChanges,\n  Input,\n  Output,\n  EventEmitter,\n  ElementRef,\n  HostBinding,\n  OnDestroy,\n  SimpleChanges,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { ViewportScroller } from '@angular/common';\n\nimport {\n  select as d3_select,\n  format as d3_format,\n  scaleLinear as d3_scaleLinear,\n  min as d3_min,\n  max as d3_max,\n  event as d3_event,\n  geoPath as d3_geoPath,\n  geoAlbers as d3_geoAlbers,\n  geoAlbersUsa as d3_geoAlbersUsa,\n  geoMercator as d3_geoMercator\n} from 'd3';\n\nimport * as topojson from 'topojson';\n\nimport { PbdsDatavizMapData } from './dataviz.interfaces';\n\n@Component({\n  selector: 'pbds-dataviz-bubble-map',\n  template: ``,\n  styles: [],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class DatavizBubbleMapComponent implements OnInit, OnChanges, OnDestroy {\n  @HostBinding('class.pbds-chart')\n  chartClass = true;\n\n  @HostBinding('class.pbds-chart-bubble-map')\n  bubbleMapClass = true;\n\n  @Input()\n  data: Array<PbdsDatavizMapData>;\n\n  @Input()\n  topojson;\n\n  @Input()\n  feature = '';\n\n  @Input()\n  projectionType;\n\n  @Input()\n  scale = null;\n\n  @Input()\n  center = null;\n\n  @Input()\n  width = 306;\n\n  @Input()\n  height = 400;\n\n  @Input()\n  type: 'medium' | 'high' | 'debug' = 'medium'; // debug to show all chart options\n\n  @Input()\n  dot = false;\n\n  @Input()\n  marginTop = 0;\n\n  @Input()\n  marginRight = 0;\n\n  @Input()\n  marginBottom = 0;\n\n  @Input()\n  marginLeft = 0;\n\n  @Input()\n  color = '#ef8200';\n\n  @Input()\n  textColor = '#fff';\n\n  @Input()\n  textSizeRange = [14, 24];\n\n  @Input()\n  dotSize = 4;\n\n  @Input()\n  bubbleSizeRange = [500, 2000];\n\n  @Input()\n  bubbleLabelFormatType: 'number' = null;\n\n  @Input()\n  bubbleLabelFormatString = '';\n\n  @Input()\n  hideTooltip = false;\n\n  @Input()\n  hideTooltipValue = false;\n\n  @Input()\n  tooltipValueFormatType: 'number' = null;\n\n  @Input()\n  tooltipValueFormatString = '';\n\n  @Output()\n  hovered: EventEmitter<object> = new EventEmitter<object>();\n\n  @Output()\n  clicked: EventEmitter<object> = new EventEmitter<object>();\n\n  private projection;\n  private geoPath;\n  private topojsonFeature;\n  private chart;\n  private svg;\n  private margin;\n  private bubbleContainer;\n  private bubbleRadius;\n  private fontRange;\n  private bubbleLabelFormat;\n  private tooltip;\n  private tooltipValueFormat;\n\n  constructor(private _element: ElementRef, private _scroll: ViewportScroller) {}\n\n  ngOnInit() {\n    this.margin = {\n      top: +this.marginTop,\n      right: +this.marginRight,\n      bottom: +this.marginBottom,\n      left: +this.marginLeft\n    };\n\n    if (this.type !== 'debug') {\n      // set type defaults\n      switch (this.type) {\n        case 'medium':\n          break;\n\n        case 'high':\n          break;\n      }\n    }\n\n    switch (this.projectionType) {\n      case 'geoAlbers':\n        this.projection = d3_geoAlbers();\n        break;\n\n      case 'geoAlbersUsa':\n        this.projection = d3_geoAlbersUsa();\n        break;\n\n      case 'geoMercator':\n        this.projection = d3_geoMercator();\n        break;\n\n      default:\n        break;\n    }\n\n    switch (this.bubbleLabelFormatType) {\n      case 'number':\n        this.bubbleLabelFormat = d3_format(this.bubbleLabelFormatString);\n        break;\n\n      default:\n        this.bubbleLabelFormat = null;\n        break;\n    }\n\n    switch (this.tooltipValueFormatType) {\n      case 'number':\n        this.tooltipValueFormat = d3_format(this.tooltipValueFormatString);\n        break;\n\n      default:\n        this.tooltipValueFormat = null;\n    }\n\n    // console.log('TOPOJSON: ', this.topojson);\n\n    this.topojsonFeature = topojson.feature(this.topojson, this.topojson.objects[this.feature]);\n    this.projection.fitSize([+this.width, +this.height], this.topojsonFeature);\n\n    // console.log('TOPOJSON FEATURE: ', this.topojsonFeature);\n    // console.log('MESH: ', topojson.mesh(this.topojson, this.topojson.objects[this.feature], (a, b) => a !== b));\n    // console.log('DATA: ', this.data);\n\n    if (this.scale) {\n      this.projection.scale(+this.scale);\n    }\n\n    if (this.center) {\n      this.projection.center(this.center);\n    }\n\n    this.geoPath = d3_geoPath().projection(this.projection);\n\n    // bubble radius range\n    if (this.data && !this.dot) {\n      this.bubbleRadius = d3_scaleLinear()\n        .range(this.bubbleSizeRange)\n        .domain([d3_min(this.data, (d: any) => +d.value), d3_max(this.data, (d: any) => +d.value)]);\n\n      // font range\n      this.fontRange = d3_scaleLinear()\n        .range(this.textSizeRange)\n        .domain([d3_min(this.data, (d: any) => +d.value), d3_max(this.data, (d: any) => +d.value)]);\n    }\n\n    // TOOLTIP\n    if (!this.hideTooltip) {\n      this.tooltip = d3_select('body')\n        .append('div')\n        .attr('class', 'pbds-tooltip south')\n        .style('opacity', 0)\n        .attr('aria-hidden', 'true'); // hide tooltip for accessibility\n\n      // tooltip header\n      this.tooltip.append('div').attr('class', 'tooltip-header');\n      if (!this.hideTooltipValue) this.tooltip.append('div').attr('class', 'tooltip-value');\n    }\n\n    // create the chart\n    this.chart = d3_select(this._element.nativeElement).attr('aria-hidden', 'true');\n\n    // create chart svg\n    this.svg = this.chart\n      .append('svg')\n      .attr('width', +this.width)\n      .attr('height', +this.height + this.margin.top + this.margin.bottom)\n      .attr('class', 'img-fluid')\n      .attr('preserveAspectRatio', 'xMinYMin meet')\n      .attr(\n        'viewBox',\n        `-${this.margin.left} -${this.margin.top} ${+this.width} ${+this.height + this.margin.top + this.margin.bottom}`\n      )\n      .append('g')\n      .attr('class', 'container');\n\n    // map\n    this.svg\n      .append('g')\n      .attr('class', 'map')\n      .selectAll('path')\n      .data(this.topojsonFeature.features)\n      .enter()\n      .append('path')\n      .attr('class', 'feature')\n      .attr('d', this.geoPath);\n\n    // borders\n    this.svg\n      .append('path')\n      .attr('class', 'mesh')\n      .datum(topojson.mesh(this.topojson, this.topojson.objects[this.feature], (a, b) => a !== b))\n      .attr('d', this.geoPath);\n\n    this.bubbleContainer = this.svg\n      .append('g')\n      .attr('class', 'dots')\n      .style('color', this.color);\n\n    this.updateChart();\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    if (changes.data && !changes.data.firstChange) {\n      this.updateChart();\n    }\n  }\n\n  ngOnDestroy() {\n    if (this.tooltip) this.tooltip.remove();\n  }\n\n  updateChart = () => {\n    // bubbles\n\n    this.bubbleContainer\n      .selectAll('circle')\n      .data(this.data)\n      .join(\n        enter =>\n          enter\n            .append('circle')\n            .attr('class', 'dot-circle')\n            .classed('solid', this.dot)\n            .attr('cx', d => this.projection([d.longitude, d.latitude])[0])\n            .attr('cy', d => this.projection([d.longitude, d.latitude])[1])\n            .attr('r', d => (!this.dot ? Math.sqrt(this.bubbleRadius(d.value)) : `${this.dotSize}px`)),\n        update =>\n          update\n            .transition()\n            .duration(1000)\n            .attr('cx', d => this.projection([d.longitude, d.latitude])[0])\n            .attr('cy', d => this.projection([d.longitude, d.latitude])[1])\n            .attr('r', d => (!this.dot ? Math.sqrt(this.bubbleRadius(d.value)) : `${this.dotSize}px`)),\n        exit => exit.remove()\n      );\n\n    if (!this.hideTooltip) {\n      this.bubbleContainer\n        .selectAll('circle')\n        .on('mouseover', (data, index, nodes) => this.bubbleMouseOver(d3_event, data, index, nodes))\n        .on('mouseout', (data, index, nodes) => this.bubbleMouseOut(d3_event, data, index, nodes))\n        .on('click', (data, index, nodes) => this.bubbleMouseClick(d3_event, data, index, nodes));\n\n      // bubble text\n      if (this.type !== 'high' && !this.dot) {\n        this.bubbleContainer\n          .selectAll('text')\n          .data(this.data)\n          .join(\n            enter =>\n              enter\n                .append('text')\n                .text(d => (this.bubbleLabelFormat ? this.bubbleLabelFormat(d.value) : d.value))\n                .attr('class', 'dot-text')\n                .style('fill', this.textColor)\n                .style('font-size', d => `${Math.round(this.fontRange(d.value))}px`)\n                .attr('x', d => this.projection([d.longitude, d.latitude])[0])\n                .attr('y', d => this.projection([d.longitude, d.latitude])[1])\n                .attr('dy', '.4em'),\n            update =>\n              update\n                .transition()\n                .duration(1000)\n                .text(d => (this.bubbleLabelFormat ? this.bubbleLabelFormat(d.value) : d.value))\n                .style('font-size', d => `${Math.round(this.fontRange(d.value))}px`)\n                .attr('x', d => this.projection([d.longitude, d.latitude])[0])\n                .attr('y', d => this.projection([d.longitude, d.latitude])[1])\n                .attr('dy', '.4em'),\n            exit => exit.remove()\n          );\n      }\n    }\n  };\n\n  bubbleMouseOver = (event, data, index, nodes) => {\n    this.chart\n      .selectAll('.dot-circle')\n      .filter((d, i) => i !== index)\n      .classed('inactive', true);\n\n    this.chart\n      .selectAll('.dot-circle')\n      .filter((d, i) => i === index)\n      .classed('active', true);\n\n    this.tooltipShow(data, nodes[index]);\n\n    this.hovered.emit({ event, data });\n  };\n\n  bubbleMouseOut = (event, data, index, nodes) => {\n    this.chart\n      .selectAll('.dot-circle')\n      .classed('active', false)\n      .classed('inactive', false);\n\n    this.tooltipHide();\n  };\n\n  bubbleMouseClick = (event, data, index, nodes) => {\n    this.clicked.emit({ event, data });\n  };\n\n  private tooltipShow = (data, node) => {\n    let dimensions = node.getBoundingClientRect();\n    let scroll = this._scroll.getScrollPosition();\n\n    this.tooltip.select('.tooltip-header').html(d => `${data.label}`);\n\n    if (!this.hideTooltipValue) {\n      this.tooltip\n        .select('.tooltip-value')\n        .html(d => (this.tooltipValueFormat ? `${this.tooltipValueFormat(data.value)}` : `${data.value}`));\n    }\n\n    let tooltipOffsetWidth = +this.tooltip.node().offsetWidth / 2;\n    let tooltipOffsetHeight = +this.tooltip.node().offsetHeight + 8;\n\n    this.tooltip.style('top', `${+scroll[1] + +dimensions.top - tooltipOffsetHeight}px`); //\n    this.tooltip.style('left', `${+scroll[0] + +dimensions.left - tooltipOffsetWidth + +dimensions.width / 2}px`);\n    this.tooltip.style('opacity', 1);\n  };\n\n  private tooltipHide = () => {\n    this.tooltip.style('opacity', 0);\n  };\n}\n","import {\n  Component,\n  OnInit,\n  OnChanges,\n  HostBinding,\n  Input,\n  Output,\n  ElementRef,\n  SimpleChanges,\n  EventEmitter,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { ViewportScroller } from '@angular/common';\n\nimport { PbdsDatavizHeatmap } from './dataviz.interfaces';\nimport { PbdsDatavizService } from './dataviz.service';\n\nimport {\n  select as d3_select,\n  isoParse as d3_isoParse,\n  timeFormat as d3_timeFormat,\n  format as d3_format,\n  scaleBand as d3_scaleBand,\n  scaleThreshold as d3_scaleThreshold,\n  scaleQuantile as d3_scaleQuantile,\n  scaleQuantize as d3_scaleQuantize,\n  min as d3_min,\n  max as d3_max,\n  axisBottom as d3_axisBottom,\n  axisLeft as d3_axisLeft,\n  event as d3_event\n} from 'd3';\n\n@Component({\n  selector: 'pbds-dataviz-heatmap',\n  template: ``,\n  styles: [],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class PbdsDatavizHeatmapComponent implements OnInit, OnChanges {\n  @HostBinding('class.pbds-chart')\n  chartClass = true;\n\n  @HostBinding('class.pbds-chart-heatmap')\n  heatmapClass = true;\n\n  @Input()\n  data: Array<PbdsDatavizHeatmap>;\n\n  @Input()\n  width = 306;\n\n  @Input()\n  height = 400;\n\n  @Input()\n  marginTop = 0; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  marginRight = 0; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  marginBottom = 30; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  marginLeft = 55;\n\n  @Input()\n  scale: 'threshold' | 'quantile' | 'quantize' = 'quantile';\n\n  @Input()\n  domain: Array<number>;\n\n  @Input()\n  xAxisFormatType: 'number' | 'time' = null;\n\n  @Input()\n  xAxisFormatString = '';\n\n  @Input()\n  yAxisFormatType: 'number' | 'time' = null;\n\n  @Input()\n  yAxisFormatString = '';\n\n  @Input()\n  hideLegend = false;\n\n  @Input()\n  legendWidth = 105 + 28; // hardcoded legend width + left margin, do not document until feedback\n\n  @Input()\n  legendPosition: 'right' | 'bottom' = 'right';\n\n  @Input()\n  legendLabelFormatType: 'number' = null;\n\n  @Input()\n  legendLabelFormatString = '';\n\n  @Input()\n  tooltipXLabelFormatType: 'number' | 'time' = null;\n\n  @Input()\n  tooltipXLabelFormatString = '';\n\n  @Input()\n  tooltipYLabelFormatType: 'number' | 'time' = null;\n\n  @Input()\n  tooltipYLabelFormatString = '';\n\n  @Input()\n  tooltipValueFormatType: 'number' = null;\n\n  @Input()\n  tooltipValueFormatString = '';\n\n  @Input()\n  theme: 'classic' | 'ocean' | 'sunset' | 'twilight' = 'classic';\n\n  @Output()\n  hovered: EventEmitter<object> = new EventEmitter<object>();\n\n  @Output()\n  clicked: EventEmitter<object> = new EventEmitter<object>();\n\n  private chart;\n  private svg;\n  private margin;\n  private colorRange;\n  private colorDomain;\n  private xAxisScale;\n  private xAxisCall;\n  private xAxis;\n  private xAxisFormat;\n  private xAxisTickSize: number;\n  private xAxisTickSizeOuter: number;\n  private hideXAxisDomain: boolean;\n  private hideXAxisZero: boolean;\n  private hideXAxisTicks: boolean;\n  private hideXAxis: boolean;\n  private yAxis;\n  private yAxisFormat;\n  private yAxisTickSize;\n  private yAxisTickSizeOuter;\n  private yAxisScale;\n  private yAxisCall;\n  private hideYAxis: boolean;\n  private hideYAxisDomain: boolean;\n  private hideYAxisZero: boolean;\n  private hideYAxisTicks: boolean;\n  private legendLabelFormat;\n  private tooltip;\n  private tooltipYLabelFormat;\n  private tooltipXLabelFormat;\n  private hideTooltip;\n  private tooltipValueFormat;\n\n  constructor(private _dataviz: PbdsDatavizService, private _element: ElementRef, private _scroll: ViewportScroller) {}\n\n  ngOnInit() {\n    this.margin = {\n      top: +this.marginTop,\n      right: +this.marginRight,\n      bottom: +this.marginBottom,\n      left: +this.marginLeft\n    };\n\n    switch (this.yAxisFormatType) {\n      case 'number':\n        this.yAxisFormat = d3_format(this.yAxisFormatString);\n        break;\n      case 'time':\n        this.yAxisFormat = d3_timeFormat(this.yAxisFormatString);\n        break;\n      default:\n        this.yAxisFormat = null;\n        break;\n    }\n\n    switch (this.xAxisFormatType) {\n      case 'number':\n        this.xAxisFormat = d3_format(this.xAxisFormatString);\n        break;\n      case 'time':\n        this.xAxisFormat = d3_timeFormat(this.xAxisFormatString);\n        break;\n      default:\n        this.xAxisFormat = null;\n        break;\n    }\n\n    switch (this.legendLabelFormatType) {\n      case 'number':\n        this.legendLabelFormat = d3_format(this.legendLabelFormatString);\n        break;\n      default:\n        this.legendLabelFormat = null;\n        break;\n    }\n\n    switch (this.tooltipYLabelFormatType) {\n      case 'number':\n        this.tooltipYLabelFormat = d3_format(this.tooltipYLabelFormatString);\n        break;\n      case 'time':\n        this.tooltipYLabelFormat = d3_timeFormat(this.tooltipYLabelFormatString);\n        break;\n      default:\n        this.tooltipYLabelFormat = null;\n        break;\n    }\n\n    switch (this.tooltipXLabelFormatType) {\n      case 'number':\n        this.tooltipXLabelFormat = d3_format(this.tooltipXLabelFormatString);\n        break;\n      case 'time':\n        this.tooltipXLabelFormat = d3_timeFormat(this.tooltipXLabelFormatString);\n        break;\n      default:\n        this.tooltipXLabelFormat = null;\n        break;\n    }\n\n    switch (this.tooltipValueFormatType) {\n      case 'number':\n        this.tooltipValueFormat = d3_format(this.tooltipValueFormatString);\n        break;\n      default:\n        this.tooltipValueFormat = null;\n    }\n\n    // defaults for all chart types\n    this.hideXAxis = false;\n    this.hideXAxisZero = false;\n    this.hideXAxisDomain = true;\n    this.hideYAxisDomain = true;\n    this.hideTooltip = false;\n    this.hideXAxisTicks = true;\n    this.hideYAxisTicks = true;\n    this.xAxisTickSize = 8;\n    this.xAxisTickSizeOuter = 0;\n    this.yAxisTickSize = 8;\n    this.yAxisTickSizeOuter = 0;\n\n    // create the chart\n    this.chart = d3_select(this._element.nativeElement).attr('aria-hidden', 'true');\n\n    // create chart svg\n    this.svg = this.chart\n      .append('svg')\n      .attr('width', +this.width)\n      .attr('height', +this.height + this.margin.top + this.margin.bottom)\n      .attr('class', 'img-fluid')\n      .attr('preserveAspectRatio', 'xMinYMin meet')\n      .attr(\n        'viewBox',\n        `-${this.margin.left} -${this.margin.top} ${+this.width} ${+this.height + this.margin.top + this.margin.bottom}`\n      );\n\n    // color range\n    const colors = this._dataviz\n      .getColors(true, this.theme)\n      .slice()\n      .reverse();\n\n    let colorDomain: any = [\n      +d3_min(this.data, (d: PbdsDatavizHeatmap) => d.value),\n      +d3_max(this.data, (d: PbdsDatavizHeatmap) => d.value)\n    ];\n    let colorValues = this.data.map(d => d.value);\n\n    switch (this.scale) {\n      case 'threshold':\n        this.colorRange = d3_scaleThreshold()\n          .domain(this.domain)\n          .range(colors);\n\n        this.colorDomain = this.colorRange.domain();\n        break;\n\n      case 'quantile':\n        this.colorRange = d3_scaleQuantile()\n          .domain(colorValues)\n          .range(colors);\n\n        this.colorDomain = this.colorRange.quantiles();\n        break;\n\n      case 'quantize':\n        this.colorRange = d3_scaleQuantize()\n          .domain(colorDomain)\n          .range(colors);\n\n        this.colorDomain = this.colorRange.thresholds();\n        break;\n    }\n\n    // console.log(colors, colorDomain, colorValues, this.scale, this.colorRange, this.colorDomain);\n\n    // define axis labels\n    const xAxisLabels: any = [...new Set(this.data.map(d => d.xLabel))];\n    const yAxisLabels: any = [...new Set(this.data.map(d => d.yLabel))].reverse();\n\n    // X axis\n    this.xAxisScale = d3_scaleBand()\n      .domain(xAxisLabels)\n      .rangeRound([0, this.width - this.margin.left])\n      .paddingInner(0.1);\n\n    this.xAxisCall = d3_axisBottom(this.xAxisScale)\n      .tickSize(this.xAxisTickSize)\n      .tickSizeOuter(this.xAxisTickSizeOuter)\n      .tickFormat(this.xAxisFormatter);\n\n    this.xAxis = this.svg\n      .append('g')\n      .attr('class', 'axis axis-x')\n      .attr('transform', `translate(0, ${this.height})`)\n      .classed('axis-hidden', this.hideXAxis)\n      .classed('axis-zero-hidden', this.hideXAxisZero)\n      .classed('axis-domain-hidden', this.hideXAxisDomain)\n      .classed('axis-ticks-hidden', this.hideXAxisTicks)\n      .call(this.xAxisCall);\n\n    // Y axis\n    this.yAxisScale = d3_scaleBand()\n      .domain(yAxisLabels)\n      .rangeRound([this.height, 0])\n      .paddingInner(0.1);\n\n    this.yAxisCall = d3_axisLeft(this.yAxisScale)\n      .tickSize(this.yAxisTickSize)\n      .tickSizeOuter(this.yAxisTickSizeOuter)\n      .tickFormat(this.yAxisFormatter);\n\n    this.yAxis = this.svg\n      .append('g')\n      .attr('class', 'axis axis-y')\n      .classed('axis-hidden', this.hideYAxis)\n      .classed('axis-zero-hidden', this.hideYAxisZero)\n      .classed('axis-domain-hidden', this.hideYAxisDomain)\n      .classed('axis-ticks-hidden', this.hideYAxisTicks)\n      .call(this.yAxisCall);\n\n    // TOOLTIP\n    if (!this.hideTooltip) {\n      this.tooltip = d3_select('body')\n        .append('div')\n        .attr('class', 'pbds-tooltip south')\n        .style('opacity', 0)\n        .attr('aria-hidden', 'true'); // hide tooltip for accessibility\n    }\n\n    // add legend classes\n    if (!this.hideLegend) {\n      this.chart.classed('pbds-chart-legend-bottom', this.legendPosition === 'bottom' ? true : false);\n      this.chart.append('ul').attr('class', `legend legend-${this.legendPosition}`);\n    }\n\n    this.updateChart();\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    if (changes.data && !changes.data.firstChange) {\n      this.updateChart();\n    }\n  }\n\n  updateChart = () => {\n    this.svg\n      .selectAll('rect')\n      .data(this.data)\n      .join(\n        enter =>\n          enter\n            .append('rect')\n            .attr('class', 'block')\n            .classed('empty', d => d.value === undefined || d.value === null)\n            .attr('x', d => this.xAxisScale(d.xLabel))\n            .attr('y', d => this.yAxisScale(d.yLabel))\n            .attr('width', this.xAxisScale.bandwidth())\n            .attr('height', this.yAxisScale.bandwidth())\n            .style('fill', d => this.colorRange(d.value)),\n        update =>\n          update.call(update => {\n            update\n              .classed('empty', d => d.value === undefined || d.value === null)\n              .transition()\n              .duration(1000)\n              .attr('x', d => this.xAxisScale(d.xLabel))\n              .attr('y', d => this.yAxisScale(d.yLabel))\n              .attr('width', this.xAxisScale.bandwidth())\n              .attr('height', this.yAxisScale.bandwidth())\n              .style('fill', d => this.colorRange(d.value));\n\n            return update;\n          }),\n        exit => exit.remove()\n      )\n      .on('mouseover', (data, index, nodes) => this.blockMouseOver(d3_event, data, index, nodes))\n      .on('mouseout', (data, index, nodes) => this.blockMouseOut())\n      .on('click', (data, index, nodes) => this.blockMouseClick(d3_event, data, index, nodes));\n\n    if (!this.hideLegend) {\n      this.chart\n        .select('.legend')\n        .selectAll('.legend-item')\n        .data(this.colorDomain)\n        .join(\n          enter => {\n            let li = enter.append('li').attr('class', 'legend-item');\n\n            li.append('span')\n              .attr('class', 'legend-key')\n              .style('background-color', d => this.colorRange(d));\n\n            li.append('span')\n              .attr('class', 'legend-label')\n              .html(d => {\n                let label: string = d;\n\n                switch (this.legendLabelFormatType) {\n                  case 'number':\n                    label = this.legendLabelFormat(d);\n                    break;\n                }\n\n                return `&ge; ${label}`;\n              });\n\n            return li;\n          },\n          update =>\n            update.select('.legend-label').html(d => {\n              let label: string = d;\n\n              switch (this.legendLabelFormatType) {\n                case 'number':\n                  label = this.legendLabelFormat(d);\n                  break;\n              }\n\n              return `&ge; ${label}`;\n            }),\n          exit => exit.remove()\n        )\n        .on('mouseover', (data, index, nodes) => this.legendMouseOver(d3_event, data, index, nodes))\n        .on('mouseout', () => this.legendMouseOut())\n        .on('click', (data, index, nodes) => this.legendMouseClick(d3_event, data, index, nodes));\n    }\n  };\n\n  blockMouseOver = (event, data, index, nodes) => {\n    // console.log(data.value, event, data, index, nodes);\n\n    if (data.value !== null) {\n      this.tooltipShow(data, index, nodes[index]);\n    }\n\n    this.hovered.emit({ event, data });\n  };\n\n  blockMouseOut = () => {\n    this.tooltipHide();\n  };\n\n  blockMouseClick = (event, data, index, nodes) => {\n    this.clicked.emit({ event, data });\n  };\n\n  legendMouseOver = (event, data, index, nodes) => {\n    this.chart\n      .selectAll('.legend-item')\n      .filter((d, i) => i !== index)\n      .classed('inactive', true);\n\n    this.chart\n      .selectAll('.block')\n      .filter((d, i) => {\n        if (index + 1 === nodes.length) {\n          return d.value < data;\n        } else {\n          return d.value < data || d.value >= +d3_select(nodes[index + 1]).data()[0];\n        }\n      })\n      .classed('inactive', true);\n\n    this.hovered.emit({ event, data });\n  };\n\n  legendMouseOut = () => {\n    this.chart.selectAll('.legend-item').classed('inactive', false);\n\n    this.chart.selectAll('.block').classed('inactive', false);\n  };\n\n  legendMouseClick = (event, data, index, nodes) => {\n    this.clicked.emit({ event, data });\n  };\n\n  private tooltipShow = (data, index, node) => {\n    // console.log('TOOLTIP: ', data, index, node);\n\n    let dimensions = node.getBoundingClientRect();\n    let scroll = this._scroll.getScrollPosition();\n    let yLabel;\n    let xLabel;\n\n    switch (this.tooltipYLabelFormatType) {\n      case 'number':\n        yLabel = this.tooltipYLabelFormat(data.yLabel);\n        break;\n\n      case 'time':\n        const parsedTime = d3_isoParse(data.yLabel);\n        yLabel = this.tooltipYLabelFormat(parsedTime);\n        break;\n\n      default:\n        yLabel = `${data.yLabel}${this.tooltipYLabelFormatString}`;\n    }\n\n    switch (this.tooltipXLabelFormatType) {\n      case 'number':\n        xLabel = this.tooltipXLabelFormat(data.xLabel);\n        break;\n\n      case 'time':\n        const parsedTime = d3_isoParse(data.xLabel);\n        xLabel = this.tooltipXLabelFormat(parsedTime);\n        break;\n\n      default:\n        xLabel = `${data.xLabel}${this.tooltipXLabelFormatString}`;\n    }\n\n    let value =\n      this.tooltipValueFormat === null\n        ? `<div class=\"tooltip-value\">${data.value}</div>`\n        : `<div class=\"tooltip-value\">${this.tooltipValueFormat(data.value)}</div>`;\n\n    this.tooltip.html(\n      `\n        ${yLabel} : ${xLabel}<br>\n        ${value}\n      `\n    );\n\n    let tooltipOffsetWidth = +this.tooltip.node().offsetWidth / 2;\n    let tooltipOffsetHeight = +this.tooltip.node().offsetHeight + 8;\n\n    this.tooltip.style('top', `${+scroll[1] + +dimensions.top - tooltipOffsetHeight}px`); //\n    this.tooltip.style('left', `${+scroll[0] + +dimensions.left - tooltipOffsetWidth + +dimensions.width / 2}px`);\n    this.tooltip.style('opacity', 1);\n\n    this.tooltip.style('opacity', 1);\n  };\n\n  private tooltipHide = () => {\n    this.tooltip.style('opacity', 0);\n  };\n\n  private xAxisFormatter = item => {\n    switch (this.xAxisFormatType) {\n      case 'number':\n        return this.xAxisFormat(item);\n\n      case 'time':\n        const parseDate = d3_isoParse(item);\n        return this.xAxisFormat(parseDate);\n\n      default:\n        return item;\n    }\n  };\n\n  private yAxisFormatter = item => {\n    switch (this.yAxisFormatType) {\n      case 'number':\n        return this.yAxisFormat(item);\n\n      case 'time':\n        const parseDate = d3_isoParse(item);\n        return this.yAxisFormat(parseDate);\n\n      default:\n        return item;\n    }\n  };\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { PbdsDatavizPieComponent } from './dataviz-pie.component';\nimport { PbdsDatavizBarComponent } from './dataviz-bar.component';\nimport { PbdsDatavizLineComponent } from './dataviz-line.component';\nimport { PbdsDatavizGaugeComponent } from './dataviz-gauge.component';\nimport { PbdsDatavizSparklineComponent } from './dataviz-sparkline.component';\nimport { PbdsDatavizStackedBarComponent } from './dataviz-stacked-bar.component';\nimport { PbdsDatavizMetricBlockComponent } from './dataviz-metric-block.component';\nimport { PbdsDatavizMetricIndicatorComponent } from './dataviz-metric-indicator.component';\nimport { DatavizBubbleMapComponent } from './dataviz-bubble-map.component';\nimport { PbdsDatavizHeatmapComponent } from './dataviz-heatmap.component';\n\n@NgModule({\n  declarations: [\n    PbdsDatavizPieComponent,\n    PbdsDatavizBarComponent,\n    PbdsDatavizLineComponent,\n    PbdsDatavizGaugeComponent,\n    PbdsDatavizSparklineComponent,\n    PbdsDatavizStackedBarComponent,\n    PbdsDatavizMetricBlockComponent,\n    DatavizBubbleMapComponent,\n    PbdsDatavizMetricIndicatorComponent,\n    PbdsDatavizHeatmapComponent\n  ],\n  imports: [CommonModule],\n  exports: [\n    PbdsDatavizPieComponent,\n    PbdsDatavizBarComponent,\n    PbdsDatavizLineComponent,\n    PbdsDatavizGaugeComponent,\n    PbdsDatavizSparklineComponent,\n    PbdsDatavizStackedBarComponent,\n    PbdsDatavizMetricBlockComponent,\n    DatavizBubbleMapComponent,\n    PbdsDatavizMetricIndicatorComponent,\n    PbdsDatavizHeatmapComponent\n  ]\n})\nexport class PbdsDatavizModule {}\n","import { Directive, HostListener, HostBinding } from '@angular/core';\nimport { ViewportScroller } from '@angular/common';\n\n@Directive({\n  selector: 'header.bg-brand-header'\n})\nexport class PbdsHeaderShadowDirective {\n  @HostBinding('class.pbds-header-shadow')\n  shadow: boolean;\n\n  @HostListener('window:scroll', []) onWindowScroll() {\n    const offset = this._scroll.getScrollPosition();\n    this.shadow = offset[1] > 20;\n  }\n\n  constructor(private _scroll: ViewportScroller) {}\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { PbdsHeaderShadowDirective } from './header-shadow.directive';\n\n@NgModule({\n  declarations: [PbdsHeaderShadowDirective],\n  imports: [CommonModule],\n  exports: [PbdsHeaderShadowDirective]\n})\nexport class PbdsHeaderShadowModule {}\n"]}