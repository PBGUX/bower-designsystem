{"version":3,"sources":["../../../projects/pb-design-system/dataviz/dataviz.service.ts","../../../projects/pb-design-system/dataviz/dataviz-pie.component.ts","../../../projects/pb-design-system/dataviz/dataviz-bar.component.ts","../../../projects/pb-design-system/dataviz/dataviz-line.component.ts","../../../projects/pb-design-system/dataviz/dataviz-gauge.component.ts","../../../projects/pb-design-system/dataviz/dataviz-sparkline.component.ts","../../../projects/pb-design-system/dataviz/dataviz-bar-stacked.component.ts","../../../projects/pb-design-system/dataviz/dataviz-metric-indicator.component.ts","../../../projects/pb-design-system/dataviz/dataviz-metric-block.component.ts","../../../projects/pb-design-system/dataviz/dataviz-bubble-map.component.ts","../../../node_modules/tslib/tslib.es6.js","../../../projects/pb-design-system/dataviz/dataviz-heatmap.component.ts","../../../projects/pb-design-system/dataviz/dataviz-choropleth-map.component.ts","../../../projects/pb-design-system/dataviz/dataviz-bar-grouped.component.ts","../../../projects/pb-design-system/dataviz/dataviz-bar-single-horizontal.component.ts","../../../projects/pb-design-system/dataviz/dataviz.module.ts"],"names":["PbdsDatavizService","_this","this","colors","classic","full","mono","twilight","ocean","sunset","getColors","theme","createGradientDefs","svg","vertical","i","length","color","gradient","append","attr","replace","createGlowFilter","glow","feOffsets","dy","slope","y","merge","x","prototype","d3Format","type","string","format","d3_format","d3_timeFormat","Injectable","args","providedIn","PbdsDatavizPieComponent","_dataviz","_element","chartClass","pieClass","width","monochrome","legendLabelFormatType","legendLabelFormatString","legendValueFormatString","tooltipLabelFormatType","tooltipLabelFormatString","tooltipValueFormatString","hovered","EventEmitter","clicked","currentData","updateChart","firstRun","selectAll","data","pie","join","enter","path","each","d","outerRadius","colorRange","label","nodes","splice","style","call","transition","delay","duration","n","attrTween","arcEnterTween","update","tooltipHide","arcUpdateTween","exit","remove","on","event","pathMouseOver","tooltipShow","tooltipMove","chart","node","pathMouseOut","pathClick","select","li","description","html","parsedTime","d3_isoParse","legendLabelFormat","legendValueFormat","value","datum","index","legendMouseOverFocus","legendMouseOutBlur","emit","d3_interpolate","startAngle","endAngle","t","arc","interpolate","arcMouseOverTween","arcZoom","arcMouseOutTween","filter","classed","slices","slice","tooltipSetPosition","percentage","Math","PI","tooltipLabelFormat","tooltip","tooltipValueFormat","coordinates","d3_pointer","ngOnInit","margin","top","right","bottom","left","height","innerRadius","min","anglePad","d3_scaleOrdinal","range","domain","map","c","d3_pie","padAngle","sort","d3_arc","padRadius","d3_select","nativeElement","ngOnChanges","changes","firstChange","ngOnDestroy","Component","selector","template","changeDetection","ChangeDetectionStrategy","OnPush","ElementRef","HostBinding","Input","Output","PbdsDatavizBarComponent","_scroll","_location","barClass","singleSeries","xAxisFormatType","xAxisFormatString","xAxisTitle","yAxisFormatType","yAxisFormatString","yAxisTicks","yAxisMinBuffer","yAxisMaxBuffer","hideLegend","legendWidth","legendPosition","tooltipValueFormatType","marginTop","marginRight","marginBottom","marginLeft","threshold","thresholdLabel","average","averageLabel","xAxisScale","yAxisScale","d3_min","d3_max","rangeRound","nice","xAxis","xAxisCall","yAxis","yAxisCall","hideXGrid","xGrid","xGridCall","hideYGrid","yGrid","yGridCall","hideGrayBars","substr","bandwidth","selection","barMouseOver","barMouseOut","barMouseClick","insert","legendMouseOver","legendMouseOut","legendMouseClick","yThreshold","raise","yAverage","bar","barColor","scroll","getScrollPosition","dimensions","currentTarget","getBoundingClientRect","hideTooltipLabel","tooltipOffsetWidth","offsetWidth","tooltipOffsetHeight","offsetHeight","xAxisFormatter","item","xAxisFormat","parseDate","yAxisFormatter","yAxisFormat","hideXAxis","hideYAxis","hideXAxisZero","hideYAxisZero","hideXAxisDomain","hideYAxisDomain","hideTooltip","hideXAxisTicks","hideYAxisTicks","xAxisTickSize","xAxisTickSizeOuter","xAxisTitleMargin","yAxisTickSize","yAxisTickSizeOuter","d3_scaleBand","align","paddingInner","paddingOuter","d3_axisBottom","tickSize","tickSizeOuter","tickFormat","text","d3_scaleLinear","d3_axisLeft","ticks","ViewportScroller","Location","nextId","PbdsDatavizLineComponent","lineClass","area","xAxisTicks","tooltipHeadingFormatString","tooltipHovered","tooltipClicked","mouserect","d3_extent","dates","series","minVal","values","maxVal","clipPathId","lineWidth","array","Array","fill","d3line","ease","d3_easeQuadInOut","d3area","linePoints","tooltipItem","mouserectMouseMove","mouseXDate","invert","leftIndex","d3_bisectLeft","d3_isoFormat","dateLower","Date","dateUpper","closestDate","closestIndex","indexOf","circles","tooltipLine","mousedata","date","mouserectMouseOut","mouserectMouseClick","position","mouserectDimensions","tooltipDimensions","dimensionCalculated","clientWidth","document","body","tooltipHeadingFormat","lineCurved","d3_line","curve","d3_curveCatmullRom","alpha","d3_area","y0","y1","d3_scaleTime","PbdsDatavizGaugeComponent","gaugeClass","hideLabel","labelFormatString","gaugeWidth","degreesToRadians","degree","calculateMinMax","minvalue","maxvalue","calculateCurve","start","drawChart","gauge","radius","arcTween","labelTween","textTween","newAngle","tween","oldValue","updatedNumber","labelFormat","max","rounded","cornerRadius","previousValue","PbdsDatavizSparklineComponent","sparklineClass","colorNegative","strokeWidth","line","barWidth_1","abs","PbdsDatavizBarStackedComponent","stackedBarClass","tooltipHeadingFormatType","tooltipHeadingValueFormatType","tooltipHeadingValueFormatString","dataKeys","Object","keys","dataStack","d3_stack","order","d3_stackOrderNone","key","yAxisMax","grayBars","bars","mouseBars","yPosition","xPosition","total","e","tooltipHeadingValueFormat","PbdsDatavizMetricIndicatorComponent","class","indicator","inverse","defineProperty","PbdsDatavizMetricBlockComponent","heading","unit","centered","centeredText","infoMessage","hideValueMargin","isPercentUnit","isUnit","indicatorRef","ContentChild","static","PbdsDatavizBubbleMapComponent","bubbleMapClass","feature","scale","center","dot","textColor","textSizeRange","dotSize","bubbleSizeRange","bubbleLabelFormatType","bubbleLabelFormatString","hideTooltipValue","bubbleContainer","projection","longitude","latitude","sqrt","bubbleRadius","bubbleMouseOver","bubbleMouseOut","bubbleMouseClick","bubbleLabelFormat","round","fontRange","projectionType","d3_geoAlbers","d3_geoAlbersUsa","d3_geoMercator","topojsonFeature","topojson.feature","topojson","objects","fitSize","geoPath","d3_geoPath","features","topojson.mesh","a","b","create","__read","o","m","Symbol","iterator","r","ar","next","done","push","error","__spread","arguments","concat","PbdsDatavizHeatmapComponent","heatmapClass","tooltipXLabelFormatType","tooltipXLabelFormatString","tooltipYLabelFormatType","tooltipYLabelFormatString","undefined","xLabel","yLabel","blockMouseOver","blockMouseOut","blockMouseClick","colorDomain","legendItems","hoveredIndex","nextNodeData","tooltipYLabelFormat","tooltipXLabelFormat","reverse","colorValues","d3_scaleThreshold","d3_scaleQuantile","quantiles","d3_scaleQuantize","thresholds","xAxisLabels","Set","yAxisLabels","PbdsDatavizChoroplethMapComponent","choroplethMapClass","dataField","mesh","colorScale","legendLabel","legendValueFormatType","legendLeft","legendTop","match","find","obj","some","featureMouseOver","featureMouseOut","featureMouseClick","mouse","mouseLeft","mouseTop","geometry","geometryLeft","geometryTop","scrollTop","legend","g","tickValues","d3_range","PbdsDatavizBarGroupedComponent","groupedBarClass","xAxisMaxBuffer","showGrid","clone","assign","barScale","updateChartVertical","xAxisMax","updateChartHorizontal","selectChildren","parentIndex","updateLegend","legendData","legendKeys","PbdsDatavizBarSingleHorizontalComponent","singleStackedBarClass","nullValueText","barMargin","xAxisTickLabelSuffix","hideLegendTooltip","tooltipDateFormatString","tooltipValueSuffix","tooltipPercentFormatString","compareChangeFormatString","isSingleData","isCompare","barPadding","d3_sum","comparePercentage","compareValue","tooltipLabel","tooltipCompareDaterangeMargin","tooltipCompareDaterange","tooltipCompareValue","tooltipDaterangeMargin","tooltipDaterange","tooltipValue","tooltipIndicator","compareStartDate","compareEndDate","tooltipDateFormat","tooltipPercentFormat","comparveValue","startDate","endDate","compareChangeDirection","compareChangeInverse","tooltipCompareChangeFormat","compareChangeValue","barHover","includes","ceil","sumValues","isLastBarZero","lastBarZeroCount","cloneData","isLast","forEach","Number","isInteger","reduce","acc","d3_easeLinear","sign","NgModule","declarations","imports","CommonModule","NgbTooltipModule","exports"],"mappings":"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","sourcesContent":["import { Injectable } from '@angular/core';\n\nimport { format as d3_format, timeFormat as d3_timeFormat } from 'd3';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class PbdsDatavizService {\n  private colors = {\n    classic: {\n      full: [\n        '#B70077',\n        '#0384D4',\n        '#EE6B0B',\n        '#A319B1',\n        '#11A611',\n        '#1BB9FF',\n        '#495A9C',\n        '#EDB700',\n        '#8B98C8',\n        '#E6C49C',\n        '#CCB8CE',\n        '#9B9B9B'\n      ],\n      mono: ['#001D56', '#003296', '#4B74C5', '#89A1D0', '#A3BCEE', '#C9D7F3'] // blue\n    },\n    twilight: {\n      full: [\n        '#A319B1',\n        '#11A611',\n        '#1BB9FF',\n        '#EE6B0B',\n        '#B70077',\n        '#0384D4',\n        '#495A9C',\n        '#EDB700',\n        '#8B98C8',\n        '#E6C49C',\n        '#CCB8CE',\n        '#9B9B9B'\n      ],\n      mono: ['#05395C', '#0A5B92', '#0072B8', '#5DA9DC', '#A5D4F3', '#D1EDFF'] // light blue\n    },\n    ocean: {\n      full: [\n        '#0384D4',\n        '#B70077',\n        '#1BB9FF',\n        '#495A9C',\n        '#EDB700',\n        '#A319B1',\n        '#EE6B0B',\n        '#11A611',\n        '#8B98C8',\n        '#E6C49C',\n        '#CCB8CE',\n        '#9B9B9B'\n      ],\n      mono: ['#394B4D', '#3A6B6E', '#14767D', '#99BFC2', '#C9E6E8', '#DEECED'] // blue-green\n    },\n    sunset: {\n      full: [\n        '#B70077',\n        '#EE6B0B',\n        '#1BB9FF',\n        '#EDB700',\n        '#11A611',\n        '#A319B1',\n        '#0384D4',\n        '#CCB8CE',\n        '#495A9C',\n        '#E6C49C',\n        '#8B98C8',\n        '#9B9B9B'\n      ],\n      mono: ['#31254A', '#50248F', '#7945C4', '#9A79E2', '#C4A8FF', '#D9C7FF'] // purple\n    }\n  };\n\n  constructor() {}\n\n  getColors = (mono = false, theme = 'classic') => {\n    return mono ? this.colors[theme].mono : this.colors[theme].full;\n  };\n\n  createGradientDefs = (svg, mono = false, theme = 'classic', vertical = true) => {\n    const colors = mono ? [this.colors[theme].mono[2]] : this.colors[theme].full;\n\n    for (let i = 0; i < colors.length; i++) {\n      const color = mono ? this.colors[theme].mono[2] : this.colors[theme].full[i];\n      let gradient;\n\n      if (vertical) {\n        gradient = svg\n          .append('defs')\n          .append('linearGradient')\n          .attr('id', `gradient-${color.replace('#', '')}`)\n          .attr('x1', '0')\n          .attr('y1', '0')\n          .attr('x2', '0')\n          .attr('y2', '1')\n          .attr('spreadMethod', 'pad');\n\n        gradient\n          .append('stop')\n          .attr('offset', '0%')\n          .attr('stop-color', color)\n          .attr('stop-opacity', '1'); // top of bar will be full opacity\n\n        gradient\n          .append('stop')\n          .attr('offset', '100%')\n          .attr('stop-color', color)\n          .attr('stop-opacity', '.3'); // bottom of bar will be .3 opacity\n      } else {\n        gradient = svg\n          .append('defs')\n          .append('linearGradient')\n          .attr('id', `gradient-horizontal-${color.replace('#', '')}`)\n          .attr('x1', '1')\n          .attr('y1', '0')\n          .attr('x2', '0')\n          .attr('y2', '0')\n          .attr('spreadMethod', 'pad');\n\n        gradient\n          .append('stop')\n          .attr('offset', '0%')\n          .attr('stop-color', color)\n          .attr('stop-opacity', '1'); // top of bar will be full opacity\n\n        gradient\n          .append('stop')\n          .attr('offset', '100%')\n          .attr('stop-color', color)\n          .attr('stop-opacity', '.3'); // bottom of bar will be .3 opacity\n      }\n    }\n\n    return colors;\n  };\n\n  createGlowFilter = svg => {\n    // add a new definition\n    const glow = svg\n      .append('defs')\n      .append('filter')\n      .attr('id', 'glow')\n      .attr('width', '200%')\n      .attr('height', '200%');\n\n    glow\n      .append('feGaussianBlur')\n      .attr('in', 'SourceGraphic')\n      .attr('stdDeviation', 4);\n\n    // build two dropshadows with different intensities\n    const feOffsets = [\n      {\n        dy: 2,\n        slope: 0.2\n      },\n      {\n        dy: 5,\n        slope: 0.05\n      }\n    ];\n\n    for (let i = 0; i < feOffsets.length; i++) {\n      glow\n        .append('feOffset')\n        .attr('result', 'offsetBlur' + i)\n        .attr('dx', 0)\n        .attr('dy', feOffsets[i].dy);\n    }\n\n    for (let y = 0; y < feOffsets.length; y++) {\n      glow\n        .append('feComponentTransfer')\n        .attr('result', 'coloredBlur' + y)\n        .attr('in', 'offsetBlur' + y)\n        .append('feFuncA')\n        .attr('type', 'linear')\n        .attr('slope', feOffsets[y].slope);\n    }\n\n    const merge = glow.append('feMerge');\n\n    merge.append('feMergeNode').attr('in', 'SourceGraphic');\n\n    for (let x = 0; x < feOffsets.length; x++) {\n      merge.append('feMergeNode').attr('in', 'coloredBlur' + x);\n    }\n  };\n\n  d3Format(type: string, string: string) {\n    let format;\n\n    switch (type) {\n      case 'number':\n        format = d3_format(string);\n        break;\n      case 'time':\n        format = d3_timeFormat(string);\n        break;\n      default:\n        format = null;\n        break;\n    }\n\n    return format;\n  }\n}\n","import {\n  Component,\n  OnInit,\n  Input,\n  ElementRef,\n  HostBinding,\n  OnChanges,\n  SimpleChanges,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  OnDestroy\n} from '@angular/core';\n\nimport { select as d3_select, pointer as d3_pointer } from 'd3-selection';\nimport { scaleOrdinal as d3_scaleOrdinal } from 'd3-scale';\nimport { pie as d3_pie, arc as d3_arc } from 'd3-shape';\nimport { interpolate as d3_interpolate } from 'd3-interpolate';\nimport { format as d3_format } from 'd3-format';\nimport { isoParse as d3_isoParse } from 'd3-time-format';\n\nimport { PbdsDatavizService } from './dataviz.service';\nimport { PbdsDatavizPie } from './dataviz.interfaces';\n\n@Component({\n  selector: 'pbds-dataviz-pie',\n  template: ``,\n  styleUrls: [],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class PbdsDatavizPieComponent implements OnInit, OnChanges, OnDestroy {\n  @HostBinding('class.pbds-chart')\n  chartClass = true;\n\n  @HostBinding('class.pbds-chart-pie')\n  pieClass = true;\n\n  @Input()\n  data: Array<PbdsDatavizPie>;\n\n  @Input()\n  width = 300;\n\n  @Input()\n  type: 'pie' | 'donut' = 'pie';\n\n  @Input()\n  monochrome = false;\n\n  @Input()\n  legendLabelFormatType: 'time' = null;\n\n  @Input()\n  legendLabelFormatString = '';\n\n  @Input()\n  legendValueFormatString = '';\n\n  @Input()\n  tooltipLabelFormatType: 'time' = null;\n\n  @Input()\n  tooltipLabelFormatString = '';\n\n  @Input()\n  tooltipValueFormatString = '';\n\n  @Input()\n  theme;\n\n  @Output()\n  hovered: EventEmitter<any> = new EventEmitter<any>();\n\n  @Output()\n  clicked: EventEmitter<any> = new EventEmitter<any>();\n\n  private currentData = [];\n  private height;\n  private chart;\n  private margin;\n  private colors;\n  private colorRange;\n  private arc;\n  private arcZoom;\n  private svg;\n  private pie;\n  private legendLabelFormat;\n  private legendValueFormat;\n  private innerRadius;\n  private anglePad;\n  private outerRadius;\n  private tooltip;\n  private tooltipLabelFormat;\n  private tooltipValueFormat;\n\n  constructor(private _dataviz: PbdsDatavizService, private _element: ElementRef) {}\n\n  ngOnInit() {\n    this.margin = { top: 10, right: 10, bottom: 10, left: 10 };\n    this.width = this.width - this.margin.left - this.margin.right;\n    this.height = this.width - this.margin.top - this.margin.bottom;\n    this.colors = this._dataviz.getColors(this.monochrome, this.theme);\n    this.innerRadius = Math.min(this.width, this.height) / 2.5;\n    this.outerRadius = Math.min(this.width, this.height) / 2;\n    this.arcZoom = 10;\n    this.anglePad = 0.02;\n    this.legendValueFormat = d3_format(this.legendValueFormatString);\n    this.tooltipValueFormat = d3_format(this.tooltipValueFormatString);\n\n    // create formatters\n    this.legendLabelFormat = this._dataviz.d3Format(this.legendLabelFormatType, this.legendLabelFormatString);\n    this.tooltipLabelFormat = this._dataviz.d3Format(this.tooltipLabelFormatType, this.tooltipLabelFormatString);\n\n    this.colorRange = d3_scaleOrdinal()\n      .range(this.colors)\n      .domain(this.data.map((c) => c.label));\n\n    if (this.type === 'pie') {\n      this.innerRadius = 0;\n      this.anglePad = 0;\n    }\n\n    this.pie = d3_pie()\n      .padAngle(this.anglePad)\n      .value((d: any) => d.value)\n      .sort(null);\n\n    this.arc = d3_arc().padRadius(this.outerRadius).innerRadius(this.innerRadius);\n\n    this.chart = d3_select(this._element.nativeElement).attr('aria-hidden', 'true');\n\n    this.svg = this.chart\n      .append('svg')\n      .attr('width', this.width)\n      .attr('height', this.height)\n      .attr('class', 'img-fluid')\n      .attr('preserveAspectRatio', 'xMinYMin meet')\n      .attr(\n        'viewBox',\n        `-${this.width / 2 + this.margin.left} -${this.height / 2 + this.margin.top} ${\n          this.width + this.margin.left + this.margin.right\n        } ${this.height + this.margin.top + this.margin.bottom}`\n      );\n\n    this.chart.append('ul').attr('class', 'legend legend-right');\n\n    this.tooltip = this.chart\n      .append('div')\n      .style('opacity', 0)\n      .attr('class', 'pbds-tooltip')\n      .attr('aria-hidden', 'true');\n\n    this.updateChart();\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    if (changes.data && !changes.data.firstChange) {\n      this.updateChart(false);\n    }\n  }\n\n  ngOnDestroy() {\n    if (this.tooltip) this.tooltip.remove();\n  }\n\n  updateChart = (firstRun = true) => {\n    // slices\n    this.svg\n      .selectAll('path')\n      .data(this.pie(this.data))\n      .join(\n        (enter) => {\n          const path = enter.append('path');\n\n          path\n            .each((d: any) => (d.outerRadius = this.outerRadius))\n            .attr('fill', (d: any) => this.colorRange(d.data.label))\n            .attr('class', 'slice')\n            .each((d, i, nodes) => {\n              // save the current data to be used in arc update tween\n              this.currentData.splice(i, 1, d);\n            });\n\n          if (this.type === 'pie') {\n            path.style('stroke', '#fff').style('stroke-width', 2).style('stroke-alignment', 'inner');\n          }\n\n          path.call((path) =>\n            path\n              .transition()\n              .delay(500)\n              .duration((d, i, n) => (firstRun ? 0 : 500))\n              .attrTween('d', this.arcEnterTween)\n          );\n\n          return path;\n        },\n        (update) => {\n          this.tooltipHide();\n\n          update.each((d: any) => {\n            return (d.outerRadius = this.outerRadius);\n          });\n\n          update.transition().duration(500).attrTween('d', this.arcUpdateTween);\n\n          return update;\n        },\n        (exit) => exit.remove()\n      )\n      .on('mouseover', (event, data) => {\n        this.pathMouseOver(event, data);\n        this.tooltipShow(event, data);\n      })\n      .on('mousemove', (event, data) => {\n        this.tooltipShow(event, data);\n        // this.tooltipMove(event, data);\n        this.tooltipMove(event, this.chart.node());\n      })\n      .on('mouseout', (event, data) => {\n        this.pathMouseOut(event, data);\n        this.tooltipHide();\n      })\n      .on('click', (event, data) => {\n        this.pathClick(event, data);\n      });\n\n    // legend\n    this.chart\n      .select('.legend')\n      .selectAll('.legend-item')\n      .data(this.data)\n      .join(\n        (enter) => {\n          const li = enter.append('li').attr('class', 'legend-item');\n\n          li.append('span')\n            .attr('class', 'legend-key')\n            .style('background-color', (d: any) => this.colorRange(d.label));\n\n          const description = li.append('span').attr('class', 'legend-description');\n\n          description\n            .append('span')\n            .attr('class', 'legend-label')\n            .html((d: any) => {\n              switch (this.legendLabelFormatType) {\n                case 'time':\n                  const parsedTime = d3_isoParse(d.label);\n                  return this.legendLabelFormat(parsedTime);\n\n                default:\n                  return d.label;\n              }\n            });\n\n          description\n            .append('span')\n            .attr('class', 'legend-value')\n            .html((d: any) => this.legendValueFormat(d.value));\n\n          return li;\n        },\n        (update) => {\n          update.selectAll('.legend-key').style('background-color', (d: any) => this.colorRange(d.label));\n\n          update.select('.legend-label').html((d: any) => {\n            switch (this.legendLabelFormatType) {\n              case 'time':\n                const parsedTime = d3_isoParse(d.label);\n                return this.legendLabelFormat(parsedTime);\n\n              default:\n                return d.label;\n            }\n          });\n\n          update.select('.legend-value').html((d: any) => this.legendValueFormat(d.value));\n\n          return update;\n        },\n        (exit) => exit.remove()\n      )\n      .datum((d, i) => {\n        return { data: d, index: i };\n      })\n      .on('mouseover focus', (event, data) => {\n        this.legendMouseOverFocus(event, data);\n        this.pathMouseOver(event, data);\n      })\n      .on('mouseout blur', (event, data) => {\n        this.legendMouseOutBlur(event, data);\n        this.pathMouseOut(event, data);\n      })\n      .on('click', (event, data) => {\n        this.clicked.emit({ event: event, data: data.data });\n      });\n  };\n\n  private arcEnterTween = (data) => {\n    const i = d3_interpolate(data.startAngle, data.endAngle);\n    return (t) => {\n      data.endAngle = i(t);\n      return this.arc(data);\n    };\n  };\n\n  // see https://bl.ocks.org/HarryStevens/e1acaf628b1693f1b32e5f2e1a7f73fb\n  private arcUpdateTween = (data, index, n) => {\n    const interpolate = d3_interpolate(this.currentData[index], data);\n\n    // update the current data for this slice\n    this.currentData[index] = interpolate(0);\n\n    return (t) => {\n      return this.arc(interpolate(t));\n    };\n  };\n\n  private arcMouseOverTween = (data) => {\n    const i = d3_interpolate(data.outerRadius, this.outerRadius + this.arcZoom);\n\n    return (t) => {\n      data.outerRadius = i(t);\n      return this.arc(data);\n    };\n  };\n\n  private arcMouseOutTween = (data) => {\n    // debugger;\n    const i = d3_interpolate(data.outerRadius, this.outerRadius);\n    return (t) => {\n      data.outerRadius = i(t);\n      return this.arc(data);\n    };\n  };\n\n  private legendMouseOverFocus = (event, data) => {\n    this.chart\n      .selectAll('.legend-item')\n      .filter((d, i) => {\n        return `${d.label}` !== `${data.label}`;\n      })\n      .classed('inactive', true);\n  };\n\n  private legendMouseOutBlur = (event, data) => {\n    this.chart.selectAll('.legend-item').classed('inactive', false);\n  };\n\n  private pathMouseOver = (event, data) => {\n    // console.log(data);\n\n    const slices = this.chart.selectAll('.slice');\n    const slice = slices.filter((d, i) => i === data.index);\n\n    this.chart\n      .selectAll('.legend-item')\n      .filter((d, i) => i !== data.index)\n      .classed('inactive', true);\n\n    slices.filter((d, i) => i !== data.index).classed('inactive', true);\n\n    slice.transition().duration(300).delay(0).attrTween('d', this.arcMouseOverTween);\n\n    this.hovered.emit({\n      event: event,\n      data: data.data ? data.data : data // legend hover data is different than slice hover data\n    });\n  };\n\n  private pathMouseOut = (event, data) => {\n    const slices = this.chart.selectAll('.slice');\n    const slice = slices.filter((d, i) => d.label === data.label);\n\n    this.chart.selectAll('.legend-item').classed('inactive', false);\n\n    slices.classed('inactive', false);\n\n    slice.transition().duration(300).delay(0).attrTween('d', this.arcMouseOutTween);\n  };\n\n  private pathClick = (event, data) => {\n    this.clicked.emit({\n      event: event,\n      data: data.data\n    });\n  };\n\n  private tooltipShow = (event, data) => {\n    // debugger;\n    this.tooltipSetPosition(event);\n\n    const percentage = (data.endAngle - data.startAngle) / (2 * Math.PI);\n    let label;\n\n    switch (this.tooltipLabelFormatType) {\n      case 'time':\n        const parsedTime = d3_isoParse(data.data.label);\n        label = this.tooltipLabelFormat(parsedTime);\n        break;\n\n      default:\n        label = data.data.label;\n    }\n\n    this.tooltip.html(\n      `\n        <div class=\"tooltip-label\">${label}</div>\n        <div class=\"tooltip-value\">${this.tooltipValueFormat(percentage)}</div>\n      `\n    );\n\n    this.tooltip.style('opacity', 1);\n  };\n\n  private tooltipMove = (event, node) => {\n    this.tooltipSetPosition(event, node);\n  };\n\n  private tooltipHide = () => {\n    this.tooltip.style('opacity', 0);\n  };\n\n  private tooltipSetPosition = (event, node?) => {\n    // debugger;\n    const coordinates = d3_pointer(event, node);\n\n    this.tooltip.style('left', `${coordinates[0] + 16}px`);\n    this.tooltip.style('top', `${coordinates[1] + 16}px`);\n  };\n}\n","import {\n  Component,\n  OnInit,\n  OnChanges,\n  Input,\n  Output,\n  EventEmitter,\n  ElementRef,\n  HostBinding,\n  OnDestroy,\n  SimpleChanges,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { ViewportScroller, Location } from '@angular/common';\n\nimport { select as d3_select } from 'd3-selection';\nimport { scaleOrdinal as d3_scaleOrdinal, scaleLinear as d3_scaleLinear, scaleBand as d3_scaleBand } from 'd3-scale';\nimport { min as d3_min, max as d3_max } from 'd3-array';\nimport { axisBottom as d3_axisBottom, axisLeft as d3_axisLeft } from 'd3-axis';\nimport { isoParse as d3_isoParse } from 'd3-time-format';\n\nimport { PbdsDatavizService } from './dataviz.service';\nimport { PbdsDatavizBar } from './dataviz.interfaces';\n\n@Component({\n  selector: 'pbds-dataviz-bar',\n  template: ``,\n  styles: [],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class PbdsDatavizBarComponent implements OnInit, OnDestroy, OnChanges {\n  @HostBinding('class.pbds-chart')\n  chartClass = true;\n\n  @HostBinding('class.pbds-chart-bar')\n  barClass = true;\n\n  @Input()\n  data: PbdsDatavizBar[];\n\n  @Input()\n  width = 306;\n\n  @Input()\n  height = 400;\n\n  @Input()\n  type: 'low' | 'medium' | 'high' | 'debug' = 'medium'; // debug to show all chart options\n\n  @Input()\n  singleSeries = false;\n\n  @Input()\n  xAxisFormatType: 'number' | 'time' = null;\n\n  @Input()\n  xAxisFormatString = '';\n\n  @Input()\n  xAxisTitle: string | null = null;\n\n  @Input()\n  yAxisFormatType: 'number' | 'time' = null;\n\n  @Input()\n  yAxisFormatString = '';\n\n  @Input()\n  yAxisTicks = 5;\n\n  @Input()\n  yAxisMinBuffer = 0.01;\n\n  @Input()\n  yAxisMaxBuffer = 0.01;\n\n  @Input()\n  hideLegend = false;\n\n  @Input()\n  legendWidth = 105 + 28; // hardcoded legend width + left margin, do not document until feedback\n\n  @Input()\n  legendPosition: 'right' | 'bottom' = 'right';\n\n  @Input()\n  legendLabelFormatType: 'number' | 'time' = null;\n\n  @Input()\n  legendLabelFormatString = '';\n\n  @Input()\n  tooltipLabelFormatType: 'number' | 'time' = null;\n\n  @Input()\n  tooltipLabelFormatString = '';\n\n  @Input()\n  tooltipValueFormatType: 'number' | 'time' = null;\n\n  @Input()\n  tooltipValueFormatString = '';\n\n  @Input()\n  marginTop = 10; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  marginRight = 0; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  marginBottom = 30; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  marginLeft = 55; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  threshold = null;\n\n  @Input()\n  thresholdLabel = 'Threshold';\n\n  @Input()\n  average = null;\n\n  @Input()\n  averageLabel = 'Average';\n\n  @Input()\n  theme;\n\n  @Output()\n  hovered: EventEmitter<object> = new EventEmitter<object>();\n\n  @Output()\n  clicked: EventEmitter<object> = new EventEmitter<object>();\n\n  private chart;\n  private svg;\n  private margin;\n  private colorRange;\n  private hideGrayBars: boolean;\n  private yThreshold;\n  private yAverage;\n  private xAxisScale;\n  private xAxisCall;\n  private xAxis;\n  private xAxisFormat;\n  private xAxisTitleMargin: number;\n  private yAxisScale;\n  private yAxisCall;\n  private yAxis;\n  private yAxisFormat;\n  private xGrid;\n  private xGridCall;\n  private yGrid;\n  private yGridCall;\n  private xAxisTickSize: number;\n  private xAxisTickSizeOuter: number;\n  private yAxisTickSize: number;\n  private yAxisTickSizeOuter: number;\n  private hideXAxis: boolean;\n  private hideYAxis: boolean;\n  private hideXAxisDomain: boolean;\n  private hideYAxisDomain: boolean;\n  private hideXAxisZero: boolean;\n  private hideYAxisZero: boolean;\n  private hideXGrid: boolean;\n  private hideYGrid: boolean;\n  private hideXAxisTicks: boolean;\n  private hideYAxisTicks: boolean;\n  private legendLabelFormat;\n  private tooltip;\n  private hideTooltip: boolean;\n  private hideTooltipLabel: boolean;\n  private tooltipValueFormat;\n  private tooltipLabelFormat;\n\n  constructor(\n    private _dataviz: PbdsDatavizService,\n    private _element: ElementRef,\n    private _scroll: ViewportScroller,\n    private _location: Location\n  ) {}\n\n  ngOnInit() {\n    this.margin = {\n      top: +this.marginTop,\n      right: +this.marginRight,\n      bottom: +this.marginBottom,\n      left: +this.marginLeft\n    };\n\n    // create formatters\n    this.xAxisFormat = this._dataviz.d3Format(this.xAxisFormatType, this.xAxisFormatString);\n    this.yAxisFormat = this._dataviz.d3Format(this.yAxisFormatType, this.yAxisFormatString);\n    this.legendLabelFormat = this._dataviz.d3Format(this.legendLabelFormatType, this.legendLabelFormatString);\n    this.tooltipLabelFormat = this._dataviz.d3Format(this.tooltipLabelFormatType, this.tooltipLabelFormatString);\n    this.tooltipValueFormat = this._dataviz.d3Format(this.tooltipValueFormatType, this.tooltipValueFormatString);\n\n    // defaults for all chart types\n    this.hideGrayBars = false;\n    this.hideXAxis = false;\n    this.hideYAxis = false;\n    this.hideXAxisZero = false;\n    this.hideYAxisZero = false;\n    this.hideXGrid = false;\n    this.hideYGrid = false;\n    this.hideXAxisDomain = false;\n    this.hideYAxisDomain = false;\n    this.hideTooltip = false;\n    this.hideXAxisTicks = false;\n    this.hideYAxisTicks = false;\n    this.xAxisTickSize = 8;\n    this.xAxisTickSizeOuter = 0;\n    this.xAxisTitleMargin = this.xAxisTitle ? 20 : 0;\n    this.yAxisTickSize = 8;\n    this.yAxisTickSizeOuter = 0;\n    this.hideTooltipLabel = false;\n\n    if (this.type !== 'debug') {\n      // set type defaults\n      switch (this.type) {\n        case 'low':\n          this.hideGrayBars = true;\n          this.hideXAxis = !this.hideLegend;\n          this.hideXAxisTicks = true;\n          this.hideXGrid = true;\n          this.hideYAxisDomain = false;\n          this.hideYAxisTicks = true;\n          this.legendPosition = 'bottom';\n          this.hideTooltipLabel = true;\n          break;\n\n        case 'medium':\n          this.hideXAxisDomain = true;\n          this.hideXAxis = !this.hideLegend;\n          this.hideXGrid = true;\n          this.hideXAxisTicks = true;\n          this.hideYAxisDomain = true;\n          this.hideYAxisTicks = true;\n          this.hideYGrid = true;\n          this.hideTooltipLabel = true;\n          break;\n\n        case 'high':\n          this.hideXAxis = true;\n          this.hideXAxisDomain = true;\n          this.hideXGrid = true;\n          this.hideYAxisDomain = true;\n          this.hideYAxisTicks = true;\n          this.hideYGrid = true;\n          this.hideLegend = true;\n          this.hideTooltipLabel = false;\n          break;\n      }\n\n      // single series overrides\n      if (this.singleSeries) {\n        this.hideLegend = true;\n        this.hideXAxis = true;\n        this.hideXGrid = true;\n        this.hideTooltipLabel = false;\n      }\n    }\n\n    // adjust margin if xAxis hidden\n    if (this.hideXAxis) this.margin.bottom = 10; // need small margin for yAxis with 0 tick label\n\n    if (!this.hideLegend && this.legendPosition === 'right') {\n      this.width = +this.width - +this.legendWidth;\n    }\n\n    // create the chart\n    this.chart = d3_select(this._element.nativeElement).attr('aria-hidden', 'true');\n\n    // create chart svg\n    this.svg = this.chart\n      .append('svg')\n      .attr('width', +this.width)\n      .attr('height', +this.height + this.margin.top + this.margin.bottom + this.xAxisTitleMargin)\n      .attr('class', 'img-fluid')\n      .attr('preserveAspectRatio', 'xMinYMin meet')\n      .attr(\n        'viewBox',\n        `-${this.margin.left} -${this.margin.top} ${+this.width} ${\n          +this.height + this.margin.top + this.margin.bottom + this.xAxisTitleMargin\n        }`\n      );\n\n    // build color ranges\n    this.colorRange = d3_scaleOrdinal().range(\n      this._dataviz.createGradientDefs(this.svg, this.singleSeries, this.theme)\n    );\n\n    // X AXIS\n    this.xAxisScale = d3_scaleBand()\n      .domain(this.data.map((d) => d.label))\n      .rangeRound([0, this.width - this.margin.left])\n      .align(0);\n\n    // add padding to the scale for gray bars\n    !this.hideGrayBars\n      ? this.xAxisScale.paddingInner(0.1).paddingOuter(0)\n      : this.xAxisScale.paddingInner(0).paddingOuter(0);\n\n    this.xAxisCall = d3_axisBottom(this.xAxisScale)\n      .tickSize(this.xAxisTickSize)\n      .tickSizeOuter(this.xAxisTickSizeOuter)\n      .tickFormat(this.xAxisFormatter);\n\n    this.xAxis = this.svg\n      .append('g')\n      .attr('class', 'axis axis-x')\n      .attr('transform', `translate(0, ${this.height})`)\n      .classed('axis-hidden', this.hideXAxis)\n      .classed('axis-zero-hidden', this.hideXAxisZero)\n      .classed('axis-domain-hidden', this.hideXAxisDomain)\n      .classed('axis-ticks-hidden', this.hideXAxisTicks)\n      .call(this.xAxisCall);\n\n    // X GRIDLINES\n    if (!this.hideXGrid) {\n      this.xGridCall = d3_axisBottom(this.xAxisScale).tickSize(-this.height);\n\n      this.xGrid = this.svg\n        .append('g')\n        .attr('class', 'grid grid-x')\n        .classed('grid-zero-hidden', this.hideXAxisZero)\n        .attr('transform', `translate(0, ${this.height})`)\n        .call(this.xGridCall);\n    }\n\n    // X AXIS TITLE\n    if (this.xAxisTitle) {\n      this.svg\n        .append('text')\n        .attr('class', 'axis-title')\n        .attr('text-anchor', 'center')\n        .attr('x', this.width / 2 - this.margin.left)\n        .attr('y', this.height + this.margin.top + (this.hideXAxis ? 15 : 0))\n        .text(this.xAxisTitle);\n    }\n\n    // Y AXIS\n    this.yAxisScale = d3_scaleLinear()\n      .domain([\n        d3_min(this.data, (d) => d.value - d.value * +this.yAxisMinBuffer),\n        d3_max(this.data, (d) => d.value + d.value * +this.yAxisMaxBuffer)\n      ])\n      .nice()\n      .rangeRound([this.height, 0]);\n\n    this.yAxisCall = d3_axisLeft(this.yAxisScale)\n      .ticks(this.yAxisTicks)\n      .tickSize(this.yAxisTickSize)\n      .tickSizeOuter(this.yAxisTickSizeOuter)\n      .tickFormat(this.yAxisFormatter);\n\n    this.yAxis = this.svg\n      .append('g')\n      .attr('class', 'axis axis-y')\n      .classed('axis-hidden', this.hideYAxis)\n      .classed('axis-zero-hidden', this.hideYAxisZero)\n      .classed('axis-domain-hidden', this.hideYAxisDomain)\n      .classed('axis-ticks-hidden', this.hideYAxisTicks)\n      .call(this.yAxisCall);\n\n    // Y GRIDLINES\n    if (!this.hideYGrid) {\n      this.yGridCall = d3_axisLeft(this.yAxisScale)\n        .ticks(this.yAxisTicks)\n        .tickSize(-this.width + this.margin.left + this.margin.right);\n\n      this.yGrid = this.svg\n        .append('g')\n        .attr('class', 'grid grid-y')\n        .classed('grid-zero-hidden', this.hideYAxisZero)\n        .attr('transform', `translate(0, 0)`)\n        .call(this.yGridCall);\n    }\n\n    // Y THRESHOLD\n    if (this.threshold) {\n      this.yThreshold = this.svg\n        .append('line')\n        .attr('class', 'threshold')\n        .attr('x2', +this.width - this.margin.right - this.margin.left)\n        .attr('transform', `translate(0,  ${this.yAxisScale(+this.threshold)})`);\n    }\n\n    // Y AVERAGE\n    if (this.average) {\n      this.yAverage = this.svg\n        .append('line')\n        .attr('class', 'average')\n        .attr('x2', +this.width - this.margin.right - this.margin.left)\n        .attr('transform', `translate(0,  ${this.yAxisScale(+this.average)})`);\n    }\n\n    // TOOLTIP\n    if (!this.hideTooltip) {\n      this.tooltip = d3_select('body')\n        .append('div')\n        .attr('class', 'pbds-tooltip south')\n        .style('opacity', 0)\n        .attr('aria-hidden', 'true'); // hide tooltip for accessibility\n    }\n\n    // add legend classes\n    if (!this.hideLegend) {\n      this.chart.classed('pbds-chart-legend-bottom', this.legendPosition === 'bottom' ? true : false);\n      this.chart.append('ul').attr('class', `legend legend-${this.legendPosition}`);\n    }\n\n    // add average to legend\n    if (this.average && !this.hideLegend) {\n      this.chart\n        .select('.legend')\n        .append('li')\n        .attr('class', 'legend-static legend-average')\n        .html(() => {\n          return `\n          <span class=\"legend-key\"></span>\n          <span class=\"legend-label\">${this.averageLabel}</span>\n        `;\n        });\n    }\n\n    // add threshold to legend\n    if (this.threshold && !this.hideLegend) {\n      this.chart\n        .select('.legend')\n        .append('li')\n        .attr('class', 'legend-static legend-threshold')\n        .html(() => {\n          return `\n          <span class=\"legend-key\"></span>\n          <span class=\"legend-label\">${this.thresholdLabel}</span>\n        `;\n        });\n    }\n\n    this.updateChart();\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    if (changes.data && !changes.data.firstChange) {\n      this.updateChart();\n    }\n  }\n\n  ngOnDestroy() {\n    if (this.tooltip) this.tooltip.remove();\n  }\n\n  updateChart = () => {\n    // update the xScale\n    this.xAxisScale.domain(this.data.map((d) => d.label));\n\n    // update the yScale\n    this.yAxisScale\n      .domain([\n        d3_min(this.data, (d) => d.value - d.value * +this.yAxisMinBuffer),\n        d3_max(this.data, (d) => d.value + d.value * +this.yAxisMaxBuffer)\n      ])\n      .rangeRound([this.height, 0])\n      .nice();\n\n    this.xAxis.transition().duration(1000).call(this.xAxisCall);\n\n    this.yAxis.transition().duration(1000).call(this.yAxisCall);\n\n    // update the grids\n    if (!this.hideXGrid) {\n      this.xGrid.transition().duration(1000).call(this.xGridCall);\n    }\n\n    if (!this.hideYGrid) {\n      this.yGrid.transition().duration(1000).call(this.yGridCall);\n    }\n\n    if (!this.hideGrayBars) {\n      // gray bars\n      this.svg\n        .selectAll('.gray-bar')\n        .data(this.data)\n        .join(\n          (enter) =>\n            enter\n              .append('rect')\n              .attr('class', 'gray-bar')\n              .attr('height', 0)\n              .attr('x', (d) => this.xAxisScale(d.label))\n              .attr('width', this.xAxisScale.bandwidth())\n              .call((enter) => enter.transition().duration(500).attr('height', this.height)),\n          (update) =>\n            update\n              .transition()\n              .duration(1000)\n              .attr('x', (d) => this.xAxisScale(d.label))\n              .attr('width', this.xAxisScale.bandwidth())\n              .selection(),\n          (exit) => exit.transition().selection().attr('pointer-events', 'none').remove()\n        );\n\n      // color bars\n      this.svg\n        .selectAll('.bar')\n        .data(this.data)\n        .join(\n          (enter) =>\n            enter\n              .append('rect')\n              .attr('class', 'bar')\n              .attr('fill', (d) => `url(${this._location.path()}#gradient-${this.colorRange(d.label).substr(1)})`) // removes hash to prevent safari bug;\n              .attr('x', (d) => this.xAxisScale(d.label) + this.xAxisScale.bandwidth() / 4)\n              .attr('width', this.xAxisScale.bandwidth() / 2)\n              .attr('y', this.height)\n              .attr('height', 0)\n              .attr('pointer-events', 'none')\n              .call((enter) =>\n                enter\n                  .transition()\n                  .duration(1000)\n                  .attr('y', (d) => this.yAxisScale(d.value))\n                  .attr('height', (d) => this.height - this.yAxisScale(d.value))\n                  .attr('data-color', (d) => this.colorRange(d.label))\n                  .transition()\n                  .attr('pointer-events', 'auto')\n              ),\n          (update) =>\n            update\n              .attr('pointer-events', 'none')\n              .transition()\n              .duration(1000)\n              .attr('x', (d) => this.xAxisScale(d.label) + this.xAxisScale.bandwidth() / 4)\n              .attr('width', this.xAxisScale.bandwidth() / 2)\n              .attr('height', (d) => this.height - this.yAxisScale(d.value))\n              .attr('y', (d) => this.yAxisScale(d.value))\n              .transition()\n              .selection()\n              .attr('pointer-events', 'auto'),\n          (exit) => exit.transition().selection().attr('pointer-events', 'none').remove()\n        )\n        .on('mouseover', (event, data) => this.barMouseOver(event, data))\n        .on('mouseout', (event, data) => this.barMouseOut())\n        .on('click', (event, data) => this.barMouseClick(event, data));\n    } else {\n      // color bars\n      this.svg\n        .selectAll('.bar')\n        .data(this.data)\n        .join(\n          (enter) =>\n            enter\n              .append('rect')\n              .attr('class', 'bar')\n              .attr('fill', (d) => `url(${this._location.path()}#gradient-${this.colorRange(d.label).substr(1)})`)\n              .attr('x', (d) => this.xAxisScale(d.label) + this.xAxisScale.bandwidth() / 5.5)\n              .attr('width', this.xAxisScale.bandwidth() / 1.5)\n              .attr('y', this.height)\n              .attr('height', 0)\n              .attr('pointer-events', 'none')\n              .call((enter) =>\n                enter\n                  .transition()\n                  .duration(1000)\n                  .attr('y', (d) => this.yAxisScale(d.value))\n                  .attr('height', (d) => this.height - this.yAxisScale(d.value))\n                  .attr('data-color', (d) => this.colorRange(d.label))\n                  .transition()\n                  .attr('pointer-events', 'auto')\n              ),\n          (update) =>\n            update\n              .attr('pointer-events', 'none')\n              .transition()\n              .duration(1000)\n              .attr('x', (d) => this.xAxisScale(d.label) + this.xAxisScale.bandwidth() / 5.5)\n              .attr('width', this.xAxisScale.bandwidth() / 1.5)\n              .attr('height', (d) => this.height - this.yAxisScale(d.value))\n              .attr('y', (d) => this.yAxisScale(d.value))\n              .transition()\n              .selection()\n              .attr('pointer-events', 'auto'),\n          (exit) => exit.transition().attr('pointer-events', 'none').remove()\n        )\n        .on('mouseover', (event, data) => this.barMouseOver(event, data))\n        .on('mouseout', (event, data) => this.barMouseOut())\n        .on('click', (event, data) => this.barMouseClick(event, data));\n    }\n\n    if (!this.hideLegend) {\n      this.chart\n        .select('.legend')\n        .selectAll('.legend-item')\n        .data(this.data)\n        .join(\n          (enter) => {\n            const li = enter.insert('li', 'li.legend-static').attr('class', 'legend-item');\n\n            li.append('span')\n              .attr('class', 'legend-key')\n              .style('background-color', (d) => this.colorRange(d.label));\n\n            li.append('span')\n              .attr('class', 'legend-label')\n              .html((d) => {\n                switch (this.legendLabelFormatType) {\n                  case 'number':\n                    return this.legendLabelFormat(d.label);\n\n                  case 'time':\n                    const parsedTime = d3_isoParse(d.label);\n                    return this.legendLabelFormat(parsedTime);\n\n                  default:\n                    return d.label;\n                }\n              });\n\n            return li;\n          },\n          (update) =>\n            update.select('.legend-label').html((d) => {\n              switch (this.legendLabelFormatType) {\n                case 'number':\n                  return this.legendLabelFormat(d.label);\n\n                case 'time':\n                  const parsedTime = d3_isoParse(d.label);\n                  return this.legendLabelFormat(parsedTime);\n\n                default:\n                  return d.label;\n              }\n            }),\n          (exit) => exit.remove()\n        )\n        .on('mouseover', (event, data) => this.legendMouseOver(event, data))\n        .on('mouseout', () => this.legendMouseOut())\n        .on('click', (event, data) => this.legendMouseClick(event, data));\n    }\n\n    if (this.threshold) {\n      this.yThreshold\n        .raise()\n        .transition()\n        .duration(1000)\n        .attr('transform', `translate(0,  ${this.yAxisScale(+this.threshold)})`);\n    }\n\n    if (this.average) {\n      this.yAverage\n        .raise()\n        .transition()\n        .duration(1000)\n        .attr('transform', `translate(0,  ${this.yAxisScale(+this.average)})`);\n    }\n  };\n\n  barMouseOver = (event, data) => {\n    this.chart\n      .selectAll('.bar')\n      .filter((d, i) => d.label !== data.label)\n      .classed('inactive', true);\n\n    const bar = this.chart.selectAll('.bar').filter((d, i) => d.label === data.label);\n\n    const barColor = bar.attr('data-color');\n\n    bar.style('fill', barColor);\n\n    this.chart\n      .selectAll('.legend-item')\n      .filter((d, i) => d.label !== data.label)\n      .classed('inactive', true);\n\n    this.tooltipShow(event, data);\n\n    this.hovered.emit({ event, data });\n  };\n\n  barMouseOut = () => {\n    this.chart.selectAll('.bar').classed('inactive', false).style('fill', null);\n\n    this.chart.selectAll('.legend-item').classed('inactive', false);\n\n    this.tooltipHide();\n  };\n\n  barMouseClick = (event, data) => {\n    this.clicked.emit({ event, data });\n  };\n\n  legendMouseOver = (event, data) => {\n    this.chart\n      .selectAll('.legend-item')\n      .filter((d, i) => d.label !== data.label)\n      .classed('inactive', true);\n\n    this.chart\n      .selectAll('.bar')\n      .filter((d, i) => d.label !== data.label)\n      .classed('inactive', true);\n\n    const bar = this.chart.selectAll('.bar').filter((d, i) => d.label === data.label);\n\n    const barColor = bar.attr('data-color');\n\n    bar.style('fill', barColor);\n\n    this.tooltipShow(\n      event,\n      data,\n      this.chart\n        .selectAll('.bar')\n        .filter((d, i) => d.label === data.label)\n        .node()\n    );\n\n    this.hovered.emit({ event, data });\n  };\n\n  legendMouseOut = () => {\n    this.chart.selectAll('.legend-item').classed('inactive', false);\n\n    this.chart.selectAll('.bar').classed('inactive', false).style('fill', null);\n\n    this.tooltipHide();\n  };\n\n  legendMouseClick = (event, data) => {\n    this.clicked.emit({ event, data });\n  };\n\n  private tooltipShow = (event, data, node?) => {\n    const scroll = this._scroll.getScrollPosition();\n    let dimensions = event.currentTarget.getBoundingClientRect();\n    let label;\n\n    if (node) {\n      const target = this.chart\n        .selectAll('.bar')\n        .filter((d, i) => d.label === data.label)\n        .node();\n\n      dimensions = target.getBoundingClientRect();\n    }\n\n    switch (this.tooltipLabelFormatType) {\n      case 'number':\n        label = this.tooltipLabelFormat(data.label);\n        break;\n\n      case 'time':\n        const parsedTime = d3_isoParse(data.label);\n        label = this.tooltipLabelFormat(parsedTime);\n        break;\n\n      default:\n        label = data.label;\n    }\n    const value =\n      this.tooltipValueFormat === null\n        ? `<div class=\"tooltip-value\">${data.value}</div>`\n        : `<div class=\"tooltip-value\">${this.tooltipValueFormat(data.value)}</div>`;\n\n    this.tooltip.html(\n      `\n        ${this.hideTooltipLabel ? '' : `${label}`}\n        ${value}\n      `\n    );\n\n    const tooltipOffsetWidth = +this.tooltip.node().offsetWidth / 2;\n    const tooltipOffsetHeight = +this.tooltip.node().offsetHeight + 8;\n\n    this.tooltip.style('top', `${+scroll[1] + +dimensions.top - tooltipOffsetHeight}px`); //\n    this.tooltip.style('left', `${+scroll[0] + +dimensions.left - tooltipOffsetWidth + +dimensions.width / 2}px`);\n    this.tooltip.style('opacity', 1);\n  };\n\n  private tooltipHide = () => {\n    this.tooltip.style('opacity', 0);\n  };\n\n  private xAxisFormatter = (item) => {\n    switch (this.xAxisFormatType) {\n      case 'number':\n        return this.xAxisFormat(item);\n\n      case 'time':\n        const parseDate = d3_isoParse(item);\n        return this.xAxisFormat(parseDate);\n\n      default:\n        return item;\n    }\n  };\n\n  private yAxisFormatter = (item) => {\n    switch (this.yAxisFormatType) {\n      case 'number':\n        return this.yAxisFormat(item);\n\n      case 'time':\n        const parseDate = d3_isoParse(item);\n        return this.yAxisFormat(parseDate);\n\n      default:\n        return item;\n    }\n  };\n}\n","import {\n  Component,\n  OnInit,\n  OnChanges,\n  Input,\n  Output,\n  EventEmitter,\n  ElementRef,\n  HostBinding,\n  OnDestroy,\n  SimpleChanges,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { ViewportScroller, Location } from '@angular/common';\n\nimport { select as d3_select, pointer as d3_pointer } from 'd3-selection';\nimport { line as d3_line, area as d3_area, curveCatmullRom as d3_curveCatmullRom } from 'd3-shape';\nimport { scaleOrdinal as d3_scaleOrdinal, scaleLinear as d3_scaleLinear, scaleTime as d3_scaleTime } from 'd3-scale';\nimport { min as d3_min, max as d3_max, extent as d3_extent, bisectLeft as d3_bisectLeft } from 'd3-array';\nimport { axisBottom as d3_axisBottom, axisLeft as d3_axisLeft } from 'd3-axis';\nimport { format as d3_format } from 'd3-format';\nimport { isoParse as d3_isoParse, isoFormat as d3_isoFormat, timeFormat as d3_timeFormat } from 'd3-time-format';\nimport { easeQuadInOut as d3_easeQuadInOut } from 'd3-ease';\n\nimport { PbdsDatavizService } from './dataviz.service';\nimport { PbdsDatavizLine } from './dataviz.interfaces';\n\n// assign an ID for each component instance\nlet nextId = 0;\n\n@Component({\n  selector: 'pbds-dataviz-line',\n  template: ``,\n  styles: [],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class PbdsDatavizLineComponent implements OnInit, OnDestroy, OnChanges {\n  @HostBinding('class.pbds-chart')\n  chartClass = true;\n\n  @HostBinding('class.pbds-chart-line')\n  lineClass = true;\n\n  @Input()\n  data: PbdsDatavizLine;\n\n  @Input()\n  width = 306;\n\n  @Input()\n  height = 400;\n\n  @Input()\n  type: 'medium' | 'high' | 'debug' = 'medium'; // debug to show all chart options\n\n  @Input()\n  area = false;\n\n  @Input()\n  xAxisFormatString = '';\n\n  @Input()\n  xAxisTicks = 6;\n\n  @Input()\n  yAxisFormatString = '';\n\n  @Input()\n  yAxisTicks = 5;\n\n  @Input()\n  yAxisMinBuffer = 0.01;\n\n  @Input()\n  yAxisMaxBuffer = 0.01;\n\n  @Input()\n  hideXGrid = true;\n\n  @Input()\n  hideYGrid = true;\n\n  @Input()\n  hideLegend = false;\n\n  @Input()\n  legendWidth = 105 + 28; // hardcoded legend width + left margin, do not document until feedback\n\n  @Input()\n  legendPosition: 'right' | 'bottom' = 'right';\n\n  @Input()\n  legendLabelFormatType: 'number' | 'time' = null;\n\n  @Input()\n  legendLabelFormatString = '';\n\n  @Input()\n  tooltipHeadingFormatString = '';\n\n  @Input()\n  tooltipLabelFormatType: 'number' | 'time' = null;\n\n  @Input()\n  tooltipLabelFormatString = '';\n\n  @Input()\n  tooltipValueFormatType: 'number' | 'time' = null;\n\n  @Input()\n  tooltipValueFormatString = '';\n\n  @Input()\n  marginTop = 10; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  marginRight = 20; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  marginBottom = 30; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  marginLeft = 55; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  theme;\n\n  @Output()\n  hovered: EventEmitter<object> = new EventEmitter<object>();\n\n  @Output()\n  clicked: EventEmitter<object> = new EventEmitter<object>();\n\n  @Output()\n  tooltipHovered: EventEmitter<object> = new EventEmitter<object>();\n\n  @Output()\n  tooltipClicked: EventEmitter<object> = new EventEmitter<object>();\n\n  private chart;\n  private svg;\n  private mouserect;\n  private tooltipLine;\n  private margin;\n  private clipPathId;\n  private d3line;\n  private d3area;\n  private lineWidth;\n  private lineCurved;\n  private linePoints;\n  private colorRange;\n  private xAxisScale;\n  private xAxisCall;\n  private xAxis;\n  private xAxisFormat;\n  private yAxisScale;\n  private yAxisCall;\n  private yAxis;\n  private yAxisFormat;\n  private xGrid;\n  private xGridCall;\n  private yGrid;\n  private yGridCall;\n  private xAxisTickSize: number;\n  private xAxisTickSizeOuter: number;\n  private yAxisTickSize: number;\n  private yAxisTickSizeOuter: number;\n  private hideXAxis: boolean;\n  private hideYAxis: boolean;\n  private hideXAxisDomain: boolean;\n  private hideYAxisDomain: boolean;\n  private hideXAxisZero: boolean;\n  private hideYAxisZero: boolean;\n  private hideXAxisTicks: boolean;\n  private hideYAxisTicks: boolean;\n  private legendLabelFormat;\n  private tooltip;\n  private hideTooltip: boolean;\n  private tooltipHeadingFormat;\n  private tooltipValueFormat;\n  private tooltipLabelFormat;\n  private mousedata;\n\n  constructor(\n    private _dataviz: PbdsDatavizService,\n    private _element: ElementRef,\n    private _scroll: ViewportScroller,\n    private _location: Location\n  ) {}\n\n  ngOnInit() {\n    this.margin = {\n      top: +this.marginTop,\n      right: +this.marginRight,\n      bottom: +this.marginBottom,\n      left: +this.marginLeft\n    };\n\n    this.clipPathId = nextId;\n\n    // create formatters\n    this.xAxisFormat = d3_timeFormat(this.xAxisFormatString);\n    this.yAxisFormat = d3_format(this.yAxisFormatString);\n    this.legendLabelFormat = this._dataviz.d3Format(this.legendLabelFormatType, this.legendLabelFormatString);\n    this.tooltipHeadingFormat = d3_timeFormat(this.tooltipHeadingFormatString);\n    this.tooltipLabelFormat = this._dataviz.d3Format(this.tooltipLabelFormatType, this.tooltipLabelFormatString);\n    this.tooltipValueFormat = this._dataviz.d3Format(this.tooltipValueFormatType, this.tooltipValueFormatString);\n\n    // defaults for all chart types\n    this.lineWidth = 3;\n    this.lineCurved = true;\n    this.linePoints = true;\n    this.hideXAxis = false;\n    this.hideYAxis = false;\n    this.hideXAxisZero = false;\n    this.hideYAxisZero = false;\n    this.hideXAxisDomain = false;\n    this.hideYAxisDomain = false;\n    this.hideTooltip = false;\n    this.hideXAxisTicks = false;\n    this.hideYAxisTicks = false;\n    this.xAxisTickSize = 8;\n    this.xAxisTickSizeOuter = 0;\n    this.yAxisTickSize = 8;\n    this.yAxisTickSizeOuter = 0;\n\n    if (this.type !== 'debug') {\n      // set type defaults\n      switch (this.type) {\n        case 'medium':\n          this.hideXAxisTicks = true;\n          this.hideYAxisTicks = true;\n          break;\n\n        case 'high':\n          this.lineWidth = 2;\n          this.lineCurved = false;\n          this.linePoints = false;\n          this.hideXAxisTicks = true;\n          this.hideYAxisTicks = true;\n          this.hideXGrid = false;\n          this.hideYGrid = false;\n          break;\n      }\n    }\n\n    // adjust margin if xAxis hidden\n    if (this.hideXAxis) this.margin.bottom = 10; // need small margin for yAxis with 0 tick label\n\n    if (!this.hideLegend && this.legendPosition === 'right') {\n      this.width = +this.width - +this.legendWidth;\n    }\n\n    // define line\n    this.d3line = d3_line()\n      .x((d: any, i) => this.xAxisScale(d3_isoParse(this.data.dates[i])))\n      .y((d: any) => this.yAxisScale(d));\n\n    // define line curve\n    if (this.lineCurved) {\n      this.d3line.curve(d3_curveCatmullRom.alpha(0.5));\n    }\n\n    // define area\n    if (this.area) {\n      this.d3area = d3_area()\n        .x((d: any, i) => this.xAxisScale(d3_isoParse(this.data.dates[i])))\n        .y0(this.height)\n        .y1((d: any, i) => this.yAxisScale(d));\n\n      if (this.lineCurved) {\n        this.d3area.curve(d3_curveCatmullRom.alpha(0.5));\n      }\n    }\n\n    // create the chart\n    this.chart = d3_select(this._element.nativeElement).attr('aria-hidden', 'true');\n\n    // create chart svg\n    this.svg = this.chart\n      .append('svg')\n      .attr('width', +this.width + this.margin.right)\n      .attr('height', +this.height + this.margin.top + this.margin.bottom)\n      .attr('class', 'img-fluid')\n      .attr('preserveAspectRatio', 'xMinYMin meet')\n      .attr(\n        'viewBox',\n        `-${this.margin.left} -${this.margin.top} ${+this.width + this.margin.right} ${\n          +this.height + this.margin.top + this.margin.bottom\n        }`\n      );\n\n    // add rectangle to capture mouse\n    this.mouserect = this.svg\n      .append('rect')\n      .attr('width', this.width - this.margin.left - this.margin.right)\n      .attr('height', this.height)\n      .attr('class', 'mouserect')\n      .on('mousemove', (event, data) => this.mouserectMouseMove(event, data))\n      .on('mouseout', (event, data) => this.mouserectMouseOut(event, data))\n      .on('click', (event, data) => this.mouserectMouseClick());\n\n    this.tooltipLine = this.svg.append('line').attr('y1', 0).attr('y2', this.height).attr('class', 'tooltip-line');\n\n    // define color range\n    this.colorRange = d3_scaleOrdinal().range(this._dataviz.getColors(false, this.theme));\n\n    // add glow def\n    this._dataviz.createGlowFilter(this.svg);\n\n    // X AXIS\n    this.xAxisScale = d3_scaleTime()\n      .domain(\n        d3_extent(this.data.dates, (d: any, i) => {\n          return d3_isoParse(d);\n        })\n      )\n      .range([0, this.width - this.margin.left - this.margin.right]);\n\n    this.xAxisCall = d3_axisBottom(this.xAxisScale)\n      .ticks(+this.xAxisTicks)\n      .tickSize(this.xAxisTickSize)\n      .tickSizeOuter(this.xAxisTickSizeOuter)\n      .tickFormat(this.xAxisFormatter);\n\n    this.xAxis = this.svg\n      .append('g')\n      .attr('class', 'axis axis-x')\n      .attr('transform', `translate(0, ${this.height})`) //${-this.margin.right / 2}\n      .classed('axis-hidden', this.hideXAxis)\n      .classed('axis-zero-hidden', this.hideXAxisZero)\n      .classed('axis-domain-hidden', this.hideXAxisDomain)\n      .classed('axis-ticks-hidden', this.hideXAxisTicks)\n      .call(this.xAxisCall);\n\n    // X GRIDLINES\n    if (!this.hideXGrid) {\n      this.xGridCall = d3_axisBottom(this.xAxisScale).tickSize(-this.height);\n\n      this.xGrid = this.svg\n        .append('g')\n        .attr('class', 'grid grid-x')\n        .classed('grid-zero-hidden', this.hideXAxisZero)\n        .attr('transform', `translate(0, ${this.height})`) //${-this.margin.right / 2}\n        .call(this.xGridCall);\n    }\n\n    // Y AXIS\n    this.yAxisScale = d3_scaleLinear()\n      .domain([\n        d3_min(this.data.series, (d: any, i) => {\n          const minVal = +d3_min(d.values);\n          return minVal - minVal * +this.yAxisMinBuffer;\n        }),\n        d3_max(this.data.series, (d: any, i) => {\n          const maxVal = +d3_max(d.values);\n          return maxVal + maxVal * this.yAxisMaxBuffer;\n        })\n      ])\n      .nice()\n      .range([this.height, 0]);\n\n    this.yAxisCall = d3_axisLeft(this.yAxisScale)\n      .ticks(this.yAxisTicks)\n      .tickSize(this.yAxisTickSize)\n      .tickSizeOuter(this.yAxisTickSizeOuter)\n      .tickFormat(this.yAxisFormatter);\n\n    this.yAxis = this.svg\n      .append('g')\n      .attr('class', 'axis axis-y')\n      .classed('axis-hidden', this.hideYAxis)\n      .classed('axis-zero-hidden', this.hideYAxisZero)\n      .classed('axis-domain-hidden', this.hideYAxisDomain)\n      .classed('axis-ticks-hidden', this.hideYAxisTicks)\n      .call(this.yAxisCall);\n\n    // Y GRIDLINES\n    if (!this.hideYGrid) {\n      this.yGridCall = d3_axisLeft(this.yAxisScale)\n        .ticks(this.yAxisTicks)\n        .tickSize(-this.width + this.margin.left + this.margin.right);\n\n      this.yGrid = this.svg\n        .append('g')\n        .attr('class', 'grid grid-y')\n        .classed('grid-zero-hidden', this.hideYAxisZero)\n        .attr('transform', `translate(0, 0)`)\n        .call(this.yGridCall);\n    }\n\n    // TOOLTIP\n    if (!this.hideTooltip) {\n      this.tooltip = d3_select('body')\n        .append('div')\n        .attr('class', 'pbds-tooltip west')\n        .style('opacity', 0)\n        .attr('aria-hidden', 'true'); // hide tooltip for accessibility\n\n      // tooltip header\n      this.tooltip.append('div').attr('class', 'tooltip-header');\n\n      // tooltip table\n      const tooltipTable = this.tooltip.append('table').attr('class', 'tooltip-table text-left w-100');\n\n      const tooltipTableTbody = tooltipTable.append('tbody');\n\n      tooltipTableTbody\n        .selectAll('tr')\n        .data(this.data)\n        .join((enter) => enter.append('tr'));\n    }\n\n    // add legend classes\n    if (!this.hideLegend) {\n      this.chart.classed('pbds-chart-legend-bottom', this.legendPosition === 'bottom' ? true : false);\n      this.chart.append('ul').attr('class', `legend legend-${this.legendPosition}`);\n    }\n\n    // add clip path for line animation\n    this.svg\n      .append('clipPath')\n      .attr('id', `clip-path-${this.clipPathId}`)\n      .append('rect')\n      .attr('width', +this.width - +this.margin.left - +this.margin.right)\n      .attr('height', +this.height);\n\n    // add clip path for points animation\n    this.svg\n      .append('clipPath')\n      .attr('id', `clip-path-points-${this.clipPathId}`)\n      .append('rect')\n      .attr('width', +this.width + +this.margin.left - +this.margin.right)\n      .attr('height', +this.height)\n      .attr('transform', `translate(-${this.margin.left}, 0)`);\n\n    this.updateChart();\n\n    nextId++;\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    if (changes.data && !changes.data.firstChange) {\n      this.updateChart();\n    }\n  }\n\n  ngOnDestroy() {\n    if (this.tooltip) this.tooltip.remove();\n  }\n\n  updateChart = () => {\n    this.mouserect.data(this.data);\n\n    // update the xScale\n    this.xAxisScale.domain(\n      d3_extent(this.data.dates, (d: any, i) => {\n        return d3_isoParse(d);\n      })\n    );\n\n    // update the yScale\n    this.yAxisScale\n      .domain([\n        d3_min(this.data.series, (d: any, i) => {\n          const minVal = +d3_min(d.values);\n          return minVal - minVal * +this.yAxisMinBuffer;\n        }),\n        d3_max(this.data.series, (d: any, i) => {\n          const maxVal = +d3_max(d.values);\n          return maxVal + maxVal * this.yAxisMaxBuffer;\n        })\n      ])\n      .nice();\n\n    this.xAxis.transition().duration(1000).call(this.xAxisCall);\n\n    this.yAxis.transition().duration(1000).call(this.yAxisCall);\n\n    // update the grids\n    if (!this.hideXGrid) {\n      this.xGrid.transition().duration(1000).call(this.xGridCall);\n    }\n\n    if (!this.hideYGrid) {\n      this.yGrid.transition().duration(1000).call(this.yGridCall);\n    }\n\n    // lines\n    this.svg\n      .selectAll('path.line')\n      .attr('filter', () => (this.type !== 'high' ? `url(${this._location.path()}#glow)` : null))\n      .data(this.data.series)\n      .join(\n        (enter) => {\n          enter\n            .append('path')\n            .attr('clip-path', `url(${this._location.path()}#clip-path-${this.clipPathId})`)\n            .attr('class', 'line')\n            .style('stroke', (d) => this.colorRange(d.label))\n            .style('stroke-width', this.lineWidth)\n            .attr('d', (data) => {\n              const array = new Array(data.values.length).fill(0);\n              return this.d3line(array);\n            })\n            .call((enter) =>\n              enter\n                .transition()\n                .duration(1000)\n                .ease(d3_easeQuadInOut)\n                .attr('d', (data) => this.d3line(data.values))\n            );\n        },\n        (update) =>\n          update.call((update) =>\n            update\n              .transition()\n              .duration(1000)\n              .ease(d3_easeQuadInOut)\n              .attr('d', (d) => this.d3line(d.values))\n          ),\n        (exit) => exit.remove()\n      );\n\n    // area\n    if (this.area) {\n      this.svg\n        .selectAll('path.area')\n        .data(this.data.series)\n        .join(\n          (enter) =>\n            enter\n              .append('path')\n              .attr('clip-path', `url(${this._location.path()}#clip-path-${this.clipPathId})`)\n              .attr('class', 'area')\n              .attr('d', (data) => {\n                const array = new Array(data.values.length).fill(0);\n                return this.d3area(array);\n              })\n              .style('color', (d) => this.colorRange(d.label))\n              .call((enter) =>\n                enter\n                  .transition()\n                  .duration(1000)\n                  .ease(d3_easeQuadInOut)\n                  .attr('d', (data) => this.d3area(data.values))\n              ),\n          (update) =>\n            update.call((update) => {\n              return update\n                .transition()\n                .duration(1000)\n                .ease(d3_easeQuadInOut)\n                .attr('d', (d) => this.d3area(d.values));\n            }),\n          (exit) => exit.remove()\n        );\n    }\n\n    // circles\n    if (this.linePoints) {\n      // add points\n      this.svg\n        .selectAll('g.points')\n        .data(this.data.series)\n        .join(\n          (enter) =>\n            enter\n              .append('g')\n              .attr('class', 'points')\n              .attr('clip-path', `url(${this._location.path()}#clip-path-points-${this.clipPathId})`)\n              .style('color', (d, i) => this.colorRange(d.label))\n\n              .selectAll('circle')\n              .data((d) => d.values)\n              .join(\n                (enter) =>\n                  enter\n                    .append('circle')\n                    .attr('cx', (d, i) => this.xAxisScale(d3_isoParse(this.data.dates[i])))\n                    .attr('cy', (d) => this.yAxisScale(0))\n                    .attr('r', this.lineWidth * 2)\n                    .style('stroke-width', this.lineWidth)\n                    .call((enter) =>\n                      enter\n                        .transition()\n                        .duration(1000)\n                        .ease(d3_easeQuadInOut)\n                        .attr('cy', (d) => this.yAxisScale(d))\n                    ),\n                () => {},\n                (exit) => exit.remove()\n              ),\n          (update) =>\n            update\n              .selectAll('circle')\n              .data((d) => d.values)\n              .join(\n                (enter) =>\n                  enter\n                    .append('circle')\n                    .attr('cx', (d, i) => this.xAxisScale(d3_isoParse(this.data.dates[i])))\n                    .attr('cy', (d) => this.yAxisScale(d))\n                    .attr('r', this.lineWidth * 2)\n                    .style('stroke-width', this.lineWidth),\n                (update) =>\n                  update.call((update) =>\n                    update\n                      .transition()\n                      .duration(1000)\n                      .ease(d3_easeQuadInOut)\n                      .attr('cx', (d, i) => this.xAxisScale(d3_isoParse(this.data.dates[i])))\n                      .attr('cy', (d) => this.yAxisScale(d))\n                  ),\n                (exit) => exit.remove()\n              ),\n          (exit) => exit.remove()\n        );\n    }\n\n    if (!this.hideLegend) {\n      this.chart\n        .select('.legend')\n        .selectAll('.legend-item')\n        .data(this.data.series)\n        .join(\n          (enter) => {\n            const li = enter.append('li').attr('class', 'legend-item');\n\n            li.append('span')\n              .attr('class', 'legend-key')\n              .style('background-color', (d) => this.colorRange(d.label));\n\n            li.append('span')\n              .attr('class', 'legend-label')\n              .html((d) => {\n                switch (this.legendLabelFormatType) {\n                  case 'number':\n                    return this.legendLabelFormat(d.label);\n\n                  case 'time':\n                    const parsedTime = d3_isoParse(d.label);\n                    return this.legendLabelFormat(parsedTime);\n\n                  default:\n                    return d.label;\n                }\n              });\n\n            return li;\n          },\n          (update) => {\n            update.select('.legend-label').html((d) => {\n              switch (this.legendLabelFormatType) {\n                case 'number':\n                  return this.legendLabelFormat(d.label);\n\n                case 'time':\n                  const parsedTime = d3_isoParse(d.label);\n                  return this.legendLabelFormat(parsedTime);\n\n                default:\n                  return d.label;\n              }\n            });\n\n            return update;\n          },\n          (exit) => exit.remove()\n        )\n        .on('mouseover', (event, data) => this.legendMouseOver(event, data))\n        .on('mouseout', () => this.legendMouseOut())\n        .on('click', (event, data) => this.legendMouseClick(event, data));\n    }\n\n    if (!this.hideTooltip) {\n      this.tooltip\n        .select('.tooltip-table')\n        .selectAll('tr')\n        .data(this.data.series)\n        .join(\n          (enter) => {\n            const tooltipItem = enter.append('tr').attr('class', 'tooltip-item');\n\n            tooltipItem\n              .append('td')\n              .style('color', (d) => this.colorRange(d.label))\n              .append('span')\n              .attr('class', 'pbds-tooltip-key');\n\n            tooltipItem\n              .append('td')\n              .attr('class', 'tooltip-label pr-2 text-nowrap')\n              .html((d) => {\n                return this.tooltipLabelFormatType ? this.tooltipLabelFormat(d.label) : d.label;\n              });\n\n            tooltipItem\n              .append('td')\n              .attr('class', 'tooltip-value text-right text-nowrap')\n              .html((d) => '');\n\n            return tooltipItem;\n          },\n          (update) => {\n            // update the tooltip label text\n            const tooltipLabel = update.select('.tooltip-label');\n\n            tooltipLabel.html((d) => {\n              return this.tooltipLabelFormatType ? this.tooltipLabelFormat(d.label) : d.label;\n            });\n          },\n          (exit) => exit.remove()\n        );\n    }\n\n    this.svg.selectAll('.points').raise();\n    this.mouserect.raise();\n  };\n\n  legendMouseOver = (event, data) => {\n    // console.log(data, this.linePoints);\n\n    this.chart\n      .selectAll('.legend-item')\n      .filter((d, i) => {\n        return d.label !== data.label;\n      })\n      .classed('inactive', true);\n\n    this.svg\n      .selectAll('.line')\n      .filter((d, i) => {\n        return d.label !== data.label;\n      })\n      .classed('inactive', true);\n\n    if (this.area) {\n      this.svg\n        .selectAll('.area')\n        .filter((d, i) => {\n          return d.label !== data.label;\n        })\n        .classed('inactive', true);\n    }\n\n    if (this.linePoints) {\n      this.svg\n        .selectAll('.points')\n        .filter((d, i) => {\n          return d.label !== data.label;\n        })\n        .selectAll('circle')\n        .classed('inactive', true);\n    }\n\n    this.hovered.emit({ event, data });\n  };\n\n  legendMouseOut = () => {\n    this.chart.selectAll('.legend-item').classed('inactive', false);\n\n    this.chart.selectAll('.line').classed('inactive', false).classed('active', false);\n\n    if (this.linePoints) {\n      this.svg.selectAll('circle').classed('active', false).classed('inactive', false);\n    }\n\n    if (this.area) {\n      this.svg.selectAll('.area').classed('inactive', false);\n    }\n  };\n\n  legendMouseClick = (event, data) => {\n    this.clicked.emit({ event, data });\n  };\n\n  mouserectMouseMove = (event, data) => {\n    const mouseXDate = this.xAxisScale.invert(d3_pointer(event)[0]); // return date at mouse x position\n\n    const leftIndex = d3_bisectLeft(this.data.dates, d3_isoFormat(mouseXDate)); // index of left closest date\n\n    // prevent error for 0 index\n    if (leftIndex === 0) return false;\n\n    const dateLower = new Date(this.data.dates[leftIndex - 1]);\n    const dateUpper = new Date(this.data.dates[leftIndex]);\n    const closestDate = +mouseXDate - +dateLower > +dateUpper - mouseXDate ? dateUpper : dateLower; // date mouse is closest to\n    const closestIndex = this.data.dates.indexOf(d3_isoFormat(closestDate)); // which index the mouse is closest to\n    // console.log(+mouseXDate, leftIndex, +dateLower, +dateUpper, +closestDate, closestIndex);\n\n    const circles = this.svg.selectAll('.line-group').selectAll('circle');\n    circles.filter((d, i) => i === closestIndex).classed('active', true);\n    circles.filter((d, i) => i !== closestIndex).classed('active', false);\n\n    this.tooltipLine\n      .attr('x1', this.xAxisScale(closestDate))\n      .attr('x2', this.xAxisScale(closestDate))\n      .classed('active', true);\n\n    // console.log(this.tooltipLine.node().getBoundingClientRect(), this._scroll.getScrollPosition());\n    this.tooltipShow(this.tooltipLine.node(), closestIndex);\n\n    this.mousedata = {\n      date: closestDate,\n      series: this.data.series.map((d) => {\n        return {\n          label: d.label,\n          value: d.values[closestIndex]\n        };\n      })\n    };\n\n    this.tooltipHovered.emit({ event, data: this.mousedata });\n  };\n\n  mouserectMouseOut = (event, data) => {\n    this.svg.selectAll('circle').classed('active', false);\n    this.tooltipLine.classed('active', false);\n    this.tooltipHide();\n  };\n\n  mouserectMouseClick = () => {\n    this.tooltipClicked.emit({ event, data: this.mousedata });\n  };\n\n  private tooltipShow = (node, closestIndex) => {\n    const scroll = this._scroll.getScrollPosition();\n    const mouserectDimensions = node.getBoundingClientRect();\n    const tooltipOffsetHeight = +this.tooltip.node().offsetHeight;\n    const tooltipDimensions = this.tooltip.node().getBoundingClientRect();\n    const dimensionCalculated = mouserectDimensions.left + tooltipDimensions.width + 8;\n    const clientWidth = document.body.clientWidth - 10;\n    let position;\n\n    // console.log(scroll, mouserectDimensions, tooltipOffsetHeight, tooltipDimensions, dimensionCalculated, clientWidth);\n\n    this.tooltip.select('.tooltip-header').html((d) => {\n      const parsedTime = d3_isoParse(this.data.dates[closestIndex]);\n      return this.tooltipHeadingFormat(parsedTime);\n    });\n\n    this.tooltip.selectAll('.tooltip-value').html((d, i) => {\n      return this.tooltipValueFormatType\n        ? this.tooltipValueFormat(this.data.series[i].values[closestIndex])\n        : this.data.series[i].values[closestIndex];\n    });\n\n    // flip the tooltip positions if near the right edge of the screen\n    if (dimensionCalculated > clientWidth) {\n      this.tooltip.classed('east', true);\n      this.tooltip.classed('west', false);\n      position = `${mouserectDimensions.left - tooltipDimensions.width - 8}px`;\n    } else if (dimensionCalculated < clientWidth) {\n      this.tooltip.classed('east', false);\n      this.tooltip.classed('west', true);\n      position = `${mouserectDimensions.left + 8}px`;\n    }\n\n    // console.log('POSITION: ', position, mouserectDimensions);\n\n    // set the tooltip styles\n    this.tooltip.style(\n      'top',\n      `${mouserectDimensions.top + mouserectDimensions.height / 2 - tooltipOffsetHeight / 2 + scroll[1]}px`\n    );\n    this.tooltip.style('left', position);\n    this.tooltip.style('opacity', 1);\n  };\n\n  private tooltipHide = () => {\n    this.tooltip.style('opacity', 0);\n  };\n\n  private xAxisFormatter = (item) => {\n    const parseDate = d3_isoParse(item);\n    return this.xAxisFormat(parseDate);\n  };\n\n  private yAxisFormatter = (item) => {\n    return this.yAxisFormat(item);\n  };\n}\n","import { Component, OnInit, Input, ElementRef, HostBinding, OnChanges, SimpleChanges } from '@angular/core';\n\nimport { select as d3_select } from 'd3-selection';\nimport { interpolate as d3_interpolate } from 'd3-interpolate';\nimport { arc as d3_arc } from 'd3-shape';\nimport { format as d3_format } from 'd3-format';\n\nimport { PbdsDatavizService } from './dataviz.service';\nimport { PbdsDatavizGauge } from './dataviz.interfaces';\n\n@Component({\n  selector: 'pbds-dataviz-gauge',\n  template: `\n    <div\n      *ngIf=\"!hideLabel\"\n      class=\"gauge-details\"\n      [ngClass]=\"{ halfmoon: type === 'halfmoon', 'gauge-details-small': type === 'halfmoon' }\"\n      [ngStyle]=\"{ 'max-width.px': width - 3 * gaugeWidth }\"\n    >\n      <div class=\"gauge-number\">{{ label }}</div>\n      <div *ngIf=\"description\" class=\"gauge-description text-center\">{{ description }}</div>\n    </div>\n  `,\n  styles: []\n})\nexport class PbdsDatavizGaugeComponent implements OnInit, OnChanges {\n  @HostBinding('class.pbds-chart')\n  chartClass = true;\n\n  @HostBinding('class.pbds-chart-gauge')\n  gaugeClass = true;\n\n  @Input()\n  data: PbdsDatavizGauge;\n\n  @Input()\n  width = 300;\n\n  @Input()\n  type: 'halfmoon' | 'horseshoe' | 'circle' = 'halfmoon';\n\n  @Input()\n  color = '#E23DA8';\n\n  @Input()\n  hideLabel = false;\n\n  @Input()\n  labelFormatString = '';\n\n  @Input()\n  description;\n\n  @Input()\n  gaugeWidth = 20;\n\n  private chart;\n  private svg;\n  private gauge;\n  private labelTween;\n  public label;\n  private startAngle;\n  private endAngle;\n  private radius;\n  private arc;\n  private labelFormat;\n  private oldValue;\n  private height;\n  private rounded;\n\n  constructor(private _dataviz: PbdsDatavizService, private _element: ElementRef) {}\n\n  ngOnInit() {\n    this.height = this.width;\n    this.radius = Math.max(this.width, this.height) / 2;\n    this.labelFormat = d3_format(this.labelFormatString);\n    this.label = this.labelFormat(this.data.value);\n\n    switch (this.type) {\n      case 'halfmoon':\n        this.startAngle = -90;\n        this.endAngle = 90;\n        this.rounded = true;\n        break;\n\n      case 'horseshoe':\n        this.startAngle = -140;\n        this.endAngle = 140;\n        this.rounded = true;\n        break;\n\n      case 'circle':\n        this.startAngle = 0;\n        this.endAngle = 360;\n        this.rounded = false;\n        break;\n    }\n\n    this.arc = d3_arc().cornerRadius(this.rounded ? this.gaugeWidth : 0);\n\n    this.chart = d3_select(this._element.nativeElement).attr('aria-hidden', 'true');\n\n    this.svg = this.chart\n      .append('svg')\n      .attr('width', this.width)\n      .attr('height', this.height)\n      .attr('class', 'img-fluid')\n      .attr('preserveAspectRatio', 'xMinYMin meet')\n      .attr('viewBox', `-${this.width / 2} -${this.height / 2} ${this.width} ${this.height}`);\n\n    this.drawChart();\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    if (changes.data && !changes.data.firstChange) {\n      this.oldValue = changes.data.previousValue.value;\n      this.updateChart();\n    }\n  }\n\n  degreesToRadians = degree => {\n    return (degree * Math.PI) / 180;\n  };\n\n  calculateMinMax = () => {\n    const percentage = this.data.minvalue / (this.data.maxvalue - this.data.minvalue);\n\n    return percentage * (this.data.value - this.data.minvalue) + (this.data.value - this.data.minvalue);\n  };\n\n  calculateCurve = data => {\n    const start = this.degreesToRadians(this.startAngle);\n    const end = start + (data * (this.degreesToRadians(this.endAngle) - start)) / this.data.maxvalue;\n\n    return [\n      {\n        startAngle: start,\n        endAngle: end\n      }\n    ];\n  };\n\n  drawChart = () => {\n    this.gauge = this.svg.append('g').attr('class', 'gauge-group');\n\n    // background arc\n    this.gauge\n      .append('path')\n      .data(this.calculateCurve(this.data.maxvalue))\n      .attr('class', 'gauge-background')\n      .attr('d', d => {\n        return this.arc({\n          innerRadius: this.radius - this.gaugeWidth,\n          outerRadius: this.radius,\n          startAngle: d.startAngle,\n          endAngle: d.endAngle\n        });\n      });\n\n    // value arc\n    this.gauge\n      .append('path')\n      .data(this.calculateCurve(this.calculateMinMax()))\n      .attr('class', 'gauge-value')\n      .attr('fill', this.color)\n      .attr('d', d => {\n        return this.arc({\n          innerRadius: this.radius - this.gaugeWidth,\n          outerRadius: this.radius,\n          startAngle: d.startAngle,\n          endAngle: d.endAngle\n        });\n      });\n\n    switch (this.type) {\n      case 'horseshoe':\n        this.svg.attr('height', 230).attr('viewBox', `-${this.width / 2} -${this.height / 2} ${this.height} 230`);\n        break;\n      case 'halfmoon':\n        this.svg.attr('height', this.width / 2);\n        this.svg.attr('viewBox', `-${this.width / 2} -${this.width / 2} ${this.width} ${this.width / 2}`);\n        break;\n    }\n  };\n\n  updateChart = () => {\n    const group = this.svg.select('.gauge-group');\n\n    group\n      .select('.gauge-value')\n      .transition()\n      .duration(750)\n      .call(this.arcTween, this.calculateMinMax());\n\n    this.labelTween = this.chart.select('.gauge-number');\n\n    this.labelTween\n      .transition()\n      .duration(750)\n      .call(this.textTween, this.data.value);\n  };\n\n  arcTween = (transition, value) => {\n    const newAngle = this.calculateCurve(value);\n\n    transition.attrTween('d', d => {\n      const interpolate = d3_interpolate(d.endAngle, newAngle[0].endAngle);\n\n      return t => {\n        d.endAngle = interpolate(t);\n\n        return this.arc({\n          innerRadius: this.radius - this.gaugeWidth,\n          outerRadius: this.radius,\n          startAngle: d.startAngle,\n          endAngle: d.endAngle\n        });\n      };\n    });\n  };\n\n  textTween = (transition, value) => {\n    value = d3_format('.4f')(value);\n    value = value.replace(/,/g, '.');\n\n    transition.tween('text', () => {\n      const interpolate = d3_interpolate(d3_format('.4f')(+this.oldValue), value);\n\n      return t => {\n        this.labelTween.text(d => {\n          const updatedNumber = this.labelFormat(interpolate(t));\n          this.label = updatedNumber;\n          return updatedNumber;\n        });\n      };\n    });\n  };\n}\n","import {\n  Component,\n  OnInit,\n  Input,\n  ElementRef,\n  HostBinding,\n  ChangeDetectionStrategy,\n  OnChanges,\n  SimpleChanges\n} from '@angular/core';\n\nimport { select as d3_select } from 'd3-selection';\nimport { line as d3_line, area as d3_area } from 'd3-shape';\nimport { scaleLinear as d3_scaleLinear } from 'd3-scale';\nimport { min as d3_min, max as d3_max } from 'd3-array';\n\nimport { PbdsDatavizSparkline } from './dataviz.interfaces';\n\n@Component({\n  selector: 'pbds-dataviz-sparkline',\n  template: ``,\n  styles: [],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class PbdsDatavizSparklineComponent implements OnInit, OnChanges {\n  @HostBinding('class.pbds-chart')\n  chartClass = true;\n\n  @HostBinding('class.pbds-chart-sparkline')\n  sparklineClass = true;\n\n  @Input()\n  data: PbdsDatavizSparkline[] = [];\n\n  @Input()\n  width = 160;\n\n  @Input()\n  height = 40;\n\n  @Input()\n  type: 'line' | 'line-high' | 'area' | 'area-high' | 'bar' = 'line';\n\n  @Input()\n  color = '#E23DA8';\n\n  @Input()\n  colorNegative: string | null = null; // undocumented, may add if needed\n\n  @Input()\n  strokeWidth = 2; // undocumented, width is automatically set by the type\n\n  @Input()\n  yAxisMinBuffer = 0;\n\n  @Input()\n  yAxisMaxBuffer = 0;\n\n  private chart;\n  private svg;\n  private margin;\n\n  constructor(private _element: ElementRef) {}\n\n  ngOnInit() {\n    this.margin = { top: 1, right: 0, bottom: 1, left: 0 };\n\n    if (this.type === 'bar') {\n      this.margin = { top: 0, right: 0, bottom: 0, left: 0 };\n    }\n\n    if (this.type === 'line-high' || this.type === 'area-high') {\n      this.strokeWidth = 1;\n    }\n\n    if (this.colorNegative === null) {\n      this.colorNegative = this.color;\n    }\n\n    this.chart = d3_select(this._element.nativeElement).attr('aria-hidden', 'true');\n\n    this.svg = this.chart\n      .append('svg')\n      .attr('width', this.width)\n      .attr('height', this.height)\n      .attr('class', 'img-fluid')\n      .attr('preserveAspectRatio', 'xMinYMin meet')\n      .attr('viewBox', `-${this.margin.left} -${this.margin.top} ${this.width} ${this.height}`);\n\n    if (this.type === 'line' || this.type === 'line-high' || this.type === 'area' || this.type === 'area-high') {\n      this.svg\n        .append('path')\n        .attr('class', 'sparkline')\n        .attr('fill', 'none')\n        .attr('stroke-width', this.strokeWidth)\n        .attr('stroke', this.color);\n    }\n\n    if (this.type === 'area' || this.type === 'area-high') {\n      this.svg.append('path').attr('class', 'sparkarea').attr('fill', this.color).attr('fill-opacity', 0.3);\n    }\n\n    this.updateChart();\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    if (changes.data && !changes.data.firstChange) {\n      this.updateChart();\n    }\n  }\n\n  updateChart() {\n    const data: any = this.data;\n\n    const x = d3_scaleLinear()\n      .domain([0, this.data.length])\n      .range([0, this.width - this.margin.left - this.margin.right]);\n\n    const y = d3_scaleLinear()\n      .domain([+d3_min(data) - this.yAxisMinBuffer, +d3_max(data) + this.yAxisMaxBuffer])\n      .range([this.height - this.margin.top - this.margin.bottom, 0]);\n\n    const line = d3_line()\n      .x((d, i) => x(i))\n      .y((d: any) => y(d));\n\n    const area = d3_area()\n      .x((d, i) => x(i))\n      .y0(this.height)\n      .y1((d: any) => y(d));\n\n    if (this.type === 'line' || this.type === 'line-high' || this.type === 'area' || this.type === 'area-high') {\n      this.svg\n        .selectAll('.sparkline')\n        .transition()\n        .duration(1000)\n        .attr('d', () => line(data));\n    }\n\n    if (this.type === 'area' || this.type === 'area-high') {\n      this.svg\n        .selectAll('.sparkarea')\n        .transition()\n        .duration(1000)\n        .attr('d', () => area(data));\n    }\n\n    if (this.type === 'bar') {\n      const barWidth = (this.width - this.data.length) / this.data.length;\n\n      // handles negative values, see example https://www.essycode.com/posts/create-sparkline-charts-d3/\n      this.svg\n        .selectAll('.sparkbar')\n        .data(this.data)\n        .join(\n          (enter) =>\n            enter\n              .append('rect')\n              .attr('class', 'sparkbar')\n              .attr('x', (d, i) => x(i))\n              .attr('y', this.height)\n              .attr('width', barWidth)\n              .attr('fill', (d) => (d > 0 ? this.color : this.colorNegative)) // still uses undocumented negative color values\n              .attr('height', 0)\n              .call((enter) => {\n                enter\n                  .transition()\n                  .duration(1000)\n                  .attr('y', (d) => (d > 0 ? y(d) : y(0)))\n                  .attr('height', (d) => Math.abs(y(d) - y(0)));\n\n                return enter;\n              }),\n          (update) =>\n            update\n              .transition()\n              .duration(1000)\n              .selection()\n              .attr('x', (d, i) => x(i))\n              .attr('y', (d) => (d > 0 ? y(d) : y(0)))\n              .attr('width', barWidth)\n              .attr('height', (d) => Math.abs(y(d) - y(0)))\n              .attr('fill', (d) => (d > 0 ? this.color : this.colorNegative)),\n          (exit) => exit.remove()\n        );\n    }\n  }\n}\n","import {\n  Component,\n  OnInit,\n  OnChanges,\n  Input,\n  Output,\n  EventEmitter,\n  ElementRef,\n  HostBinding,\n  OnDestroy,\n  SimpleChanges,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { ViewportScroller } from '@angular/common';\n\nimport { select as d3_select } from 'd3-selection';\nimport { scaleOrdinal as d3_scaleOrdinal, scaleLinear as d3_scaleLinear, scaleBand as d3_scaleBand } from 'd3-scale';\nimport { max as d3_max } from 'd3-array';\nimport { axisBottom as d3_axisBottom, axisLeft as d3_axisLeft } from 'd3-axis';\nimport { isoParse as d3_isoParse } from 'd3-time-format';\nimport { stack as d3_stack, stackOrderNone as d3_stackOrderNone } from 'd3-shape';\n\nimport { PbdsDatavizService } from './dataviz.service';\nimport { PbdsDatavizBarStacked } from './dataviz.interfaces';\n\n@Component({\n  selector: 'pbds-dataviz-bar-stacked',\n  template: ``,\n  styles: [],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class PbdsDatavizBarStackedComponent implements OnInit, OnDestroy, OnChanges {\n  @HostBinding('class.pbds-chart')\n  chartClass = true;\n\n  @HostBinding('class.pbds-chart-stacked-bar')\n  stackedBarClass = true;\n\n  @Input()\n  data: Array<PbdsDatavizBarStacked>;\n\n  @Input()\n  width = 306;\n\n  @Input()\n  height = 400;\n\n  @Input()\n  type: 'low' | 'medium' | 'high' | 'debug' = 'medium'; // debug to show all chart options\n\n  @Input()\n  marginTop = 10; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  marginRight = 0; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  marginBottom = 30; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  marginLeft = 55; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  hideXAxis = false;\n\n  @Input()\n  xAxisFormatType: 'number' | 'time' = null;\n\n  @Input()\n  xAxisFormatString = '';\n\n  @Input()\n  yAxisFormatType: 'number' | 'time' = null;\n\n  @Input()\n  yAxisFormatString = '';\n\n  @Input()\n  yAxisTicks = 5;\n\n  @Input()\n  yAxisMaxBuffer = 0.01;\n\n  @Input()\n  hideLegend = false;\n\n  @Input()\n  legendWidth = 105 + 28; // hardcoded legend width + left margin, do not document until feedback\n\n  @Input()\n  legendPosition: 'right' | 'bottom' = 'right';\n\n  @Input()\n  legendLabelFormatType: 'number' | 'time' = null;\n\n  @Input()\n  legendLabelFormatString = '';\n\n  @Input()\n  tooltipHeadingFormatType: 'time' = null;\n\n  @Input()\n  tooltipHeadingFormatString = '';\n\n  @Input()\n  tooltipHeadingValueFormatType: 'number' = null;\n\n  @Input()\n  tooltipHeadingValueFormatString = '';\n\n  @Input()\n  tooltipLabelFormatType: 'time' = null;\n\n  @Input()\n  tooltipLabelFormatString = '';\n\n  @Input()\n  tooltipValueFormatType: 'number' = null;\n\n  @Input()\n  tooltipValueFormatString = '';\n\n  @Input()\n  theme;\n\n  @Output()\n  hovered: EventEmitter<object> = new EventEmitter<object>();\n\n  @Output()\n  clicked: EventEmitter<object> = new EventEmitter<object>();\n\n  private dataStack;\n  private dataKeys;\n  private chart;\n  private svg;\n  private grayBars;\n  private mouseBars;\n  private bars;\n  private margin;\n  private colorRange;\n  private hideGrayBars: boolean;\n  private xAxisScale;\n  private xAxisCall;\n  private xAxis;\n  private xAxisFormat;\n  private xAxisTickSize: number;\n  private xAxisTickSizeOuter: number;\n  private hideXAxisDomain: boolean;\n  private hideXAxisZero: boolean;\n  private hideXAxisTicks: boolean;\n  private hideXGrid: boolean;\n  private hideYGrid: boolean;\n  private yAxisMax;\n  private yAxisScale;\n  private yAxisCall;\n  private yAxis;\n  private yAxisFormat;\n  private yAxisTickSize: number;\n  private yAxisTickSizeOuter: number;\n  private xGrid;\n  private xGridCall;\n  private yGrid;\n  private yGridCall;\n  private hideYAxis: boolean;\n  private hideYAxisZero: boolean;\n  private hideYAxisDomain: boolean;\n  private hideYAxisTicks: boolean;\n  private legendLabelFormat;\n  private tooltip;\n  private hideTooltip: boolean;\n  private tooltipHeadingFormat;\n  private tooltipHeadingValueFormat;\n  private tooltipValueFormat;\n  private tooltipLabelFormat;\n\n  constructor(private _dataviz: PbdsDatavizService, private _element: ElementRef, private _scroll: ViewportScroller) {}\n\n  ngOnInit() {\n    // extract keys for stack data\n    this.dataKeys = Object.keys(this.data[0]).filter((item) => item !== 'key');\n\n    // create the D3 stack data\n    this.dataStack = d3_stack().keys(this.dataKeys).order(d3_stackOrderNone)(this.data);\n\n    //////////////////////////////////////////\n\n    this.margin = {\n      top: +this.marginTop,\n      right: +this.marginRight,\n      bottom: +this.marginBottom,\n      left: +this.marginLeft\n    };\n\n    // create formatters\n    this.xAxisFormat = this._dataviz.d3Format(this.xAxisFormatType, this.xAxisFormatString);\n    this.yAxisFormat = this._dataviz.d3Format(this.yAxisFormatType, this.yAxisFormatString);\n    this.legendLabelFormat = this._dataviz.d3Format(this.legendLabelFormatType, this.legendLabelFormatString);\n    this.tooltipHeadingFormat = this._dataviz.d3Format(this.tooltipHeadingFormatType, this.tooltipHeadingFormatString);\n    this.tooltipHeadingValueFormat = this._dataviz.d3Format(\n      this.tooltipHeadingValueFormatType,\n      this.tooltipHeadingValueFormatString\n    );\n    this.tooltipLabelFormat = this._dataviz.d3Format(this.tooltipLabelFormatType, this.tooltipLabelFormatString);\n    this.tooltipValueFormat = this._dataviz.d3Format(this.tooltipValueFormatType, this.tooltipValueFormatString);\n\n    // defaults for all chart types\n    this.hideGrayBars = false;\n    this.hideYAxis = false;\n    this.hideXAxisZero = false;\n    this.hideYAxisZero = false;\n    this.hideXGrid = false;\n    this.hideYGrid = false;\n    this.hideXAxisDomain = false;\n    this.hideYAxisDomain = false;\n    this.hideTooltip = false;\n    this.hideXAxisTicks = false;\n    this.hideYAxisTicks = false;\n    this.xAxisTickSize = 8;\n    this.xAxisTickSizeOuter = 0;\n    this.yAxisTickSize = 8;\n    this.yAxisTickSizeOuter = 0;\n    // this.hideTooltipLabel = false;\n\n    if (this.type !== 'debug') {\n      // set type defaults\n      switch (this.type) {\n        case 'low':\n          this.hideGrayBars = true;\n          this.hideXAxisTicks = true;\n          this.hideXGrid = true;\n          this.hideYAxisDomain = false;\n          this.hideYAxisTicks = true;\n          this.legendPosition = 'bottom';\n          break;\n\n        case 'medium':\n          this.hideXAxisDomain = true;\n          this.hideXGrid = true;\n          this.hideXAxisTicks = true;\n          this.hideYAxisDomain = true;\n          this.hideYAxisTicks = true;\n          this.hideYGrid = true;\n          break;\n\n        case 'high':\n          this.hideXAxis = true;\n          this.hideXAxisTicks = true;\n          this.hideXAxisDomain = true;\n          this.hideXGrid = true;\n          this.hideYAxisDomain = true;\n          this.hideYAxisTicks = true;\n          this.hideYGrid = true;\n          this.hideLegend = false;\n          this.legendPosition = 'bottom';\n          break;\n      }\n    }\n\n    // adjust margin if xAxis hidden\n    if (this.hideXAxis) this.margin.bottom = 10; // need small margin for yAxis with 0 tick label\n\n    if (!this.hideLegend && this.legendPosition === 'right') {\n      this.width = +this.width - +this.legendWidth;\n    }\n\n    // create the chart\n    this.chart = d3_select(this._element.nativeElement).attr('aria-hidden', 'true');\n\n    // create chart svg\n    this.svg = this.chart\n      .append('svg')\n      .attr('width', +this.width)\n      .attr('height', +this.height + this.margin.top + this.margin.bottom)\n      .attr('class', 'img-fluid')\n      .attr('preserveAspectRatio', 'xMinYMin meet')\n      .attr(\n        'viewBox',\n        `-${this.margin.left} -${this.margin.top} ${+this.width} ${+this.height + this.margin.top + this.margin.bottom}`\n      );\n\n    this.grayBars = this.svg.append('g').attr('class', 'gray-bars');\n    this.mouseBars = this.svg.append('g').attr('class', 'mouseover-bars');\n    this.bars = this.svg.append('g').attr('class', 'bars');\n\n    // build color ranges\n    this.colorRange = d3_scaleOrdinal().range(this._dataviz.getColors(false, this.theme));\n\n    // X AXIS\n    this.xAxisScale = d3_scaleBand()\n      .domain(this.data.map((d) => d.key))\n      .rangeRound([0, this.width - this.margin.left])\n      .align(0);\n\n    // add padding to the scale for gray bars\n    !this.hideGrayBars\n      ? this.xAxisScale.paddingInner(0.1).paddingOuter(0)\n      : this.xAxisScale.paddingInner(0).paddingOuter(0);\n\n    this.xAxisCall = d3_axisBottom(this.xAxisScale)\n      .tickSize(this.xAxisTickSize)\n      .tickSizeOuter(this.xAxisTickSizeOuter)\n      .tickFormat(this.xAxisFormatter);\n\n    this.xAxis = this.svg\n      .append('g')\n      .attr('class', 'axis axis-x')\n      .attr('transform', `translate(0, ${this.height})`)\n      .classed('axis-hidden', this.hideXAxis)\n      .classed('axis-zero-hidden', this.hideXAxisZero)\n      .classed('axis-domain-hidden', this.hideXAxisDomain)\n      .classed('axis-ticks-hidden', this.hideXAxisTicks)\n      .call(this.xAxisCall);\n\n    // X GRIDLINES\n    if (!this.hideXGrid) {\n      this.xGridCall = d3_axisBottom(this.xAxisScale).tickSize(-this.height);\n\n      this.xGrid = this.svg\n        .append('g')\n        .attr('class', 'grid grid-x')\n        .classed('grid-zero-hidden', this.hideXAxisZero)\n        .attr('transform', `translate(0, ${this.height})`)\n        .call(this.xGridCall);\n    }\n\n    // KEEP: use this block to debug yAxisMax\n    // console.log(\n    //   d3_max(this.dataStack, (data: any) => {\n    //     // console.log(data);\n\n    //     return d3_max(data, (d: any) => {\n    //       // console.log('D: ', d);\n    //       return d[1];\n    //     });\n    //   })\n    // );\n\n    // Y AXIS\n    this.yAxisMax = d3_max(this.dataStack, (data: any) => {\n      return d3_max(data, (d: any) => {\n        return d[1];\n      });\n    });\n\n    this.yAxisMax = this.yAxisMax + this.yAxisMax * this.yAxisMaxBuffer;\n\n    this.yAxisScale = d3_scaleLinear().domain([0, this.yAxisMax]).nice().rangeRound([this.height, 0]);\n\n    this.yAxisCall = d3_axisLeft(this.yAxisScale)\n      .ticks(this.yAxisTicks)\n      .tickSize(this.yAxisTickSize)\n      .tickSizeOuter(this.yAxisTickSizeOuter)\n      .tickFormat(this.yAxisFormatter);\n\n    this.yAxis = this.svg\n      .append('g')\n      .attr('class', 'axis axis-y')\n      .classed('axis-hidden', this.hideYAxis)\n      .classed('axis-zero-hidden', this.hideYAxisZero)\n      .classed('axis-domain-hidden', this.hideYAxisDomain)\n      .classed('axis-ticks-hidden', this.hideYAxisTicks)\n      .call(this.yAxisCall);\n\n    // Y GRIDLINES\n    if (!this.hideYGrid) {\n      this.yGridCall = d3_axisLeft(this.yAxisScale)\n        .ticks(this.yAxisTicks)\n        .tickSize(-this.width + this.margin.left + this.margin.right);\n\n      this.yGrid = this.svg\n        .append('g')\n        .attr('class', 'grid grid-y')\n        .classed('grid-zero-hidden', this.hideYAxisZero)\n        .attr('transform', `translate(0, 0)`)\n        .call(this.yGridCall);\n    }\n\n    // TOOLTIP\n    if (!this.hideTooltip) {\n      this.tooltip = d3_select('body')\n        .append('div')\n        .attr('class', 'pbds-tooltip west')\n        .style('opacity', 0)\n        .attr('aria-hidden', 'true'); // hide tooltip for accessibility\n\n      // tooltip header\n      this.tooltip.append('div').attr('class', 'tooltip-header');\n      this.tooltip.append('div').attr('class', 'tooltip-header-value');\n\n      // tooltip table\n      this.tooltip.append('table').attr('class', 'tooltip-table text-left w-100').append('tbody');\n    }\n\n    // add legend classes\n    if (!this.hideLegend) {\n      this.chart.classed('pbds-chart-legend-bottom', this.legendPosition === 'bottom' ? true : false);\n      this.chart.append('ul').attr('class', `legend legend-${this.legendPosition}`);\n    }\n\n    this.updateChart();\n  }\n\n  ngOnDestroy() {\n    if (this.tooltip) this.tooltip.remove();\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    if (changes.data && !changes.data.firstChange) {\n      this.updateChart(false);\n    }\n  }\n\n  updateChart = (firstRun = true) => {\n    this.dataKeys = Object.keys(this.data[0]).filter((item) => item !== 'key');\n\n    // create the D3 stack data\n    this.dataStack = d3_stack().keys(this.dataKeys).order(d3_stackOrderNone)(this.data);\n\n    // update the xScale\n    this.xAxisScale.domain(this.data.map((d) => d.key));\n\n    // update the yScale\n    this.yAxisMax = d3_max(this.dataStack, (data: any) => {\n      return d3_max(data, (d: any) => {\n        return d[1];\n      });\n    });\n\n    this.yAxisMax = this.yAxisMax + this.yAxisMax * this.yAxisMaxBuffer;\n\n    this.yAxisScale.domain([0, this.yAxisMax]).rangeRound([this.height, 0]).nice();\n\n    this.xAxis\n      .transition()\n      .duration(0) // 1000\n      .call(this.xAxisCall);\n\n    this.yAxis\n      .transition()\n      .duration(0) // 1000\n      .call(this.yAxisCall);\n\n    // update the grids\n    if (!this.hideXGrid) {\n      this.xGrid\n        .transition()\n        .duration(0) // 1000\n        .call(this.xGridCall);\n    }\n\n    if (!this.hideYGrid) {\n      this.yGrid\n        .transition()\n        .duration(0) // 1000\n        .call(this.yGridCall);\n    }\n\n    // add gray bars\n    if (!this.hideGrayBars) {\n      this.grayBars\n        .selectAll('.gray-bar')\n        .data(this.data)\n        .join(\n          (enter) =>\n            enter\n              .append('rect')\n              .attr('class', 'gray-bar')\n              .attr('x', (d) => this.xAxisScale(d.key))\n              .attr('width', this.xAxisScale.bandwidth())\n              .attr('height', this.height),\n          (update) =>\n            update\n              .transition()\n              .duration((d, i, n) => (firstRun ? 0 : 1000))\n              .attr('x', (d) => this.xAxisScale(d.key))\n              .attr('width', this.xAxisScale.bandwidth())\n              .attr('height', this.height)\n              .selection(),\n          (exit) => exit.remove()\n        );\n    }\n\n    // add colored bars\n    const barGroups = this.bars\n      .selectAll('.bar-group')\n      .data(this.dataStack)\n      .join(\n        (enter) =>\n          enter\n            .append('g')\n            .attr('class', 'bar-group')\n            .attr('fill', (d) => this.colorRange(d.index)),\n        (update) => update.attr('fill', (d) => this.colorRange(d.index)),\n        (exit) => exit.remove()\n      );\n\n    barGroups\n      .selectAll('.bar')\n      .data((d) => d)\n      .join(\n        (enter) =>\n          enter\n            .append('rect')\n            .attr('class', 'bar')\n            .classed('bar-divided', this.type !== 'high')\n            .classed('bar-divided-low', this.type === 'low')\n            .attr('x', (d, i) => {\n              let x;\n\n              if (this.type === 'medium') {\n                x = this.xAxisScale(d.data.key) + (this.xAxisScale.bandwidth() / 8) * 3;\n              } else {\n                x = this.xAxisScale(d.data.key) + (this.xAxisScale.bandwidth() / 4) * 1;\n              }\n\n              return x;\n            })\n            .attr('y', (d) => this.yAxisScale(d[0]))\n            .attr('width', (d) => {\n              let width;\n\n              if (this.type === 'medium') {\n                width = this.xAxisScale.bandwidth() / 4;\n              } else {\n                width = this.xAxisScale.bandwidth() / 2;\n              }\n\n              return width;\n            })\n            .attr('height', 0)\n            .call((enter) => {\n              enter\n                .transition()\n                .duration((d, i, n) => (firstRun ? 0 : 500))\n                .delay((d, i, n) => (firstRun ? 0 : 750))\n                .attr('y', (d) => this.yAxisScale(d[1]))\n                .attr('height', (d) => {\n                  return this.yAxisScale(d[0]) - this.yAxisScale(d[1]);\n                });\n\n              return enter;\n            }),\n        (update) =>\n          update.call((update) => {\n            // let width;\n\n            // if (this.type === 'medium') {\n            //   width = this.xAxisScale.bandwidth() / 4;\n            // } else {\n            //   width = this.xAxisScale.bandwidth() / 2;\n            // }\n\n            update\n              .transition()\n              .duration(1000)\n              .attr('width', this.xAxisScale.bandwidth() / 4)\n              .attr('x', (d, i) => this.xAxisScale(d.data.key) + (this.xAxisScale.bandwidth() / 8) * 3)\n              .attr('y', (d) => this.yAxisScale(d[1]))\n              .attr('height', (d) => this.yAxisScale(d[0]) - this.yAxisScale(d[1]))\n              .selection();\n\n            return update;\n          }),\n\n        (exit) => exit.remove()\n      );\n\n    // mouseover bars\n    this.mouseBars\n      .selectAll('.mouseover-bar')\n      .data(this.data)\n      .join(\n        (enter) =>\n          enter\n            .append('rect')\n            .attr('class', 'mouseover-bar')\n            .style('opacity', 0)\n            .attr('x', (d) => this.xAxisScale(d.key))\n            .attr('width', this.xAxisScale.bandwidth())\n            .attr('height', this.height),\n        (update) =>\n          update\n            .attr('pointer-events', 'none')\n            .attr('x', (d) => this.xAxisScale(d.key))\n            .attr('width', this.xAxisScale.bandwidth())\n            .attr('height', this.height)\n            .transition()\n            .selection()\n            .attr('pointer-events', 'auto'),\n        (exit) => exit.transition().selection().attr('pointer-events', 'none').remove()\n      )\n      .datum((d, i) => {\n        return { data: d, index: i };\n      })\n      .on('mouseover', (event, data) => this.barMouseOver(event, data))\n      .on('mouseout', (event, data) => this.barMouseOut())\n      .on('click', (event, data) => this.barMouseClick(event, data));\n\n    this.bars.raise();\n    this.xAxis.raise();\n    this.mouseBars.raise();\n\n    if (!this.hideLegend) {\n      this.chart\n        .select('.legend')\n        .selectAll('.legend-item')\n        .data(this.dataStack)\n        .join(\n          (enter) => {\n            const li = enter.append('li').attr('class', 'legend-item');\n\n            li.append('span')\n              .attr('class', 'legend-key')\n              .style('background-color', (d) => this.colorRange(d.index));\n\n            li.append('span')\n              .attr('class', 'legend-label')\n              .html((d) => {\n                switch (this.legendLabelFormatType) {\n                  case 'number':\n                    return this.legendLabelFormat(d.key);\n\n                  case 'time':\n                    const parsedTime = d3_isoParse(d.key);\n                    return this.legendLabelFormat(parsedTime);\n\n                  default:\n                    return d.key;\n                }\n              });\n\n            return li;\n          },\n          (update) => {\n            update.select('.legend-label').html((d) => {\n              switch (this.legendLabelFormatType) {\n                case 'number':\n                  return this.legendLabelFormat(d.key);\n\n                case 'time':\n                  const parsedTime = d3_isoParse(d.key);\n                  return this.legendLabelFormat(parsedTime);\n\n                default:\n                  return d.key;\n              }\n            });\n\n            return update;\n          },\n          (exit) => exit.remove()\n        )\n        .datum((d, i) => {\n          return { data: this.data, index: i };\n        })\n        .on('mouseover', (event, data) => this.legendMouseOver(event, data))\n        .on('mouseout', () => this.legendMouseOut())\n        .on('click', (event, data) => this.legendMouseClick(event, data));\n    }\n  };\n\n  barMouseOver = (event, data) => {\n    this.chart\n      .selectAll('.bar-group')\n      .selectAll('.bar')\n      .filter((d, i) => {\n        return i !== data.index;\n      })\n      .classed('inactive', true);\n\n    this.tooltipShow(event, data);\n\n    this.hovered.emit({ event, data });\n  };\n\n  barMouseOut = () => {\n    this.chart.selectAll('.bar').classed('inactive', false);\n\n    this.tooltipHide();\n  };\n\n  barMouseClick = (event, data) => {\n    this.clicked.emit({ event, data });\n  };\n\n  legendMouseOver = (event, data) => {\n    this.chart\n      .selectAll('.legend-item')\n      .filter((d, i) => i !== data.index)\n      .classed('inactive', true);\n\n    this.chart\n      .selectAll('.bar-group')\n      .filter((d, i) => i !== data.index)\n      .classed('inactive', true);\n\n    this.hovered.emit({ event, data });\n  };\n\n  legendMouseOut = () => {\n    this.chart.selectAll('.legend-item').classed('inactive', false);\n\n    this.chart.selectAll('.bar-group').classed('inactive', false);\n\n    this.tooltipHide();\n  };\n\n  legendMouseClick = (event, data) => {\n    this.clicked.emit({ event, data });\n  };\n\n  private xAxisFormatter = (item) => {\n    switch (this.xAxisFormatType) {\n      case 'number':\n        return this.xAxisFormat(item);\n\n      case 'time':\n        const parseDate = d3_isoParse(item);\n        return this.xAxisFormat(parseDate);\n\n      default:\n        return item;\n    }\n  };\n\n  private tooltipShow = (event, data) => {\n    const scroll = this._scroll.getScrollPosition();\n    const mouserectDimensions = event.currentTarget.getBoundingClientRect();\n    const clientWidth = document.body.clientWidth - 10;\n    let dimensionCalculated;\n    let tooltipDimensions;\n    let tooltipOffsetHeight;\n    // const yPosition = event.currentTarget.getBoundingClientRect();\n    let yPosition;\n    let xPosition;\n\n    // console.log(scroll, mouserectDimensions, tooltipOffsetHeight, tooltipDimensions, dimensionCalculated, clientWidth);\n\n    this.tooltip.select('.tooltip-header').html((d) => {\n      switch (this.tooltipHeadingFormatType) {\n        case 'time':\n          const parseDate = d3_isoParse(data.data.key);\n          return this.tooltipHeadingFormat(parseDate);\n\n        default:\n          return data.data.key;\n      }\n    });\n\n    this.tooltip.select('.tooltip-header-value').html((d) => {\n      let total = 0;\n\n      Object.keys(data.data).map((e) => {\n        if (e !== 'key') {\n          total = total + data.data[e];\n        }\n      });\n\n      return this.tooltipHeadingValueFormat(total);\n    });\n\n    this.tooltip\n      .select('.tooltip-table')\n      .select('tbody')\n      .html((d) => {\n        let html = ``;\n        let label;\n        let value;\n\n        Object.keys(data.data).map((key, index) => {\n          switch (this.tooltipLabelFormatType) {\n            case 'time':\n              const parseDate = d3_isoParse(key);\n              label = this.tooltipHeadingFormat(parseDate);\n              break;\n\n            default:\n              label = key;\n          }\n\n          switch (this.tooltipValueFormatType) {\n            case 'number':\n              value = this.tooltipValueFormat(data.data[key]);\n              break;\n\n            default:\n              value = data.data[key];\n          }\n\n          if (key !== 'key') {\n            html += `\n              <tr class='tooltip-item'>\n                <td style=\"color: ${this.colorRange(index - 1)}\">\n                  <span class=\"pbds-tooltip-key\"></span>\n                </td>\n                <td class=\"tooltip-label pr-2 text-nowrap\">${label}</td>\n                <td class=\"tooltip-value text-right text-nowrap\">${value}</td>\n              </tr>\n            `;\n          }\n        });\n\n        return html;\n      });\n\n    tooltipDimensions = this.tooltip.node().getBoundingClientRect();\n    dimensionCalculated = mouserectDimensions.left + mouserectDimensions.width + tooltipDimensions.width + 8;\n    tooltipOffsetHeight = +this.tooltip.node().offsetHeight;\n\n    // flip the tooltip positions if near the right edge of the screen\n    if (dimensionCalculated > clientWidth) {\n      this.tooltip.classed('east', true);\n      this.tooltip.classed('west', false);\n\n      if (this.type === 'medium') {\n        xPosition = `${mouserectDimensions.left + (mouserectDimensions.width / 8) * 3 - tooltipDimensions.width - 8}px`;\n      } else {\n        xPosition = `${mouserectDimensions.left + (mouserectDimensions.width / 4) * 1 - tooltipDimensions.width - 8}px`;\n      }\n    } else if (dimensionCalculated < clientWidth) {\n      this.tooltip.classed('east', false);\n      this.tooltip.classed('west', true);\n\n      if (this.type === 'medium') {\n        xPosition = `${mouserectDimensions.left + (mouserectDimensions.width / 8) * 5 + 8}px`;\n      } else {\n        xPosition = `${mouserectDimensions.left + (mouserectDimensions.width / 4) * 3 + 8}px`;\n      }\n    }\n\n    yPosition = this.svg\n      .selectAll('.bar-group')\n      .filter(':last-child')\n      .selectAll('.bar')\n      .filter((d, i) => {\n        return i === data.index;\n      })\n      .node()\n      .getBoundingClientRect();\n\n    // set the tooltip styles\n    this.tooltip.style('top', `${yPosition.top - tooltipOffsetHeight / 2 + scroll[1]}px`);\n    this.tooltip.style('left', xPosition);\n    this.tooltip.style('opacity', 1);\n  };\n\n  private tooltipHide = () => {\n    this.tooltip.style('opacity', 0);\n  };\n\n  private yAxisFormatter = (item) => {\n    switch (this.yAxisFormatType) {\n      case 'number':\n        return this.yAxisFormat(item);\n\n      case 'time':\n        const parseDate = d3_isoParse(item);\n        return this.yAxisFormat(parseDate);\n\n      default:\n        return item;\n    }\n  };\n}\n","import { Component, Input, HostBinding } from '@angular/core';\n\n@Component({\n  selector: 'pbds-dataviz-metric-indicator',\n  template: `\n    <span>{{ value }}</span>\n  `,\n  styles: []\n})\nexport class PbdsDatavizMetricIndicatorComponent {\n  @Input()\n  value = 0;\n\n  @Input()\n  class = '';\n\n  @Input()\n  indicator: 'flat' | 'increase' | 'decrease' = 'flat';\n\n  @Input()\n  inverse = false;\n\n  @HostBinding('class')\n  get hostClasses() {\n    return ['metric-block-indicator', this.indicator, this.inverse ? 'inverse' : '', this.class].join(' ');\n  }\n}\n","import { Component, OnInit, Input, HostBinding, ElementRef, ContentChild } from '@angular/core';\n\nimport { PbdsDatavizMetricIndicatorComponent } from './dataviz-metric-indicator.component';\n\n@Component({\n  selector: 'pbds-dataviz-metric-block',\n  template: `\n    <div class=\"metric-block-inner\">\n      <div *ngIf=\"heading\" class=\"metric-block-heading\">\n        {{ heading }}\n        <i\n          *ngIf=\"infoMessage\"\n          class=\"pbi-icon-mini pbi-info-circle-open ml-1 align-middle\"\n          ngbTooltip=\"{{ infoMessage }}\"\n          container=\"body\"\n        ></i>\n      </div>\n      <div class=\"metric-block-data-block\">\n        <div class=\"metric-block-contents\">\n          <div class=\"metric-block-value\" [ngClass]=\"{ 'mr-0': hideValueMargin }\">\n            {{ value\n            }}<span [ngClass]=\"{ 'metric-block-unit': isUnit, 'metric-block-percentage': isPercentUnit }\">{{\n              unit\n            }}</span>\n          </div>\n\n          <div>\n            <ng-content select=\"pbds-dataviz-metric-indicator\"></ng-content>\n          </div>\n          <div *ngIf=\"description\" class=\"metric-block-description\">{{ description }}</div>\n        </div>\n        <ng-content select=\"pbds-dataviz-sparkline\"></ng-content>\n      </div>\n    </div>\n  `,\n  styles: []\n})\nexport class PbdsDatavizMetricBlockComponent implements OnInit {\n  @Input()\n  class = '';\n\n  @Input()\n  heading: string = null;\n\n  @Input()\n  value = 0;\n\n  @Input()\n  unit: string = null;\n\n  @Input()\n  description: string = null;\n\n  @Input()\n  centered = false;\n\n  @Input()\n  centeredText = false;\n\n  @Input()\n  vertical = false;\n\n  @Input()\n  infoMessage: string | null = null;\n\n  hideValueMargin = false;\n  isPercentUnit = false;\n  isUnit = false;\n\n  @HostBinding('class')\n  get hostClasses() {\n    return [\n      'metric-block',\n      this.centered ? 'metric-block-centered' : '',\n      this.centeredText ? 'metric-block-centered-text' : '',\n      this.vertical ? 'metric-block-vertical' : '',\n      this.class\n    ].join(' ');\n  }\n\n  @ContentChild(PbdsDatavizMetricIndicatorComponent, { static: true }) indicatorRef: ElementRef;\n\n  ngOnInit() {\n    if (!this.indicatorRef) {\n      this.hideValueMargin = true;\n    }\n\n    if (this.unit !== '%' && this.unit !== null) {\n      this.isUnit = true;\n    } else if (this.unit === '%') {\n      this.isPercentUnit = true;\n    }\n  }\n}\n","import {\n  Component,\n  OnInit,\n  OnChanges,\n  Input,\n  Output,\n  EventEmitter,\n  ElementRef,\n  HostBinding,\n  OnDestroy,\n  SimpleChanges,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { ViewportScroller } from '@angular/common';\n\nimport { select as d3_select } from 'd3-selection';\nimport { scaleLinear as d3_scaleLinear } from 'd3-scale';\nimport { min as d3_min, max as d3_max } from 'd3-array';\nimport {\n  geoPath as d3_geoPath,\n  geoAlbers as d3_geoAlbers,\n  geoAlbersUsa as d3_geoAlbersUsa,\n  geoMercator as d3_geoMercator\n} from 'd3-geo';\n\nimport * as topojson from 'topojson-client';\n\nimport { PbdsDatavizService } from './dataviz.service';\nimport { PbdsDatavizMapData } from './dataviz.interfaces';\n\n@Component({\n  selector: 'pbds-dataviz-bubble-map',\n  template: ``,\n  styles: [],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class PbdsDatavizBubbleMapComponent implements OnInit, OnChanges, OnDestroy {\n  @HostBinding('class.pbds-chart')\n  chartClass = true;\n\n  @HostBinding('class.pbds-chart-bubble-map')\n  bubbleMapClass = true;\n\n  @Input()\n  data: Array<PbdsDatavizMapData>;\n\n  @Input()\n  topojson;\n\n  @Input()\n  feature = '';\n\n  @Input()\n  projectionType;\n\n  @Input()\n  scale = null;\n\n  @Input()\n  center = null;\n\n  @Input()\n  width = 306;\n\n  @Input()\n  height = 400;\n\n  @Input()\n  type: 'medium' | 'high' | 'debug' = 'medium'; // debug to show all chart options\n\n  @Input()\n  dot = false;\n\n  @Input()\n  marginTop = 0;\n\n  @Input()\n  marginRight = 0;\n\n  @Input()\n  marginBottom = 0;\n\n  @Input()\n  marginLeft = 0;\n\n  @Input()\n  color = '#ef8200';\n\n  @Input()\n  textColor = '#fff';\n\n  @Input()\n  textSizeRange = [14, 24];\n\n  @Input()\n  dotSize = 4;\n\n  @Input()\n  bubbleSizeRange = [500, 2000];\n\n  @Input()\n  bubbleLabelFormatType: 'number' = null;\n\n  @Input()\n  bubbleLabelFormatString = '';\n\n  @Input()\n  hideTooltip = false;\n\n  @Input()\n  hideTooltipValue = false;\n\n  @Input()\n  tooltipValueFormatType: 'number' = null;\n\n  @Input()\n  tooltipValueFormatString = '';\n\n  @Output()\n  hovered: EventEmitter<object> = new EventEmitter<object>();\n\n  @Output()\n  clicked: EventEmitter<object> = new EventEmitter<object>();\n\n  private projection;\n  private geoPath;\n  private topojsonFeature;\n  private chart;\n  private svg;\n  private margin;\n  private bubbleContainer;\n  private bubbleRadius;\n  private fontRange;\n  private bubbleLabelFormat;\n  private tooltip;\n  private tooltipValueFormat;\n\n  constructor(private _element: ElementRef, private _scroll: ViewportScroller, private _dataviz: PbdsDatavizService) {}\n\n  ngOnInit() {\n    this.margin = {\n      top: +this.marginTop,\n      right: +this.marginRight,\n      bottom: +this.marginBottom,\n      left: +this.marginLeft\n    };\n\n    if (this.type !== 'debug') {\n      // set type defaults\n      switch (this.type) {\n        case 'medium':\n          break;\n\n        case 'high':\n          break;\n      }\n    }\n\n    switch (this.projectionType) {\n      case 'geoAlbers':\n        this.projection = d3_geoAlbers();\n        break;\n\n      case 'geoAlbersUsa':\n        this.projection = d3_geoAlbersUsa();\n        break;\n\n      case 'geoMercator':\n        this.projection = d3_geoMercator();\n        break;\n\n      default:\n        break;\n    }\n\n    // dreate formatters\n    this.bubbleLabelFormat = this._dataviz.d3Format(this.bubbleLabelFormatType, this.bubbleLabelFormatString);\n    this.tooltipValueFormat = this._dataviz.d3Format(this.tooltipValueFormatType, this.tooltipValueFormatString);\n\n    // console.log('TOPOJSON: ', this.topojson);\n\n    this.topojsonFeature = topojson.feature(this.topojson, this.topojson.objects[this.feature]);\n    this.projection.fitSize([+this.width, +this.height], this.topojsonFeature);\n\n    // console.log('TOPOJSON FEATURE: ', this.topojsonFeature);\n    // console.log('MESH: ', topojson.mesh(this.topojson, this.topojson.objects[this.feature], (a, b) => a !== b));\n    // console.log('DATA: ', this.data);\n\n    if (this.scale) {\n      this.projection.scale(+this.scale);\n    }\n\n    if (this.center) {\n      this.projection.center(this.center);\n    }\n\n    this.geoPath = d3_geoPath().projection(this.projection);\n\n    // bubble radius range\n    if (this.data && !this.dot) {\n      this.bubbleRadius = d3_scaleLinear()\n        .range(this.bubbleSizeRange)\n        .domain([d3_min(this.data, (d: any) => +d.value), d3_max(this.data, (d: any) => +d.value)]);\n\n      // font range\n      this.fontRange = d3_scaleLinear()\n        .range(this.textSizeRange)\n        .domain([d3_min(this.data, (d: any) => +d.value), d3_max(this.data, (d: any) => +d.value)]);\n    }\n\n    // TOOLTIP\n    if (!this.hideTooltip) {\n      this.tooltip = d3_select('body')\n        .append('div')\n        .attr('class', 'pbds-tooltip south')\n        .style('opacity', 0)\n        .attr('aria-hidden', 'true'); // hide tooltip for accessibility\n\n      // tooltip header\n      this.tooltip.append('div').attr('class', 'tooltip-header');\n      if (!this.hideTooltipValue) this.tooltip.append('div').attr('class', 'tooltip-value');\n    }\n\n    // create the chart\n    this.chart = d3_select(this._element.nativeElement).attr('aria-hidden', 'true');\n\n    // create chart svg\n    this.svg = this.chart\n      .append('svg')\n      .attr('width', +this.width + this.margin.left + this.margin.right)\n      .attr('height', +this.height + this.margin.top + this.margin.bottom)\n      .attr('class', 'img-fluid')\n      .attr('preserveAspectRatio', 'xMinYMin meet')\n      .attr(\n        'viewBox',\n        `-${this.margin.left} -${this.margin.top} ${+this.width + this.margin.left + this.margin.right} ${\n          +this.height + this.margin.top + this.margin.bottom\n        }`\n      )\n      .append('g')\n      .attr('class', 'container');\n\n    // map\n    this.svg\n      .append('g')\n      .attr('class', 'map')\n      .selectAll('path')\n      .data(this.topojsonFeature.features)\n      .join((enter) => enter.append('path').attr('class', 'feature').attr('d', this.geoPath));\n\n    // borders\n    this.svg\n      .append('path')\n      .attr('class', 'mesh')\n      .datum(topojson.mesh(this.topojson, this.topojson.objects[this.feature], (a, b) => a !== b))\n      .attr('d', this.geoPath);\n\n    this.bubbleContainer = this.svg.append('g').attr('class', 'dots').style('color', this.color);\n\n    this.updateChart();\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    if (changes.data && !changes.data.firstChange) {\n      this.updateChart();\n    }\n  }\n\n  ngOnDestroy() {\n    if (this.tooltip) this.tooltip.remove();\n  }\n\n  updateChart = () => {\n    // bubbles\n\n    this.bubbleContainer\n      .selectAll('circle')\n      .data(this.data)\n      .join(\n        (enter) =>\n          enter\n            .append('circle')\n            .attr('class', 'dot-circle')\n            .classed('solid', this.dot)\n            .attr('cx', (d) => this.projection([d.longitude, d.latitude])[0])\n            .attr('cy', (d) => this.projection([d.longitude, d.latitude])[1])\n            .attr('r', (d) => (!this.dot ? Math.sqrt(this.bubbleRadius(d.value)) : `${this.dotSize}px`)),\n        (update) =>\n          update\n            .transition()\n            .duration(1000)\n            .attr('cx', (d) => this.projection([d.longitude, d.latitude])[0])\n            .attr('cy', (d) => this.projection([d.longitude, d.latitude])[1])\n            .attr('r', (d) => (!this.dot ? Math.sqrt(this.bubbleRadius(d.value)) : `${this.dotSize}px`))\n            .transition()\n            .selection()\n            .attr('pointer-events', 'auto'),\n        (exit) => exit.transition().selection().attr('pointer-events', 'none').remove()\n      );\n\n    if (!this.hideTooltip) {\n      this.bubbleContainer\n        .selectAll('circle')\n        .on('mouseover', (event, data) => this.bubbleMouseOver(event, data))\n        .on('mouseout', (event, data) => this.bubbleMouseOut(event, data))\n        .on('click', (event, data) => this.bubbleMouseClick(event, data));\n\n      // bubble text\n      if (this.type !== 'high' && !this.dot) {\n        this.bubbleContainer\n          .selectAll('text')\n          .data(this.data)\n          .join(\n            (enter) =>\n              enter\n                .append('text')\n                .text((d) => (this.bubbleLabelFormat ? this.bubbleLabelFormat(d.value) : d.value))\n                .attr('class', 'dot-text')\n                .style('fill', this.textColor)\n                .style('font-size', (d) => `${Math.round(this.fontRange(d.value))}px`)\n                .attr('x', (d) => this.projection([d.longitude, d.latitude])[0])\n                .attr('y', (d) => this.projection([d.longitude, d.latitude])[1])\n                .attr('dy', '.4em'),\n            (update) =>\n              update\n                .attr('pointer-events', 'none')\n                .transition()\n                .duration(1000)\n                .text((d) => (this.bubbleLabelFormat ? this.bubbleLabelFormat(d.value) : d.value))\n                .style('font-size', (d) => `${Math.round(this.fontRange(d.value))}px`)\n                .attr('x', (d) => this.projection([d.longitude, d.latitude])[0])\n                .attr('y', (d) => this.projection([d.longitude, d.latitude])[1])\n                .attr('dy', '.4em')\n                .transition()\n                .selection()\n                .attr('pointer-events', 'auto'),\n            (exit) => exit.transition().selection().attr('pointer-events', 'none').remove()\n          );\n      }\n    }\n  };\n\n  bubbleMouseOver = (event, data) => {\n    this.chart.selectAll('.dot-circle').classed('inactive', true);\n\n    d3_select(event.currentTarget).classed('active', true).classed('inactive', false);\n\n    this.tooltipShow(event, data);\n\n    this.hovered.emit({ event, data });\n  };\n\n  bubbleMouseOut = (event, data) => {\n    this.chart.selectAll('.dot-circle').classed('active', false).classed('inactive', false);\n\n    this.tooltipHide();\n  };\n\n  bubbleMouseClick = (event, data) => {\n    this.clicked.emit({ event, data });\n  };\n\n  private tooltipShow = (event, data) => {\n    const dimensions = event.currentTarget.getBoundingClientRect();\n    const scroll = this._scroll.getScrollPosition();\n\n    this.tooltip.select('.tooltip-header').html((d) => `${data.label}`);\n\n    if (!this.hideTooltipValue) {\n      this.tooltip\n        .select('.tooltip-value')\n        .html((d) => (this.tooltipValueFormat ? `${this.tooltipValueFormat(data.value)}` : `${data.value}`));\n    }\n\n    const tooltipOffsetWidth = +this.tooltip.node().offsetWidth / 2;\n    const tooltipOffsetHeight = +this.tooltip.node().offsetHeight + 8;\n\n    this.tooltip.style('top', `${+scroll[1] + +dimensions.top - tooltipOffsetHeight}px`); //\n    this.tooltip.style('left', `${+scroll[0] + +dimensions.left - tooltipOffsetWidth + +dimensions.width / 2}px`);\n    this.tooltip.style('opacity', 1);\n  };\n\n  private tooltipHide = () => {\n    this.tooltip.style('opacity', 0);\n  };\n}\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from) {\r\n    for (var i = 0, il = from.length, j = to.length; i < il; i++, j++)\r\n        to[j] = from[i];\r\n    return to;\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n","import {\n  Component,\n  OnInit,\n  OnChanges,\n  OnDestroy,\n  HostBinding,\n  Input,\n  Output,\n  ElementRef,\n  SimpleChanges,\n  EventEmitter,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { ViewportScroller } from '@angular/common';\n\nimport { PbdsDatavizHeatmap } from './dataviz.interfaces';\nimport { PbdsDatavizService } from './dataviz.service';\n\nimport { select as d3_select } from 'd3-selection';\nimport {\n  scaleThreshold as d3_scaleThreshold,\n  scaleQuantile as d3_scaleQuantile,\n  scaleQuantize as d3_scaleQuantize,\n  scaleBand as d3_scaleBand\n} from 'd3-scale';\nimport { min as d3_min, max as d3_max } from 'd3-array';\nimport { axisBottom as d3_axisBottom, axisLeft as d3_axisLeft } from 'd3-axis';\nimport { isoParse as d3_isoParse } from 'd3-time-format';\n\n@Component({\n  selector: 'pbds-dataviz-heatmap',\n  template: ``,\n  styles: [],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class PbdsDatavizHeatmapComponent implements OnInit, OnChanges, OnDestroy {\n  @HostBinding('class.pbds-chart')\n  chartClass = true;\n\n  @HostBinding('class.pbds-chart-heatmap')\n  heatmapClass = true;\n\n  @Input()\n  data: Array<PbdsDatavizHeatmap>;\n\n  @Input()\n  width = 306;\n\n  @Input()\n  height = 400;\n\n  @Input()\n  marginTop = 0; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  marginRight = 0; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  marginBottom = 30; // hardcoded on purpose, do not document until feedback\n\n  @Input()\n  marginLeft = 55;\n\n  @Input()\n  scale: 'threshold' | 'quantile' | 'quantize' = 'quantile';\n\n  @Input()\n  domain: Array<number>;\n\n  @Input()\n  xAxisFormatType: 'number' | 'time' = null;\n\n  @Input()\n  xAxisFormatString = '';\n\n  @Input()\n  yAxisFormatType: 'number' | 'time' = null;\n\n  @Input()\n  yAxisFormatString = '';\n\n  @Input()\n  hideLegend = false;\n\n  @Input()\n  legendWidth = 105 + 28; // hardcoded legend width + left margin, do not document until feedback\n\n  @Input()\n  legendPosition: 'right' | 'bottom' = 'right';\n\n  @Input()\n  legendLabelFormatType: 'number' = null;\n\n  @Input()\n  legendLabelFormatString = '';\n\n  @Input()\n  tooltipXLabelFormatType: 'number' | 'time' = null;\n\n  @Input()\n  tooltipXLabelFormatString = '';\n\n  @Input()\n  tooltipYLabelFormatType: 'number' | 'time' = null;\n\n  @Input()\n  tooltipYLabelFormatString = '';\n\n  @Input()\n  tooltipValueFormatType: 'number' = null;\n\n  @Input()\n  tooltipValueFormatString = '';\n\n  @Input()\n  theme: 'classic' | 'ocean' | 'sunset' | 'twilight' = 'classic';\n\n  @Output()\n  hovered: EventEmitter<object> = new EventEmitter<object>();\n\n  @Output()\n  clicked: EventEmitter<object> = new EventEmitter<object>();\n\n  private chart;\n  private svg;\n  private margin;\n  private colorRange;\n  private colorDomain;\n  private xAxisScale;\n  private xAxisCall;\n  private xAxis;\n  private xAxisFormat;\n  private xAxisTickSize: number;\n  private xAxisTickSizeOuter: number;\n  private hideXAxisDomain: boolean;\n  private hideXAxisZero: boolean;\n  private hideXAxisTicks: boolean;\n  private hideXAxis: boolean;\n  private yAxis;\n  private yAxisFormat;\n  private yAxisTickSize;\n  private yAxisTickSizeOuter;\n  private yAxisScale;\n  private yAxisCall;\n  private hideYAxis: boolean;\n  private hideYAxisDomain: boolean;\n  private hideYAxisZero: boolean;\n  private hideYAxisTicks: boolean;\n  private legendLabelFormat;\n  private tooltip;\n  private tooltipYLabelFormat;\n  private tooltipXLabelFormat;\n  private hideTooltip;\n  private tooltipValueFormat;\n\n  constructor(private _dataviz: PbdsDatavizService, private _element: ElementRef, private _scroll: ViewportScroller) {}\n\n  ngOnInit() {\n    this.margin = {\n      top: +this.marginTop,\n      right: +this.marginRight,\n      bottom: +this.marginBottom,\n      left: +this.marginLeft\n    };\n\n    // create formatters\n    this.yAxisFormat = this._dataviz.d3Format(this.yAxisFormatType, this.yAxisFormatString);\n    this.xAxisFormat = this._dataviz.d3Format(this.xAxisFormatType, this.xAxisFormatString);\n    this.legendLabelFormat = this._dataviz.d3Format(this.legendLabelFormatType, this.legendLabelFormatString);\n    this.tooltipYLabelFormat = this._dataviz.d3Format(this.tooltipYLabelFormatType, this.tooltipYLabelFormatString);\n    this.tooltipXLabelFormat = this._dataviz.d3Format(this.tooltipXLabelFormatType, this.tooltipXLabelFormatString);\n    this.tooltipValueFormat = this._dataviz.d3Format(this.tooltipValueFormatType, this.tooltipValueFormatString);\n\n    // defaults for all chart types\n    this.hideXAxis = false;\n    this.hideXAxisZero = false;\n    this.hideXAxisDomain = true;\n    this.hideYAxisDomain = true;\n    this.hideTooltip = false;\n    this.hideXAxisTicks = true;\n    this.hideYAxisTicks = true;\n    this.xAxisTickSize = 8;\n    this.xAxisTickSizeOuter = 0;\n    this.yAxisTickSize = 8;\n    this.yAxisTickSizeOuter = 0;\n\n    // create the chart\n    this.chart = d3_select(this._element.nativeElement).attr('aria-hidden', 'true');\n\n    // create chart svg\n    this.svg = this.chart\n      .append('svg')\n      .attr('width', +this.width)\n      .attr('height', +this.height + this.margin.top + this.margin.bottom)\n      .attr('class', 'img-fluid')\n      .attr('preserveAspectRatio', 'xMinYMin meet')\n      .attr(\n        'viewBox',\n        `-${this.margin.left} -${this.margin.top} ${+this.width} ${+this.height + this.margin.top + this.margin.bottom}`\n      );\n\n    // color range\n    const colors = this._dataviz.getColors(true, this.theme).slice().reverse();\n\n    const colorDomain: any = [\n      +d3_min(this.data, (d: PbdsDatavizHeatmap) => d.value),\n      +d3_max(this.data, (d: PbdsDatavizHeatmap) => d.value)\n    ];\n    const colorValues = this.data.map((d) => d.value);\n\n    switch (this.scale) {\n      case 'threshold':\n        this.colorRange = d3_scaleThreshold().domain(this.domain).range(colors);\n\n        this.colorDomain = this.colorRange.domain();\n        break;\n\n      case 'quantile':\n        this.colorRange = d3_scaleQuantile().domain(colorValues).range(colors);\n\n        this.colorDomain = this.colorRange.quantiles();\n        break;\n\n      case 'quantize':\n        this.colorRange = d3_scaleQuantize().domain(colorDomain).range(colors);\n\n        this.colorDomain = this.colorRange.thresholds();\n        break;\n    }\n\n    // console.log(colors, colorDomain, colorValues, this.scale, this.colorRange, this.colorDomain);\n\n    // define axis labels\n    const xAxisLabels: any = [...new Set(this.data.map((d) => d.xLabel))];\n    const yAxisLabels: any = [...new Set(this.data.map((d) => d.yLabel))].reverse();\n\n    // X axis\n    this.xAxisScale = d3_scaleBand()\n      .domain(xAxisLabels)\n      .rangeRound([0, this.width - this.margin.left])\n      .paddingInner(0.1);\n\n    this.xAxisCall = d3_axisBottom(this.xAxisScale)\n      .tickSize(this.xAxisTickSize)\n      .tickSizeOuter(this.xAxisTickSizeOuter)\n      .tickFormat(this.xAxisFormatter);\n\n    this.xAxis = this.svg\n      .append('g')\n      .attr('class', 'axis axis-x')\n      .attr('transform', `translate(0, ${this.height})`)\n      .classed('axis-hidden', this.hideXAxis)\n      .classed('axis-zero-hidden', this.hideXAxisZero)\n      .classed('axis-domain-hidden', this.hideXAxisDomain)\n      .classed('axis-ticks-hidden', this.hideXAxisTicks)\n      .call(this.xAxisCall);\n\n    // Y axis\n    this.yAxisScale = d3_scaleBand().domain(yAxisLabels).rangeRound([this.height, 0]).paddingInner(0.1);\n\n    this.yAxisCall = d3_axisLeft(this.yAxisScale)\n      .tickSize(this.yAxisTickSize)\n      .tickSizeOuter(this.yAxisTickSizeOuter)\n      .tickFormat(this.yAxisFormatter);\n\n    this.yAxis = this.svg\n      .append('g')\n      .attr('class', 'axis axis-y')\n      .classed('axis-hidden', this.hideYAxis)\n      .classed('axis-zero-hidden', this.hideYAxisZero)\n      .classed('axis-domain-hidden', this.hideYAxisDomain)\n      .classed('axis-ticks-hidden', this.hideYAxisTicks)\n      .call(this.yAxisCall);\n\n    // TOOLTIP\n    if (!this.hideTooltip) {\n      this.tooltip = d3_select('body')\n        .append('div')\n        .attr('class', 'pbds-tooltip south')\n        .style('opacity', 0)\n        .attr('aria-hidden', 'true'); // hide tooltip for accessibility\n    }\n\n    // add legend classes\n    if (!this.hideLegend) {\n      this.chart.classed('pbds-chart-legend-bottom', this.legendPosition === 'bottom' ? true : false);\n      this.chart.append('ul').attr('class', `legend legend-${this.legendPosition}`);\n    }\n\n    this.updateChart();\n  }\n\n  ngOnDestroy() {\n    if (this.tooltip) this.tooltip.remove();\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    if (changes.data && !changes.data.firstChange) {\n      this.updateChart();\n    }\n  }\n\n  updateChart = () => {\n    this.svg\n      .selectAll('rect')\n      .data(this.data)\n      .join(\n        (enter) =>\n          enter\n            .append('rect')\n            .attr('class', 'block')\n            .classed('empty', (d) => d.value === undefined || d.value === null)\n            .attr('x', (d) => this.xAxisScale(d.xLabel))\n            .attr('y', (d) => this.yAxisScale(d.yLabel))\n            .attr('width', this.xAxisScale.bandwidth())\n            .attr('height', this.yAxisScale.bandwidth())\n            .style('fill', (d) => this.colorRange(d.value)),\n        (update) =>\n          update.call((update) => {\n            update\n              .classed('empty', (d) => d.value === undefined || d.value === null)\n              .attr('pointer-events', 'none')\n              .transition()\n              .duration(1000)\n              .attr('x', (d) => this.xAxisScale(d.xLabel))\n              .attr('y', (d) => this.yAxisScale(d.yLabel))\n              .attr('width', this.xAxisScale.bandwidth())\n              .attr('height', this.yAxisScale.bandwidth())\n              .style('fill', (d) => this.colorRange(d.value))\n              .transition()\n              .selection()\n              .attr('pointer-events', 'auto');\n\n            return update;\n          }),\n        (exit) => exit.transition().selection().attr('pointer-events', 'none').remove()\n      )\n      .on('mouseover', (event, data) => this.blockMouseOver(event, data))\n      .on('mouseout', (event, data) => this.blockMouseOut())\n      .on('click', (event, data) => this.blockMouseClick(event, data));\n\n    if (!this.hideLegend) {\n      this.chart\n        .select('.legend')\n        .selectAll('.legend-item')\n        .data(this.colorDomain)\n        .join(\n          (enter) => {\n            const li = enter\n              .append('li')\n              .attr('class', 'legend-item')\n              .attr('data-index', (d, i) => {\n                return i;\n              });\n\n            li.append('span')\n              .attr('class', 'legend-key')\n              .style('background-color', (d) => this.colorRange(d));\n\n            li.append('span')\n              .attr('class', 'legend-label')\n              .html((d) => {\n                let label: string = d;\n\n                switch (this.legendLabelFormatType) {\n                  case 'number':\n                    label = this.legendLabelFormat(d);\n                    break;\n                }\n\n                return `&ge; ${label}`;\n              });\n\n            return li;\n          },\n          (update) =>\n            update\n              .select('.legend-label')\n              .attr('data-index', (d, i) => {\n                return i;\n              })\n              .html((d) => {\n                // console.log('HTML D: ', d);\n                let label = d;\n\n                switch (this.legendLabelFormatType) {\n                  case 'number':\n                    label = this.legendLabelFormat(d);\n                    break;\n                }\n\n                return `&ge; ${label}`;\n              }),\n          (exit) => exit.remove()\n        )\n        .on('mouseover', (event, data) => this.legendMouseOver(event, data))\n        .on('mouseout', () => this.legendMouseOut())\n        .on('click', (event, data) => this.legendMouseClick(event, data));\n    }\n  };\n\n  blockMouseOver = (event, data) => {\n    // console.log(data.value, event, data, index, nodes);\n\n    if (data.value !== null) {\n      this.tooltipShow(event, data);\n    }\n\n    this.hovered.emit({ event, data });\n  };\n\n  blockMouseOut = () => {\n    this.tooltipHide();\n  };\n\n  blockMouseClick = (event, data) => {\n    this.clicked.emit({ event, data });\n  };\n\n  legendMouseOver = (event, data) => {\n    const legendItems = this.chart.selectAll('.legend-item');\n    const hovered = d3_select(event.currentTarget);\n    const hoveredIndex = +hovered.attr('data-index');\n\n    legendItems.classed('inactive', true);\n    hovered.classed('inactive', false);\n\n    const nodes = legendItems.nodes();\n\n    this.chart\n      .selectAll('.block')\n      .filter((d, i) => {\n        if (hoveredIndex + 1 === nodes.length) {\n          return d.value < data;\n        } else {\n          const nextNodeData = +d3_select(nodes[+hoveredIndex + 1]).data();\n\n          return d.value < data || d.value >= nextNodeData;\n        }\n      })\n      .classed('inactive', true);\n\n    this.hovered.emit({ event, data: data });\n  };\n\n  legendMouseOut = () => {\n    this.chart.selectAll('.legend-item').classed('inactive', false);\n\n    this.chart.selectAll('.block').classed('inactive', false);\n  };\n\n  legendMouseClick = (event, data) => {\n    this.clicked.emit({ event, data: data });\n  };\n\n  private tooltipShow = (event, data) => {\n    // console.log('TOOLTIP: ', data, index, node);\n\n    const dimensions = event.currentTarget.getBoundingClientRect();\n    const scroll = this._scroll.getScrollPosition();\n    let yLabel;\n    let xLabel;\n\n    switch (this.tooltipYLabelFormatType) {\n      case 'number':\n        yLabel = this.tooltipYLabelFormat(data.yLabel);\n        break;\n\n      case 'time':\n        const parsedTime = d3_isoParse(data.yLabel);\n        yLabel = this.tooltipYLabelFormat(parsedTime);\n        break;\n\n      default:\n        yLabel = `${data.yLabel}${this.tooltipYLabelFormatString}`;\n    }\n\n    switch (this.tooltipXLabelFormatType) {\n      case 'number':\n        xLabel = this.tooltipXLabelFormat(data.xLabel);\n        break;\n\n      case 'time':\n        const parsedTime = d3_isoParse(data.xLabel);\n        xLabel = this.tooltipXLabelFormat(parsedTime);\n        break;\n\n      default:\n        xLabel = `${data.xLabel}${this.tooltipXLabelFormatString}`;\n    }\n\n    const value =\n      this.tooltipValueFormat === null\n        ? `<div class=\"tooltip-value\">${data.value}</div>`\n        : `<div class=\"tooltip-value\">${this.tooltipValueFormat(data.value)}</div>`;\n\n    this.tooltip.html(\n      `\n        ${yLabel} : ${xLabel}<br>\n        ${value}\n      `\n    );\n\n    const tooltipOffsetWidth = +this.tooltip.node().offsetWidth / 2;\n    const tooltipOffsetHeight = +this.tooltip.node().offsetHeight + 8;\n\n    this.tooltip.style('top', `${+scroll[1] + +dimensions.top - tooltipOffsetHeight}px`); //\n    this.tooltip.style('left', `${+scroll[0] + +dimensions.left - tooltipOffsetWidth + +dimensions.width / 2}px`);\n    this.tooltip.style('opacity', 1);\n\n    this.tooltip.style('opacity', 1);\n  };\n\n  private tooltipHide = () => {\n    this.tooltip.style('opacity', 0);\n  };\n\n  private xAxisFormatter = (item) => {\n    switch (this.xAxisFormatType) {\n      case 'number':\n        return this.xAxisFormat(item);\n\n      case 'time':\n        const parseDate = d3_isoParse(item);\n        return this.xAxisFormat(parseDate);\n\n      default:\n        return item;\n    }\n  };\n\n  private yAxisFormatter = (item) => {\n    switch (this.yAxisFormatType) {\n      case 'number':\n        return this.yAxisFormat(item);\n\n      case 'time':\n        const parseDate = d3_isoParse(item);\n        return this.yAxisFormat(parseDate);\n\n      default:\n        return item;\n    }\n  };\n}\n","import {\n  Component,\n  OnInit,\n  OnChanges,\n  Input,\n  Output,\n  EventEmitter,\n  ElementRef,\n  HostBinding,\n  OnDestroy,\n  SimpleChanges,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { ViewportScroller } from '@angular/common';\n\nimport { select as d3_select, pointer as d3_pointer } from 'd3-selection';\nimport {\n  scaleLinear as d3_scaleLinear,\n  scaleThreshold as d3_scaleThreshold,\n  scaleQuantile as d3_scaleQuantile,\n  scaleQuantize as d3_scaleQuantize\n} from 'd3-scale';\nimport { min as d3_min, max as d3_max, range as d3_range } from 'd3-array';\nimport {\n  geoPath as d3_geoPath,\n  geoAlbers as d3_geoAlbers,\n  geoAlbersUsa as d3_geoAlbersUsa,\n  geoMercator as d3_geoMercator\n} from 'd3-geo';\nimport { axisBottom as d3_axisBottom } from 'd3-axis';\n\nimport * as topojson from 'topojson-client';\nimport { PbdsDatavizService } from './dataviz.service';\n\nimport { PbdsDatavizChoroplethMapData } from './dataviz.interfaces';\n\n@Component({\n  selector: 'pbds-dataviz-choropleth-map',\n  template: ``,\n  styles: [],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class PbdsDatavizChoroplethMapComponent implements OnInit, OnDestroy, OnChanges {\n  @HostBinding('class.pbds-chart')\n  chartClass = true;\n\n  @HostBinding('class.pbds-chart-choropleth-map')\n  choroplethMapClass = true;\n\n  @Input()\n  data: Array<PbdsDatavizChoroplethMapData>;\n\n  @Input()\n  topojson;\n\n  @Input()\n  feature = '';\n\n  @Input()\n  projectionType;\n\n  @Input()\n  dataField = 'id';\n\n  @Input()\n  mesh: string | null = null;\n\n  @Input()\n  scale = null;\n\n  @Input()\n  center = null;\n\n  @Input()\n  width = 960;\n\n  @Input()\n  height = 500;\n\n  @Input()\n  marginTop = 0;\n\n  @Input()\n  marginRight = 0;\n\n  @Input()\n  marginBottom = 0;\n\n  @Input()\n  marginLeft = 0;\n\n  @Input()\n  theme: 'classic' | 'ocean' | 'sunset' | 'twilight' = 'classic';\n\n  @Input()\n  colorScale: 'threshold' | 'quantile' | 'quantize' = 'quantile';\n\n  @Input()\n  domain: Array<number>;\n\n  @Input()\n  hideTooltip = false;\n\n  @Input()\n  tooltipValueFormatType: 'number' = null;\n\n  @Input()\n  tooltipValueFormatString = '';\n\n  @Input()\n  hideLegend = false;\n\n  @Input()\n  legendWidth = 260;\n\n  @Input()\n  legendLabel: string | null = null;\n\n  @Input()\n  legendValueFormatType: 'number' = null;\n\n  @Input()\n  legendValueFormatString = '';\n\n  @Input()\n  legendLeft = 20;\n\n  @Input()\n  legendTop = 20;\n\n  @Output()\n  hovered: EventEmitter<object> = new EventEmitter<object>();\n\n  @Output()\n  clicked: EventEmitter<object> = new EventEmitter<object>();\n\n  private projection;\n  private geoPath;\n  private topojsonFeature;\n  private chart;\n  private svg;\n  private margin;\n  private colorRange;\n  private colorDomain;\n  private tooltip;\n  private tooltipValueFormat;\n  private legendValueFormat;\n\n  constructor(private _dataviz: PbdsDatavizService, private _element: ElementRef, private _scroll: ViewportScroller) {}\n\n  ngOnInit() {\n    this.margin = {\n      top: +this.marginTop,\n      right: +this.marginRight,\n      bottom: +this.marginBottom,\n      left: +this.marginLeft\n    };\n\n    // color range\n    const colors = this._dataviz.getColors(true, this.theme).slice().reverse();\n\n    const colorDomain: any = [+d3_min(this.data, (d) => d.value), +d3_max(this.data, (d) => d.value)];\n    const colorValues = this.data.map((d) => d.value);\n\n    switch (this.colorScale) {\n      case 'threshold':\n        this.colorRange = d3_scaleThreshold().domain(this.domain).range(colors);\n\n        this.colorDomain = this.colorRange.domain();\n        break;\n\n      case 'quantile':\n        this.colorRange = d3_scaleQuantile().domain(colorValues).range(colors);\n\n        this.colorDomain = this.colorRange.quantiles();\n        break;\n\n      case 'quantize':\n        this.colorRange = d3_scaleQuantize().domain(colorDomain).range(colors);\n\n        this.colorDomain = this.colorRange.thresholds();\n        break;\n    }\n\n    // create formatters\n    this.tooltipValueFormat = this._dataviz.d3Format(this.tooltipValueFormatType, this.tooltipValueFormatString);\n    this.legendValueFormat = this._dataviz.d3Format(this.legendValueFormatType, this.legendValueFormatString);\n\n    switch (this.projectionType) {\n      case 'geoAlbers':\n        this.projection = d3_geoAlbers();\n        break;\n\n      case 'geoAlbersUsa':\n        this.projection = d3_geoAlbersUsa();\n        break;\n\n      case 'geoMercator':\n        this.projection = d3_geoMercator();\n        break;\n    }\n\n    this.topojsonFeature = topojson.feature(this.topojson, this.topojson.objects[this.feature]);\n    this.projection.fitSize([+this.width, +this.height], this.topojsonFeature);\n\n    if (this.scale) {\n      this.projection.scale(+this.scale);\n    }\n\n    if (this.center) {\n      this.projection.center(this.center);\n    }\n\n    this.geoPath = d3_geoPath().projection(this.projection);\n\n    // console.log('TOPOJSON: ', this.topojson);\n    // console.log('TOPOJSON FEATURE: ', this.topojsonFeature);\n    // console.log('MESH: ', topojson.mesh(this.topojson, this.topojson.objects[this.feature], (a, b) => a !== b));\n    // console.log('DATA: ', this.data);\n\n    // create the chart\n    this.chart = d3_select(this._element.nativeElement).attr('aria-hidden', 'true');\n\n    // TOOLTIP\n    if (!this.hideTooltip) {\n      this.tooltip = d3_select('body')\n        .append('div')\n        .attr('class', 'pbds-tooltip south')\n        .style('opacity', 0)\n        .attr('aria-hidden', 'true'); // hide tooltip for accessibility\n\n      // tooltip header\n      this.tooltip.append('div').attr('class', 'tooltip-header');\n      this.tooltip.append('div').attr('class', 'tooltip-value');\n    }\n\n    // create chart svg\n    this.svg = this.chart\n      .append('svg')\n      .attr('width', +this.width)\n      .attr('height', +this.height + this.margin.top + this.margin.bottom)\n      .attr('class', 'img-fluid')\n      .attr('preserveAspectRatio', 'xMinYMin meet')\n      .attr(\n        'viewBox',\n        `-${this.margin.left} -${this.margin.top} ${+this.width} ${+this.height + this.margin.top + this.margin.bottom}`\n      );\n\n    // map\n    this.svg\n      .append('g')\n      .attr('class', 'map')\n      .selectAll('path')\n      .data(this.topojsonFeature.features)\n      .join((enter) => enter.append('path').attr('class', 'feature').attr('d', this.geoPath));\n\n    // borders\n    this.svg\n      .append('path')\n      .attr('class', 'mesh')\n      .datum(topojson.mesh(this.topojson, this.topojson.objects[this.mesh || this.feature], (a, b) => a !== b))\n      .attr('d', this.geoPath);\n\n    // legend\n    if (!this.hideLegend) {\n      this.svg\n        .append('g')\n        .attr('transform', `translate(${+this.legendLeft}, ${+this.legendTop})`)\n        .call(this.legend);\n    }\n\n    this.updateChart();\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    if (changes.data && !changes.data.firstChange) {\n      this.updateChart();\n    }\n  }\n\n  ngOnDestroy() {\n    if (this.tooltip) this.tooltip.remove();\n  }\n\n  updateChart = () => {\n    this.svg\n      .select('.map')\n      .selectAll('path')\n      .style('fill', (d, i) => {\n        const match = this.data.find((obj) => obj[this.dataField] === d[this.dataField]);\n        if (match) {\n          return this.colorRange(match.value);\n        }\n      })\n      .classed('hasData', (d, i) => {\n        return this.data.some((obj) => obj[this.dataField] === d[this.dataField]);\n      });\n\n    if (!this.hideTooltip) {\n      this.svg\n        .select('.map')\n        .selectAll('path')\n        .on('mouseover', (event, data) =>\n          this.featureMouseOver(\n            event,\n            this.data.find((obj) => obj[this.dataField] === data[this.dataField])\n          )\n        )\n        .on('mouseout', (event, data) => this.featureMouseOut(event, this.data))\n        .on('mousemove', (event, data) => this.tooltipMove(event))\n        .on('click', (event, data) =>\n          this.featureMouseClick(\n            event,\n            this.data.find((obj) => obj[this.dataField] === data[this.dataField])\n          )\n        );\n    }\n  };\n\n  featureMouseOver = (event, data) => {\n    if (data) {\n      this.tooltipShow(event, data);\n      this.hovered.emit({ event, data });\n    }\n  };\n\n  featureMouseOut = (event, data) => {\n    this.tooltipHide();\n  };\n\n  featureMouseClick = (event, data) => {\n    if (data) {\n      this.clicked.emit({ event, data });\n    }\n  };\n\n  private tooltipShow = (event, data) => {\n    // console.log('TOOLTIP: ', data, node);\n\n    this.tooltipSetPosition(event);\n\n    if (data.label) {\n      this.tooltip.select('.tooltip-header').html((d) => `${data.label}`);\n    }\n\n    this.tooltip\n      .select('.tooltip-value')\n      .html((d) => (this.tooltipValueFormat ? `${this.tooltipValueFormat(data.value)}` : `${data.value}`));\n\n    this.tooltip.style('opacity', 1);\n  };\n\n  private tooltipHide = () => {\n    this.tooltip.style('opacity', 0);\n  };\n\n  private tooltipMove = (event) => {\n    this.tooltipSetPosition(event);\n  };\n\n  private tooltipSetPosition = (event) => {\n    const mouse = d3_pointer(event, this.chart.node());\n    const mouseLeft = +mouse[0];\n    const mouseTop = +mouse[1];\n\n    const geometry = this.chart.node().getBoundingClientRect();\n    const geometryLeft = +geometry.left;\n    const geometryTop = +geometry.top;\n\n    const scroll = this._scroll.getScrollPosition();\n    // const scrollLeft = +scroll[0];\n    const scrollTop = +scroll[1];\n\n    const tooltipOffsetWidth = +this.tooltip.node().offsetWidth / 2;\n    const tooltipOffsetHeight = +this.tooltip.node().offsetHeight;\n\n    this.tooltip.style('top', `${scrollTop + mouseTop + geometryTop - tooltipOffsetHeight - 14}px`);\n    this.tooltip.style('left', `${mouseLeft + geometryLeft - tooltipOffsetWidth}px`); //\n  };\n\n  legend = (g) => {\n    const length = this.colorRange.range().length;\n\n    // console.log(this.colorRange.range().length, this.colorDomain);\n\n    const x = d3_scaleLinear()\n      .domain([1, length - 1])\n      .rangeRound([+this.legendWidth / length, (this.legendWidth * (length - 1)) / length]);\n\n    g.attr('class', 'legend')\n      .selectAll('rect')\n      .data(this.colorRange.range())\n      .join('rect')\n      .attr('height', 8)\n      .attr('x', (d, i) => x(i))\n      .attr('width', (d, i) => x(i + 1) - x(i))\n      .attr('fill', (d) => d);\n\n    if (this.legendLabel) {\n      g.append('text').attr('y', -6).attr('text-anchor', 'start').attr('class', 'legend-label').text(this.legendLabel);\n    }\n\n    g.call(\n      d3_axisBottom(x)\n        .tickSize(13)\n        .tickValues(d3_range(1, length))\n        .tickFormat((i: number) =>\n          this.legendValueFormat ? `${this.legendValueFormat(this.colorDomain[i - 1])}` : `${this.colorDomain[i - 1]}`\n        )\n    )\n      .select('.domain')\n      .remove();\n  };\n}\n","import {\n  Component,\n  OnInit,\n  OnChanges,\n  Input,\n  Output,\n  EventEmitter,\n  ElementRef,\n  HostBinding,\n  OnDestroy,\n  SimpleChanges,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { ViewportScroller, Location } from '@angular/common';\n\nimport { select as d3_select } from 'd3-selection';\nimport { scaleOrdinal as d3_scaleOrdinal, scaleBand as d3_scaleBand, scaleLinear as d3_scaleLinear } from 'd3-scale';\nimport { max as d3_max } from 'd3-array';\nimport { axisBottom as d3_axisBottom, axisLeft as d3_axisLeft } from 'd3-axis';\nimport { isoParse as d3_isoParse } from 'd3-time-format';\n\nimport { PbdsDatavizService } from './dataviz.service';\nimport { PbdsDatavizBarGrouped } from './dataviz.interfaces';\n\n@Component({\n  selector: 'pbds-dataviz-bar-grouped',\n  template: ``,\n  styles: [],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class PbdsDatavizBarGroupedComponent implements OnInit, OnDestroy, OnChanges {\n  @HostBinding('class.pbds-chart')\n  chartClass = true;\n\n  @HostBinding('class.pbds-chart-bar-grouped')\n  groupedBarClass = true;\n\n  @Input()\n  data: Array<PbdsDatavizBarGrouped>;\n\n  @Input()\n  width = 306;\n\n  @Input()\n  height = 400;\n\n  @Input()\n  vertical = true;\n\n  @Input()\n  hideXAxis = false;\n\n  @Input()\n  xAxisMaxBuffer = 0.01;\n\n  @Input()\n  xAxisFormatType: 'number' | 'time' = null;\n\n  @Input()\n  xAxisFormatString = '';\n\n  @Input()\n  xAxisTicks = 5;\n\n  @Input()\n  hideYAxis = false;\n\n  @Input()\n  yAxisMaxBuffer = 0.01;\n\n  @Input()\n  yAxisFormatType: 'number' | 'time' = null;\n\n  @Input()\n  yAxisFormatString = '';\n\n  @Input()\n  yAxisTicks = 5;\n\n  @Input()\n  marginTop = 10;\n\n  @Input()\n  marginRight = this.vertical ? 0 : 55;\n\n  @Input()\n  marginBottom = 30;\n\n  @Input()\n  marginLeft = 55;\n\n  @Input()\n  hideLegend = false;\n\n  @Input()\n  legendWidth = 105 + 28; // hardcoded legend width + left margin, do not document until feedback\n\n  @Input()\n  legendPosition: 'right' | 'bottom' = 'right';\n\n  @Input()\n  legendLabelFormatType: 'number' | 'time' = null;\n\n  @Input()\n  legendLabelFormatString = '';\n\n  @Input()\n  hideTooltip = false;\n\n  @Input()\n  tooltipLabelFormatType: 'number' | 'time' = null;\n\n  @Input()\n  tooltipLabelFormatString = '';\n\n  @Input()\n  tooltipValueFormatType: 'number' = null;\n\n  @Input()\n  tooltipValueFormatString = '';\n\n  @Input()\n  showGrid = false;\n\n  @Input()\n  theme: 'classic' | 'sunset' | 'ocean' | 'twilight' = 'classic';\n\n  @Output()\n  hovered: EventEmitter<object> = new EventEmitter<object>();\n\n  @Output()\n  clicked: EventEmitter<object> = new EventEmitter<object>();\n\n  private barScale;\n  private chart;\n  private svg;\n  private margin;\n  private colorRange;\n  private xAxisMax;\n  private xAxisScale;\n  private xAxisCall;\n  private xAxis;\n  private xAxisTickSize: number;\n  private xAxisTickSizeOuter: number;\n  private xAxisFormat;\n  private hideXAxisDomain: boolean;\n  private hideXAxisZero: boolean;\n  private hideXAxisTicks: boolean;\n  private xGrid;\n  private xGridCall;\n  private yAxisMax;\n  private yAxisScale;\n  private yAxisCall;\n  private yAxis;\n  private yAxisFormat;\n  private yAxisTickSize: number;\n  private yAxisTickSizeOuter: number;\n  private hideYAxisZero: boolean;\n  private hideYAxisDomain: boolean;\n  private hideYAxisTicks: boolean;\n  private yGrid;\n  private yGridCall;\n  private legendLabelFormat;\n  private hideGrayBars: boolean;\n  private tooltip;\n  private tooltipValueFormat;\n  private tooltipLabelFormat;\n\n  constructor(\n    private _dataviz: PbdsDatavizService,\n    private _element: ElementRef,\n    private _scroll: ViewportScroller,\n    private _location: Location\n  ) {}\n\n  ngOnInit() {\n    this.margin = {\n      top: +this.marginTop,\n      right: +this.marginRight,\n      bottom: +this.marginBottom,\n      left: +this.marginLeft\n    };\n\n    // create formatters\n    this.xAxisFormat = this._dataviz.d3Format(this.xAxisFormatType, this.xAxisFormatString);\n    this.yAxisFormat = this._dataviz.d3Format(this.yAxisFormatType, this.yAxisFormatString);\n    this.legendLabelFormat = this._dataviz.d3Format(this.legendLabelFormatType, this.legendLabelFormatString);\n    this.tooltipLabelFormat = this._dataviz.d3Format(this.tooltipLabelFormatType, this.tooltipLabelFormatString);\n    this.tooltipValueFormat = this._dataviz.d3Format(this.tooltipValueFormatType, this.tooltipValueFormatString);\n\n    // defaults for all chart types\n    this.hideGrayBars = false;\n    this.hideXAxisZero = false;\n    this.hideXAxisDomain = false;\n    this.hideXAxisTicks = true;\n    this.xAxisTickSize = 8;\n    this.xAxisTickSizeOuter = 0;\n    this.hideYAxisZero = false;\n    this.hideYAxisDomain = false;\n    this.hideYAxisTicks = true;\n    this.yAxisTickSize = 8;\n    this.yAxisTickSizeOuter = 0;\n\n    if (!this.hideLegend && this.legendPosition === 'right') {\n      this.width = +this.width - +this.legendWidth;\n    }\n\n    // create the chart\n    this.chart = d3_select(this._element.nativeElement).attr('aria-hidden', 'true');\n\n    // create chart svg\n    this.svg = this.chart\n      .append('svg')\n      .attr('width', () => {\n        if (this.vertical) {\n          return +this.width;\n        } else {\n          return +this.width + this.margin.left + this.margin.right;\n        }\n      })\n      .attr('height', +this.height + this.margin.top + this.margin.bottom)\n      .attr('class', 'img-fluid')\n      .attr('preserveAspectRatio', 'xMinYMin meet')\n      .attr('viewBox', () => {\n        if (this.vertical) {\n          return `-${this.margin.left} -${this.margin.top} ${+this.width} ${\n            +this.height + this.margin.top + this.margin.bottom\n          }`;\n        } else {\n          return `-${this.margin.left} -${this.margin.top} ${+this.width + this.margin.left + this.margin.right} ${\n            +this.height + this.margin.top + this.margin.bottom\n          }`;\n        }\n      });\n\n    // TOOLTIP\n    if (!this.hideTooltip) {\n      this.tooltip = d3_select('body')\n        .append('div')\n        .attr('class', () => {\n          return this.vertical ? 'pbds-tooltip south' : 'pbds-tooltip west';\n        })\n        .style('opacity', 0)\n        .attr('aria-hidden', 'true'); // hide tooltip for accessibility\n    }\n\n    // add legend classes\n    if (!this.hideLegend) {\n      this.chart.classed('pbds-chart-legend-bottom', this.legendPosition === 'bottom' ? true : false);\n      this.chart.append('ul').attr('class', `legend legend-${this.legendPosition}`);\n    }\n\n    // build color ranges\n    this.colorRange = d3_scaleOrdinal().range(\n      this._dataviz.createGradientDefs(this.svg, false, this.theme, this.vertical)\n    );\n\n    if (this.vertical) {\n      // X AXIS\n      this.xAxisScale = d3_scaleBand()\n        .domain(this.data.map((d) => d.key))\n        .rangeRound([0, this.width - this.margin.left])\n        .align(0);\n\n      // add padding to the scale for gray bars\n      !this.hideGrayBars\n        ? this.xAxisScale.paddingInner(0.1).paddingOuter(0)\n        : this.xAxisScale.paddingInner(0).paddingOuter(0);\n\n      this.xAxisCall = d3_axisBottom(this.xAxisScale)\n        .tickSize(this.xAxisTickSize)\n        .tickSizeOuter(this.xAxisTickSizeOuter)\n        .tickFormat(this.xAxisFormatter);\n\n      this.xAxis = this.svg\n        .append('g')\n        .attr('class', 'axis axis-x')\n        .attr('transform', `translate(0, ${this.height})`)\n        .classed('axis-hidden', this.hideXAxis)\n        .classed('axis-zero-hidden', this.hideXAxisZero)\n        .classed('axis-domain-hidden', this.hideXAxisDomain)\n        .classed('axis-ticks-hidden', this.hideXAxisTicks)\n        .call(this.xAxisCall);\n\n      // X GRIDLINES\n      // if (!this.hideXGrid) {\n      //   this.xGridCall = d3_axisBottom(this.xAxisScale).tickSize(-this.height);\n\n      //   this.xGrid = this.svg\n      //     .append('g')\n      //     .attr('class', 'grid grid-x')\n      //     .classed('grid-zero-hidden', this.hideXAxisZero)\n      //     .attr('transform', `translate(0, ${this.height})`)\n      //     .call(this.xGridCall);\n      // }\n\n      // Y AXIS\n      this.yAxisMax = d3_max(this.data, (data: any) => {\n        const clone = { ...data };\n        delete clone.key;\n\n        return d3_max(Object.values(clone));\n      });\n\n      this.yAxisMax = this.yAxisMax + this.yAxisMax * this.yAxisMaxBuffer;\n\n      this.yAxisScale = d3_scaleLinear().domain([0, this.yAxisMax]).nice().rangeRound([this.height, 0]);\n\n      this.yAxisCall = d3_axisLeft(this.yAxisScale)\n        .ticks(this.yAxisTicks)\n        .tickSize(this.yAxisTickSize)\n        .tickSizeOuter(this.yAxisTickSizeOuter)\n        .tickFormat(this.yAxisFormatter);\n\n      this.yAxis = this.svg\n        .append('g')\n        .attr('class', 'axis axis-y')\n        .classed('axis-hidden', this.hideYAxis)\n        .classed('axis-zero-hidden', this.hideYAxisZero)\n        .classed('axis-domain-hidden', this.hideYAxisDomain)\n        .classed('axis-ticks-hidden', this.hideYAxisTicks)\n        .call(this.yAxisCall);\n\n      // Y GRIDLINES\n      if (this.showGrid) {\n        this.yGridCall = d3_axisLeft(this.yAxisScale)\n          .ticks(this.yAxisTicks)\n          .tickSize(-this.width + this.margin.left + this.margin.right);\n\n        this.yGrid = this.svg\n          .append('g')\n          .attr('class', 'grid grid-y')\n          .classed('grid-zero-hidden', this.hideYAxisZero)\n          .attr('transform', `translate(0, 0)`)\n          .call(this.yGridCall);\n      }\n\n      // color bar scale\n      this.barScale = d3_scaleBand()\n        .domain(Object.keys(this.data[0]).slice(1))\n        .rangeRound([0, this.xAxisScale.bandwidth()])\n        .paddingInner(0.2)\n        .paddingOuter(0.5);\n\n      this.updateChartVertical();\n    } else {\n      // X AXIS\n      this.xAxisMax = d3_max(this.data, (data: any) => {\n        const clone = { ...data };\n        delete clone.key;\n        return d3_max(Object.values(clone));\n      });\n\n      this.xAxisMax = this.xAxisMax + this.xAxisMax * this.xAxisMaxBuffer;\n\n      this.xAxisScale = d3_scaleLinear().domain([0, this.xAxisMax]).rangeRound([0, this.width]).nice();\n\n      this.xAxisCall = d3_axisBottom(this.xAxisScale)\n        .ticks(this.xAxisTicks)\n        .tickSize(this.xAxisTickSize)\n        .tickSizeOuter(this.xAxisTickSizeOuter)\n        .tickFormat(this.xAxisFormatter);\n\n      this.xAxis = this.svg\n        .append('g')\n        .attr('class', 'axis axis-x')\n        .attr('transform', `translate(0, ${this.height})`)\n        .classed('axis-hidden', this.hideXAxis)\n        .classed('axis-zero-hidden', this.hideXAxisZero)\n        .classed('axis-domain-hidden', this.hideXAxisDomain)\n        .classed('axis-ticks-hidden', this.hideXAxisTicks)\n        .call(this.xAxisCall);\n\n      // Y AXIS\n      this.yAxisScale = d3_scaleBand()\n        .domain(this.data.map((d) => d.key))\n        .rangeRound([0, this.height])\n        .align(1);\n\n      // add padding to the scale for gray bars\n      !this.hideGrayBars\n        ? this.yAxisScale.paddingInner(0.1).paddingOuter(0)\n        : this.yAxisScale.paddingInner(0).paddingOuter(0);\n\n      this.yAxisCall = d3_axisLeft(this.yAxisScale)\n        .tickSize(this.yAxisTickSize)\n        .tickSizeOuter(this.yAxisTickSizeOuter)\n        .tickFormat(this.yAxisFormatter);\n\n      this.yAxis = this.svg\n        .append('g')\n        .attr('class', 'axis axis-y')\n        .classed('axis-hidden', this.hideYAxis)\n        .classed('axis-zero-hidden', this.hideYAxisZero)\n        .classed('axis-domain-hidden', this.hideYAxisDomain)\n        .classed('axis-ticks-hidden', this.hideYAxisTicks)\n        .call(this.yAxisCall);\n\n      // X GRIDLINES\n      if (this.showGrid) {\n        this.xGridCall = d3_axisBottom(this.xAxisScale).tickSize(-this.height);\n        this.xGrid = this.svg\n          .append('g')\n          .attr('class', 'grid grid-x')\n          .classed('grid-zero-hidden', this.hideXAxisZero)\n          .attr('transform', `translate(0, ${this.height})`)\n          .call(this.xGridCall);\n      }\n\n      // Y GRIDLINES\n      // if (!this.hideYGrid) {\n      //   this.yGridCall = d3_axisLeft(this.yAxisScale)\n      //     .ticks(this.yAxisTicks)\n      //     .tickSize(-this.width);\n\n      //   this.yGrid = this.svg\n      //     .append('g')\n      //     .attr('class', 'grid grid-y')\n      //     .classed('grid-zero-hidden', this.hideYAxisZero)\n      //     .attr('transform', `translate(0, 0)`)\n      //     .call(this.yGridCall);\n      // }\n\n      // color bar scale\n      this.barScale = d3_scaleBand()\n        .domain(Object.keys(this.data[0]).slice(1))\n        .rangeRound([this.yAxisScale.bandwidth(), 0])\n        .paddingInner(0.2)\n        .paddingOuter(0.5);\n\n      this.updateChartHorizontal();\n    }\n  }\n\n  ngOnDestroy() {\n    if (this.tooltip) this.tooltip.remove();\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    if (changes.data && !changes.data.firstChange) {\n      if (this.vertical) {\n        this.updateChartVertical();\n      } else {\n        this.updateChartHorizontal();\n      }\n    }\n  }\n\n  updateChartVertical() {\n    // update the xScale\n    this.xAxisScale.domain(this.data.map((d) => d.key));\n\n    // update the yScale\n    this.yAxisMax = d3_max(this.data, (data: any) => {\n      const clone = { ...data };\n      delete clone.key;\n\n      return d3_max(Object.values(clone));\n    });\n\n    this.yAxisMax = this.yAxisMax + this.yAxisMax * this.yAxisMaxBuffer;\n\n    this.yAxisScale.domain([0, this.yAxisMax]).rangeRound([this.height, 0]).nice();\n\n    this.xAxis.transition().duration(1000).call(this.xAxisCall);\n\n    this.yAxis.transition().duration(1000).call(this.yAxisCall);\n\n    // update the grids\n    // if (!this.hideXGrid) {\n    //   this.xGrid\n    //     .transition()\n    //     .duration(1000)\n    //     .call(this.xGridCall);\n    // }\n\n    if (this.showGrid) {\n      this.yGrid.transition().duration(1000).call(this.yGridCall);\n    }\n\n    // update the color bar scale\n    this.barScale.domain(Object.keys(this.data[0]).slice(1)).rangeRound([0, this.xAxisScale.bandwidth()]);\n\n    this.svg\n      .selectAll('.gray-bar')\n      .data(this.data)\n      .join(\n        (enter) =>\n          enter\n            .append('rect')\n            .attr('class', 'gray-bar')\n            .attr('x', (d) => this.xAxisScale(d.key))\n            .attr('y', (d) => this.yAxisScale(d.value))\n            .attr('width', this.xAxisScale.bandwidth())\n            .attr('height', this.height),\n        (update) =>\n          update\n            .transition()\n            .duration(1000)\n            .attr('x', (d) => this.xAxisScale(d.key))\n            .attr('y', (d) => this.yAxisScale(d.value))\n            .attr('width', this.xAxisScale.bandwidth())\n            .attr('height', this.height)\n            .selection()\n      );\n\n    this.svg\n      .selectAll('.bar-group')\n      .data(this.data)\n      .join(\n        (enter) =>\n          enter\n            .append('g')\n            .attr('class', 'bar-group')\n            .attr('transform', (d, i) => {\n              return `translate(${this.xAxisScale(d.key)}, 0)`;\n            }),\n        (update) =>\n          update\n            .transition()\n            .duration(1000)\n            .attr('transform', (d, i) => {\n              return `translate(${this.xAxisScale(d.key)}, 0)`;\n            })\n            .selection()\n      );\n\n    this.svg\n      .selectAll('.bar-group')\n      // .selectAll('.bar')\n      .selectChildren()\n      .data((d, i) => {\n        const clone = { ...d };\n        delete clone.key;\n\n        const keys = Object.keys(clone);\n\n        const keyData = keys.map(function (key) {\n          return { label: key, value: d[key], parentIndex: i };\n        });\n\n        return keyData;\n      })\n      .join(\n        (enter) =>\n          enter\n            .append('rect')\n            .attr('class', 'bar')\n            .attr('fill', (d) => `url(${this._location.path()}#gradient-${this.colorRange(d.label).substr(1)})`)\n            .attr('data-color', (d) => this.colorRange(d.label))\n            .attr('data-parent-index', (d) => d.parentIndex)\n            .attr('x', (d) => this.barScale(d.label))\n            .attr('width', this.barScale.bandwidth())\n            .attr('y', this.height)\n            .attr('height', 0)\n            .call((enter) => {\n              return enter\n                .attr('pointer-events', 'none')\n                .transition()\n                .duration(0) // 500\n                .attr('height', (d) => this.height - this.yAxisScale(d.value))\n                .attr('y', (d) => this.yAxisScale(d.value))\n                .transition()\n                .attr('pointer-events', 'auto');\n            }),\n\n        (update) =>\n          update\n            .attr('pointer-events', 'none')\n            .transition()\n            .duration(1000)\n            .attr('x', (d) => this.barScale(d.label))\n            .attr('width', this.barScale.bandwidth())\n            .attr('height', (d) => this.height - this.yAxisScale(d.value))\n            .attr('y', (d) => this.yAxisScale(d.value))\n            .transition()\n            .selection()\n            .attr('pointer-events', 'auto'),\n        (exit) =>\n          exit\n            .transition()\n            .duration(0) // 100\n            .selection()\n            .attr('pointer-events', 'none')\n            .attr('height', 0)\n            .attr('y', this.height)\n      )\n      .on('mouseover', (event, data: PbdsDatavizBarGrouped[]) => this.barMouseOver(event, data))\n      .on('mouseout', (event, data) => this.barMouseOut())\n      .on('click', (event, data) => this.barMouseClick(event, data));\n\n    this.updateLegend();\n\n    this.svg.selectAll('.axis').raise();\n  }\n\n  updateChartHorizontal() {\n    // update the xScale\n    this.xAxisMax = d3_max(this.data, (data: any) => {\n      const clone = { ...data };\n      delete clone.key;\n      return d3_max(Object.values(clone));\n    });\n\n    this.xAxisMax = this.xAxisMax + this.xAxisMax * this.xAxisMaxBuffer;\n\n    this.xAxisScale.domain([0, this.xAxisMax]).rangeRound([0, this.width]).nice();\n\n    // update the yScale\n    this.yAxisScale.domain(this.data.map((d) => d.key));\n\n    this.xAxis.transition().duration(1000).call(this.xAxisCall);\n\n    this.yAxis.transition().duration(1000).call(this.yAxisCall);\n\n    // update the grids\n    if (this.showGrid) {\n      this.xGrid.transition().duration(1000).call(this.xGridCall);\n    }\n\n    // if (!this.hideYGrid) {\n    //   this.yGrid\n    //     .transition()\n    //     .duration(1000)\n    //     .call(this.yGridCall);\n    // }\n\n    // update the color bar scale\n    this.barScale.domain(Object.keys(this.data[0]).slice(1)).rangeRound([0, this.yAxisScale.bandwidth()]);\n\n    this.svg\n      .selectAll('.gray-bar')\n      .data(this.data)\n      .join(\n        (enter) =>\n          enter\n            .append('rect')\n            .attr('class', 'gray-bar')\n            .attr('y', (d) => this.yAxisScale(d.key))\n            .attr('width', this.width)\n            .attr('height', this.yAxisScale.bandwidth()),\n        (update) =>\n          update\n            .transition()\n            .duration(1000)\n            .attr('y', (d) => this.yAxisScale(d.key))\n            .attr('width', this.width)\n            .attr('height', this.yAxisScale.bandwidth())\n            .selection()\n      );\n\n    this.svg\n      .selectAll('.bar-group')\n      .data(this.data)\n      .join(\n        (enter) =>\n          enter\n            .append('g')\n            .attr('class', 'bar-group')\n            .attr('transform', (d, i) => {\n              return `translate(0, ${this.yAxisScale(d.key)})`;\n            }),\n        (update) =>\n          update\n            .transition()\n            .duration(1000)\n            .attr('transform', (d, i) => {\n              return `translate(0, ${this.yAxisScale(d.key)})`;\n            })\n            .selection()\n      );\n\n    this.svg\n      .selectAll('.bar-group')\n      .selectAll('.bar')\n      .data((d, i) => {\n        const clone = { ...d };\n        delete clone.key;\n\n        const keys = Object.keys(clone);\n\n        const keyData = keys.map(function (key) {\n          return { label: key, value: d[key], parentIndex: i };\n        });\n\n        return keyData;\n      })\n      .join(\n        (enter) =>\n          enter\n            .append('rect')\n            .attr('class', 'bar')\n            .attr(\n              'fill',\n              (d) => `url(${this._location.path()}#gradient-horizontal-${this.colorRange(d.label).substr(1)})`\n            )\n            .attr('data-color', (d) => this.colorRange(d.label))\n            .attr('data-parent-index', (d) => d.parentIndex)\n            .attr('x', 0)\n            .attr('width', 0)\n            .attr('y', (d) => this.barScale(d.label))\n            .attr('height', this.barScale.bandwidth())\n            .call((enter) => {\n              return enter\n                .attr('pointer-events', 'none')\n                .transition()\n                .duration(0) // 500\n                .attr('width', (d) => this.xAxisScale(d.value))\n                .transition()\n                .attr('pointer-events', 'auto');\n            }),\n        (update) =>\n          update\n            .attr('pointer-events', 'none')\n            .transition()\n            .duration(1000)\n            .attr('width', (d) => this.xAxisScale(d.value))\n            .attr('height', this.barScale.bandwidth())\n            .attr('y', (d) => this.barScale(d.label))\n            .transition()\n            .selection()\n            .attr('pointer-events', 'auto'),\n        (exit) =>\n          exit\n            .transition()\n            .duration(0) // 100\n            .selection()\n            .attr('pointer-events', 'none')\n            .attr('width', 0)\n      )\n      .on('mouseover', (event, data) => this.barMouseOver(event, data))\n      .on('mouseout', (event, data) => this.barMouseOut())\n      .on('click', (event, data) => this.barMouseClick(event, data));\n\n    this.updateLegend();\n\n    this.svg.selectAll('.axis').raise();\n  }\n\n  updateLegend() {\n    // legend\n    if (!this.hideLegend) {\n      const legendData = { ...this.data[0] };\n      delete legendData.key;\n      const legendKeys = Object.keys(legendData).map(function (key) {\n        return { label: key };\n      });\n\n      this.chart\n        .select('.legend')\n        .selectAll('.legend-item')\n        .data(legendKeys)\n        .join(\n          (enter) => {\n            const li = enter.append('li').attr('class', 'legend-item');\n\n            li.insert('span')\n              .attr('class', 'legend-key')\n              .style('background-color', (d) => this.colorRange(d.label));\n\n            li.insert('span', '.legend-item')\n              .attr('class', 'legend-label')\n              .html((d) => {\n                switch (this.legendLabelFormatType) {\n                  case 'number':\n                    return this.legendLabelFormat(d.label);\n\n                  case 'time':\n                    const parsedTime = d3_isoParse(d.label);\n                    return this.legendLabelFormat(parsedTime);\n\n                  default:\n                    return d.label;\n                }\n              });\n\n            return li;\n          },\n          (update) => {\n            update.select('.legend-label').html((d) => {\n              switch (this.legendLabelFormatType) {\n                case 'number':\n                  return this.legendLabelFormat(d.label);\n\n                case 'time':\n                  const parsedTime = d3_isoParse(d.label);\n                  return this.legendLabelFormat(parsedTime);\n\n                default:\n                  return d.label;\n              }\n            });\n\n            return update;\n          },\n          (exit) => exit.remove()\n        )\n        .on('mouseover', (event, data) => this.legendMouseOver(event, data))\n        .on('mouseout', () => this.legendMouseOut())\n        .on('click', (event, data) => this.legendMouseClick(event, data));\n    }\n  }\n\n  barMouseOver = (event, data: PbdsDatavizBarGrouped[]) => {\n    const node = d3_select(event.currentTarget);\n\n    this.chart.selectAll('.bar-group').selectAll('.bar').classed('inactive', true);\n\n    node.classed('inactive', false).style('fill', node.attr('data-color'));\n\n    this.tooltipShow(event, data);\n\n    this.hovered.emit({ event, data });\n  };\n\n  barMouseOut = () => {\n    this.chart.selectAll('.bar').classed('inactive', false).style('fill', null);\n\n    this.tooltipHide();\n  };\n\n  barMouseClick = (event, data) => {\n    this.clicked.emit({ event, data });\n  };\n\n  legendMouseOver = (event, data) => {\n    this.chart\n      .selectAll('.legend-item')\n      .filter((d, i) => d.label !== data.label)\n      .classed('inactive', true);\n\n    this.chart\n      .selectAll('.bar-group')\n      .selectAll('.bar')\n      .filter((d, i) => d.label !== data.label)\n      .classed('inactive', true);\n\n    const bar = this.chart\n      .selectAll('.bar-group')\n      .selectAll('.bar')\n      .filter((d, i) => d.label === data.label)\n      .classed('inactive', null);\n\n    const barColor = bar.attr('data-color');\n\n    bar.style('fill', () => barColor);\n\n    this.hovered.emit({ event, data });\n  };\n\n  legendMouseOut = () => {\n    this.chart.selectAll('.legend-item').classed('inactive', false);\n\n    this.chart.selectAll('.bar-group').selectAll('.bar').classed('inactive', false).style('fill', null);\n  };\n\n  legendMouseClick = (event, data) => {\n    this.clicked.emit({ event, data });\n  };\n\n  private tooltipShow = (event, data) => {\n    const dimensions = event.currentTarget.getBoundingClientRect();\n    const scroll = this._scroll.getScrollPosition();\n    let label;\n\n    switch (this.tooltipLabelFormatType) {\n      case 'number':\n        label = this.tooltipLabelFormat(data.label);\n        break;\n\n      case 'time':\n        const parsedTime = d3_isoParse(data.label);\n        label = this.tooltipLabelFormat(parsedTime);\n        break;\n\n      default:\n        label = data.label;\n    }\n\n    const value =\n      this.tooltipValueFormat === null\n        ? `<div class=\"tooltip-value\">${data.value}</div>`\n        : `<div class=\"tooltip-value\">${this.tooltipValueFormat(data.value)}</div>`;\n\n    this.tooltip.html(\n      `\n        ${label}\n        ${value}\n      `\n    );\n\n    const tooltipOffsetWidth = +this.tooltip.node().offsetWidth / 2;\n    const tooltipOffsetHeight = +this.tooltip.node().offsetHeight;\n    const tooltipTipSize = 8;\n\n    if (this.vertical) {\n      this.tooltip.style('top', `${+scroll[1] + +dimensions.top - tooltipOffsetHeight - tooltipTipSize}px`);\n      this.tooltip.style('left', `${+scroll[0] + +dimensions.left - tooltipOffsetWidth + +dimensions.width / 2}px`);\n    } else {\n      this.tooltip.style('top', `${+scroll[1] + +dimensions.top + +dimensions.height / 2 - tooltipOffsetHeight / 2}px`);\n      this.tooltip.style('left', `${+scroll[0] + +dimensions.right + tooltipTipSize}px`);\n    }\n\n    this.tooltip.style('opacity', 1);\n  };\n\n  private tooltipHide = () => {\n    this.tooltip.style('opacity', 0);\n  };\n\n  private xAxisFormatter = (item) => {\n    switch (this.xAxisFormatType) {\n      case 'number':\n        return this.xAxisFormat(item);\n\n      case 'time':\n        const parseDate = d3_isoParse(item);\n        return this.xAxisFormat(parseDate);\n\n      default:\n        return item;\n    }\n  };\n\n  private yAxisFormatter = (item) => {\n    switch (this.yAxisFormatType) {\n      case 'number':\n        return this.yAxisFormat(item);\n\n      case 'time':\n        const parseDate = d3_isoParse(item);\n        return this.yAxisFormat(parseDate);\n\n      default:\n        return item;\n    }\n  };\n}\n","import {\n  Component,\n  OnInit,\n  Input,\n  ElementRef,\n  HostBinding,\n  OnChanges,\n  SimpleChanges,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  OnDestroy\n} from '@angular/core';\n\nimport { ViewportScroller, Location } from '@angular/common';\n\nimport { select as d3_select } from 'd3-selection';\nimport { scaleOrdinal as d3_scaleOrdinal, scaleLinear as d3_scaleLinear } from 'd3-scale';\nimport { sum as d3_sum } from 'd3-array';\nimport { axisBottom as d3_axisBottom } from 'd3-axis';\nimport { format as d3_format } from 'd3-format';\nimport { timeFormat as d3_timeFormat, isoParse as d3_isoParse } from 'd3-time-format';\nimport { easeLinear as d3_easeLinear } from 'd3-ease';\n\nimport { PbdsDatavizService } from './dataviz.service';\nimport { PbdsDatavizBarSingleHorizontal, PbdsDatavizBarSingleHorizontalCompare } from './dataviz.interfaces';\n\n@Component({\n  selector: 'pbds-dataviz-bar-single-horizontal',\n  template: ``,\n  styles: [],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class PbdsDatavizBarSingleHorizontalComponent implements OnInit, OnDestroy, OnChanges {\n  @HostBinding('class.pbds-chart')\n  chartClass = true;\n\n  @HostBinding('class.pbds-chart-bar-single-horizontal')\n  singleStackedBarClass = true;\n\n  @Input()\n  data: Array<PbdsDatavizBarSingleHorizontal | PbdsDatavizBarSingleHorizontalCompare>;\n\n  @Input()\n  width = 300;\n\n  @Input()\n  height = 40;\n\n  @Input()\n  nullValueText = 'No data available';\n\n  @Input()\n  percentage = false;\n\n  @Input()\n  marginTop = 10;\n\n  @Input()\n  marginRight = 20;\n\n  @Input()\n  marginBottom = 35;\n\n  @Input()\n  marginLeft = 15;\n\n  @Input()\n  barMargin = 2;\n\n  @Input()\n  hideXAxis = false;\n\n  @Input()\n  xAxisTicks = 6;\n\n  @Input()\n  xAxisTitle: string | null = null;\n\n  @Input()\n  xAxisFormatType: 'number' = null;\n\n  @Input()\n  xAxisFormatString = '';\n\n  @Input()\n  xAxisTickLabelSuffix = '';\n\n  @Input()\n  hideXGrid = false;\n\n  @Input()\n  hideLegend = false;\n\n  @Input()\n  hideLegendTooltip = true;\n\n  @Input()\n  legendWidth = 105 + 28; // hardcoded legend width + left margin, do not document until feedback\n\n  @Input()\n  legendPosition: 'right' | 'bottom' = 'bottom';\n\n  @Input()\n  legendLabelFormatType: 'number' | 'time' = null;\n\n  @Input()\n  legendLabelFormatString = '';\n\n  @Input()\n  hideTooltip = false;\n\n  @Input()\n  tooltipLabelFormatType: 'number' | 'time' = null;\n\n  @Input()\n  tooltipLabelFormatString = '';\n\n  @Input()\n  tooltipDateFormatString = '%b %e, %Y';\n\n  @Input()\n  tooltipValueFormatType: 'number' = null;\n\n  @Input()\n  tooltipValueFormatString = '';\n\n  @Input()\n  tooltipValueSuffix = '';\n\n  @Input()\n  tooltipPercentFormatString = '.2%';\n\n  @Input()\n  compareChangeFormatString = '.2%';\n\n  @Input()\n  monochrome = false;\n\n  @Input()\n  theme: 'classic' | 'ocean' | 'sunset' | 'twilight';\n\n  @Output()\n  hovered: EventEmitter<object> = new EventEmitter<object>();\n\n  @Output()\n  clicked: EventEmitter<object> = new EventEmitter<object>();\n\n  private isSingleData = false;\n  private isCompare = false;\n  private chart;\n  private svg;\n  private margin;\n  private colorRange;\n  private barPadding = 40;\n  private xAxisCall;\n  private xAxis;\n  private xAxisScale;\n  private xAxisTickSize: number;\n  private xAxisTickSizeOuter: number;\n  private xAxisFormat;\n  private xAxisTitleMargin: number;\n  private hideXAxisDomain: boolean;\n  private hideXAxisZero: boolean;\n  private hideXAxisTicks: boolean;\n  private xGrid;\n  private xGridCall;\n  private legendLabelFormat;\n  private tooltip;\n  private tooltipLabelFormat;\n  private tooltipValueFormat;\n  private tooltipDateFormat;\n  private tooltipPercentFormat;\n  private tooltipCompareChangeFormat;\n\n  constructor(\n    private _dataviz: PbdsDatavizService,\n    private _element: ElementRef,\n    private _scroll: ViewportScroller,\n    private _location: Location\n  ) {}\n\n  ngOnInit() {\n    this.height = +this.height + this.barPadding;\n\n    this.margin = {\n      top: +this.marginTop,\n      right: +this.marginRight,\n      bottom: +this.marginBottom,\n      left: +this.marginLeft\n    };\n\n    this.isSingleData = this.data.length === 1 ? true : false;\n    this.isCompare = Object.keys(this.data[0]).includes('compareValue');\n\n    // create formatters\n    this.xAxisFormat = this._dataviz.d3Format(this.xAxisFormatType, this.xAxisFormatString);\n    this.legendLabelFormat = this._dataviz.d3Format(this.legendLabelFormatType, this.legendLabelFormatString);\n    this.tooltipValueFormat = this._dataviz.d3Format(this.tooltipValueFormatType, this.tooltipValueFormatString);\n    this.tooltipDateFormat = d3_timeFormat(this.tooltipDateFormatString);\n    this.tooltipPercentFormat = d3_format(this.tooltipPercentFormatString);\n    this.tooltipCompareChangeFormat = d3_format(this.compareChangeFormatString);\n\n    // defaults for all chart types\n    this.hideXAxisZero = false;\n    this.hideXAxisDomain = true;\n    this.hideXAxisTicks = true;\n    this.xAxisTickSize = 8;\n    this.xAxisTickSizeOuter = 0;\n    this.xAxisTitleMargin = this.xAxisTitle ? 20 : 0;\n\n    if (!this.hideLegend && this.legendPosition === 'right') {\n      this.width = +this.width - +this.legendWidth;\n    }\n\n    // create the chart\n    this.chart = d3_select(this._element.nativeElement).attr('aria-hidden', 'true');\n\n    // create chart svg\n    this.svg = this.chart\n      .append('svg')\n      .attr('width', () => {\n        return +this.width + this.margin.left + this.margin.right;\n      })\n      .attr('height', +this.height + this.margin.top + this.margin.bottom + this.xAxisTitleMargin)\n      .attr('class', 'img-fluid')\n      .attr('preserveAspectRatio', 'xMinYMin meet')\n      .attr('viewBox', () => {\n        return `-${this.margin.left} -${this.margin.top} ${+this.width + this.margin.left + this.margin.right} ${\n          +this.height + this.margin.top + this.margin.bottom + this.xAxisTitleMargin\n        }`;\n      });\n\n    // TOOLTIP\n    if (!this.hideTooltip) {\n      this.tooltip = d3_select('body')\n        .append('div')\n        .attr('class', 'pbds-tooltip south')\n        .classed('pbds-tooltip-compare', this.isCompare)\n        .style('opacity', 0)\n        .attr('aria-hidden', 'true'); // hide tooltip for accessibility\n    }\n\n    // add legend classes\n    if (!this.hideLegend && this.data.length > 1) {\n      this.chart.classed('pbds-chart-legend-bottom', this.legendPosition === 'bottom' ? true : false);\n      this.chart.append('ul').attr('class', `legend legend-${this.legendPosition}`);\n    }\n\n    // X AXIS\n    this.xAxisScale = d3_scaleLinear()\n      .domain([0, Math.ceil(d3_sum(this.data, (d: any) => d.value))])\n      .range([0, +this.width]);\n\n    this.xAxisCall = d3_axisBottom(this.xAxisScale)\n      // .tickValues([0, d3_sum(this.data, (d: any) => d.value)])\n      .ticks(this.xAxisTicks)\n      .tickSize(this.xAxisTickSize)\n      .tickSizeOuter(this.xAxisTickSizeOuter)\n      .tickFormat(this.xAxisFormatter);\n\n    this.xAxis = this.svg\n      .append('g')\n      .attr('class', 'axis axis-x')\n      .attr('transform', `translate(0, ${this.height})`)\n      .classed('axis-hidden', this.hideXAxis)\n      .classed('axis-zero-hidden', this.hideXAxisZero)\n      .classed('axis-domain-hidden', this.hideXAxisDomain)\n      .classed('axis-ticks-hidden', this.hideXAxisTicks);\n    // .call(this.xAxisCall);\n\n    // X GRIDLINES\n    if (!this.hideXGrid) {\n      this.xGridCall = d3_axisBottom(this.xAxisScale).tickSize(-this.height);\n\n      this.xGrid = this.svg\n        .append('g')\n        .attr('class', 'grid grid-x')\n        .classed('grid-zero-hidden', this.hideXAxisZero)\n        .attr('transform', `translate(0, ${this.height})`)\n        .call(this.xGridCall);\n    }\n\n    if (this.xAxisTitle) {\n      this.svg\n        .append('text')\n        .attr('class', 'axis-title')\n        .attr('text-anchor', 'center')\n        .attr('x', this.width / 2 - this.margin.left)\n        .attr('y', this.height + this.margin.top + (!this.hideXAxis ? 40 : 0))\n        .text(this.xAxisTitle);\n    }\n\n    // build color ranges\n    let colors;\n\n    if (this.isSingleData) {\n      colors = this._dataviz.createGradientDefs(this.svg, this.monochrome, this.theme, false);\n    } else if (this.monochrome) {\n      colors = this._dataviz.getColors(this.monochrome, this.theme).reverse();\n    } else {\n      colors = this._dataviz.getColors(this.monochrome, this.theme);\n    }\n\n    this.colorRange = d3_scaleOrdinal().range(colors);\n\n    this.updateChart();\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    if (changes.data && !changes.data.firstChange) {\n      this.updateChart();\n    }\n  }\n\n  ngOnDestroy() {\n    if (this.tooltip) this.tooltip.remove();\n  }\n\n  updateChart() {\n    this.isSingleData = this.data.length === 1 ? true : false;\n    this.isCompare = Object.keys(this.data[0]).includes('compareValue');\n\n    const sumValues = d3_sum(this.data, (d: any) => d.value);\n    const isLastBarZero =\n      this.data[this.data.length - 1].value === 0 || this.data[this.data.length - 1].value === null ? true : false;\n\n    let lastBarZeroCount = 0;\n    const cloneData = [...this.data];\n    let isLast = false;\n\n    cloneData.reverse().forEach((value, index, array) => {\n      if ((value.value === 0 || value.value === null) && !isLast) {\n        lastBarZeroCount++;\n      } else {\n        isLast = true;\n      }\n    });\n\n    if (this.percentage && !this.isSingleData) {\n      this.xAxisScale.domain([0, sumValues]).range([0, +this.width]);\n      this.xAxisCall.tickValues([0, sumValues * 0.25, sumValues * 0.5, sumValues * 0.75, sumValues]);\n      this.xAxis.call(this.xAxisCall);\n\n      this.xGridCall.tickValues([0, sumValues * 0.25, sumValues * 0.5, sumValues * 0.75, sumValues]);\n      this.xGrid.call(this.xGridCall);\n\n      this.svg\n        .select('.axis-x')\n        .selectAll('text')\n        .html((d, i) => {\n          const format = d3_format('.0%');\n          return format(i * 0.25);\n        });\n    } else if (this.percentage && this.isSingleData) {\n      this.xAxisScale.domain([0, 1.0]).range([0, +this.width]);\n      this.xAxisCall.tickValues([0, 0.25, 0.5, 0.75, 1.0]);\n      this.xAxis.call(this.xAxisCall);\n\n      this.xGridCall.tickValues([0, 0.25, 0.5, 0.75, 1.0]);\n      this.xGrid.call(this.xGridCall);\n\n      this.svg\n        .select('.axis-x')\n        .selectAll('text')\n        .html((d, i) => {\n          const format = d3_format('.0%');\n          return format(i * 0.25);\n        });\n    } else {\n      this.xAxisScale.domain([0, Math.ceil(sumValues)]).range([0, +this.width]);\n      this.xGridCall.tickValues(this.xAxisScale.ticks().filter((n) => Number.isInteger(n))); // remove decimal grid values\n\n      this.xAxis.transition().duration(1000).call(this.xAxisCall);\n\n      // update the grids\n      if (!this.hideXGrid) {\n        this.xGrid.transition().duration(1000).call(this.xGridCall);\n      }\n    }\n\n    this.svg\n      .selectAll('.bar')\n      .data(this.data)\n      .join(\n        (enter) =>\n          enter\n            .append('rect')\n            .attr('class', 'bar')\n            .attr('width', 0)\n            .attr('height', () => {\n              return this.height - this.barPadding;\n            })\n            .attr('fill', (d) => {\n              if (this.isSingleData) {\n                return `url(${this._location.path()}#gradient-horizontal-${this.colorRange(d.label).substr(1)})`;\n              } else {\n                return this.colorRange(d.label);\n              }\n            })\n            .attr('y', () => {\n              return this.barPadding / 2;\n            })\n            .attr('x', (d, i) => {\n              return this.data.slice(0, i).reduce((acc, item) => {\n                // console.log(acc, item, acc + this.xAxisScale(item.value) + this.barMargin);\n                return +acc + +this.xAxisScale(item.value);\n              }, 1);\n            })\n            .attr('pointer-events', 'none')\n            .call((enter) => {\n              return (\n                enter\n                  .transition()\n                  // .duration(0)\n                  .delay((d, i) => i * 250)\n                  .ease(d3_easeLinear)\n                  .attr('width', (d, i) => {\n                    // debugger;\n                    if (i === this.data.length - lastBarZeroCount - 1 && isLastBarZero) {\n                      return this.xAxisScale(d.value);\n                    } else if (i !== this.data.length - 1) {\n                      let width = this.xAxisScale(d.value) - +this.barMargin;\n                      width = Math.sign(width) === -1 ? 0 : width; // handle negative values\n                      return width;\n                    } else {\n                      return this.xAxisScale(d.value);\n                    }\n                  })\n                  .transition()\n                  .attr('pointer-events', 'auto')\n              );\n            }),\n        (update) =>\n          update\n            .attr('pointer-events', 'none')\n            .transition()\n            .duration(1000)\n            .attr('width', (d, i) => {\n              // debugger;\n              if (d.value === null || d.value === 0) {\n                return this.xAxisScale(0);\n              } else if (i === this.data.length - 1) {\n                return this.xAxisScale(d.value);\n              } else {\n                return this.xAxisScale(d.value) - this.barMargin;\n              }\n            })\n            .attr('x', (d, i) => {\n              return this.data.slice(0, i).reduce((acc, item) => {\n                return acc + +this.xAxisScale(item.value);\n              }, 0);\n            })\n            .transition()\n            .selection()\n            .attr('pointer-events', 'auto'),\n        (exit) => exit.transition().selection().attr('pointer-events', 'none').remove()\n      )\n      .datum((d, i) => {\n        return { data: this.data, index: i };\n      })\n      .on('mouseover', (event, data) => this.barMouseOver(event, data))\n      .on('mouseout', (event, data) => this.barMouseOut())\n      .on('click', (event, data) => this.barMouseClick(event, data));\n\n    if (!this.hideLegend) {\n      this.chart\n        .select('.legend')\n        .selectAll('.legend-item')\n        .data(this.data)\n        .join(\n          (enter) => {\n            const li = enter.append('li').attr('class', 'legend-item').classed('align-items-start', this.isCompare);\n\n            li.insert('span')\n              .attr('class', 'legend-key')\n              .style('background-color', (d) => this.colorRange(d.label))\n              .classed('mt-1', this.isCompare);\n\n            li.insert('span')\n              .attr('class', 'legend-description')\n              .classed('d-flex', this.isCompare)\n              .classed('flex-column', this.isCompare);\n\n            li.select('.legend-description')\n              .insert('span')\n              .attr('class', 'legend-label')\n              .html((d) => {\n                switch (this.legendLabelFormatType) {\n                  case 'number':\n                    return this.legendLabelFormat(d.label);\n\n                  case 'time':\n                    const parsedTime = d3_isoParse(d.label);\n                    return this.legendLabelFormat(parsedTime);\n\n                  default:\n                    return d.label;\n                }\n              });\n\n            li.select('.legend-description')\n              .insert('div')\n              .attr('class', 'legend-change')\n              .classed('d-none', !this.isCompare);\n\n            li.select('.legend-change').html((d) => {\n              return `<div class=\"metric-block-indicator ${d.compareChangeDirection} ${\n                d.compareChangeInverse ? 'inverse' : ''\n              } mt-1\"><span>${this.tooltipCompareChangeFormat(d.compareChangeValue)}</span></div>`;\n            });\n\n            return li;\n          },\n          (update) => {\n            update.classed('align-items-start', this.isCompare);\n            update.select('.legend-key').classed('mt-1', this.isCompare);\n            update.select('.legend-change').classed('d-none', !this.isCompare);\n\n            if (this.isCompare) {\n              update.select('.legend-change').html((d) => {\n                return `<div class=\"metric-block-indicator ${d.compareChangeDirection} ${\n                  d.compareChangeInverse ? 'inverse' : ''\n                } mt-1\"><span>${this.tooltipCompareChangeFormat(d.compareChangeValue)}</span></div>`;\n              });\n            }\n\n            update.select('.legend-label').html((d) => {\n              switch (this.legendLabelFormatType) {\n                case 'number':\n                  return this.legendLabelFormat(d.label);\n\n                case 'time':\n                  const parsedTime = d3_isoParse(d.label);\n                  return this.legendLabelFormat(parsedTime);\n\n                default:\n                  return d.label;\n              }\n            });\n\n            return update;\n          },\n          (exit) => exit.remove()\n        )\n        .datum((d, i) => {\n          return { data: this.data, index: i };\n        })\n        .on('mouseover', (event, data) => this.legendMouseOver(event, data))\n        .on('mouseout', () => this.legendMouseOut())\n        .on('click', (event, data) => this.legendMouseClick(event, data));\n    }\n  }\n\n  barMouseOver = (event, data) => {\n    const node = d3_select(event.currentTarget);\n\n    this.chart.selectAll('.bar').classed('inactive', true);\n\n    node.classed('inactive', false);\n\n    this.chart\n      .selectAll('.legend-item')\n      .filter((d, i) => {\n        // debugger;\n        return i !== data.index;\n      })\n      .classed('inactive', true);\n\n    this.tooltipShow(event, data.data[data.index]);\n\n    this.hovered.emit({ event, data });\n  };\n\n  barMouseOut = () => {\n    this.chart.selectAll('.bar').classed('inactive', false).style('fill', null);\n\n    this.chart.selectAll('.legend-item').classed('inactive', false);\n\n    this.tooltipHide();\n  };\n\n  barMouseClick = (event, data) => {\n    this.clicked.emit({ event, data });\n  };\n\n  private tooltipShow = (event, data, node?) => {\n    const dimensions = node ? node.getBoundingClientRect() : event.currentTarget.getBoundingClientRect();\n    const scroll = this._scroll.getScrollPosition();\n\n    const percentage = data.value / d3_sum(this.data, (d: any) => d.value);\n    const comparePercentage = data.compareValue / d3_sum(this.data, (d: any) => d.compareValue);\n\n    let tooltipLabel = ``;\n    let tooltipCompareDaterangeMargin = ``;\n    let tooltipCompareDaterange = ``;\n    let tooltipCompareValue = ``;\n    let tooltipDaterangeMargin = ``;\n    let tooltipDaterange = ``;\n    let tooltipValue = `${this.nullValueText}`;\n    let tooltipIndicator = '';\n\n    // tooltip label\n    if (!this.isSingleData) {\n      this.tooltip.classed('pbds-tooltip-compare', null);\n\n      switch (this.tooltipLabelFormatType) {\n        case 'number':\n          tooltipLabel = this.tooltipLabelFormat(data.label);\n          break;\n\n        case 'time':\n          const parsedTime = d3_isoParse(data.label);\n          tooltipLabel = this.tooltipLabelFormat(parsedTime);\n          break;\n\n        default:\n          tooltipLabel = data.label;\n      }\n    }\n\n    // tooltip compare daterange\n    if (this.isCompare && data.compareStartDate && data.compareEndDate) {\n      this.tooltip.classed('pbds-tooltip-compare', this.isCompare);\n      tooltipCompareDaterangeMargin = `mt-2`;\n\n      tooltipCompareDaterange = `${this.tooltipDateFormat(\n        d3_isoParse(data.compareStartDate)\n      )} - ${this.tooltipDateFormat(d3_isoParse(data.compareEndDate))}`;\n    }\n\n    // tooltip compare value\n    if (this.percentage && this.isCompare && data.compareValue) {\n      tooltipCompareValue =\n        this.tooltipValueFormat === null\n          ? `${this.tooltipPercentFormat(comparePercentage)} (${data.comparveValue}${this.tooltipValueSuffix})`\n          : `${this.tooltipPercentFormat(comparePercentage)} (${this.tooltipValueFormat(data.compareValue)}${\n              this.tooltipValueSuffix\n            })`;\n    } else if (this.isCompare && data.compareValue !== null) {\n      tooltipCompareValue =\n        this.tooltipValueFormat === null\n          ? `${data.compareValue}${this.tooltipValueSuffix} (${this.tooltipPercentFormat(comparePercentage)})`\n          : `${this.tooltipValueFormat(data.compareValue)}${this.tooltipValueSuffix} (${this.tooltipPercentFormat(\n              comparePercentage\n            )})`;\n    } else if (this.isCompare && data.compareValue === null) {\n      tooltipCompareValue = `${this.nullValueText}`;\n    }\n\n    // tooltip daterange\n    if (data.startDate && data.endDate) {\n      tooltipDaterange = `${this.tooltipDateFormat(d3_isoParse(data.startDate))} - ${this.tooltipDateFormat(\n        d3_isoParse(data.endDate)\n      )}`;\n    }\n\n    //tooltip daterange margin\n    if (tooltipLabel !== '') {\n      tooltipDaterangeMargin = `mt-2`;\n    }\n\n    // tooltip value\n    if (this.isSingleData && this.percentage && data.value) {\n      tooltipValue = this.tooltipValueFormat === null ? `${data.value}` : `${this.tooltipValueFormat(data.value)}`;\n    } else if (this.isSingleData && data.value !== null) {\n      tooltipValue =\n        this.tooltipValueFormat === null\n          ? `${data.value}${this.tooltipValueSuffix}`\n          : `${this.tooltipValueFormat(data.value)}${this.tooltipValueSuffix}`;\n    } else if (!this.isSingleData && this.percentage && data.value !== null) {\n      tooltipValue =\n        this.tooltipValueFormat === null\n          ? `${this.tooltipPercentFormat(percentage)} (${data.value}${this.tooltipValueSuffix})`\n          : `${this.tooltipPercentFormat(percentage)} (${this.tooltipValueFormat(data.value)}${\n              this.tooltipValueSuffix\n            })`;\n    } else if (!this.isSingleData && data.value !== null) {\n      tooltipValue =\n        this.tooltipValueFormat === null\n          ? `${data.value}${this.tooltipValueSuffix} (${this.tooltipPercentFormat(percentage)})`\n          : `${this.tooltipValueFormat(data.value)}${this.tooltipValueSuffix} (${this.tooltipPercentFormat(\n              percentage\n            )})`;\n    }\n\n    // tooltip metric indicator\n    if (!this.isSingleData && this.isCompare && data.value !== null && data.compareValue !== null) {\n      tooltipIndicator = `<div class=\"metric-block-indicator ${data.compareChangeDirection} ${\n        data.compareChangeInverse ? 'inverse' : ''\n      } ml-2\"><span>${this.tooltipCompareChangeFormat(data.compareChangeValue)}</span></div>`;\n    }\n\n    this.tooltip.html(() => {\n      return `\n        <div class=\"tooltip-label font-weight-bold\">${tooltipLabel}</div>\n        <div class=\"${tooltipCompareDaterangeMargin}\">${tooltipCompareDaterange}</div>\n        <div class=\"tooltip-value font-weight-bold\">${tooltipCompareValue}</div>\n        <div class=\"${tooltipDaterangeMargin}\">${tooltipDaterange}</div>\n        <div class=\"tooltip-value\"><span class=\"font-weight-bold\">${tooltipValue}</span> <span>${tooltipIndicator}</span></div>\n      `;\n    });\n\n    const tooltipOffsetWidth = +this.tooltip.node().offsetWidth / 2;\n    const tooltipOffsetHeight = +this.tooltip.node().offsetHeight;\n    const tooltipTipSize = 8;\n\n    this.tooltip.style('top', `${+scroll[1] + +dimensions.top - tooltipOffsetHeight - tooltipTipSize}px`);\n\n    if (this.data.length > 1) {\n      this.tooltip.style('left', `${+scroll[0] + +dimensions.left - tooltipOffsetWidth + +dimensions.width / 2}px`);\n    } else {\n      this.tooltip.style('left', `${+scroll[0] - tooltipOffsetWidth + +dimensions.right}px`);\n    }\n\n    this.tooltip.style('opacity', 1);\n  };\n\n  private tooltipHide = () => {\n    this.tooltip.style('opacity', 0);\n  };\n\n  legendMouseOver = (event, data) => {\n    if (!this.hideLegendTooltip) {\n      const barHover = this.svg\n        .selectAll('.bar')\n        .filter((d, i) => i === data.index)\n        .node();\n\n      this.tooltipShow(event, data.data[data.index], barHover);\n    }\n\n    this.chart\n      .selectAll('.legend-item')\n      .filter((d, i) => i !== data.index)\n      .classed('inactive', true);\n\n    this.chart\n      .selectAll('.bar')\n      .filter((d, i) => i !== data.index)\n      .classed('inactive', true);\n\n    // this.chart\n    //   .selectAll('.bar')\n    //   .filter((d, i) => i === data.index)\n    //   .classed('inactive', null);\n\n    this.hovered.emit({ event, data });\n  };\n\n  legendMouseOut = () => {\n    this.chart.selectAll('.legend-item').classed('inactive', false);\n\n    this.chart.selectAll('.bar').classed('inactive', false).style('fill', null);\n\n    // hide tooltip for zero/null values\n    this.tooltipHide();\n  };\n\n  legendMouseClick = (event, data) => {\n    this.clicked.emit({ event, data });\n  };\n\n  private xAxisFormatter = (item) => {\n    switch (this.xAxisFormatType) {\n      case 'number':\n        return `${this.xAxisFormat(item)}${this.xAxisTickLabelSuffix}`;\n\n      default:\n        return `${item}${this.xAxisTickLabelSuffix}`;\n    }\n  };\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { NgbTooltipModule } from '@ng-bootstrap/ng-bootstrap';\n\nimport { PbdsDatavizPieComponent } from './dataviz-pie.component';\nimport { PbdsDatavizBarComponent } from './dataviz-bar.component';\nimport { PbdsDatavizLineComponent } from './dataviz-line.component';\nimport { PbdsDatavizGaugeComponent } from './dataviz-gauge.component';\nimport { PbdsDatavizSparklineComponent } from './dataviz-sparkline.component';\nimport { PbdsDatavizBarStackedComponent } from './dataviz-bar-stacked.component';\nimport { PbdsDatavizMetricBlockComponent } from './dataviz-metric-block.component';\nimport { PbdsDatavizMetricIndicatorComponent } from './dataviz-metric-indicator.component';\nimport { PbdsDatavizBubbleMapComponent } from './dataviz-bubble-map.component';\nimport { PbdsDatavizHeatmapComponent } from './dataviz-heatmap.component';\nimport { PbdsDatavizChoroplethMapComponent } from './dataviz-choropleth-map.component';\nimport { PbdsDatavizBarGroupedComponent } from './dataviz-bar-grouped.component';\nimport { PbdsDatavizBarSingleHorizontalComponent } from './dataviz-bar-single-horizontal.component';\n\n@NgModule({\n  declarations: [\n    PbdsDatavizPieComponent,\n    PbdsDatavizBarComponent,\n    PbdsDatavizLineComponent,\n    PbdsDatavizGaugeComponent,\n    PbdsDatavizSparklineComponent,\n    PbdsDatavizBarStackedComponent,\n    PbdsDatavizMetricBlockComponent,\n    PbdsDatavizBubbleMapComponent,\n    PbdsDatavizMetricIndicatorComponent,\n    PbdsDatavizHeatmapComponent,\n    PbdsDatavizChoroplethMapComponent,\n    PbdsDatavizBarGroupedComponent,\n    PbdsDatavizBarSingleHorizontalComponent\n  ],\n  imports: [CommonModule, NgbTooltipModule],\n  exports: [\n    PbdsDatavizPieComponent,\n    PbdsDatavizBarComponent,\n    PbdsDatavizLineComponent,\n    PbdsDatavizGaugeComponent,\n    PbdsDatavizSparklineComponent,\n    PbdsDatavizBarStackedComponent,\n    PbdsDatavizMetricBlockComponent,\n    PbdsDatavizBubbleMapComponent,\n    PbdsDatavizMetricIndicatorComponent,\n    PbdsDatavizHeatmapComponent,\n    PbdsDatavizChoroplethMapComponent,\n    PbdsDatavizBarGroupedComponent,\n    PbdsDatavizBarSingleHorizontalComponent\n  ]\n})\nexport class PbdsDatavizModule {}\n"]}